(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();var tf={exports:{}},ga={};var D0;function TT(){if(D0)return ga;D0=1;var l=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,r,a){var u=null;if(a!==void 0&&(u=""+a),r.key!==void 0&&(u=""+r.key),"key"in r){a={};for(var c in r)c!=="key"&&(a[c]=r[c])}else a=r;return r=a.ref,{$$typeof:l,type:s,key:u,ref:r!==void 0?r:null,props:a}}return ga.Fragment=e,ga.jsx=t,ga.jsxs=t,ga}var I0;function xT(){return I0||(I0=1,tf.exports=TT()),tf.exports}var R=xT(),sf={exports:{}},Ae={};var C0;function AT(){if(C0)return Ae;C0=1;var l=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),m=Symbol.for("react.activity"),v=Symbol.iterator;function E(C){return C===null||typeof C!="object"?null:(C=v&&C[v]||C["@@iterator"],typeof C=="function"?C:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,T={};function L(C,F,se){this.props=C,this.context=F,this.refs=T,this.updater=se||S}L.prototype.isReactComponent={},L.prototype.setState=function(C,F){if(typeof C!="object"&&typeof C!="function"&&C!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,C,F,"setState")},L.prototype.forceUpdate=function(C){this.updater.enqueueForceUpdate(this,C,"forceUpdate")};function _(){}_.prototype=L.prototype;function I(C,F,se){this.props=C,this.context=F,this.refs=T,this.updater=se||S}var O=I.prototype=new _;O.constructor=I,x(O,L.prototype),O.isPureReactComponent=!0;var k=Array.isArray;function K(){}var w={H:null,A:null,T:null,S:null},B=Object.prototype.hasOwnProperty;function $(C,F,se){var re=se.ref;return{$$typeof:l,type:C,key:F,ref:re!==void 0?re:null,props:se}}function U(C,F){return $(C.type,F,C.props)}function W(C){return typeof C=="object"&&C!==null&&C.$$typeof===l}function ne(C){var F={"=":"=0",":":"=2"};return"$"+C.replace(/[=:]/g,function(se){return F[se]})}var ce=/\/+/g;function he(C,F){return typeof C=="object"&&C!==null&&C.key!=null?ne(""+C.key):F.toString(36)}function oe(C){switch(C.status){case"fulfilled":return C.value;case"rejected":throw C.reason;default:switch(typeof C.status=="string"?C.then(K,K):(C.status="pending",C.then(function(F){C.status==="pending"&&(C.status="fulfilled",C.value=F)},function(F){C.status==="pending"&&(C.status="rejected",C.reason=F)})),C.status){case"fulfilled":return C.value;case"rejected":throw C.reason}}throw C}function N(C,F,se,re,le){var de=typeof C;(de==="undefined"||de==="boolean")&&(C=null);var Se=!1;if(C===null)Se=!0;else switch(de){case"bigint":case"string":case"number":Se=!0;break;case"object":switch(C.$$typeof){case l:case e:Se=!0;break;case g:return Se=C._init,N(Se(C._payload),F,se,re,le)}}if(Se)return le=le(C),Se=re===""?"."+he(C,0):re,k(le)?(se="",Se!=null&&(se=Se.replace(ce,"$&/")+"/"),N(le,F,se,"",function(Dt){return Dt})):le!=null&&(W(le)&&(le=U(le,se+(le.key==null||C&&C.key===le.key?"":(""+le.key).replace(ce,"$&/")+"/")+Se)),F.push(le)),1;Se=0;var Ne=re===""?".":re+":";if(k(C))for(var ke=0;ke<C.length;ke++)re=C[ke],de=Ne+he(re,ke),Se+=N(re,F,se,de,le);else if(ke=E(C),typeof ke=="function")for(C=ke.call(C),ke=0;!(re=C.next()).done;)re=re.value,de=Ne+he(re,ke++),Se+=N(re,F,se,de,le);else if(de==="object"){if(typeof C.then=="function")return N(oe(C),F,se,re,le);throw F=String(C),Error("Objects are not valid as a React child (found: "+(F==="[object Object]"?"object with keys {"+Object.keys(C).join(", ")+"}":F)+"). If you meant to render a collection of children, use an array instead.")}return Se}function X(C,F,se){if(C==null)return C;var re=[],le=0;return N(C,re,"","",function(de){return F.call(se,de,le++)}),re}function J(C){if(C._status===-1){var F=C._result;F=F(),F.then(function(se){(C._status===0||C._status===-1)&&(C._status=1,C._result=se)},function(se){(C._status===0||C._status===-1)&&(C._status=2,C._result=se)}),C._status===-1&&(C._status=0,C._result=F)}if(C._status===1)return C._result.default;throw C._result}var ae=typeof reportError=="function"?reportError:function(C){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var F=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof C=="object"&&C!==null&&typeof C.message=="string"?String(C.message):String(C),error:C});if(!window.dispatchEvent(F))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",C);return}console.error(C)},ue={map:X,forEach:function(C,F,se){X(C,function(){F.apply(this,arguments)},se)},count:function(C){var F=0;return X(C,function(){F++}),F},toArray:function(C){return X(C,function(F){return F})||[]},only:function(C){if(!W(C))throw Error("React.Children.only expected to receive a single React element child.");return C}};return Ae.Activity=m,Ae.Children=ue,Ae.Component=L,Ae.Fragment=t,Ae.Profiler=r,Ae.PureComponent=I,Ae.StrictMode=s,Ae.Suspense=h,Ae.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=w,Ae.__COMPILER_RUNTIME={__proto__:null,c:function(C){return w.H.useMemoCache(C)}},Ae.cache=function(C){return function(){return C.apply(null,arguments)}},Ae.cacheSignal=function(){return null},Ae.cloneElement=function(C,F,se){if(C==null)throw Error("The argument must be a React element, but you passed "+C+".");var re=x({},C.props),le=C.key;if(F!=null)for(de in F.key!==void 0&&(le=""+F.key),F)!B.call(F,de)||de==="key"||de==="__self"||de==="__source"||de==="ref"&&F.ref===void 0||(re[de]=F[de]);var de=arguments.length-2;if(de===1)re.children=se;else if(1<de){for(var Se=Array(de),Ne=0;Ne<de;Ne++)Se[Ne]=arguments[Ne+2];re.children=Se}return $(C.type,le,re)},Ae.createContext=function(C){return C={$$typeof:u,_currentValue:C,_currentValue2:C,_threadCount:0,Provider:null,Consumer:null},C.Provider=C,C.Consumer={$$typeof:a,_context:C},C},Ae.createElement=function(C,F,se){var re,le={},de=null;if(F!=null)for(re in F.key!==void 0&&(de=""+F.key),F)B.call(F,re)&&re!=="key"&&re!=="__self"&&re!=="__source"&&(le[re]=F[re]);var Se=arguments.length-2;if(Se===1)le.children=se;else if(1<Se){for(var Ne=Array(Se),ke=0;ke<Se;ke++)Ne[ke]=arguments[ke+2];le.children=Ne}if(C&&C.defaultProps)for(re in Se=C.defaultProps,Se)le[re]===void 0&&(le[re]=Se[re]);return $(C,de,le)},Ae.createRef=function(){return{current:null}},Ae.forwardRef=function(C){return{$$typeof:c,render:C}},Ae.isValidElement=W,Ae.lazy=function(C){return{$$typeof:g,_payload:{_status:-1,_result:C},_init:J}},Ae.memo=function(C,F){return{$$typeof:d,type:C,compare:F===void 0?null:F}},Ae.startTransition=function(C){var F=w.T,se={};w.T=se;try{var re=C(),le=w.S;le!==null&&le(se,re),typeof re=="object"&&re!==null&&typeof re.then=="function"&&re.then(K,ae)}catch(de){ae(de)}finally{F!==null&&se.types!==null&&(F.types=se.types),w.T=F}},Ae.unstable_useCacheRefresh=function(){return w.H.useCacheRefresh()},Ae.use=function(C){return w.H.use(C)},Ae.useActionState=function(C,F,se){return w.H.useActionState(C,F,se)},Ae.useCallback=function(C,F){return w.H.useCallback(C,F)},Ae.useContext=function(C){return w.H.useContext(C)},Ae.useDebugValue=function(){},Ae.useDeferredValue=function(C,F){return w.H.useDeferredValue(C,F)},Ae.useEffect=function(C,F){return w.H.useEffect(C,F)},Ae.useEffectEvent=function(C){return w.H.useEffectEvent(C)},Ae.useId=function(){return w.H.useId()},Ae.useImperativeHandle=function(C,F,se){return w.H.useImperativeHandle(C,F,se)},Ae.useInsertionEffect=function(C,F){return w.H.useInsertionEffect(C,F)},Ae.useLayoutEffect=function(C,F){return w.H.useLayoutEffect(C,F)},Ae.useMemo=function(C,F){return w.H.useMemo(C,F)},Ae.useOptimistic=function(C,F){return w.H.useOptimistic(C,F)},Ae.useReducer=function(C,F,se){return w.H.useReducer(C,F,se)},Ae.useRef=function(C){return w.H.useRef(C)},Ae.useState=function(C){return w.H.useState(C)},Ae.useSyncExternalStore=function(C,F,se){return w.H.useSyncExternalStore(C,F,se)},Ae.useTransition=function(){return w.H.useTransition()},Ae.version="19.2.4",Ae}var O0;function id(){return O0||(O0=1,sf.exports=AT()),sf.exports}var Q=id(),nf={exports:{}},ma={},rf={exports:{}},af={};var w0;function bT(){return w0||(w0=1,(function(l){function e(N,X){var J=N.length;N.push(X);e:for(;0<J;){var ae=J-1>>>1,ue=N[ae];if(0<r(ue,X))N[ae]=X,N[J]=ue,J=ae;else break e}}function t(N){return N.length===0?null:N[0]}function s(N){if(N.length===0)return null;var X=N[0],J=N.pop();if(J!==X){N[0]=J;e:for(var ae=0,ue=N.length,C=ue>>>1;ae<C;){var F=2*(ae+1)-1,se=N[F],re=F+1,le=N[re];if(0>r(se,J))re<ue&&0>r(le,se)?(N[ae]=le,N[re]=J,ae=re):(N[ae]=se,N[F]=J,ae=F);else if(re<ue&&0>r(le,J))N[ae]=le,N[re]=J,ae=re;else break e}}return X}function r(N,X){var J=N.sortIndex-X.sortIndex;return J!==0?J:N.id-X.id}if(l.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;l.unstable_now=function(){return a.now()}}else{var u=Date,c=u.now();l.unstable_now=function(){return u.now()-c}}var h=[],d=[],g=1,m=null,v=3,E=!1,S=!1,x=!1,T=!1,L=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function O(N){for(var X=t(d);X!==null;){if(X.callback===null)s(d);else if(X.startTime<=N)s(d),X.sortIndex=X.expirationTime,e(h,X);else break;X=t(d)}}function k(N){if(x=!1,O(N),!S)if(t(h)!==null)S=!0,K||(K=!0,ne());else{var X=t(d);X!==null&&oe(k,X.startTime-N)}}var K=!1,w=-1,B=5,$=-1;function U(){return T?!0:!(l.unstable_now()-$<B)}function W(){if(T=!1,K){var N=l.unstable_now();$=N;var X=!0;try{e:{S=!1,x&&(x=!1,_(w),w=-1),E=!0;var J=v;try{t:{for(O(N),m=t(h);m!==null&&!(m.expirationTime>N&&U());){var ae=m.callback;if(typeof ae=="function"){m.callback=null,v=m.priorityLevel;var ue=ae(m.expirationTime<=N);if(N=l.unstable_now(),typeof ue=="function"){m.callback=ue,O(N),X=!0;break t}m===t(h)&&s(h),O(N)}else s(h);m=t(h)}if(m!==null)X=!0;else{var C=t(d);C!==null&&oe(k,C.startTime-N),X=!1}}break e}finally{m=null,v=J,E=!1}X=void 0}}finally{X?ne():K=!1}}}var ne;if(typeof I=="function")ne=function(){I(W)};else if(typeof MessageChannel<"u"){var ce=new MessageChannel,he=ce.port2;ce.port1.onmessage=W,ne=function(){he.postMessage(null)}}else ne=function(){L(W,0)};function oe(N,X){w=L(function(){N(l.unstable_now())},X)}l.unstable_IdlePriority=5,l.unstable_ImmediatePriority=1,l.unstable_LowPriority=4,l.unstable_NormalPriority=3,l.unstable_Profiling=null,l.unstable_UserBlockingPriority=2,l.unstable_cancelCallback=function(N){N.callback=null},l.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<N?Math.floor(1e3/N):5},l.unstable_getCurrentPriorityLevel=function(){return v},l.unstable_next=function(N){switch(v){case 1:case 2:case 3:var X=3;break;default:X=v}var J=v;v=X;try{return N()}finally{v=J}},l.unstable_requestPaint=function(){T=!0},l.unstable_runWithPriority=function(N,X){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var J=v;v=N;try{return X()}finally{v=J}},l.unstable_scheduleCallback=function(N,X,J){var ae=l.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?ae+J:ae):J=ae,N){case 1:var ue=-1;break;case 2:ue=250;break;case 5:ue=1073741823;break;case 4:ue=1e4;break;default:ue=5e3}return ue=J+ue,N={id:g++,callback:X,priorityLevel:N,startTime:J,expirationTime:ue,sortIndex:-1},J>ae?(N.sortIndex=J,e(d,N),t(h)===null&&N===t(d)&&(x?(_(w),w=-1):x=!0,oe(k,J-ae))):(N.sortIndex=ue,e(h,N),S||E||(S=!0,K||(K=!0,ne()))),N},l.unstable_shouldYield=U,l.unstable_wrapCallback=function(N){var X=v;return function(){var J=v;v=X;try{return N.apply(this,arguments)}finally{v=J}}}})(af)),af}var M0;function LT(){return M0||(M0=1,rf.exports=bT()),rf.exports}var lf={exports:{}},It={};var k0;function RT(){if(k0)return It;k0=1;var l=id();function e(h){var d="https://react.dev/errors/"+h;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)d+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+h+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function a(h,d,g){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:m==null?null:""+m,children:h,containerInfo:d,implementation:g}}var u=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(h,d){if(h==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return It.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,It.createPortal=function(h,d){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return a(h,d,null,g)},It.flushSync=function(h){var d=u.T,g=s.p;try{if(u.T=null,s.p=2,h)return h()}finally{u.T=d,s.p=g,s.d.f()}},It.preconnect=function(h,d){typeof h=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,s.d.C(h,d))},It.prefetchDNS=function(h){typeof h=="string"&&s.d.D(h)},It.preinit=function(h,d){if(typeof h=="string"&&d&&typeof d.as=="string"){var g=d.as,m=c(g,d.crossOrigin),v=typeof d.integrity=="string"?d.integrity:void 0,E=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;g==="style"?s.d.S(h,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:m,integrity:v,fetchPriority:E}):g==="script"&&s.d.X(h,{crossOrigin:m,integrity:v,fetchPriority:E,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},It.preinitModule=function(h,d){if(typeof h=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var g=c(d.as,d.crossOrigin);s.d.M(h,{crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&s.d.M(h)},It.preload=function(h,d){if(typeof h=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var g=d.as,m=c(g,d.crossOrigin);s.d.L(h,g,{crossOrigin:m,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},It.preloadModule=function(h,d){if(typeof h=="string")if(d){var g=c(d.as,d.crossOrigin);s.d.m(h,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else s.d.m(h)},It.requestFormReset=function(h){s.d.r(h)},It.unstable_batchedUpdates=function(h,d){return h(d)},It.useFormState=function(h,d,g){return u.H.useFormState(h,d,g)},It.useFormStatus=function(){return u.H.useHostTransitionStatus()},It.version="19.2.4",It}var N0;function _T(){if(N0)return lf.exports;N0=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(e){console.error(e)}}return l(),lf.exports=RT(),lf.exports}var P0;function DT(){if(P0)return ma;P0=1;var l=LT(),e=id(),t=_T();function s(i){var n="https://react.dev/errors/"+i;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)n+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+i+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function a(i){var n=i,o=i;if(i.alternate)for(;n.return;)n=n.return;else{i=n;do n=i,(n.flags&4098)!==0&&(o=n.return),i=n.return;while(i)}return n.tag===3?o:null}function u(i){if(i.tag===13){var n=i.memoizedState;if(n===null&&(i=i.alternate,i!==null&&(n=i.memoizedState)),n!==null)return n.dehydrated}return null}function c(i){if(i.tag===31){var n=i.memoizedState;if(n===null&&(i=i.alternate,i!==null&&(n=i.memoizedState)),n!==null)return n.dehydrated}return null}function h(i){if(a(i)!==i)throw Error(s(188))}function d(i){var n=i.alternate;if(!n){if(n=a(i),n===null)throw Error(s(188));return n!==i?null:i}for(var o=i,f=n;;){var p=o.return;if(p===null)break;var y=p.alternate;if(y===null){if(f=p.return,f!==null){o=f;continue}break}if(p.child===y.child){for(y=p.child;y;){if(y===o)return h(p),i;if(y===f)return h(p),n;y=y.sibling}throw Error(s(188))}if(o.return!==f.return)o=p,f=y;else{for(var A=!1,D=p.child;D;){if(D===o){A=!0,o=p,f=y;break}if(D===f){A=!0,f=p,o=y;break}D=D.sibling}if(!A){for(D=y.child;D;){if(D===o){A=!0,o=y,f=p;break}if(D===f){A=!0,f=y,o=p;break}D=D.sibling}if(!A)throw Error(s(189))}}if(o.alternate!==f)throw Error(s(190))}if(o.tag!==3)throw Error(s(188));return o.stateNode.current===o?i:n}function g(i){var n=i.tag;if(n===5||n===26||n===27||n===6)return i;for(i=i.child;i!==null;){if(n=g(i),n!==null)return n;i=i.sibling}return null}var m=Object.assign,v=Symbol.for("react.element"),E=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),L=Symbol.for("react.profiler"),_=Symbol.for("react.consumer"),I=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),K=Symbol.for("react.suspense_list"),w=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),$=Symbol.for("react.activity"),U=Symbol.for("react.memo_cache_sentinel"),W=Symbol.iterator;function ne(i){return i===null||typeof i!="object"?null:(i=W&&i[W]||i["@@iterator"],typeof i=="function"?i:null)}var ce=Symbol.for("react.client.reference");function he(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===ce?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case x:return"Fragment";case L:return"Profiler";case T:return"StrictMode";case k:return"Suspense";case K:return"SuspenseList";case $:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case S:return"Portal";case I:return i.displayName||"Context";case _:return(i._context.displayName||"Context")+".Consumer";case O:var n=i.render;return i=i.displayName,i||(i=n.displayName||n.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case w:return n=i.displayName||null,n!==null?n:he(i.type)||"Memo";case B:n=i._payload,i=i._init;try{return he(i(n))}catch{}}return null}var oe=Array.isArray,N=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,J={pending:!1,data:null,method:null,action:null},ae=[],ue=-1;function C(i){return{current:i}}function F(i){0>ue||(i.current=ae[ue],ae[ue]=null,ue--)}function se(i,n){ue++,ae[ue]=i.current,i.current=n}var re=C(null),le=C(null),de=C(null),Se=C(null);function Ne(i,n){switch(se(de,n),se(le,i),se(re,null),n.nodeType){case 9:case 11:i=(i=n.documentElement)&&(i=i.namespaceURI)?Wm(i):0;break;default:if(i=n.tagName,n=n.namespaceURI)n=Wm(n),i=Zm(n,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}F(re),se(re,i)}function ke(){F(re),F(le),F(de)}function Dt(i){i.memoizedState!==null&&se(Se,i);var n=re.current,o=Zm(n,i.type);n!==o&&(se(le,i),se(re,o))}function ni(i){le.current===i&&(F(re),F(le)),Se.current===i&&(F(Se),ca._currentValue=J)}var Er,yn;function Ei(i){if(Er===void 0)try{throw Error()}catch(o){var n=o.stack.trim().match(/\n( *(at )?)/);Er=n&&n[1]||"",yn=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Er+i+yn}var Ma=!1;function Ce(i,n){if(!i||Ma)return"";Ma=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(n){var ie=function(){throw Error()};if(Object.defineProperty(ie.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ie,[])}catch(q){var Y=q}Reflect.construct(i,[],ie)}else{try{ie.call()}catch(q){Y=q}i.call(ie.prototype)}}else{try{throw Error()}catch(q){Y=q}(ie=i())&&typeof ie.catch=="function"&&ie.catch(function(){})}}catch(q){if(q&&Y&&typeof q.stack=="string")return[q.stack,Y.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=f.DetermineComponentFrameRoot(),A=y[0],D=y[1];if(A&&D){var M=A.split(`
`),V=D.split(`
`);for(p=f=0;f<M.length&&!M[f].includes("DetermineComponentFrameRoot");)f++;for(;p<V.length&&!V[p].includes("DetermineComponentFrameRoot");)p++;if(f===M.length||p===V.length)for(f=M.length-1,p=V.length-1;1<=f&&0<=p&&M[f]!==V[p];)p--;for(;1<=f&&0<=p;f--,p--)if(M[f]!==V[p]){if(f!==1||p!==1)do if(f--,p--,0>p||M[f]!==V[p]){var Z=`
`+M[f].replace(" at new "," at ");return i.displayName&&Z.includes("<anonymous>")&&(Z=Z.replace("<anonymous>",i.displayName)),Z}while(1<=f&&0<=p);break}}}finally{Ma=!1,Error.prepareStackTrace=o}return(o=i?i.displayName||i.name:"")?Ei(o):""}function mt(i,n){switch(i.tag){case 26:case 27:case 5:return Ei(i.type);case 16:return Ei("Lazy");case 13:return i.child!==n&&n!==null?Ei("Suspense Fallback"):Ei("Suspense");case 19:return Ei("SuspenseList");case 0:case 15:return Ce(i.type,!1);case 11:return Ce(i.type.render,!1);case 1:return Ce(i.type,!0);case 31:return Ei("Activity");default:return""}}function Ct(i){try{var n="",o=null;do n+=mt(i,o),o=i,i=i.return;while(i);return n}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var Si=Object.prototype.hasOwnProperty,Ot=l.unstable_scheduleCallback,Ri=l.unstable_cancelCallback,$i=l.unstable_shouldYield,ka=l.unstable_requestPaint,pt=l.unstable_now,Na=l.unstable_getCurrentPriorityLevel,ds=l.unstable_ImmediatePriority,Sr=l.unstable_UserBlockingPriority,vn=l.unstable_NormalPriority,Pa=l.unstable_LowPriority,Tr=l.unstable_IdlePriority,Vs=l.log,nE=l.unstable_setDisableYieldValue,xr=null,Ht=null;function hs(i){if(typeof Vs=="function"&&nE(i),Ht&&typeof Ht.setStrictMode=="function")try{Ht.setStrictMode(xr,i)}catch{}}var Kt=Math.clz32?Math.clz32:lE,rE=Math.log,aE=Math.LN2;function lE(i){return i>>>=0,i===0?32:31-(rE(i)/aE|0)|0}var Ua=256,Fa=262144,Ba=4194304;function Ys(i){var n=i&42;if(n!==0)return n;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return i&261888;case 262144:case 524288:case 1048576:case 2097152:return i&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function $a(i,n,o){var f=i.pendingLanes;if(f===0)return 0;var p=0,y=i.suspendedLanes,A=i.pingedLanes;i=i.warmLanes;var D=f&134217727;return D!==0?(f=D&~y,f!==0?p=Ys(f):(A&=D,A!==0?p=Ys(A):o||(o=D&~i,o!==0&&(p=Ys(o))))):(D=f&~y,D!==0?p=Ys(D):A!==0?p=Ys(A):o||(o=f&~i,o!==0&&(p=Ys(o)))),p===0?0:n!==0&&n!==p&&(n&y)===0&&(y=p&-p,o=n&-n,y>=o||y===32&&(o&4194048)!==0)?n:p}function Ar(i,n){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&n)===0}function oE(i,n){switch(i){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wd(){var i=Ba;return Ba<<=1,(Ba&62914560)===0&&(Ba=4194304),i}function Ho(i){for(var n=[],o=0;31>o;o++)n.push(i);return n}function br(i,n){i.pendingLanes|=n,n!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function uE(i,n,o,f,p,y){var A=i.pendingLanes;i.pendingLanes=o,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=o,i.entangledLanes&=o,i.errorRecoveryDisabledLanes&=o,i.shellSuspendCounter=0;var D=i.entanglements,M=i.expirationTimes,V=i.hiddenUpdates;for(o=A&~o;0<o;){var Z=31-Kt(o),ie=1<<Z;D[Z]=0,M[Z]=-1;var Y=V[Z];if(Y!==null)for(V[Z]=null,Z=0;Z<Y.length;Z++){var q=Y[Z];q!==null&&(q.lane&=-536870913)}o&=~ie}f!==0&&Md(i,f,0),y!==0&&p===0&&i.tag!==0&&(i.suspendedLanes|=y&~(A&~n))}function Md(i,n,o){i.pendingLanes|=n,i.suspendedLanes&=~n;var f=31-Kt(n);i.entangledLanes|=n,i.entanglements[f]=i.entanglements[f]|1073741824|o&261930}function kd(i,n){var o=i.entangledLanes|=n;for(i=i.entanglements;o;){var f=31-Kt(o),p=1<<f;p&n|i[f]&n&&(i[f]|=n),o&=~p}}function Nd(i,n){var o=n&-n;return o=(o&42)!==0?1:Ko(o),(o&(i.suspendedLanes|n))!==0?0:o}function Ko(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function zo(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function Pd(){var i=X.p;return i!==0?i:(i=window.event,i===void 0?32:T0(i.type))}function Ud(i,n){var o=X.p;try{return X.p=i,n()}finally{X.p=o}}var gs=Math.random().toString(36).slice(2),St="__reactFiber$"+gs,kt="__reactProps$"+gs,En="__reactContainer$"+gs,Vo="__reactEvents$"+gs,cE="__reactListeners$"+gs,fE="__reactHandles$"+gs,Fd="__reactResources$"+gs,Lr="__reactMarker$"+gs;function Yo(i){delete i[St],delete i[kt],delete i[Vo],delete i[cE],delete i[fE]}function Sn(i){var n=i[St];if(n)return n;for(var o=i.parentNode;o;){if(n=o[En]||o[St]){if(o=n.alternate,n.child!==null||o!==null&&o.child!==null)for(i=r0(i);i!==null;){if(o=i[St])return o;i=r0(i)}return n}i=o,o=i.parentNode}return null}function Tn(i){if(i=i[St]||i[En]){var n=i.tag;if(n===5||n===6||n===13||n===31||n===26||n===27||n===3)return i}return null}function Rr(i){var n=i.tag;if(n===5||n===26||n===27||n===6)return i.stateNode;throw Error(s(33))}function xn(i){var n=i[Fd];return n||(n=i[Fd]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function yt(i){i[Lr]=!0}var Bd=new Set,$d={};function qs(i,n){An(i,n),An(i+"Capture",n)}function An(i,n){for($d[i]=n,i=0;i<n.length;i++)Bd.add(n[i])}var dE=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Gd={},jd={};function hE(i){return Si.call(jd,i)?!0:Si.call(Gd,i)?!1:dE.test(i)?jd[i]=!0:(Gd[i]=!0,!1)}function Ga(i,n,o){if(hE(n))if(o===null)i.removeAttribute(n);else{switch(typeof o){case"undefined":case"function":case"symbol":i.removeAttribute(n);return;case"boolean":var f=n.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){i.removeAttribute(n);return}}i.setAttribute(n,""+o)}}function ja(i,n,o){if(o===null)i.removeAttribute(n);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(n);return}i.setAttribute(n,""+o)}}function Gi(i,n,o,f){if(f===null)i.removeAttribute(o);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(o);return}i.setAttributeNS(n,o,""+f)}}function ri(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Hd(i){var n=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function gE(i,n,o){var f=Object.getOwnPropertyDescriptor(i.constructor.prototype,n);if(!i.hasOwnProperty(n)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var p=f.get,y=f.set;return Object.defineProperty(i,n,{configurable:!0,get:function(){return p.call(this)},set:function(A){o=""+A,y.call(this,A)}}),Object.defineProperty(i,n,{enumerable:f.enumerable}),{getValue:function(){return o},setValue:function(A){o=""+A},stopTracking:function(){i._valueTracker=null,delete i[n]}}}}function qo(i){if(!i._valueTracker){var n=Hd(i)?"checked":"value";i._valueTracker=gE(i,n,""+i[n])}}function Kd(i){if(!i)return!1;var n=i._valueTracker;if(!n)return!0;var o=n.getValue(),f="";return i&&(f=Hd(i)?i.checked?"true":"false":i.value),i=f,i!==o?(n.setValue(i),!0):!1}function Ha(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var mE=/[\n"\\]/g;function ai(i){return i.replace(mE,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function Xo(i,n,o,f,p,y,A,D){i.name="",A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"?i.type=A:i.removeAttribute("type"),n!=null?A==="number"?(n===0&&i.value===""||i.value!=n)&&(i.value=""+ri(n)):i.value!==""+ri(n)&&(i.value=""+ri(n)):A!=="submit"&&A!=="reset"||i.removeAttribute("value"),n!=null?Qo(i,A,ri(n)):o!=null?Qo(i,A,ri(o)):f!=null&&i.removeAttribute("value"),p==null&&y!=null&&(i.defaultChecked=!!y),p!=null&&(i.checked=p&&typeof p!="function"&&typeof p!="symbol"),D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?i.name=""+ri(D):i.removeAttribute("name")}function zd(i,n,o,f,p,y,A,D){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(i.type=y),n!=null||o!=null){if(!(y!=="submit"&&y!=="reset"||n!=null)){qo(i);return}o=o!=null?""+ri(o):"",n=n!=null?""+ri(n):o,D||n===i.value||(i.value=n),i.defaultValue=n}f=f??p,f=typeof f!="function"&&typeof f!="symbol"&&!!f,i.checked=D?i.checked:!!f,i.defaultChecked=!!f,A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"&&(i.name=A),qo(i)}function Qo(i,n,o){n==="number"&&Ha(i.ownerDocument)===i||i.defaultValue===""+o||(i.defaultValue=""+o)}function bn(i,n,o,f){if(i=i.options,n){n={};for(var p=0;p<o.length;p++)n["$"+o[p]]=!0;for(o=0;o<i.length;o++)p=n.hasOwnProperty("$"+i[o].value),i[o].selected!==p&&(i[o].selected=p),p&&f&&(i[o].defaultSelected=!0)}else{for(o=""+ri(o),n=null,p=0;p<i.length;p++){if(i[p].value===o){i[p].selected=!0,f&&(i[p].defaultSelected=!0);return}n!==null||i[p].disabled||(n=i[p])}n!==null&&(n.selected=!0)}}function Vd(i,n,o){if(n!=null&&(n=""+ri(n),n!==i.value&&(i.value=n),o==null)){i.defaultValue!==n&&(i.defaultValue=n);return}i.defaultValue=o!=null?""+ri(o):""}function Yd(i,n,o,f){if(n==null){if(f!=null){if(o!=null)throw Error(s(92));if(oe(f)){if(1<f.length)throw Error(s(93));f=f[0]}o=f}o==null&&(o=""),n=o}o=ri(n),i.defaultValue=o,f=i.textContent,f===o&&f!==""&&f!==null&&(i.value=f),qo(i)}function Ln(i,n){if(n){var o=i.firstChild;if(o&&o===i.lastChild&&o.nodeType===3){o.nodeValue=n;return}}i.textContent=n}var pE=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function qd(i,n,o){var f=n.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?f?i.setProperty(n,""):n==="float"?i.cssFloat="":i[n]="":f?i.setProperty(n,o):typeof o!="number"||o===0||pE.has(n)?n==="float"?i.cssFloat=o:i[n]=(""+o).trim():i[n]=o+"px"}function Xd(i,n,o){if(n!=null&&typeof n!="object")throw Error(s(62));if(i=i.style,o!=null){for(var f in o)!o.hasOwnProperty(f)||n!=null&&n.hasOwnProperty(f)||(f.indexOf("--")===0?i.setProperty(f,""):f==="float"?i.cssFloat="":i[f]="");for(var p in n)f=n[p],n.hasOwnProperty(p)&&o[p]!==f&&qd(i,p,f)}else for(var y in n)n.hasOwnProperty(y)&&qd(i,y,n[y])}function Wo(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var yE=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),vE=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ka(i){return vE.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}function ji(){}var Zo=null;function Jo(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Rn=null,_n=null;function Qd(i){var n=Tn(i);if(n&&(i=n.stateNode)){var o=i[kt]||null;e:switch(i=n.stateNode,n.type){case"input":if(Xo(i,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),n=o.name,o.type==="radio"&&n!=null){for(o=i;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+ai(""+n)+'"][type="radio"]'),n=0;n<o.length;n++){var f=o[n];if(f!==i&&f.form===i.form){var p=f[kt]||null;if(!p)throw Error(s(90));Xo(f,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(n=0;n<o.length;n++)f=o[n],f.form===i.form&&Kd(f)}break e;case"textarea":Vd(i,o.value,o.defaultValue);break e;case"select":n=o.value,n!=null&&bn(i,!!o.multiple,n,!1)}}}var eu=!1;function Wd(i,n,o){if(eu)return i(n,o);eu=!0;try{var f=i(n);return f}finally{if(eu=!1,(Rn!==null||_n!==null)&&(Ol(),Rn&&(n=Rn,i=_n,_n=Rn=null,Qd(n),i)))for(n=0;n<i.length;n++)Qd(i[n])}}function _r(i,n){var o=i.stateNode;if(o===null)return null;var f=o[kt]||null;if(f===null)return null;o=f[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(i=i.type,f=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!f;break e;default:i=!1}if(i)return null;if(o&&typeof o!="function")throw Error(s(231,n,typeof o));return o}var Hi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),tu=!1;if(Hi)try{var Dr={};Object.defineProperty(Dr,"passive",{get:function(){tu=!0}}),window.addEventListener("test",Dr,Dr),window.removeEventListener("test",Dr,Dr)}catch{tu=!1}var ms=null,iu=null,za=null;function Zd(){if(za)return za;var i,n=iu,o=n.length,f,p="value"in ms?ms.value:ms.textContent,y=p.length;for(i=0;i<o&&n[i]===p[i];i++);var A=o-i;for(f=1;f<=A&&n[o-f]===p[y-f];f++);return za=p.slice(i,1<f?1-f:void 0)}function Va(i){var n=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&n===13&&(i=13)):i=n,i===10&&(i=13),32<=i||i===13?i:0}function Ya(){return!0}function Jd(){return!1}function Nt(i){function n(o,f,p,y,A){this._reactName=o,this._targetInst=p,this.type=f,this.nativeEvent=y,this.target=A,this.currentTarget=null;for(var D in i)i.hasOwnProperty(D)&&(o=i[D],this[D]=o?o(y):y[D]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Ya:Jd,this.isPropagationStopped=Jd,this}return m(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=Ya)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=Ya)},persist:function(){},isPersistent:Ya}),n}var Xs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},qa=Nt(Xs),Ir=m({},Xs,{view:0,detail:0}),EE=Nt(Ir),su,nu,Cr,Xa=m({},Ir,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:au,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Cr&&(Cr&&i.type==="mousemove"?(su=i.screenX-Cr.screenX,nu=i.screenY-Cr.screenY):nu=su=0,Cr=i),su)},movementY:function(i){return"movementY"in i?i.movementY:nu}}),eh=Nt(Xa),SE=m({},Xa,{dataTransfer:0}),TE=Nt(SE),xE=m({},Ir,{relatedTarget:0}),ru=Nt(xE),AE=m({},Xs,{animationName:0,elapsedTime:0,pseudoElement:0}),bE=Nt(AE),LE=m({},Xs,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),RE=Nt(LE),_E=m({},Xs,{data:0}),th=Nt(_E),DE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},IE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},CE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function OE(i){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(i):(i=CE[i])?!!n[i]:!1}function au(){return OE}var wE=m({},Ir,{key:function(i){if(i.key){var n=DE[i.key]||i.key;if(n!=="Unidentified")return n}return i.type==="keypress"?(i=Va(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?IE[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:au,charCode:function(i){return i.type==="keypress"?Va(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Va(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),ME=Nt(wE),kE=m({},Xa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ih=Nt(kE),NE=m({},Ir,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:au}),PE=Nt(NE),UE=m({},Xs,{propertyName:0,elapsedTime:0,pseudoElement:0}),FE=Nt(UE),BE=m({},Xa,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),$E=Nt(BE),GE=m({},Xs,{newState:0,oldState:0}),jE=Nt(GE),HE=[9,13,27,32],lu=Hi&&"CompositionEvent"in window,Or=null;Hi&&"documentMode"in document&&(Or=document.documentMode);var KE=Hi&&"TextEvent"in window&&!Or,sh=Hi&&(!lu||Or&&8<Or&&11>=Or),nh=" ",rh=!1;function ah(i,n){switch(i){case"keyup":return HE.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function lh(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Dn=!1;function zE(i,n){switch(i){case"compositionend":return lh(n);case"keypress":return n.which!==32?null:(rh=!0,nh);case"textInput":return i=n.data,i===nh&&rh?null:i;default:return null}}function VE(i,n){if(Dn)return i==="compositionend"||!lu&&ah(i,n)?(i=Zd(),za=iu=ms=null,Dn=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return sh&&n.locale!=="ko"?null:n.data;default:return null}}var YE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function oh(i){var n=i&&i.nodeName&&i.nodeName.toLowerCase();return n==="input"?!!YE[i.type]:n==="textarea"}function uh(i,n,o,f){Rn?_n?_n.push(f):_n=[f]:Rn=f,n=Fl(n,"onChange"),0<n.length&&(o=new qa("onChange","change",null,o,f),i.push({event:o,listeners:n}))}var wr=null,Mr=null;function qE(i){zm(i,0)}function Qa(i){var n=Rr(i);if(Kd(n))return i}function ch(i,n){if(i==="change")return n}var fh=!1;if(Hi){var ou;if(Hi){var uu="oninput"in document;if(!uu){var dh=document.createElement("div");dh.setAttribute("oninput","return;"),uu=typeof dh.oninput=="function"}ou=uu}else ou=!1;fh=ou&&(!document.documentMode||9<document.documentMode)}function hh(){wr&&(wr.detachEvent("onpropertychange",gh),Mr=wr=null)}function gh(i){if(i.propertyName==="value"&&Qa(Mr)){var n=[];uh(n,Mr,i,Jo(i)),Wd(qE,n)}}function XE(i,n,o){i==="focusin"?(hh(),wr=n,Mr=o,wr.attachEvent("onpropertychange",gh)):i==="focusout"&&hh()}function QE(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Qa(Mr)}function WE(i,n){if(i==="click")return Qa(n)}function ZE(i,n){if(i==="input"||i==="change")return Qa(n)}function JE(i,n){return i===n&&(i!==0||1/i===1/n)||i!==i&&n!==n}var zt=typeof Object.is=="function"?Object.is:JE;function kr(i,n){if(zt(i,n))return!0;if(typeof i!="object"||i===null||typeof n!="object"||n===null)return!1;var o=Object.keys(i),f=Object.keys(n);if(o.length!==f.length)return!1;for(f=0;f<o.length;f++){var p=o[f];if(!Si.call(n,p)||!zt(i[p],n[p]))return!1}return!0}function mh(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function ph(i,n){var o=mh(i);i=0;for(var f;o;){if(o.nodeType===3){if(f=i+o.textContent.length,i<=n&&f>=n)return{node:o,offset:n-i};i=f}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=mh(o)}}function yh(i,n){return i&&n?i===n?!0:i&&i.nodeType===3?!1:n&&n.nodeType===3?yh(i,n.parentNode):"contains"in i?i.contains(n):i.compareDocumentPosition?!!(i.compareDocumentPosition(n)&16):!1:!1}function vh(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var n=Ha(i.document);n instanceof i.HTMLIFrameElement;){try{var o=typeof n.contentWindow.location.href=="string"}catch{o=!1}if(o)i=n.contentWindow;else break;n=Ha(i.document)}return n}function cu(i){var n=i&&i.nodeName&&i.nodeName.toLowerCase();return n&&(n==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||n==="textarea"||i.contentEditable==="true")}var eS=Hi&&"documentMode"in document&&11>=document.documentMode,In=null,fu=null,Nr=null,du=!1;function Eh(i,n,o){var f=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;du||In==null||In!==Ha(f)||(f=In,"selectionStart"in f&&cu(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Nr&&kr(Nr,f)||(Nr=f,f=Fl(fu,"onSelect"),0<f.length&&(n=new qa("onSelect","select",null,n,o),i.push({event:n,listeners:f}),n.target=In)))}function Qs(i,n){var o={};return o[i.toLowerCase()]=n.toLowerCase(),o["Webkit"+i]="webkit"+n,o["Moz"+i]="moz"+n,o}var Cn={animationend:Qs("Animation","AnimationEnd"),animationiteration:Qs("Animation","AnimationIteration"),animationstart:Qs("Animation","AnimationStart"),transitionrun:Qs("Transition","TransitionRun"),transitionstart:Qs("Transition","TransitionStart"),transitioncancel:Qs("Transition","TransitionCancel"),transitionend:Qs("Transition","TransitionEnd")},hu={},Sh={};Hi&&(Sh=document.createElement("div").style,"AnimationEvent"in window||(delete Cn.animationend.animation,delete Cn.animationiteration.animation,delete Cn.animationstart.animation),"TransitionEvent"in window||delete Cn.transitionend.transition);function Ws(i){if(hu[i])return hu[i];if(!Cn[i])return i;var n=Cn[i],o;for(o in n)if(n.hasOwnProperty(o)&&o in Sh)return hu[i]=n[o];return i}var Th=Ws("animationend"),xh=Ws("animationiteration"),Ah=Ws("animationstart"),tS=Ws("transitionrun"),iS=Ws("transitionstart"),sS=Ws("transitioncancel"),bh=Ws("transitionend"),Lh=new Map,gu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");gu.push("scrollEnd");function Ti(i,n){Lh.set(i,n),qs(n,[i])}var Wa=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},li=[],On=0,mu=0;function Za(){for(var i=On,n=mu=On=0;n<i;){var o=li[n];li[n++]=null;var f=li[n];li[n++]=null;var p=li[n];li[n++]=null;var y=li[n];if(li[n++]=null,f!==null&&p!==null){var A=f.pending;A===null?p.next=p:(p.next=A.next,A.next=p),f.pending=p}y!==0&&Rh(o,p,y)}}function Ja(i,n,o,f){li[On++]=i,li[On++]=n,li[On++]=o,li[On++]=f,mu|=f,i.lanes|=f,i=i.alternate,i!==null&&(i.lanes|=f)}function pu(i,n,o,f){return Ja(i,n,o,f),el(i)}function Zs(i,n){return Ja(i,null,null,n),el(i)}function Rh(i,n,o){i.lanes|=o;var f=i.alternate;f!==null&&(f.lanes|=o);for(var p=!1,y=i.return;y!==null;)y.childLanes|=o,f=y.alternate,f!==null&&(f.childLanes|=o),y.tag===22&&(i=y.stateNode,i===null||i._visibility&1||(p=!0)),i=y,y=y.return;return i.tag===3?(y=i.stateNode,p&&n!==null&&(p=31-Kt(o),i=y.hiddenUpdates,f=i[p],f===null?i[p]=[n]:f.push(n),n.lane=o|536870912),y):null}function el(i){if(50<sa)throw sa=0,Lc=null,Error(s(185));for(var n=i.return;n!==null;)i=n,n=i.return;return i.tag===3?i.stateNode:null}var wn={};function nS(i,n,o,f){this.tag=i,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vt(i,n,o,f){return new nS(i,n,o,f)}function yu(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Ki(i,n){var o=i.alternate;return o===null?(o=Vt(i.tag,n,i.key,i.mode),o.elementType=i.elementType,o.type=i.type,o.stateNode=i.stateNode,o.alternate=i,i.alternate=o):(o.pendingProps=n,o.type=i.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=i.flags&65011712,o.childLanes=i.childLanes,o.lanes=i.lanes,o.child=i.child,o.memoizedProps=i.memoizedProps,o.memoizedState=i.memoizedState,o.updateQueue=i.updateQueue,n=i.dependencies,o.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},o.sibling=i.sibling,o.index=i.index,o.ref=i.ref,o.refCleanup=i.refCleanup,o}function _h(i,n){i.flags&=65011714;var o=i.alternate;return o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),i}function tl(i,n,o,f,p,y){var A=0;if(f=i,typeof i=="function")yu(i)&&(A=1);else if(typeof i=="string")A=uT(i,o,re.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case $:return i=Vt(31,o,n,p),i.elementType=$,i.lanes=y,i;case x:return Js(o.children,p,y,n);case T:A=8,p|=24;break;case L:return i=Vt(12,o,n,p|2),i.elementType=L,i.lanes=y,i;case k:return i=Vt(13,o,n,p),i.elementType=k,i.lanes=y,i;case K:return i=Vt(19,o,n,p),i.elementType=K,i.lanes=y,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case I:A=10;break e;case _:A=9;break e;case O:A=11;break e;case w:A=14;break e;case B:A=16,f=null;break e}A=29,o=Error(s(130,i===null?"null":typeof i,"")),f=null}return n=Vt(A,o,n,p),n.elementType=i,n.type=f,n.lanes=y,n}function Js(i,n,o,f){return i=Vt(7,i,f,n),i.lanes=o,i}function vu(i,n,o){return i=Vt(6,i,null,n),i.lanes=o,i}function Dh(i){var n=Vt(18,null,null,0);return n.stateNode=i,n}function Eu(i,n,o){return n=Vt(4,i.children!==null?i.children:[],i.key,n),n.lanes=o,n.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},n}var Ih=new WeakMap;function oi(i,n){if(typeof i=="object"&&i!==null){var o=Ih.get(i);return o!==void 0?o:(n={value:i,source:n,stack:Ct(n)},Ih.set(i,n),n)}return{value:i,source:n,stack:Ct(n)}}var Mn=[],kn=0,il=null,Pr=0,ui=[],ci=0,ps=null,_i=1,Di="";function zi(i,n){Mn[kn++]=Pr,Mn[kn++]=il,il=i,Pr=n}function Ch(i,n,o){ui[ci++]=_i,ui[ci++]=Di,ui[ci++]=ps,ps=i;var f=_i;i=Di;var p=32-Kt(f)-1;f&=~(1<<p),o+=1;var y=32-Kt(n)+p;if(30<y){var A=p-p%5;y=(f&(1<<A)-1).toString(32),f>>=A,p-=A,_i=1<<32-Kt(n)+p|o<<p|f,Di=y+i}else _i=1<<y|o<<p|f,Di=i}function Su(i){i.return!==null&&(zi(i,1),Ch(i,1,0))}function Tu(i){for(;i===il;)il=Mn[--kn],Mn[kn]=null,Pr=Mn[--kn],Mn[kn]=null;for(;i===ps;)ps=ui[--ci],ui[ci]=null,Di=ui[--ci],ui[ci]=null,_i=ui[--ci],ui[ci]=null}function Oh(i,n){ui[ci++]=_i,ui[ci++]=Di,ui[ci++]=ps,_i=n.id,Di=n.overflow,ps=i}var Tt=null,Qe=null,Me=!1,ys=null,fi=!1,xu=Error(s(519));function vs(i){var n=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Ur(oi(n,i)),xu}function wh(i){var n=i.stateNode,o=i.type,f=i.memoizedProps;switch(n[St]=i,n[kt]=f,o){case"dialog":Ie("cancel",n),Ie("close",n);break;case"iframe":case"object":case"embed":Ie("load",n);break;case"video":case"audio":for(o=0;o<ra.length;o++)Ie(ra[o],n);break;case"source":Ie("error",n);break;case"img":case"image":case"link":Ie("error",n),Ie("load",n);break;case"details":Ie("toggle",n);break;case"input":Ie("invalid",n),zd(n,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":Ie("invalid",n);break;case"textarea":Ie("invalid",n),Yd(n,f.value,f.defaultValue,f.children)}o=f.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||n.textContent===""+o||f.suppressHydrationWarning===!0||Xm(n.textContent,o)?(f.popover!=null&&(Ie("beforetoggle",n),Ie("toggle",n)),f.onScroll!=null&&Ie("scroll",n),f.onScrollEnd!=null&&Ie("scrollend",n),f.onClick!=null&&(n.onclick=ji),n=!0):n=!1,n||vs(i,!0)}function Mh(i){for(Tt=i.return;Tt;)switch(Tt.tag){case 5:case 31:case 13:fi=!1;return;case 27:case 3:fi=!0;return;default:Tt=Tt.return}}function Nn(i){if(i!==Tt)return!1;if(!Me)return Mh(i),Me=!0,!1;var n=i.tag,o;if((o=n!==3&&n!==27)&&((o=n===5)&&(o=i.type,o=!(o!=="form"&&o!=="button")||$c(i.type,i.memoizedProps)),o=!o),o&&Qe&&vs(i),Mh(i),n===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(s(317));Qe=n0(i)}else if(n===31){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(s(317));Qe=n0(i)}else n===27?(n=Qe,ws(i.type)?(i=zc,zc=null,Qe=i):Qe=n):Qe=Tt?hi(i.stateNode.nextSibling):null;return!0}function en(){Qe=Tt=null,Me=!1}function Au(){var i=ys;return i!==null&&(Bt===null?Bt=i:Bt.push.apply(Bt,i),ys=null),i}function Ur(i){ys===null?ys=[i]:ys.push(i)}var bu=C(null),tn=null,Vi=null;function Es(i,n,o){se(bu,n._currentValue),n._currentValue=o}function Yi(i){i._currentValue=bu.current,F(bu)}function Lu(i,n,o){for(;i!==null;){var f=i.alternate;if((i.childLanes&n)!==n?(i.childLanes|=n,f!==null&&(f.childLanes|=n)):f!==null&&(f.childLanes&n)!==n&&(f.childLanes|=n),i===o)break;i=i.return}}function Ru(i,n,o,f){var p=i.child;for(p!==null&&(p.return=i);p!==null;){var y=p.dependencies;if(y!==null){var A=p.child;y=y.firstContext;e:for(;y!==null;){var D=y;y=p;for(var M=0;M<n.length;M++)if(D.context===n[M]){y.lanes|=o,D=y.alternate,D!==null&&(D.lanes|=o),Lu(y.return,o,i),f||(A=null);break e}y=D.next}}else if(p.tag===18){if(A=p.return,A===null)throw Error(s(341));A.lanes|=o,y=A.alternate,y!==null&&(y.lanes|=o),Lu(A,o,i),A=null}else A=p.child;if(A!==null)A.return=p;else for(A=p;A!==null;){if(A===i){A=null;break}if(p=A.sibling,p!==null){p.return=A.return,A=p;break}A=A.return}p=A}}function Pn(i,n,o,f){i=null;for(var p=n,y=!1;p!==null;){if(!y){if((p.flags&524288)!==0)y=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var A=p.alternate;if(A===null)throw Error(s(387));if(A=A.memoizedProps,A!==null){var D=p.type;zt(p.pendingProps.value,A.value)||(i!==null?i.push(D):i=[D])}}else if(p===Se.current){if(A=p.alternate,A===null)throw Error(s(387));A.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(i!==null?i.push(ca):i=[ca])}p=p.return}i!==null&&Ru(n,i,o,f),n.flags|=262144}function sl(i){for(i=i.firstContext;i!==null;){if(!zt(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function sn(i){tn=i,Vi=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function xt(i){return kh(tn,i)}function nl(i,n){return tn===null&&sn(i),kh(i,n)}function kh(i,n){var o=n._currentValue;if(n={context:n,memoizedValue:o,next:null},Vi===null){if(i===null)throw Error(s(308));Vi=n,i.dependencies={lanes:0,firstContext:n},i.flags|=524288}else Vi=Vi.next=n;return o}var rS=typeof AbortController<"u"?AbortController:function(){var i=[],n=this.signal={aborted:!1,addEventListener:function(o,f){i.push(f)}};this.abort=function(){n.aborted=!0,i.forEach(function(o){return o()})}},aS=l.unstable_scheduleCallback,lS=l.unstable_NormalPriority,ot={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function _u(){return{controller:new rS,data:new Map,refCount:0}}function Fr(i){i.refCount--,i.refCount===0&&aS(lS,function(){i.controller.abort()})}var Br=null,Du=0,Un=0,Fn=null;function oS(i,n){if(Br===null){var o=Br=[];Du=0,Un=Oc(),Fn={status:"pending",value:void 0,then:function(f){o.push(f)}}}return Du++,n.then(Nh,Nh),n}function Nh(){if(--Du===0&&Br!==null){Fn!==null&&(Fn.status="fulfilled");var i=Br;Br=null,Un=0,Fn=null;for(var n=0;n<i.length;n++)(0,i[n])()}}function uS(i,n){var o=[],f={status:"pending",value:null,reason:null,then:function(p){o.push(p)}};return i.then(function(){f.status="fulfilled",f.value=n;for(var p=0;p<o.length;p++)(0,o[p])(n)},function(p){for(f.status="rejected",f.reason=p,p=0;p<o.length;p++)(0,o[p])(void 0)}),f}var Ph=N.S;N.S=function(i,n){Em=pt(),typeof n=="object"&&n!==null&&typeof n.then=="function"&&oS(i,n),Ph!==null&&Ph(i,n)};var nn=C(null);function Iu(){var i=nn.current;return i!==null?i:Ye.pooledCache}function rl(i,n){n===null?se(nn,nn.current):se(nn,n.pool)}function Uh(){var i=Iu();return i===null?null:{parent:ot._currentValue,pool:i}}var Bn=Error(s(460)),Cu=Error(s(474)),al=Error(s(542)),ll={then:function(){}};function Fh(i){return i=i.status,i==="fulfilled"||i==="rejected"}function Bh(i,n,o){switch(o=i[o],o===void 0?i.push(n):o!==n&&(n.then(ji,ji),n=o),n.status){case"fulfilled":return n.value;case"rejected":throw i=n.reason,Gh(i),i;default:if(typeof n.status=="string")n.then(ji,ji);else{if(i=Ye,i!==null&&100<i.shellSuspendCounter)throw Error(s(482));i=n,i.status="pending",i.then(function(f){if(n.status==="pending"){var p=n;p.status="fulfilled",p.value=f}},function(f){if(n.status==="pending"){var p=n;p.status="rejected",p.reason=f}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw i=n.reason,Gh(i),i}throw an=n,Bn}}function rn(i){try{var n=i._init;return n(i._payload)}catch(o){throw o!==null&&typeof o=="object"&&typeof o.then=="function"?(an=o,Bn):o}}var an=null;function $h(){if(an===null)throw Error(s(459));var i=an;return an=null,i}function Gh(i){if(i===Bn||i===al)throw Error(s(483))}var $n=null,$r=0;function ol(i){var n=$r;return $r+=1,$n===null&&($n=[]),Bh($n,i,n)}function Gr(i,n){n=n.props.ref,i.ref=n!==void 0?n:null}function ul(i,n){throw n.$$typeof===v?Error(s(525)):(i=Object.prototype.toString.call(n),Error(s(31,i==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":i)))}function jh(i){function n(G,P){if(i){var z=G.deletions;z===null?(G.deletions=[P],G.flags|=16):z.push(P)}}function o(G,P){if(!i)return null;for(;P!==null;)n(G,P),P=P.sibling;return null}function f(G){for(var P=new Map;G!==null;)G.key!==null?P.set(G.key,G):P.set(G.index,G),G=G.sibling;return P}function p(G,P){return G=Ki(G,P),G.index=0,G.sibling=null,G}function y(G,P,z){return G.index=z,i?(z=G.alternate,z!==null?(z=z.index,z<P?(G.flags|=67108866,P):z):(G.flags|=67108866,P)):(G.flags|=1048576,P)}function A(G){return i&&G.alternate===null&&(G.flags|=67108866),G}function D(G,P,z,te){return P===null||P.tag!==6?(P=vu(z,G.mode,te),P.return=G,P):(P=p(P,z),P.return=G,P)}function M(G,P,z,te){var ve=z.type;return ve===x?Z(G,P,z.props.children,te,z.key):P!==null&&(P.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===B&&rn(ve)===P.type)?(P=p(P,z.props),Gr(P,z),P.return=G,P):(P=tl(z.type,z.key,z.props,null,G.mode,te),Gr(P,z),P.return=G,P)}function V(G,P,z,te){return P===null||P.tag!==4||P.stateNode.containerInfo!==z.containerInfo||P.stateNode.implementation!==z.implementation?(P=Eu(z,G.mode,te),P.return=G,P):(P=p(P,z.children||[]),P.return=G,P)}function Z(G,P,z,te,ve){return P===null||P.tag!==7?(P=Js(z,G.mode,te,ve),P.return=G,P):(P=p(P,z),P.return=G,P)}function ie(G,P,z){if(typeof P=="string"&&P!==""||typeof P=="number"||typeof P=="bigint")return P=vu(""+P,G.mode,z),P.return=G,P;if(typeof P=="object"&&P!==null){switch(P.$$typeof){case E:return z=tl(P.type,P.key,P.props,null,G.mode,z),Gr(z,P),z.return=G,z;case S:return P=Eu(P,G.mode,z),P.return=G,P;case B:return P=rn(P),ie(G,P,z)}if(oe(P)||ne(P))return P=Js(P,G.mode,z,null),P.return=G,P;if(typeof P.then=="function")return ie(G,ol(P),z);if(P.$$typeof===I)return ie(G,nl(G,P),z);ul(G,P)}return null}function Y(G,P,z,te){var ve=P!==null?P.key:null;if(typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint")return ve!==null?null:D(G,P,""+z,te);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case E:return z.key===ve?M(G,P,z,te):null;case S:return z.key===ve?V(G,P,z,te):null;case B:return z=rn(z),Y(G,P,z,te)}if(oe(z)||ne(z))return ve!==null?null:Z(G,P,z,te,null);if(typeof z.then=="function")return Y(G,P,ol(z),te);if(z.$$typeof===I)return Y(G,P,nl(G,z),te);ul(G,z)}return null}function q(G,P,z,te,ve){if(typeof te=="string"&&te!==""||typeof te=="number"||typeof te=="bigint")return G=G.get(z)||null,D(P,G,""+te,ve);if(typeof te=="object"&&te!==null){switch(te.$$typeof){case E:return G=G.get(te.key===null?z:te.key)||null,M(P,G,te,ve);case S:return G=G.get(te.key===null?z:te.key)||null,V(P,G,te,ve);case B:return te=rn(te),q(G,P,z,te,ve)}if(oe(te)||ne(te))return G=G.get(z)||null,Z(P,G,te,ve,null);if(typeof te.then=="function")return q(G,P,z,ol(te),ve);if(te.$$typeof===I)return q(G,P,z,nl(P,te),ve);ul(P,te)}return null}function me(G,P,z,te){for(var ve=null,Pe=null,pe=P,Le=P=0,we=null;pe!==null&&Le<z.length;Le++){pe.index>Le?(we=pe,pe=null):we=pe.sibling;var Ue=Y(G,pe,z[Le],te);if(Ue===null){pe===null&&(pe=we);break}i&&pe&&Ue.alternate===null&&n(G,pe),P=y(Ue,P,Le),Pe===null?ve=Ue:Pe.sibling=Ue,Pe=Ue,pe=we}if(Le===z.length)return o(G,pe),Me&&zi(G,Le),ve;if(pe===null){for(;Le<z.length;Le++)pe=ie(G,z[Le],te),pe!==null&&(P=y(pe,P,Le),Pe===null?ve=pe:Pe.sibling=pe,Pe=pe);return Me&&zi(G,Le),ve}for(pe=f(pe);Le<z.length;Le++)we=q(pe,G,Le,z[Le],te),we!==null&&(i&&we.alternate!==null&&pe.delete(we.key===null?Le:we.key),P=y(we,P,Le),Pe===null?ve=we:Pe.sibling=we,Pe=we);return i&&pe.forEach(function(Us){return n(G,Us)}),Me&&zi(G,Le),ve}function Ee(G,P,z,te){if(z==null)throw Error(s(151));for(var ve=null,Pe=null,pe=P,Le=P=0,we=null,Ue=z.next();pe!==null&&!Ue.done;Le++,Ue=z.next()){pe.index>Le?(we=pe,pe=null):we=pe.sibling;var Us=Y(G,pe,Ue.value,te);if(Us===null){pe===null&&(pe=we);break}i&&pe&&Us.alternate===null&&n(G,pe),P=y(Us,P,Le),Pe===null?ve=Us:Pe.sibling=Us,Pe=Us,pe=we}if(Ue.done)return o(G,pe),Me&&zi(G,Le),ve;if(pe===null){for(;!Ue.done;Le++,Ue=z.next())Ue=ie(G,Ue.value,te),Ue!==null&&(P=y(Ue,P,Le),Pe===null?ve=Ue:Pe.sibling=Ue,Pe=Ue);return Me&&zi(G,Le),ve}for(pe=f(pe);!Ue.done;Le++,Ue=z.next())Ue=q(pe,G,Le,Ue.value,te),Ue!==null&&(i&&Ue.alternate!==null&&pe.delete(Ue.key===null?Le:Ue.key),P=y(Ue,P,Le),Pe===null?ve=Ue:Pe.sibling=Ue,Pe=Ue);return i&&pe.forEach(function(ST){return n(G,ST)}),Me&&zi(G,Le),ve}function ze(G,P,z,te){if(typeof z=="object"&&z!==null&&z.type===x&&z.key===null&&(z=z.props.children),typeof z=="object"&&z!==null){switch(z.$$typeof){case E:e:{for(var ve=z.key;P!==null;){if(P.key===ve){if(ve=z.type,ve===x){if(P.tag===7){o(G,P.sibling),te=p(P,z.props.children),te.return=G,G=te;break e}}else if(P.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===B&&rn(ve)===P.type){o(G,P.sibling),te=p(P,z.props),Gr(te,z),te.return=G,G=te;break e}o(G,P);break}else n(G,P);P=P.sibling}z.type===x?(te=Js(z.props.children,G.mode,te,z.key),te.return=G,G=te):(te=tl(z.type,z.key,z.props,null,G.mode,te),Gr(te,z),te.return=G,G=te)}return A(G);case S:e:{for(ve=z.key;P!==null;){if(P.key===ve)if(P.tag===4&&P.stateNode.containerInfo===z.containerInfo&&P.stateNode.implementation===z.implementation){o(G,P.sibling),te=p(P,z.children||[]),te.return=G,G=te;break e}else{o(G,P);break}else n(G,P);P=P.sibling}te=Eu(z,G.mode,te),te.return=G,G=te}return A(G);case B:return z=rn(z),ze(G,P,z,te)}if(oe(z))return me(G,P,z,te);if(ne(z)){if(ve=ne(z),typeof ve!="function")throw Error(s(150));return z=ve.call(z),Ee(G,P,z,te)}if(typeof z.then=="function")return ze(G,P,ol(z),te);if(z.$$typeof===I)return ze(G,P,nl(G,z),te);ul(G,z)}return typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint"?(z=""+z,P!==null&&P.tag===6?(o(G,P.sibling),te=p(P,z),te.return=G,G=te):(o(G,P),te=vu(z,G.mode,te),te.return=G,G=te),A(G)):o(G,P)}return function(G,P,z,te){try{$r=0;var ve=ze(G,P,z,te);return $n=null,ve}catch(pe){if(pe===Bn||pe===al)throw pe;var Pe=Vt(29,pe,null,G.mode);return Pe.lanes=te,Pe.return=G,Pe}}}var ln=jh(!0),Hh=jh(!1),Ss=!1;function Ou(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function wu(i,n){i=i.updateQueue,n.updateQueue===i&&(n.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function Ts(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function xs(i,n,o){var f=i.updateQueue;if(f===null)return null;if(f=f.shared,(Fe&2)!==0){var p=f.pending;return p===null?n.next=n:(n.next=p.next,p.next=n),f.pending=n,n=el(i),Rh(i,null,o),n}return Ja(i,f,n,o),el(i)}function jr(i,n,o){if(n=n.updateQueue,n!==null&&(n=n.shared,(o&4194048)!==0)){var f=n.lanes;f&=i.pendingLanes,o|=f,n.lanes=o,kd(i,o)}}function Mu(i,n){var o=i.updateQueue,f=i.alternate;if(f!==null&&(f=f.updateQueue,o===f)){var p=null,y=null;if(o=o.firstBaseUpdate,o!==null){do{var A={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};y===null?p=y=A:y=y.next=A,o=o.next}while(o!==null);y===null?p=y=n:y=y.next=n}else p=y=n;o={baseState:f.baseState,firstBaseUpdate:p,lastBaseUpdate:y,shared:f.shared,callbacks:f.callbacks},i.updateQueue=o;return}i=o.lastBaseUpdate,i===null?o.firstBaseUpdate=n:i.next=n,o.lastBaseUpdate=n}var ku=!1;function Hr(){if(ku){var i=Fn;if(i!==null)throw i}}function Kr(i,n,o,f){ku=!1;var p=i.updateQueue;Ss=!1;var y=p.firstBaseUpdate,A=p.lastBaseUpdate,D=p.shared.pending;if(D!==null){p.shared.pending=null;var M=D,V=M.next;M.next=null,A===null?y=V:A.next=V,A=M;var Z=i.alternate;Z!==null&&(Z=Z.updateQueue,D=Z.lastBaseUpdate,D!==A&&(D===null?Z.firstBaseUpdate=V:D.next=V,Z.lastBaseUpdate=M))}if(y!==null){var ie=p.baseState;A=0,Z=V=M=null,D=y;do{var Y=D.lane&-536870913,q=Y!==D.lane;if(q?(Oe&Y)===Y:(f&Y)===Y){Y!==0&&Y===Un&&(ku=!0),Z!==null&&(Z=Z.next={lane:0,tag:D.tag,payload:D.payload,callback:null,next:null});e:{var me=i,Ee=D;Y=n;var ze=o;switch(Ee.tag){case 1:if(me=Ee.payload,typeof me=="function"){ie=me.call(ze,ie,Y);break e}ie=me;break e;case 3:me.flags=me.flags&-65537|128;case 0:if(me=Ee.payload,Y=typeof me=="function"?me.call(ze,ie,Y):me,Y==null)break e;ie=m({},ie,Y);break e;case 2:Ss=!0}}Y=D.callback,Y!==null&&(i.flags|=64,q&&(i.flags|=8192),q=p.callbacks,q===null?p.callbacks=[Y]:q.push(Y))}else q={lane:Y,tag:D.tag,payload:D.payload,callback:D.callback,next:null},Z===null?(V=Z=q,M=ie):Z=Z.next=q,A|=Y;if(D=D.next,D===null){if(D=p.shared.pending,D===null)break;q=D,D=q.next,q.next=null,p.lastBaseUpdate=q,p.shared.pending=null}}while(!0);Z===null&&(M=ie),p.baseState=M,p.firstBaseUpdate=V,p.lastBaseUpdate=Z,y===null&&(p.shared.lanes=0),_s|=A,i.lanes=A,i.memoizedState=ie}}function Kh(i,n){if(typeof i!="function")throw Error(s(191,i));i.call(n)}function zh(i,n){var o=i.callbacks;if(o!==null)for(i.callbacks=null,i=0;i<o.length;i++)Kh(o[i],n)}var Gn=C(null),cl=C(0);function Vh(i,n){i=is,se(cl,i),se(Gn,n),is=i|n.baseLanes}function Nu(){se(cl,is),se(Gn,Gn.current)}function Pu(){is=cl.current,F(Gn),F(cl)}var Yt=C(null),di=null;function As(i){var n=i.alternate;se(rt,rt.current&1),se(Yt,i),di===null&&(n===null||Gn.current!==null||n.memoizedState!==null)&&(di=i)}function Uu(i){se(rt,rt.current),se(Yt,i),di===null&&(di=i)}function Yh(i){i.tag===22?(se(rt,rt.current),se(Yt,i),di===null&&(di=i)):bs()}function bs(){se(rt,rt.current),se(Yt,Yt.current)}function qt(i){F(Yt),di===i&&(di=null),F(rt)}var rt=C(0);function fl(i){for(var n=i;n!==null;){if(n.tag===13){var o=n.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||Hc(o)||Kc(o)))return n}else if(n.tag===19&&(n.memoizedProps.revealOrder==="forwards"||n.memoizedProps.revealOrder==="backwards"||n.memoizedProps.revealOrder==="unstable_legacy-backwards"||n.memoizedProps.revealOrder==="together")){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break;for(;n.sibling===null;){if(n.return===null||n.return===i)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var qi=0,be=null,He=null,ut=null,dl=!1,jn=!1,on=!1,hl=0,zr=0,Hn=null,cS=0;function it(){throw Error(s(321))}function Fu(i,n){if(n===null)return!1;for(var o=0;o<n.length&&o<i.length;o++)if(!zt(i[o],n[o]))return!1;return!0}function Bu(i,n,o,f,p,y){return qi=y,be=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,N.H=i===null||i.memoizedState===null?Cg:ec,on=!1,y=o(f,p),on=!1,jn&&(y=Xh(n,o,f,p)),qh(i),y}function qh(i){N.H=qr;var n=He!==null&&He.next!==null;if(qi=0,ut=He=be=null,dl=!1,zr=0,Hn=null,n)throw Error(s(300));i===null||ct||(i=i.dependencies,i!==null&&sl(i)&&(ct=!0))}function Xh(i,n,o,f){be=i;var p=0;do{if(jn&&(Hn=null),zr=0,jn=!1,25<=p)throw Error(s(301));if(p+=1,ut=He=null,i.updateQueue!=null){var y=i.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}N.H=Og,y=n(o,f)}while(jn);return y}function fS(){var i=N.H,n=i.useState()[0];return n=typeof n.then=="function"?Vr(n):n,i=i.useState()[0],(He!==null?He.memoizedState:null)!==i&&(be.flags|=1024),n}function $u(){var i=hl!==0;return hl=0,i}function Gu(i,n,o){n.updateQueue=i.updateQueue,n.flags&=-2053,i.lanes&=~o}function ju(i){if(dl){for(i=i.memoizedState;i!==null;){var n=i.queue;n!==null&&(n.pending=null),i=i.next}dl=!1}qi=0,ut=He=be=null,jn=!1,zr=hl=0,Hn=null}function wt(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ut===null?be.memoizedState=ut=i:ut=ut.next=i,ut}function at(){if(He===null){var i=be.alternate;i=i!==null?i.memoizedState:null}else i=He.next;var n=ut===null?be.memoizedState:ut.next;if(n!==null)ut=n,He=i;else{if(i===null)throw be.alternate===null?Error(s(467)):Error(s(310));He=i,i={memoizedState:He.memoizedState,baseState:He.baseState,baseQueue:He.baseQueue,queue:He.queue,next:null},ut===null?be.memoizedState=ut=i:ut=ut.next=i}return ut}function gl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Vr(i){var n=zr;return zr+=1,Hn===null&&(Hn=[]),i=Bh(Hn,i,n),n=be,(ut===null?n.memoizedState:ut.next)===null&&(n=n.alternate,N.H=n===null||n.memoizedState===null?Cg:ec),i}function ml(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Vr(i);if(i.$$typeof===I)return xt(i)}throw Error(s(438,String(i)))}function Hu(i){var n=null,o=be.updateQueue;if(o!==null&&(n=o.memoCache),n==null){var f=be.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(n={data:f.data.map(function(p){return p.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),o===null&&(o=gl(),be.updateQueue=o),o.memoCache=n,o=n.data[n.index],o===void 0)for(o=n.data[n.index]=Array(i),f=0;f<i;f++)o[f]=U;return n.index++,o}function Xi(i,n){return typeof n=="function"?n(i):n}function pl(i){var n=at();return Ku(n,He,i)}function Ku(i,n,o){var f=i.queue;if(f===null)throw Error(s(311));f.lastRenderedReducer=o;var p=i.baseQueue,y=f.pending;if(y!==null){if(p!==null){var A=p.next;p.next=y.next,y.next=A}n.baseQueue=p=y,f.pending=null}if(y=i.baseState,p===null)i.memoizedState=y;else{n=p.next;var D=A=null,M=null,V=n,Z=!1;do{var ie=V.lane&-536870913;if(ie!==V.lane?(Oe&ie)===ie:(qi&ie)===ie){var Y=V.revertLane;if(Y===0)M!==null&&(M=M.next={lane:0,revertLane:0,gesture:null,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null}),ie===Un&&(Z=!0);else if((qi&Y)===Y){V=V.next,Y===Un&&(Z=!0);continue}else ie={lane:0,revertLane:V.revertLane,gesture:null,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null},M===null?(D=M=ie,A=y):M=M.next=ie,be.lanes|=Y,_s|=Y;ie=V.action,on&&o(y,ie),y=V.hasEagerState?V.eagerState:o(y,ie)}else Y={lane:ie,revertLane:V.revertLane,gesture:V.gesture,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null},M===null?(D=M=Y,A=y):M=M.next=Y,be.lanes|=ie,_s|=ie;V=V.next}while(V!==null&&V!==n);if(M===null?A=y:M.next=D,!zt(y,i.memoizedState)&&(ct=!0,Z&&(o=Fn,o!==null)))throw o;i.memoizedState=y,i.baseState=A,i.baseQueue=M,f.lastRenderedState=y}return p===null&&(f.lanes=0),[i.memoizedState,f.dispatch]}function zu(i){var n=at(),o=n.queue;if(o===null)throw Error(s(311));o.lastRenderedReducer=i;var f=o.dispatch,p=o.pending,y=n.memoizedState;if(p!==null){o.pending=null;var A=p=p.next;do y=i(y,A.action),A=A.next;while(A!==p);zt(y,n.memoizedState)||(ct=!0),n.memoizedState=y,n.baseQueue===null&&(n.baseState=y),o.lastRenderedState=y}return[y,f]}function Qh(i,n,o){var f=be,p=at(),y=Me;if(y){if(o===void 0)throw Error(s(407));o=o()}else o=n();var A=!zt((He||p).memoizedState,o);if(A&&(p.memoizedState=o,ct=!0),p=p.queue,qu(Jh.bind(null,f,p,i),[i]),p.getSnapshot!==n||A||ut!==null&&ut.memoizedState.tag&1){if(f.flags|=2048,Kn(9,{destroy:void 0},Zh.bind(null,f,p,o,n),null),Ye===null)throw Error(s(349));y||(qi&127)!==0||Wh(f,n,o)}return o}function Wh(i,n,o){i.flags|=16384,i={getSnapshot:n,value:o},n=be.updateQueue,n===null?(n=gl(),be.updateQueue=n,n.stores=[i]):(o=n.stores,o===null?n.stores=[i]:o.push(i))}function Zh(i,n,o,f){n.value=o,n.getSnapshot=f,eg(n)&&tg(i)}function Jh(i,n,o){return o(function(){eg(n)&&tg(i)})}function eg(i){var n=i.getSnapshot;i=i.value;try{var o=n();return!zt(i,o)}catch{return!0}}function tg(i){var n=Zs(i,2);n!==null&&$t(n,i,2)}function Vu(i){var n=wt();if(typeof i=="function"){var o=i;if(i=o(),on){hs(!0);try{o()}finally{hs(!1)}}}return n.memoizedState=n.baseState=i,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Xi,lastRenderedState:i},n}function ig(i,n,o,f){return i.baseState=o,Ku(i,He,typeof f=="function"?f:Xi)}function dS(i,n,o,f,p){if(El(i))throw Error(s(485));if(i=n.action,i!==null){var y={payload:p,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(A){y.listeners.push(A)}};N.T!==null?o(!0):y.isTransition=!1,f(y),o=n.pending,o===null?(y.next=n.pending=y,sg(n,y)):(y.next=o.next,n.pending=o.next=y)}}function sg(i,n){var o=n.action,f=n.payload,p=i.state;if(n.isTransition){var y=N.T,A={};N.T=A;try{var D=o(p,f),M=N.S;M!==null&&M(A,D),ng(i,n,D)}catch(V){Yu(i,n,V)}finally{y!==null&&A.types!==null&&(y.types=A.types),N.T=y}}else try{y=o(p,f),ng(i,n,y)}catch(V){Yu(i,n,V)}}function ng(i,n,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(f){rg(i,n,f)},function(f){return Yu(i,n,f)}):rg(i,n,o)}function rg(i,n,o){n.status="fulfilled",n.value=o,ag(n),i.state=o,n=i.pending,n!==null&&(o=n.next,o===n?i.pending=null:(o=o.next,n.next=o,sg(i,o)))}function Yu(i,n,o){var f=i.pending;if(i.pending=null,f!==null){f=f.next;do n.status="rejected",n.reason=o,ag(n),n=n.next;while(n!==f)}i.action=null}function ag(i){i=i.listeners;for(var n=0;n<i.length;n++)(0,i[n])()}function lg(i,n){return n}function og(i,n){if(Me){var o=Ye.formState;if(o!==null){e:{var f=be;if(Me){if(Qe){t:{for(var p=Qe,y=fi;p.nodeType!==8;){if(!y){p=null;break t}if(p=hi(p.nextSibling),p===null){p=null;break t}}y=p.data,p=y==="F!"||y==="F"?p:null}if(p){Qe=hi(p.nextSibling),f=p.data==="F!";break e}}vs(f)}f=!1}f&&(n=o[0])}}return o=wt(),o.memoizedState=o.baseState=n,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:lg,lastRenderedState:n},o.queue=f,o=_g.bind(null,be,f),f.dispatch=o,f=Vu(!1),y=Ju.bind(null,be,!1,f.queue),f=wt(),p={state:n,dispatch:null,action:i,pending:null},f.queue=p,o=dS.bind(null,be,p,y,o),p.dispatch=o,f.memoizedState=i,[n,o,!1]}function ug(i){var n=at();return cg(n,He,i)}function cg(i,n,o){if(n=Ku(i,n,lg)[0],i=pl(Xi)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var f=Vr(n)}catch(A){throw A===Bn?al:A}else f=n;n=at();var p=n.queue,y=p.dispatch;return o!==n.memoizedState&&(be.flags|=2048,Kn(9,{destroy:void 0},hS.bind(null,p,o),null)),[f,y,i]}function hS(i,n){i.action=n}function fg(i){var n=at(),o=He;if(o!==null)return cg(n,o,i);at(),n=n.memoizedState,o=at();var f=o.queue.dispatch;return o.memoizedState=i,[n,f,!1]}function Kn(i,n,o,f){return i={tag:i,create:o,deps:f,inst:n,next:null},n=be.updateQueue,n===null&&(n=gl(),be.updateQueue=n),o=n.lastEffect,o===null?n.lastEffect=i.next=i:(f=o.next,o.next=i,i.next=f,n.lastEffect=i),i}function dg(){return at().memoizedState}function yl(i,n,o,f){var p=wt();be.flags|=i,p.memoizedState=Kn(1|n,{destroy:void 0},o,f===void 0?null:f)}function vl(i,n,o,f){var p=at();f=f===void 0?null:f;var y=p.memoizedState.inst;He!==null&&f!==null&&Fu(f,He.memoizedState.deps)?p.memoizedState=Kn(n,y,o,f):(be.flags|=i,p.memoizedState=Kn(1|n,y,o,f))}function hg(i,n){yl(8390656,8,i,n)}function qu(i,n){vl(2048,8,i,n)}function gS(i){be.flags|=4;var n=be.updateQueue;if(n===null)n=gl(),be.updateQueue=n,n.events=[i];else{var o=n.events;o===null?n.events=[i]:o.push(i)}}function gg(i){var n=at().memoizedState;return gS({ref:n,nextImpl:i}),function(){if((Fe&2)!==0)throw Error(s(440));return n.impl.apply(void 0,arguments)}}function mg(i,n){return vl(4,2,i,n)}function pg(i,n){return vl(4,4,i,n)}function yg(i,n){if(typeof n=="function"){i=i();var o=n(i);return function(){typeof o=="function"?o():n(null)}}if(n!=null)return i=i(),n.current=i,function(){n.current=null}}function vg(i,n,o){o=o!=null?o.concat([i]):null,vl(4,4,yg.bind(null,n,i),o)}function Xu(){}function Eg(i,n){var o=at();n=n===void 0?null:n;var f=o.memoizedState;return n!==null&&Fu(n,f[1])?f[0]:(o.memoizedState=[i,n],i)}function Sg(i,n){var o=at();n=n===void 0?null:n;var f=o.memoizedState;if(n!==null&&Fu(n,f[1]))return f[0];if(f=i(),on){hs(!0);try{i()}finally{hs(!1)}}return o.memoizedState=[f,n],f}function Qu(i,n,o){return o===void 0||(qi&1073741824)!==0&&(Oe&261930)===0?i.memoizedState=n:(i.memoizedState=o,i=Tm(),be.lanes|=i,_s|=i,o)}function Tg(i,n,o,f){return zt(o,n)?o:Gn.current!==null?(i=Qu(i,o,f),zt(i,n)||(ct=!0),i):(qi&42)===0||(qi&1073741824)!==0&&(Oe&261930)===0?(ct=!0,i.memoizedState=o):(i=Tm(),be.lanes|=i,_s|=i,n)}function xg(i,n,o,f,p){var y=X.p;X.p=y!==0&&8>y?y:8;var A=N.T,D={};N.T=D,Ju(i,!1,n,o);try{var M=p(),V=N.S;if(V!==null&&V(D,M),M!==null&&typeof M=="object"&&typeof M.then=="function"){var Z=uS(M,f);Yr(i,n,Z,Wt(i))}else Yr(i,n,f,Wt(i))}catch(ie){Yr(i,n,{then:function(){},status:"rejected",reason:ie},Wt())}finally{X.p=y,A!==null&&D.types!==null&&(A.types=D.types),N.T=A}}function mS(){}function Wu(i,n,o,f){if(i.tag!==5)throw Error(s(476));var p=Ag(i).queue;xg(i,p,n,J,o===null?mS:function(){return bg(i),o(f)})}function Ag(i){var n=i.memoizedState;if(n!==null)return n;n={memoizedState:J,baseState:J,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Xi,lastRenderedState:J},next:null};var o={};return n.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Xi,lastRenderedState:o},next:null},i.memoizedState=n,i=i.alternate,i!==null&&(i.memoizedState=n),n}function bg(i){var n=Ag(i);n.next===null&&(n=i.alternate.memoizedState),Yr(i,n.next.queue,{},Wt())}function Zu(){return xt(ca)}function Lg(){return at().memoizedState}function Rg(){return at().memoizedState}function pS(i){for(var n=i.return;n!==null;){switch(n.tag){case 24:case 3:var o=Wt();i=Ts(o);var f=xs(n,i,o);f!==null&&($t(f,n,o),jr(f,n,o)),n={cache:_u()},i.payload=n;return}n=n.return}}function yS(i,n,o){var f=Wt();o={lane:f,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null},El(i)?Dg(n,o):(o=pu(i,n,o,f),o!==null&&($t(o,i,f),Ig(o,n,f)))}function _g(i,n,o){var f=Wt();Yr(i,n,o,f)}function Yr(i,n,o,f){var p={lane:f,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null};if(El(i))Dg(n,p);else{var y=i.alternate;if(i.lanes===0&&(y===null||y.lanes===0)&&(y=n.lastRenderedReducer,y!==null))try{var A=n.lastRenderedState,D=y(A,o);if(p.hasEagerState=!0,p.eagerState=D,zt(D,A))return Ja(i,n,p,0),Ye===null&&Za(),!1}catch{}if(o=pu(i,n,p,f),o!==null)return $t(o,i,f),Ig(o,n,f),!0}return!1}function Ju(i,n,o,f){if(f={lane:2,revertLane:Oc(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},El(i)){if(n)throw Error(s(479))}else n=pu(i,o,f,2),n!==null&&$t(n,i,2)}function El(i){var n=i.alternate;return i===be||n!==null&&n===be}function Dg(i,n){jn=dl=!0;var o=i.pending;o===null?n.next=n:(n.next=o.next,o.next=n),i.pending=n}function Ig(i,n,o){if((o&4194048)!==0){var f=n.lanes;f&=i.pendingLanes,o|=f,n.lanes=o,kd(i,o)}}var qr={readContext:xt,use:ml,useCallback:it,useContext:it,useEffect:it,useImperativeHandle:it,useLayoutEffect:it,useInsertionEffect:it,useMemo:it,useReducer:it,useRef:it,useState:it,useDebugValue:it,useDeferredValue:it,useTransition:it,useSyncExternalStore:it,useId:it,useHostTransitionStatus:it,useFormState:it,useActionState:it,useOptimistic:it,useMemoCache:it,useCacheRefresh:it};qr.useEffectEvent=it;var Cg={readContext:xt,use:ml,useCallback:function(i,n){return wt().memoizedState=[i,n===void 0?null:n],i},useContext:xt,useEffect:hg,useImperativeHandle:function(i,n,o){o=o!=null?o.concat([i]):null,yl(4194308,4,yg.bind(null,n,i),o)},useLayoutEffect:function(i,n){return yl(4194308,4,i,n)},useInsertionEffect:function(i,n){yl(4,2,i,n)},useMemo:function(i,n){var o=wt();n=n===void 0?null:n;var f=i();if(on){hs(!0);try{i()}finally{hs(!1)}}return o.memoizedState=[f,n],f},useReducer:function(i,n,o){var f=wt();if(o!==void 0){var p=o(n);if(on){hs(!0);try{o(n)}finally{hs(!1)}}}else p=n;return f.memoizedState=f.baseState=p,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:p},f.queue=i,i=i.dispatch=yS.bind(null,be,i),[f.memoizedState,i]},useRef:function(i){var n=wt();return i={current:i},n.memoizedState=i},useState:function(i){i=Vu(i);var n=i.queue,o=_g.bind(null,be,n);return n.dispatch=o,[i.memoizedState,o]},useDebugValue:Xu,useDeferredValue:function(i,n){var o=wt();return Qu(o,i,n)},useTransition:function(){var i=Vu(!1);return i=xg.bind(null,be,i.queue,!0,!1),wt().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,n,o){var f=be,p=wt();if(Me){if(o===void 0)throw Error(s(407));o=o()}else{if(o=n(),Ye===null)throw Error(s(349));(Oe&127)!==0||Wh(f,n,o)}p.memoizedState=o;var y={value:o,getSnapshot:n};return p.queue=y,hg(Jh.bind(null,f,y,i),[i]),f.flags|=2048,Kn(9,{destroy:void 0},Zh.bind(null,f,y,o,n),null),o},useId:function(){var i=wt(),n=Ye.identifierPrefix;if(Me){var o=Di,f=_i;o=(f&~(1<<32-Kt(f)-1)).toString(32)+o,n="_"+n+"R_"+o,o=hl++,0<o&&(n+="H"+o.toString(32)),n+="_"}else o=cS++,n="_"+n+"r_"+o.toString(32)+"_";return i.memoizedState=n},useHostTransitionStatus:Zu,useFormState:og,useActionState:og,useOptimistic:function(i){var n=wt();n.memoizedState=n.baseState=i;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=o,n=Ju.bind(null,be,!0,o),o.dispatch=n,[i,n]},useMemoCache:Hu,useCacheRefresh:function(){return wt().memoizedState=pS.bind(null,be)},useEffectEvent:function(i){var n=wt(),o={impl:i};return n.memoizedState=o,function(){if((Fe&2)!==0)throw Error(s(440));return o.impl.apply(void 0,arguments)}}},ec={readContext:xt,use:ml,useCallback:Eg,useContext:xt,useEffect:qu,useImperativeHandle:vg,useInsertionEffect:mg,useLayoutEffect:pg,useMemo:Sg,useReducer:pl,useRef:dg,useState:function(){return pl(Xi)},useDebugValue:Xu,useDeferredValue:function(i,n){var o=at();return Tg(o,He.memoizedState,i,n)},useTransition:function(){var i=pl(Xi)[0],n=at().memoizedState;return[typeof i=="boolean"?i:Vr(i),n]},useSyncExternalStore:Qh,useId:Lg,useHostTransitionStatus:Zu,useFormState:ug,useActionState:ug,useOptimistic:function(i,n){var o=at();return ig(o,He,i,n)},useMemoCache:Hu,useCacheRefresh:Rg};ec.useEffectEvent=gg;var Og={readContext:xt,use:ml,useCallback:Eg,useContext:xt,useEffect:qu,useImperativeHandle:vg,useInsertionEffect:mg,useLayoutEffect:pg,useMemo:Sg,useReducer:zu,useRef:dg,useState:function(){return zu(Xi)},useDebugValue:Xu,useDeferredValue:function(i,n){var o=at();return He===null?Qu(o,i,n):Tg(o,He.memoizedState,i,n)},useTransition:function(){var i=zu(Xi)[0],n=at().memoizedState;return[typeof i=="boolean"?i:Vr(i),n]},useSyncExternalStore:Qh,useId:Lg,useHostTransitionStatus:Zu,useFormState:fg,useActionState:fg,useOptimistic:function(i,n){var o=at();return He!==null?ig(o,He,i,n):(o.baseState=i,[i,o.queue.dispatch])},useMemoCache:Hu,useCacheRefresh:Rg};Og.useEffectEvent=gg;function tc(i,n,o,f){n=i.memoizedState,o=o(f,n),o=o==null?n:m({},n,o),i.memoizedState=o,i.lanes===0&&(i.updateQueue.baseState=o)}var ic={enqueueSetState:function(i,n,o){i=i._reactInternals;var f=Wt(),p=Ts(f);p.payload=n,o!=null&&(p.callback=o),n=xs(i,p,f),n!==null&&($t(n,i,f),jr(n,i,f))},enqueueReplaceState:function(i,n,o){i=i._reactInternals;var f=Wt(),p=Ts(f);p.tag=1,p.payload=n,o!=null&&(p.callback=o),n=xs(i,p,f),n!==null&&($t(n,i,f),jr(n,i,f))},enqueueForceUpdate:function(i,n){i=i._reactInternals;var o=Wt(),f=Ts(o);f.tag=2,n!=null&&(f.callback=n),n=xs(i,f,o),n!==null&&($t(n,i,o),jr(n,i,o))}};function wg(i,n,o,f,p,y,A){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(f,y,A):n.prototype&&n.prototype.isPureReactComponent?!kr(o,f)||!kr(p,y):!0}function Mg(i,n,o,f){i=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(o,f),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(o,f),n.state!==i&&ic.enqueueReplaceState(n,n.state,null)}function un(i,n){var o=n;if("ref"in n){o={};for(var f in n)f!=="ref"&&(o[f]=n[f])}if(i=i.defaultProps){o===n&&(o=m({},o));for(var p in i)o[p]===void 0&&(o[p]=i[p])}return o}function kg(i){Wa(i)}function Ng(i){console.error(i)}function Pg(i){Wa(i)}function Sl(i,n){try{var o=i.onUncaughtError;o(n.value,{componentStack:n.stack})}catch(f){setTimeout(function(){throw f})}}function Ug(i,n,o){try{var f=i.onCaughtError;f(o.value,{componentStack:o.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function sc(i,n,o){return o=Ts(o),o.tag=3,o.payload={element:null},o.callback=function(){Sl(i,n)},o}function Fg(i){return i=Ts(i),i.tag=3,i}function Bg(i,n,o,f){var p=o.type.getDerivedStateFromError;if(typeof p=="function"){var y=f.value;i.payload=function(){return p(y)},i.callback=function(){Ug(n,o,f)}}var A=o.stateNode;A!==null&&typeof A.componentDidCatch=="function"&&(i.callback=function(){Ug(n,o,f),typeof p!="function"&&(Ds===null?Ds=new Set([this]):Ds.add(this));var D=f.stack;this.componentDidCatch(f.value,{componentStack:D!==null?D:""})})}function vS(i,n,o,f,p){if(o.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(n=o.alternate,n!==null&&Pn(n,o,p,!0),o=Yt.current,o!==null){switch(o.tag){case 31:case 13:return di===null?wl():o.alternate===null&&st===0&&(st=3),o.flags&=-257,o.flags|=65536,o.lanes=p,f===ll?o.flags|=16384:(n=o.updateQueue,n===null?o.updateQueue=new Set([f]):n.add(f),Dc(i,f,p)),!1;case 22:return o.flags|=65536,f===ll?o.flags|=16384:(n=o.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([f])},o.updateQueue=n):(o=n.retryQueue,o===null?n.retryQueue=new Set([f]):o.add(f)),Dc(i,f,p)),!1}throw Error(s(435,o.tag))}return Dc(i,f,p),wl(),!1}if(Me)return n=Yt.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=p,f!==xu&&(i=Error(s(422),{cause:f}),Ur(oi(i,o)))):(f!==xu&&(n=Error(s(423),{cause:f}),Ur(oi(n,o))),i=i.current.alternate,i.flags|=65536,p&=-p,i.lanes|=p,f=oi(f,o),p=sc(i.stateNode,f,p),Mu(i,p),st!==4&&(st=2)),!1;var y=Error(s(520),{cause:f});if(y=oi(y,o),ia===null?ia=[y]:ia.push(y),st!==4&&(st=2),n===null)return!0;f=oi(f,o),o=n;do{switch(o.tag){case 3:return o.flags|=65536,i=p&-p,o.lanes|=i,i=sc(o.stateNode,f,i),Mu(o,i),!1;case 1:if(n=o.type,y=o.stateNode,(o.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Ds===null||!Ds.has(y))))return o.flags|=65536,p&=-p,o.lanes|=p,p=Fg(p),Bg(p,i,o,f),Mu(o,p),!1}o=o.return}while(o!==null);return!1}var nc=Error(s(461)),ct=!1;function At(i,n,o,f){n.child=i===null?Hh(n,null,o,f):ln(n,i.child,o,f)}function $g(i,n,o,f,p){o=o.render;var y=n.ref;if("ref"in f){var A={};for(var D in f)D!=="ref"&&(A[D]=f[D])}else A=f;return sn(n),f=Bu(i,n,o,A,y,p),D=$u(),i!==null&&!ct?(Gu(i,n,p),Qi(i,n,p)):(Me&&D&&Su(n),n.flags|=1,At(i,n,f,p),n.child)}function Gg(i,n,o,f,p){if(i===null){var y=o.type;return typeof y=="function"&&!yu(y)&&y.defaultProps===void 0&&o.compare===null?(n.tag=15,n.type=y,jg(i,n,y,f,p)):(i=tl(o.type,null,f,n,n.mode,p),i.ref=n.ref,i.return=n,n.child=i)}if(y=i.child,!dc(i,p)){var A=y.memoizedProps;if(o=o.compare,o=o!==null?o:kr,o(A,f)&&i.ref===n.ref)return Qi(i,n,p)}return n.flags|=1,i=Ki(y,f),i.ref=n.ref,i.return=n,n.child=i}function jg(i,n,o,f,p){if(i!==null){var y=i.memoizedProps;if(kr(y,f)&&i.ref===n.ref)if(ct=!1,n.pendingProps=f=y,dc(i,p))(i.flags&131072)!==0&&(ct=!0);else return n.lanes=i.lanes,Qi(i,n,p)}return rc(i,n,o,f,p)}function Hg(i,n,o,f){var p=f.children,y=i!==null?i.memoizedState:null;if(i===null&&n.stateNode===null&&(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((n.flags&128)!==0){if(y=y!==null?y.baseLanes|o:o,i!==null){for(f=n.child=i.child,p=0;f!==null;)p=p|f.lanes|f.childLanes,f=f.sibling;f=p&~y}else f=0,n.child=null;return Kg(i,n,y,o,f)}if((o&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},i!==null&&rl(n,y!==null?y.cachePool:null),y!==null?Vh(n,y):Nu(),Yh(n);else return f=n.lanes=536870912,Kg(i,n,y!==null?y.baseLanes|o:o,o,f)}else y!==null?(rl(n,y.cachePool),Vh(n,y),bs(),n.memoizedState=null):(i!==null&&rl(n,null),Nu(),bs());return At(i,n,p,o),n.child}function Xr(i,n){return i!==null&&i.tag===22||n.stateNode!==null||(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.sibling}function Kg(i,n,o,f,p){var y=Iu();return y=y===null?null:{parent:ot._currentValue,pool:y},n.memoizedState={baseLanes:o,cachePool:y},i!==null&&rl(n,null),Nu(),Yh(n),i!==null&&Pn(i,n,f,!0),n.childLanes=p,null}function Tl(i,n){return n=Al({mode:n.mode,children:n.children},i.mode),n.ref=i.ref,i.child=n,n.return=i,n}function zg(i,n,o){return ln(n,i.child,null,o),i=Tl(n,n.pendingProps),i.flags|=2,qt(n),n.memoizedState=null,i}function ES(i,n,o){var f=n.pendingProps,p=(n.flags&128)!==0;if(n.flags&=-129,i===null){if(Me){if(f.mode==="hidden")return i=Tl(n,f),n.lanes=536870912,Xr(null,i);if(Uu(n),(i=Qe)?(i=s0(i,fi),i=i!==null&&i.data==="&"?i:null,i!==null&&(n.memoizedState={dehydrated:i,treeContext:ps!==null?{id:_i,overflow:Di}:null,retryLane:536870912,hydrationErrors:null},o=Dh(i),o.return=n,n.child=o,Tt=n,Qe=null)):i=null,i===null)throw vs(n);return n.lanes=536870912,null}return Tl(n,f)}var y=i.memoizedState;if(y!==null){var A=y.dehydrated;if(Uu(n),p)if(n.flags&256)n.flags&=-257,n=zg(i,n,o);else if(n.memoizedState!==null)n.child=i.child,n.flags|=128,n=null;else throw Error(s(558));else if(ct||Pn(i,n,o,!1),p=(o&i.childLanes)!==0,ct||p){if(f=Ye,f!==null&&(A=Nd(f,o),A!==0&&A!==y.retryLane))throw y.retryLane=A,Zs(i,A),$t(f,i,A),nc;wl(),n=zg(i,n,o)}else i=y.treeContext,Qe=hi(A.nextSibling),Tt=n,Me=!0,ys=null,fi=!1,i!==null&&Oh(n,i),n=Tl(n,f),n.flags|=4096;return n}return i=Ki(i.child,{mode:f.mode,children:f.children}),i.ref=n.ref,n.child=i,i.return=n,i}function xl(i,n){var o=n.ref;if(o===null)i!==null&&i.ref!==null&&(n.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(s(284));(i===null||i.ref!==o)&&(n.flags|=4194816)}}function rc(i,n,o,f,p){return sn(n),o=Bu(i,n,o,f,void 0,p),f=$u(),i!==null&&!ct?(Gu(i,n,p),Qi(i,n,p)):(Me&&f&&Su(n),n.flags|=1,At(i,n,o,p),n.child)}function Vg(i,n,o,f,p,y){return sn(n),n.updateQueue=null,o=Xh(n,f,o,p),qh(i),f=$u(),i!==null&&!ct?(Gu(i,n,y),Qi(i,n,y)):(Me&&f&&Su(n),n.flags|=1,At(i,n,o,y),n.child)}function Yg(i,n,o,f,p){if(sn(n),n.stateNode===null){var y=wn,A=o.contextType;typeof A=="object"&&A!==null&&(y=xt(A)),y=new o(f,y),n.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=ic,n.stateNode=y,y._reactInternals=n,y=n.stateNode,y.props=f,y.state=n.memoizedState,y.refs={},Ou(n),A=o.contextType,y.context=typeof A=="object"&&A!==null?xt(A):wn,y.state=n.memoizedState,A=o.getDerivedStateFromProps,typeof A=="function"&&(tc(n,o,A,f),y.state=n.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(A=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),A!==y.state&&ic.enqueueReplaceState(y,y.state,null),Kr(n,f,y,p),Hr(),y.state=n.memoizedState),typeof y.componentDidMount=="function"&&(n.flags|=4194308),f=!0}else if(i===null){y=n.stateNode;var D=n.memoizedProps,M=un(o,D);y.props=M;var V=y.context,Z=o.contextType;A=wn,typeof Z=="object"&&Z!==null&&(A=xt(Z));var ie=o.getDerivedStateFromProps;Z=typeof ie=="function"||typeof y.getSnapshotBeforeUpdate=="function",D=n.pendingProps!==D,Z||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(D||V!==A)&&Mg(n,y,f,A),Ss=!1;var Y=n.memoizedState;y.state=Y,Kr(n,f,y,p),Hr(),V=n.memoizedState,D||Y!==V||Ss?(typeof ie=="function"&&(tc(n,o,ie,f),V=n.memoizedState),(M=Ss||wg(n,o,M,f,Y,V,A))?(Z||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(n.flags|=4194308)):(typeof y.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=f,n.memoizedState=V),y.props=f,y.state=V,y.context=A,f=M):(typeof y.componentDidMount=="function"&&(n.flags|=4194308),f=!1)}else{y=n.stateNode,wu(i,n),A=n.memoizedProps,Z=un(o,A),y.props=Z,ie=n.pendingProps,Y=y.context,V=o.contextType,M=wn,typeof V=="object"&&V!==null&&(M=xt(V)),D=o.getDerivedStateFromProps,(V=typeof D=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(A!==ie||Y!==M)&&Mg(n,y,f,M),Ss=!1,Y=n.memoizedState,y.state=Y,Kr(n,f,y,p),Hr();var q=n.memoizedState;A!==ie||Y!==q||Ss||i!==null&&i.dependencies!==null&&sl(i.dependencies)?(typeof D=="function"&&(tc(n,o,D,f),q=n.memoizedState),(Z=Ss||wg(n,o,Z,f,Y,q,M)||i!==null&&i.dependencies!==null&&sl(i.dependencies))?(V||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(f,q,M),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(f,q,M)),typeof y.componentDidUpdate=="function"&&(n.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof y.componentDidUpdate!="function"||A===i.memoizedProps&&Y===i.memoizedState||(n.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||A===i.memoizedProps&&Y===i.memoizedState||(n.flags|=1024),n.memoizedProps=f,n.memoizedState=q),y.props=f,y.state=q,y.context=M,f=Z):(typeof y.componentDidUpdate!="function"||A===i.memoizedProps&&Y===i.memoizedState||(n.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||A===i.memoizedProps&&Y===i.memoizedState||(n.flags|=1024),f=!1)}return y=f,xl(i,n),f=(n.flags&128)!==0,y||f?(y=n.stateNode,o=f&&typeof o.getDerivedStateFromError!="function"?null:y.render(),n.flags|=1,i!==null&&f?(n.child=ln(n,i.child,null,p),n.child=ln(n,null,o,p)):At(i,n,o,p),n.memoizedState=y.state,i=n.child):i=Qi(i,n,p),i}function qg(i,n,o,f){return en(),n.flags|=256,At(i,n,o,f),n.child}var ac={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function lc(i){return{baseLanes:i,cachePool:Uh()}}function oc(i,n,o){return i=i!==null?i.childLanes&~o:0,n&&(i|=Qt),i}function Xg(i,n,o){var f=n.pendingProps,p=!1,y=(n.flags&128)!==0,A;if((A=y)||(A=i!==null&&i.memoizedState===null?!1:(rt.current&2)!==0),A&&(p=!0,n.flags&=-129),A=(n.flags&32)!==0,n.flags&=-33,i===null){if(Me){if(p?As(n):bs(),(i=Qe)?(i=s0(i,fi),i=i!==null&&i.data!=="&"?i:null,i!==null&&(n.memoizedState={dehydrated:i,treeContext:ps!==null?{id:_i,overflow:Di}:null,retryLane:536870912,hydrationErrors:null},o=Dh(i),o.return=n,n.child=o,Tt=n,Qe=null)):i=null,i===null)throw vs(n);return Kc(i)?n.lanes=32:n.lanes=536870912,null}var D=f.children;return f=f.fallback,p?(bs(),p=n.mode,D=Al({mode:"hidden",children:D},p),f=Js(f,p,o,null),D.return=n,f.return=n,D.sibling=f,n.child=D,f=n.child,f.memoizedState=lc(o),f.childLanes=oc(i,A,o),n.memoizedState=ac,Xr(null,f)):(As(n),uc(n,D))}var M=i.memoizedState;if(M!==null&&(D=M.dehydrated,D!==null)){if(y)n.flags&256?(As(n),n.flags&=-257,n=cc(i,n,o)):n.memoizedState!==null?(bs(),n.child=i.child,n.flags|=128,n=null):(bs(),D=f.fallback,p=n.mode,f=Al({mode:"visible",children:f.children},p),D=Js(D,p,o,null),D.flags|=2,f.return=n,D.return=n,f.sibling=D,n.child=f,ln(n,i.child,null,o),f=n.child,f.memoizedState=lc(o),f.childLanes=oc(i,A,o),n.memoizedState=ac,n=Xr(null,f));else if(As(n),Kc(D)){if(A=D.nextSibling&&D.nextSibling.dataset,A)var V=A.dgst;A=V,f=Error(s(419)),f.stack="",f.digest=A,Ur({value:f,source:null,stack:null}),n=cc(i,n,o)}else if(ct||Pn(i,n,o,!1),A=(o&i.childLanes)!==0,ct||A){if(A=Ye,A!==null&&(f=Nd(A,o),f!==0&&f!==M.retryLane))throw M.retryLane=f,Zs(i,f),$t(A,i,f),nc;Hc(D)||wl(),n=cc(i,n,o)}else Hc(D)?(n.flags|=192,n.child=i.child,n=null):(i=M.treeContext,Qe=hi(D.nextSibling),Tt=n,Me=!0,ys=null,fi=!1,i!==null&&Oh(n,i),n=uc(n,f.children),n.flags|=4096);return n}return p?(bs(),D=f.fallback,p=n.mode,M=i.child,V=M.sibling,f=Ki(M,{mode:"hidden",children:f.children}),f.subtreeFlags=M.subtreeFlags&65011712,V!==null?D=Ki(V,D):(D=Js(D,p,o,null),D.flags|=2),D.return=n,f.return=n,f.sibling=D,n.child=f,Xr(null,f),f=n.child,D=i.child.memoizedState,D===null?D=lc(o):(p=D.cachePool,p!==null?(M=ot._currentValue,p=p.parent!==M?{parent:M,pool:M}:p):p=Uh(),D={baseLanes:D.baseLanes|o,cachePool:p}),f.memoizedState=D,f.childLanes=oc(i,A,o),n.memoizedState=ac,Xr(i.child,f)):(As(n),o=i.child,i=o.sibling,o=Ki(o,{mode:"visible",children:f.children}),o.return=n,o.sibling=null,i!==null&&(A=n.deletions,A===null?(n.deletions=[i],n.flags|=16):A.push(i)),n.child=o,n.memoizedState=null,o)}function uc(i,n){return n=Al({mode:"visible",children:n},i.mode),n.return=i,i.child=n}function Al(i,n){return i=Vt(22,i,null,n),i.lanes=0,i}function cc(i,n,o){return ln(n,i.child,null,o),i=uc(n,n.pendingProps.children),i.flags|=2,n.memoizedState=null,i}function Qg(i,n,o){i.lanes|=n;var f=i.alternate;f!==null&&(f.lanes|=n),Lu(i.return,n,o)}function fc(i,n,o,f,p,y){var A=i.memoizedState;A===null?i.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:f,tail:o,tailMode:p,treeForkCount:y}:(A.isBackwards=n,A.rendering=null,A.renderingStartTime=0,A.last=f,A.tail=o,A.tailMode=p,A.treeForkCount=y)}function Wg(i,n,o){var f=n.pendingProps,p=f.revealOrder,y=f.tail;f=f.children;var A=rt.current,D=(A&2)!==0;if(D?(A=A&1|2,n.flags|=128):A&=1,se(rt,A),At(i,n,f,o),f=Me?Pr:0,!D&&i!==null&&(i.flags&128)!==0)e:for(i=n.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Qg(i,o,n);else if(i.tag===19)Qg(i,o,n);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break e;for(;i.sibling===null;){if(i.return===null||i.return===n)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(p){case"forwards":for(o=n.child,p=null;o!==null;)i=o.alternate,i!==null&&fl(i)===null&&(p=o),o=o.sibling;o=p,o===null?(p=n.child,n.child=null):(p=o.sibling,o.sibling=null),fc(n,!1,p,o,y,f);break;case"backwards":case"unstable_legacy-backwards":for(o=null,p=n.child,n.child=null;p!==null;){if(i=p.alternate,i!==null&&fl(i)===null){n.child=p;break}i=p.sibling,p.sibling=o,o=p,p=i}fc(n,!0,o,null,y,f);break;case"together":fc(n,!1,null,null,void 0,f);break;default:n.memoizedState=null}return n.child}function Qi(i,n,o){if(i!==null&&(n.dependencies=i.dependencies),_s|=n.lanes,(o&n.childLanes)===0)if(i!==null){if(Pn(i,n,o,!1),(o&n.childLanes)===0)return null}else return null;if(i!==null&&n.child!==i.child)throw Error(s(153));if(n.child!==null){for(i=n.child,o=Ki(i,i.pendingProps),n.child=o,o.return=n;i.sibling!==null;)i=i.sibling,o=o.sibling=Ki(i,i.pendingProps),o.return=n;o.sibling=null}return n.child}function dc(i,n){return(i.lanes&n)!==0?!0:(i=i.dependencies,!!(i!==null&&sl(i)))}function SS(i,n,o){switch(n.tag){case 3:Ne(n,n.stateNode.containerInfo),Es(n,ot,i.memoizedState.cache),en();break;case 27:case 5:Dt(n);break;case 4:Ne(n,n.stateNode.containerInfo);break;case 10:Es(n,n.type,n.memoizedProps.value);break;case 31:if(n.memoizedState!==null)return n.flags|=128,Uu(n),null;break;case 13:var f=n.memoizedState;if(f!==null)return f.dehydrated!==null?(As(n),n.flags|=128,null):(o&n.child.childLanes)!==0?Xg(i,n,o):(As(n),i=Qi(i,n,o),i!==null?i.sibling:null);As(n);break;case 19:var p=(i.flags&128)!==0;if(f=(o&n.childLanes)!==0,f||(Pn(i,n,o,!1),f=(o&n.childLanes)!==0),p){if(f)return Wg(i,n,o);n.flags|=128}if(p=n.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),se(rt,rt.current),f)break;return null;case 22:return n.lanes=0,Hg(i,n,o,n.pendingProps);case 24:Es(n,ot,i.memoizedState.cache)}return Qi(i,n,o)}function Zg(i,n,o){if(i!==null)if(i.memoizedProps!==n.pendingProps)ct=!0;else{if(!dc(i,o)&&(n.flags&128)===0)return ct=!1,SS(i,n,o);ct=(i.flags&131072)!==0}else ct=!1,Me&&(n.flags&1048576)!==0&&Ch(n,Pr,n.index);switch(n.lanes=0,n.tag){case 16:e:{var f=n.pendingProps;if(i=rn(n.elementType),n.type=i,typeof i=="function")yu(i)?(f=un(i,f),n.tag=1,n=Yg(null,n,i,f,o)):(n.tag=0,n=rc(null,n,i,f,o));else{if(i!=null){var p=i.$$typeof;if(p===O){n.tag=11,n=$g(null,n,i,f,o);break e}else if(p===w){n.tag=14,n=Gg(null,n,i,f,o);break e}}throw n=he(i)||i,Error(s(306,n,""))}}return n;case 0:return rc(i,n,n.type,n.pendingProps,o);case 1:return f=n.type,p=un(f,n.pendingProps),Yg(i,n,f,p,o);case 3:e:{if(Ne(n,n.stateNode.containerInfo),i===null)throw Error(s(387));f=n.pendingProps;var y=n.memoizedState;p=y.element,wu(i,n),Kr(n,f,null,o);var A=n.memoizedState;if(f=A.cache,Es(n,ot,f),f!==y.cache&&Ru(n,[ot],o,!0),Hr(),f=A.element,y.isDehydrated)if(y={element:f,isDehydrated:!1,cache:A.cache},n.updateQueue.baseState=y,n.memoizedState=y,n.flags&256){n=qg(i,n,f,o);break e}else if(f!==p){p=oi(Error(s(424)),n),Ur(p),n=qg(i,n,f,o);break e}else for(i=n.stateNode.containerInfo,i.nodeType===9?i=i.body:i=i.nodeName==="HTML"?i.ownerDocument.body:i,Qe=hi(i.firstChild),Tt=n,Me=!0,ys=null,fi=!0,o=Hh(n,null,f,o),n.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(en(),f===p){n=Qi(i,n,o);break e}At(i,n,f,o)}n=n.child}return n;case 26:return xl(i,n),i===null?(o=u0(n.type,null,n.pendingProps,null))?n.memoizedState=o:Me||(o=n.type,i=n.pendingProps,f=Bl(de.current).createElement(o),f[St]=n,f[kt]=i,bt(f,o,i),yt(f),n.stateNode=f):n.memoizedState=u0(n.type,i.memoizedProps,n.pendingProps,i.memoizedState),null;case 27:return Dt(n),i===null&&Me&&(f=n.stateNode=a0(n.type,n.pendingProps,de.current),Tt=n,fi=!0,p=Qe,ws(n.type)?(zc=p,Qe=hi(f.firstChild)):Qe=p),At(i,n,n.pendingProps.children,o),xl(i,n),i===null&&(n.flags|=4194304),n.child;case 5:return i===null&&Me&&((p=f=Qe)&&(f=QS(f,n.type,n.pendingProps,fi),f!==null?(n.stateNode=f,Tt=n,Qe=hi(f.firstChild),fi=!1,p=!0):p=!1),p||vs(n)),Dt(n),p=n.type,y=n.pendingProps,A=i!==null?i.memoizedProps:null,f=y.children,$c(p,y)?f=null:A!==null&&$c(p,A)&&(n.flags|=32),n.memoizedState!==null&&(p=Bu(i,n,fS,null,null,o),ca._currentValue=p),xl(i,n),At(i,n,f,o),n.child;case 6:return i===null&&Me&&((i=o=Qe)&&(o=WS(o,n.pendingProps,fi),o!==null?(n.stateNode=o,Tt=n,Qe=null,i=!0):i=!1),i||vs(n)),null;case 13:return Xg(i,n,o);case 4:return Ne(n,n.stateNode.containerInfo),f=n.pendingProps,i===null?n.child=ln(n,null,f,o):At(i,n,f,o),n.child;case 11:return $g(i,n,n.type,n.pendingProps,o);case 7:return At(i,n,n.pendingProps,o),n.child;case 8:return At(i,n,n.pendingProps.children,o),n.child;case 12:return At(i,n,n.pendingProps.children,o),n.child;case 10:return f=n.pendingProps,Es(n,n.type,f.value),At(i,n,f.children,o),n.child;case 9:return p=n.type._context,f=n.pendingProps.children,sn(n),p=xt(p),f=f(p),n.flags|=1,At(i,n,f,o),n.child;case 14:return Gg(i,n,n.type,n.pendingProps,o);case 15:return jg(i,n,n.type,n.pendingProps,o);case 19:return Wg(i,n,o);case 31:return ES(i,n,o);case 22:return Hg(i,n,o,n.pendingProps);case 24:return sn(n),f=xt(ot),i===null?(p=Iu(),p===null&&(p=Ye,y=_u(),p.pooledCache=y,y.refCount++,y!==null&&(p.pooledCacheLanes|=o),p=y),n.memoizedState={parent:f,cache:p},Ou(n),Es(n,ot,p)):((i.lanes&o)!==0&&(wu(i,n),Kr(n,null,null,o),Hr()),p=i.memoizedState,y=n.memoizedState,p.parent!==f?(p={parent:f,cache:f},n.memoizedState=p,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=p),Es(n,ot,f)):(f=y.cache,Es(n,ot,f),f!==p.cache&&Ru(n,[ot],o,!0))),At(i,n,n.pendingProps.children,o),n.child;case 29:throw n.pendingProps}throw Error(s(156,n.tag))}function Wi(i){i.flags|=4}function hc(i,n,o,f,p){if((n=(i.mode&32)!==0)&&(n=!1),n){if(i.flags|=16777216,(p&335544128)===p)if(i.stateNode.complete)i.flags|=8192;else if(Lm())i.flags|=8192;else throw an=ll,Cu}else i.flags&=-16777217}function Jg(i,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!g0(n))if(Lm())i.flags|=8192;else throw an=ll,Cu}function bl(i,n){n!==null&&(i.flags|=4),i.flags&16384&&(n=i.tag!==22?wd():536870912,i.lanes|=n,qn|=n)}function Qr(i,n){if(!Me)switch(i.tailMode){case"hidden":n=i.tail;for(var o=null;n!==null;)n.alternate!==null&&(o=n),n=n.sibling;o===null?i.tail=null:o.sibling=null;break;case"collapsed":o=i.tail;for(var f=null;o!==null;)o.alternate!==null&&(f=o),o=o.sibling;f===null?n||i.tail===null?i.tail=null:i.tail.sibling=null:f.sibling=null}}function We(i){var n=i.alternate!==null&&i.alternate.child===i.child,o=0,f=0;if(n)for(var p=i.child;p!==null;)o|=p.lanes|p.childLanes,f|=p.subtreeFlags&65011712,f|=p.flags&65011712,p.return=i,p=p.sibling;else for(p=i.child;p!==null;)o|=p.lanes|p.childLanes,f|=p.subtreeFlags,f|=p.flags,p.return=i,p=p.sibling;return i.subtreeFlags|=f,i.childLanes=o,n}function TS(i,n,o){var f=n.pendingProps;switch(Tu(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return We(n),null;case 1:return We(n),null;case 3:return o=n.stateNode,f=null,i!==null&&(f=i.memoizedState.cache),n.memoizedState.cache!==f&&(n.flags|=2048),Yi(ot),ke(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(i===null||i.child===null)&&(Nn(n)?Wi(n):i===null||i.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,Au())),We(n),null;case 26:var p=n.type,y=n.memoizedState;return i===null?(Wi(n),y!==null?(We(n),Jg(n,y)):(We(n),hc(n,p,null,f,o))):y?y!==i.memoizedState?(Wi(n),We(n),Jg(n,y)):(We(n),n.flags&=-16777217):(i=i.memoizedProps,i!==f&&Wi(n),We(n),hc(n,p,i,f,o)),null;case 27:if(ni(n),o=de.current,p=n.type,i!==null&&n.stateNode!=null)i.memoizedProps!==f&&Wi(n);else{if(!f){if(n.stateNode===null)throw Error(s(166));return We(n),null}i=re.current,Nn(n)?wh(n):(i=a0(p,f,o),n.stateNode=i,Wi(n))}return We(n),null;case 5:if(ni(n),p=n.type,i!==null&&n.stateNode!=null)i.memoizedProps!==f&&Wi(n);else{if(!f){if(n.stateNode===null)throw Error(s(166));return We(n),null}if(y=re.current,Nn(n))wh(n);else{var A=Bl(de.current);switch(y){case 1:y=A.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:y=A.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":y=A.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":y=A.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":y=A.createElement("div"),y.innerHTML="<script><\/script>",y=y.removeChild(y.firstChild);break;case"select":y=typeof f.is=="string"?A.createElement("select",{is:f.is}):A.createElement("select"),f.multiple?y.multiple=!0:f.size&&(y.size=f.size);break;default:y=typeof f.is=="string"?A.createElement(p,{is:f.is}):A.createElement(p)}}y[St]=n,y[kt]=f;e:for(A=n.child;A!==null;){if(A.tag===5||A.tag===6)y.appendChild(A.stateNode);else if(A.tag!==4&&A.tag!==27&&A.child!==null){A.child.return=A,A=A.child;continue}if(A===n)break e;for(;A.sibling===null;){if(A.return===null||A.return===n)break e;A=A.return}A.sibling.return=A.return,A=A.sibling}n.stateNode=y;e:switch(bt(y,p,f),p){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&Wi(n)}}return We(n),hc(n,n.type,i===null?null:i.memoizedProps,n.pendingProps,o),null;case 6:if(i&&n.stateNode!=null)i.memoizedProps!==f&&Wi(n);else{if(typeof f!="string"&&n.stateNode===null)throw Error(s(166));if(i=de.current,Nn(n)){if(i=n.stateNode,o=n.memoizedProps,f=null,p=Tt,p!==null)switch(p.tag){case 27:case 5:f=p.memoizedProps}i[St]=n,i=!!(i.nodeValue===o||f!==null&&f.suppressHydrationWarning===!0||Xm(i.nodeValue,o)),i||vs(n,!0)}else i=Bl(i).createTextNode(f),i[St]=n,n.stateNode=i}return We(n),null;case 31:if(o=n.memoizedState,i===null||i.memoizedState!==null){if(f=Nn(n),o!==null){if(i===null){if(!f)throw Error(s(318));if(i=n.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(s(557));i[St]=n}else en(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;We(n),i=!1}else o=Au(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=o),i=!0;if(!i)return n.flags&256?(qt(n),n):(qt(n),null);if((n.flags&128)!==0)throw Error(s(558))}return We(n),null;case 13:if(f=n.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(p=Nn(n),f!==null&&f.dehydrated!==null){if(i===null){if(!p)throw Error(s(318));if(p=n.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(s(317));p[St]=n}else en(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;We(n),p=!1}else p=Au(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=p),p=!0;if(!p)return n.flags&256?(qt(n),n):(qt(n),null)}return qt(n),(n.flags&128)!==0?(n.lanes=o,n):(o=f!==null,i=i!==null&&i.memoizedState!==null,o&&(f=n.child,p=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(p=f.alternate.memoizedState.cachePool.pool),y=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(y=f.memoizedState.cachePool.pool),y!==p&&(f.flags|=2048)),o!==i&&o&&(n.child.flags|=8192),bl(n,n.updateQueue),We(n),null);case 4:return ke(),i===null&&Nc(n.stateNode.containerInfo),We(n),null;case 10:return Yi(n.type),We(n),null;case 19:if(F(rt),f=n.memoizedState,f===null)return We(n),null;if(p=(n.flags&128)!==0,y=f.rendering,y===null)if(p)Qr(f,!1);else{if(st!==0||i!==null&&(i.flags&128)!==0)for(i=n.child;i!==null;){if(y=fl(i),y!==null){for(n.flags|=128,Qr(f,!1),i=y.updateQueue,n.updateQueue=i,bl(n,i),n.subtreeFlags=0,i=o,o=n.child;o!==null;)_h(o,i),o=o.sibling;return se(rt,rt.current&1|2),Me&&zi(n,f.treeForkCount),n.child}i=i.sibling}f.tail!==null&&pt()>Il&&(n.flags|=128,p=!0,Qr(f,!1),n.lanes=4194304)}else{if(!p)if(i=fl(y),i!==null){if(n.flags|=128,p=!0,i=i.updateQueue,n.updateQueue=i,bl(n,i),Qr(f,!0),f.tail===null&&f.tailMode==="hidden"&&!y.alternate&&!Me)return We(n),null}else 2*pt()-f.renderingStartTime>Il&&o!==536870912&&(n.flags|=128,p=!0,Qr(f,!1),n.lanes=4194304);f.isBackwards?(y.sibling=n.child,n.child=y):(i=f.last,i!==null?i.sibling=y:n.child=y,f.last=y)}return f.tail!==null?(i=f.tail,f.rendering=i,f.tail=i.sibling,f.renderingStartTime=pt(),i.sibling=null,o=rt.current,se(rt,p?o&1|2:o&1),Me&&zi(n,f.treeForkCount),i):(We(n),null);case 22:case 23:return qt(n),Pu(),f=n.memoizedState!==null,i!==null?i.memoizedState!==null!==f&&(n.flags|=8192):f&&(n.flags|=8192),f?(o&536870912)!==0&&(n.flags&128)===0&&(We(n),n.subtreeFlags&6&&(n.flags|=8192)):We(n),o=n.updateQueue,o!==null&&bl(n,o.retryQueue),o=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(o=i.memoizedState.cachePool.pool),f=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(f=n.memoizedState.cachePool.pool),f!==o&&(n.flags|=2048),i!==null&&F(nn),null;case 24:return o=null,i!==null&&(o=i.memoizedState.cache),n.memoizedState.cache!==o&&(n.flags|=2048),Yi(ot),We(n),null;case 25:return null;case 30:return null}throw Error(s(156,n.tag))}function xS(i,n){switch(Tu(n),n.tag){case 1:return i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 3:return Yi(ot),ke(),i=n.flags,(i&65536)!==0&&(i&128)===0?(n.flags=i&-65537|128,n):null;case 26:case 27:case 5:return ni(n),null;case 31:if(n.memoizedState!==null){if(qt(n),n.alternate===null)throw Error(s(340));en()}return i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 13:if(qt(n),i=n.memoizedState,i!==null&&i.dehydrated!==null){if(n.alternate===null)throw Error(s(340));en()}return i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 19:return F(rt),null;case 4:return ke(),null;case 10:return Yi(n.type),null;case 22:case 23:return qt(n),Pu(),i!==null&&F(nn),i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 24:return Yi(ot),null;case 25:return null;default:return null}}function em(i,n){switch(Tu(n),n.tag){case 3:Yi(ot),ke();break;case 26:case 27:case 5:ni(n);break;case 4:ke();break;case 31:n.memoizedState!==null&&qt(n);break;case 13:qt(n);break;case 19:F(rt);break;case 10:Yi(n.type);break;case 22:case 23:qt(n),Pu(),i!==null&&F(nn);break;case 24:Yi(ot)}}function Wr(i,n){try{var o=n.updateQueue,f=o!==null?o.lastEffect:null;if(f!==null){var p=f.next;o=p;do{if((o.tag&i)===i){f=void 0;var y=o.create,A=o.inst;f=y(),A.destroy=f}o=o.next}while(o!==p)}}catch(D){$e(n,n.return,D)}}function Ls(i,n,o){try{var f=n.updateQueue,p=f!==null?f.lastEffect:null;if(p!==null){var y=p.next;f=y;do{if((f.tag&i)===i){var A=f.inst,D=A.destroy;if(D!==void 0){A.destroy=void 0,p=n;var M=o,V=D;try{V()}catch(Z){$e(p,M,Z)}}}f=f.next}while(f!==y)}}catch(Z){$e(n,n.return,Z)}}function tm(i){var n=i.updateQueue;if(n!==null){var o=i.stateNode;try{zh(n,o)}catch(f){$e(i,i.return,f)}}}function im(i,n,o){o.props=un(i.type,i.memoizedProps),o.state=i.memoizedState;try{o.componentWillUnmount()}catch(f){$e(i,n,f)}}function Zr(i,n){try{var o=i.ref;if(o!==null){switch(i.tag){case 26:case 27:case 5:var f=i.stateNode;break;case 30:f=i.stateNode;break;default:f=i.stateNode}typeof o=="function"?i.refCleanup=o(f):o.current=f}}catch(p){$e(i,n,p)}}function Ii(i,n){var o=i.ref,f=i.refCleanup;if(o!==null)if(typeof f=="function")try{f()}catch(p){$e(i,n,p)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(p){$e(i,n,p)}else o.current=null}function sm(i){var n=i.type,o=i.memoizedProps,f=i.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":o.autoFocus&&f.focus();break e;case"img":o.src?f.src=o.src:o.srcSet&&(f.srcset=o.srcSet)}}catch(p){$e(i,i.return,p)}}function gc(i,n,o){try{var f=i.stateNode;KS(f,i.type,o,n),f[kt]=n}catch(p){$e(i,i.return,p)}}function nm(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&ws(i.type)||i.tag===4}function mc(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||nm(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&ws(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function pc(i,n,o){var f=i.tag;if(f===5||f===6)i=i.stateNode,n?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(i,n):(n=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,n.appendChild(i),o=o._reactRootContainer,o!=null||n.onclick!==null||(n.onclick=ji));else if(f!==4&&(f===27&&ws(i.type)&&(o=i.stateNode,n=null),i=i.child,i!==null))for(pc(i,n,o),i=i.sibling;i!==null;)pc(i,n,o),i=i.sibling}function Ll(i,n,o){var f=i.tag;if(f===5||f===6)i=i.stateNode,n?o.insertBefore(i,n):o.appendChild(i);else if(f!==4&&(f===27&&ws(i.type)&&(o=i.stateNode),i=i.child,i!==null))for(Ll(i,n,o),i=i.sibling;i!==null;)Ll(i,n,o),i=i.sibling}function rm(i){var n=i.stateNode,o=i.memoizedProps;try{for(var f=i.type,p=n.attributes;p.length;)n.removeAttributeNode(p[0]);bt(n,f,o),n[St]=i,n[kt]=o}catch(y){$e(i,i.return,y)}}var Zi=!1,ft=!1,yc=!1,am=typeof WeakSet=="function"?WeakSet:Set,vt=null;function AS(i,n){if(i=i.containerInfo,Fc=Vl,i=vh(i),cu(i)){if("selectionStart"in i)var o={start:i.selectionStart,end:i.selectionEnd};else e:{o=(o=i.ownerDocument)&&o.defaultView||window;var f=o.getSelection&&o.getSelection();if(f&&f.rangeCount!==0){o=f.anchorNode;var p=f.anchorOffset,y=f.focusNode;f=f.focusOffset;try{o.nodeType,y.nodeType}catch{o=null;break e}var A=0,D=-1,M=-1,V=0,Z=0,ie=i,Y=null;t:for(;;){for(var q;ie!==o||p!==0&&ie.nodeType!==3||(D=A+p),ie!==y||f!==0&&ie.nodeType!==3||(M=A+f),ie.nodeType===3&&(A+=ie.nodeValue.length),(q=ie.firstChild)!==null;)Y=ie,ie=q;for(;;){if(ie===i)break t;if(Y===o&&++V===p&&(D=A),Y===y&&++Z===f&&(M=A),(q=ie.nextSibling)!==null)break;ie=Y,Y=ie.parentNode}ie=q}o=D===-1||M===-1?null:{start:D,end:M}}else o=null}o=o||{start:0,end:0}}else o=null;for(Bc={focusedElem:i,selectionRange:o},Vl=!1,vt=n;vt!==null;)if(n=vt,i=n.child,(n.subtreeFlags&1028)!==0&&i!==null)i.return=n,vt=i;else for(;vt!==null;){switch(n=vt,y=n.alternate,i=n.flags,n.tag){case 0:if((i&4)!==0&&(i=n.updateQueue,i=i!==null?i.events:null,i!==null))for(o=0;o<i.length;o++)p=i[o],p.ref.impl=p.nextImpl;break;case 11:case 15:break;case 1:if((i&1024)!==0&&y!==null){i=void 0,o=n,p=y.memoizedProps,y=y.memoizedState,f=o.stateNode;try{var me=un(o.type,p);i=f.getSnapshotBeforeUpdate(me,y),f.__reactInternalSnapshotBeforeUpdate=i}catch(Ee){$e(o,o.return,Ee)}}break;case 3:if((i&1024)!==0){if(i=n.stateNode.containerInfo,o=i.nodeType,o===9)jc(i);else if(o===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":jc(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(s(163))}if(i=n.sibling,i!==null){i.return=n.return,vt=i;break}vt=n.return}}function lm(i,n,o){var f=o.flags;switch(o.tag){case 0:case 11:case 15:es(i,o),f&4&&Wr(5,o);break;case 1:if(es(i,o),f&4)if(i=o.stateNode,n===null)try{i.componentDidMount()}catch(A){$e(o,o.return,A)}else{var p=un(o.type,n.memoizedProps);n=n.memoizedState;try{i.componentDidUpdate(p,n,i.__reactInternalSnapshotBeforeUpdate)}catch(A){$e(o,o.return,A)}}f&64&&tm(o),f&512&&Zr(o,o.return);break;case 3:if(es(i,o),f&64&&(i=o.updateQueue,i!==null)){if(n=null,o.child!==null)switch(o.child.tag){case 27:case 5:n=o.child.stateNode;break;case 1:n=o.child.stateNode}try{zh(i,n)}catch(A){$e(o,o.return,A)}}break;case 27:n===null&&f&4&&rm(o);case 26:case 5:es(i,o),n===null&&f&4&&sm(o),f&512&&Zr(o,o.return);break;case 12:es(i,o);break;case 31:es(i,o),f&4&&cm(i,o);break;case 13:es(i,o),f&4&&fm(i,o),f&64&&(i=o.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(o=wS.bind(null,o),ZS(i,o))));break;case 22:if(f=o.memoizedState!==null||Zi,!f){n=n!==null&&n.memoizedState!==null||ft,p=Zi;var y=ft;Zi=f,(ft=n)&&!y?ts(i,o,(o.subtreeFlags&8772)!==0):es(i,o),Zi=p,ft=y}break;case 30:break;default:es(i,o)}}function om(i){var n=i.alternate;n!==null&&(i.alternate=null,om(n)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(n=i.stateNode,n!==null&&Yo(n)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var Ze=null,Pt=!1;function Ji(i,n,o){for(o=o.child;o!==null;)um(i,n,o),o=o.sibling}function um(i,n,o){if(Ht&&typeof Ht.onCommitFiberUnmount=="function")try{Ht.onCommitFiberUnmount(xr,o)}catch{}switch(o.tag){case 26:ft||Ii(o,n),Ji(i,n,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:ft||Ii(o,n);var f=Ze,p=Pt;ws(o.type)&&(Ze=o.stateNode,Pt=!1),Ji(i,n,o),la(o.stateNode),Ze=f,Pt=p;break;case 5:ft||Ii(o,n);case 6:if(f=Ze,p=Pt,Ze=null,Ji(i,n,o),Ze=f,Pt=p,Ze!==null)if(Pt)try{(Ze.nodeType===9?Ze.body:Ze.nodeName==="HTML"?Ze.ownerDocument.body:Ze).removeChild(o.stateNode)}catch(y){$e(o,n,y)}else try{Ze.removeChild(o.stateNode)}catch(y){$e(o,n,y)}break;case 18:Ze!==null&&(Pt?(i=Ze,t0(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,o.stateNode),ir(i)):t0(Ze,o.stateNode));break;case 4:f=Ze,p=Pt,Ze=o.stateNode.containerInfo,Pt=!0,Ji(i,n,o),Ze=f,Pt=p;break;case 0:case 11:case 14:case 15:Ls(2,o,n),ft||Ls(4,o,n),Ji(i,n,o);break;case 1:ft||(Ii(o,n),f=o.stateNode,typeof f.componentWillUnmount=="function"&&im(o,n,f)),Ji(i,n,o);break;case 21:Ji(i,n,o);break;case 22:ft=(f=ft)||o.memoizedState!==null,Ji(i,n,o),ft=f;break;default:Ji(i,n,o)}}function cm(i,n){if(n.memoizedState===null&&(i=n.alternate,i!==null&&(i=i.memoizedState,i!==null))){i=i.dehydrated;try{ir(i)}catch(o){$e(n,n.return,o)}}}function fm(i,n){if(n.memoizedState===null&&(i=n.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{ir(i)}catch(o){$e(n,n.return,o)}}function bS(i){switch(i.tag){case 31:case 13:case 19:var n=i.stateNode;return n===null&&(n=i.stateNode=new am),n;case 22:return i=i.stateNode,n=i._retryCache,n===null&&(n=i._retryCache=new am),n;default:throw Error(s(435,i.tag))}}function Rl(i,n){var o=bS(i);n.forEach(function(f){if(!o.has(f)){o.add(f);var p=MS.bind(null,i,f);f.then(p,p)}})}function Ut(i,n){var o=n.deletions;if(o!==null)for(var f=0;f<o.length;f++){var p=o[f],y=i,A=n,D=A;e:for(;D!==null;){switch(D.tag){case 27:if(ws(D.type)){Ze=D.stateNode,Pt=!1;break e}break;case 5:Ze=D.stateNode,Pt=!1;break e;case 3:case 4:Ze=D.stateNode.containerInfo,Pt=!0;break e}D=D.return}if(Ze===null)throw Error(s(160));um(y,A,p),Ze=null,Pt=!1,y=p.alternate,y!==null&&(y.return=null),p.return=null}if(n.subtreeFlags&13886)for(n=n.child;n!==null;)dm(n,i),n=n.sibling}var xi=null;function dm(i,n){var o=i.alternate,f=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:Ut(n,i),Ft(i),f&4&&(Ls(3,i,i.return),Wr(3,i),Ls(5,i,i.return));break;case 1:Ut(n,i),Ft(i),f&512&&(ft||o===null||Ii(o,o.return)),f&64&&Zi&&(i=i.updateQueue,i!==null&&(f=i.callbacks,f!==null&&(o=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=o===null?f:o.concat(f))));break;case 26:var p=xi;if(Ut(n,i),Ft(i),f&512&&(ft||o===null||Ii(o,o.return)),f&4){var y=o!==null?o.memoizedState:null;if(f=i.memoizedState,o===null)if(f===null)if(i.stateNode===null){e:{f=i.type,o=i.memoizedProps,p=p.ownerDocument||p;t:switch(f){case"title":y=p.getElementsByTagName("title")[0],(!y||y[Lr]||y[St]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=p.createElement(f),p.head.insertBefore(y,p.querySelector("head > title"))),bt(y,f,o),y[St]=i,yt(y),f=y;break e;case"link":var A=d0("link","href",p).get(f+(o.href||""));if(A){for(var D=0;D<A.length;D++)if(y=A[D],y.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&y.getAttribute("rel")===(o.rel==null?null:o.rel)&&y.getAttribute("title")===(o.title==null?null:o.title)&&y.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){A.splice(D,1);break t}}y=p.createElement(f),bt(y,f,o),p.head.appendChild(y);break;case"meta":if(A=d0("meta","content",p).get(f+(o.content||""))){for(D=0;D<A.length;D++)if(y=A[D],y.getAttribute("content")===(o.content==null?null:""+o.content)&&y.getAttribute("name")===(o.name==null?null:o.name)&&y.getAttribute("property")===(o.property==null?null:o.property)&&y.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&y.getAttribute("charset")===(o.charSet==null?null:o.charSet)){A.splice(D,1);break t}}y=p.createElement(f),bt(y,f,o),p.head.appendChild(y);break;default:throw Error(s(468,f))}y[St]=i,yt(y),f=y}i.stateNode=f}else h0(p,i.type,i.stateNode);else i.stateNode=f0(p,f,i.memoizedProps);else y!==f?(y===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):y.count--,f===null?h0(p,i.type,i.stateNode):f0(p,f,i.memoizedProps)):f===null&&i.stateNode!==null&&gc(i,i.memoizedProps,o.memoizedProps)}break;case 27:Ut(n,i),Ft(i),f&512&&(ft||o===null||Ii(o,o.return)),o!==null&&f&4&&gc(i,i.memoizedProps,o.memoizedProps);break;case 5:if(Ut(n,i),Ft(i),f&512&&(ft||o===null||Ii(o,o.return)),i.flags&32){p=i.stateNode;try{Ln(p,"")}catch(me){$e(i,i.return,me)}}f&4&&i.stateNode!=null&&(p=i.memoizedProps,gc(i,p,o!==null?o.memoizedProps:p)),f&1024&&(yc=!0);break;case 6:if(Ut(n,i),Ft(i),f&4){if(i.stateNode===null)throw Error(s(162));f=i.memoizedProps,o=i.stateNode;try{o.nodeValue=f}catch(me){$e(i,i.return,me)}}break;case 3:if(jl=null,p=xi,xi=$l(n.containerInfo),Ut(n,i),xi=p,Ft(i),f&4&&o!==null&&o.memoizedState.isDehydrated)try{ir(n.containerInfo)}catch(me){$e(i,i.return,me)}yc&&(yc=!1,hm(i));break;case 4:f=xi,xi=$l(i.stateNode.containerInfo),Ut(n,i),Ft(i),xi=f;break;case 12:Ut(n,i),Ft(i);break;case 31:Ut(n,i),Ft(i),f&4&&(f=i.updateQueue,f!==null&&(i.updateQueue=null,Rl(i,f)));break;case 13:Ut(n,i),Ft(i),i.child.flags&8192&&i.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(Dl=pt()),f&4&&(f=i.updateQueue,f!==null&&(i.updateQueue=null,Rl(i,f)));break;case 22:p=i.memoizedState!==null;var M=o!==null&&o.memoizedState!==null,V=Zi,Z=ft;if(Zi=V||p,ft=Z||M,Ut(n,i),ft=Z,Zi=V,Ft(i),f&8192)e:for(n=i.stateNode,n._visibility=p?n._visibility&-2:n._visibility|1,p&&(o===null||M||Zi||ft||cn(i)),o=null,n=i;;){if(n.tag===5||n.tag===26){if(o===null){M=o=n;try{if(y=M.stateNode,p)A=y.style,typeof A.setProperty=="function"?A.setProperty("display","none","important"):A.display="none";else{D=M.stateNode;var ie=M.memoizedProps.style,Y=ie!=null&&ie.hasOwnProperty("display")?ie.display:null;D.style.display=Y==null||typeof Y=="boolean"?"":(""+Y).trim()}}catch(me){$e(M,M.return,me)}}}else if(n.tag===6){if(o===null){M=n;try{M.stateNode.nodeValue=p?"":M.memoizedProps}catch(me){$e(M,M.return,me)}}}else if(n.tag===18){if(o===null){M=n;try{var q=M.stateNode;p?i0(q,!0):i0(M.stateNode,!1)}catch(me){$e(M,M.return,me)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===i)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break e;for(;n.sibling===null;){if(n.return===null||n.return===i)break e;o===n&&(o=null),n=n.return}o===n&&(o=null),n.sibling.return=n.return,n=n.sibling}f&4&&(f=i.updateQueue,f!==null&&(o=f.retryQueue,o!==null&&(f.retryQueue=null,Rl(i,o))));break;case 19:Ut(n,i),Ft(i),f&4&&(f=i.updateQueue,f!==null&&(i.updateQueue=null,Rl(i,f)));break;case 30:break;case 21:break;default:Ut(n,i),Ft(i)}}function Ft(i){var n=i.flags;if(n&2){try{for(var o,f=i.return;f!==null;){if(nm(f)){o=f;break}f=f.return}if(o==null)throw Error(s(160));switch(o.tag){case 27:var p=o.stateNode,y=mc(i);Ll(i,y,p);break;case 5:var A=o.stateNode;o.flags&32&&(Ln(A,""),o.flags&=-33);var D=mc(i);Ll(i,D,A);break;case 3:case 4:var M=o.stateNode.containerInfo,V=mc(i);pc(i,V,M);break;default:throw Error(s(161))}}catch(Z){$e(i,i.return,Z)}i.flags&=-3}n&4096&&(i.flags&=-4097)}function hm(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var n=i;hm(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),i=i.sibling}}function es(i,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)lm(i,n.alternate,n),n=n.sibling}function cn(i){for(i=i.child;i!==null;){var n=i;switch(n.tag){case 0:case 11:case 14:case 15:Ls(4,n,n.return),cn(n);break;case 1:Ii(n,n.return);var o=n.stateNode;typeof o.componentWillUnmount=="function"&&im(n,n.return,o),cn(n);break;case 27:la(n.stateNode);case 26:case 5:Ii(n,n.return),cn(n);break;case 22:n.memoizedState===null&&cn(n);break;case 30:cn(n);break;default:cn(n)}i=i.sibling}}function ts(i,n,o){for(o=o&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var f=n.alternate,p=i,y=n,A=y.flags;switch(y.tag){case 0:case 11:case 15:ts(p,y,o),Wr(4,y);break;case 1:if(ts(p,y,o),f=y,p=f.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(V){$e(f,f.return,V)}if(f=y,p=f.updateQueue,p!==null){var D=f.stateNode;try{var M=p.shared.hiddenCallbacks;if(M!==null)for(p.shared.hiddenCallbacks=null,p=0;p<M.length;p++)Kh(M[p],D)}catch(V){$e(f,f.return,V)}}o&&A&64&&tm(y),Zr(y,y.return);break;case 27:rm(y);case 26:case 5:ts(p,y,o),o&&f===null&&A&4&&sm(y),Zr(y,y.return);break;case 12:ts(p,y,o);break;case 31:ts(p,y,o),o&&A&4&&cm(p,y);break;case 13:ts(p,y,o),o&&A&4&&fm(p,y);break;case 22:y.memoizedState===null&&ts(p,y,o),Zr(y,y.return);break;case 30:break;default:ts(p,y,o)}n=n.sibling}}function vc(i,n){var o=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(o=i.memoizedState.cachePool.pool),i=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(i=n.memoizedState.cachePool.pool),i!==o&&(i!=null&&i.refCount++,o!=null&&Fr(o))}function Ec(i,n){i=null,n.alternate!==null&&(i=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==i&&(n.refCount++,i!=null&&Fr(i))}function Ai(i,n,o,f){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)gm(i,n,o,f),n=n.sibling}function gm(i,n,o,f){var p=n.flags;switch(n.tag){case 0:case 11:case 15:Ai(i,n,o,f),p&2048&&Wr(9,n);break;case 1:Ai(i,n,o,f);break;case 3:Ai(i,n,o,f),p&2048&&(i=null,n.alternate!==null&&(i=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==i&&(n.refCount++,i!=null&&Fr(i)));break;case 12:if(p&2048){Ai(i,n,o,f),i=n.stateNode;try{var y=n.memoizedProps,A=y.id,D=y.onPostCommit;typeof D=="function"&&D(A,n.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(M){$e(n,n.return,M)}}else Ai(i,n,o,f);break;case 31:Ai(i,n,o,f);break;case 13:Ai(i,n,o,f);break;case 23:break;case 22:y=n.stateNode,A=n.alternate,n.memoizedState!==null?y._visibility&2?Ai(i,n,o,f):Jr(i,n):y._visibility&2?Ai(i,n,o,f):(y._visibility|=2,zn(i,n,o,f,(n.subtreeFlags&10256)!==0||!1)),p&2048&&vc(A,n);break;case 24:Ai(i,n,o,f),p&2048&&Ec(n.alternate,n);break;default:Ai(i,n,o,f)}}function zn(i,n,o,f,p){for(p=p&&((n.subtreeFlags&10256)!==0||!1),n=n.child;n!==null;){var y=i,A=n,D=o,M=f,V=A.flags;switch(A.tag){case 0:case 11:case 15:zn(y,A,D,M,p),Wr(8,A);break;case 23:break;case 22:var Z=A.stateNode;A.memoizedState!==null?Z._visibility&2?zn(y,A,D,M,p):Jr(y,A):(Z._visibility|=2,zn(y,A,D,M,p)),p&&V&2048&&vc(A.alternate,A);break;case 24:zn(y,A,D,M,p),p&&V&2048&&Ec(A.alternate,A);break;default:zn(y,A,D,M,p)}n=n.sibling}}function Jr(i,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var o=i,f=n,p=f.flags;switch(f.tag){case 22:Jr(o,f),p&2048&&vc(f.alternate,f);break;case 24:Jr(o,f),p&2048&&Ec(f.alternate,f);break;default:Jr(o,f)}n=n.sibling}}var ea=8192;function Vn(i,n,o){if(i.subtreeFlags&ea)for(i=i.child;i!==null;)mm(i,n,o),i=i.sibling}function mm(i,n,o){switch(i.tag){case 26:Vn(i,n,o),i.flags&ea&&i.memoizedState!==null&&cT(o,xi,i.memoizedState,i.memoizedProps);break;case 5:Vn(i,n,o);break;case 3:case 4:var f=xi;xi=$l(i.stateNode.containerInfo),Vn(i,n,o),xi=f;break;case 22:i.memoizedState===null&&(f=i.alternate,f!==null&&f.memoizedState!==null?(f=ea,ea=16777216,Vn(i,n,o),ea=f):Vn(i,n,o));break;default:Vn(i,n,o)}}function pm(i){var n=i.alternate;if(n!==null&&(i=n.child,i!==null)){n.child=null;do n=i.sibling,i.sibling=null,i=n;while(i!==null)}}function ta(i){var n=i.deletions;if((i.flags&16)!==0){if(n!==null)for(var o=0;o<n.length;o++){var f=n[o];vt=f,vm(f,i)}pm(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)ym(i),i=i.sibling}function ym(i){switch(i.tag){case 0:case 11:case 15:ta(i),i.flags&2048&&Ls(9,i,i.return);break;case 3:ta(i);break;case 12:ta(i);break;case 22:var n=i.stateNode;i.memoizedState!==null&&n._visibility&2&&(i.return===null||i.return.tag!==13)?(n._visibility&=-3,_l(i)):ta(i);break;default:ta(i)}}function _l(i){var n=i.deletions;if((i.flags&16)!==0){if(n!==null)for(var o=0;o<n.length;o++){var f=n[o];vt=f,vm(f,i)}pm(i)}for(i=i.child;i!==null;){switch(n=i,n.tag){case 0:case 11:case 15:Ls(8,n,n.return),_l(n);break;case 22:o=n.stateNode,o._visibility&2&&(o._visibility&=-3,_l(n));break;default:_l(n)}i=i.sibling}}function vm(i,n){for(;vt!==null;){var o=vt;switch(o.tag){case 0:case 11:case 15:Ls(8,o,n);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var f=o.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:Fr(o.memoizedState.cache)}if(f=o.child,f!==null)f.return=o,vt=f;else e:for(o=i;vt!==null;){f=vt;var p=f.sibling,y=f.return;if(om(f),f===o){vt=null;break e}if(p!==null){p.return=y,vt=p;break e}vt=y}}}var LS={getCacheForType:function(i){var n=xt(ot),o=n.data.get(i);return o===void 0&&(o=i(),n.data.set(i,o)),o},cacheSignal:function(){return xt(ot).controller.signal}},RS=typeof WeakMap=="function"?WeakMap:Map,Fe=0,Ye=null,De=null,Oe=0,Be=0,Xt=null,Rs=!1,Yn=!1,Sc=!1,is=0,st=0,_s=0,fn=0,Tc=0,Qt=0,qn=0,ia=null,Bt=null,xc=!1,Dl=0,Em=0,Il=1/0,Cl=null,Ds=null,dt=0,Is=null,Xn=null,ss=0,Ac=0,bc=null,Sm=null,sa=0,Lc=null;function Wt(){return(Fe&2)!==0&&Oe!==0?Oe&-Oe:N.T!==null?Oc():Pd()}function Tm(){if(Qt===0)if((Oe&536870912)===0||Me){var i=Fa;Fa<<=1,(Fa&3932160)===0&&(Fa=262144),Qt=i}else Qt=536870912;return i=Yt.current,i!==null&&(i.flags|=32),Qt}function $t(i,n,o){(i===Ye&&(Be===2||Be===9)||i.cancelPendingCommit!==null)&&(Qn(i,0),Cs(i,Oe,Qt,!1)),br(i,o),((Fe&2)===0||i!==Ye)&&(i===Ye&&((Fe&2)===0&&(fn|=o),st===4&&Cs(i,Oe,Qt,!1)),Ci(i))}function xm(i,n,o){if((Fe&6)!==0)throw Error(s(327));var f=!o&&(n&127)===0&&(n&i.expiredLanes)===0||Ar(i,n),p=f?IS(i,n):_c(i,n,!0),y=f;do{if(p===0){Yn&&!f&&Cs(i,n,0,!1);break}else{if(o=i.current.alternate,y&&!_S(o)){p=_c(i,n,!1),y=!1;continue}if(p===2){if(y=n,i.errorRecoveryDisabledLanes&y)var A=0;else A=i.pendingLanes&-536870913,A=A!==0?A:A&536870912?536870912:0;if(A!==0){n=A;e:{var D=i;p=ia;var M=D.current.memoizedState.isDehydrated;if(M&&(Qn(D,A).flags|=256),A=_c(D,A,!1),A!==2){if(Sc&&!M){D.errorRecoveryDisabledLanes|=y,fn|=y,p=4;break e}y=Bt,Bt=p,y!==null&&(Bt===null?Bt=y:Bt.push.apply(Bt,y))}p=A}if(y=!1,p!==2)continue}}if(p===1){Qn(i,0),Cs(i,n,0,!0);break}e:{switch(f=i,y=p,y){case 0:case 1:throw Error(s(345));case 4:if((n&4194048)!==n)break;case 6:Cs(f,n,Qt,!Rs);break e;case 2:Bt=null;break;case 3:case 5:break;default:throw Error(s(329))}if((n&62914560)===n&&(p=Dl+300-pt(),10<p)){if(Cs(f,n,Qt,!Rs),$a(f,0,!0)!==0)break e;ss=n,f.timeoutHandle=Jm(Am.bind(null,f,o,Bt,Cl,xc,n,Qt,fn,qn,Rs,y,"Throttled",-0,0),p);break e}Am(f,o,Bt,Cl,xc,n,Qt,fn,qn,Rs,y,null,-0,0)}}break}while(!0);Ci(i)}function Am(i,n,o,f,p,y,A,D,M,V,Z,ie,Y,q){if(i.timeoutHandle=-1,ie=n.subtreeFlags,ie&8192||(ie&16785408)===16785408){ie={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ji},mm(n,y,ie);var me=(y&62914560)===y?Dl-pt():(y&4194048)===y?Em-pt():0;if(me=fT(ie,me),me!==null){ss=y,i.cancelPendingCommit=me(Om.bind(null,i,n,y,o,f,p,A,D,M,Z,ie,null,Y,q)),Cs(i,y,A,!V);return}}Om(i,n,y,o,f,p,A,D,M)}function _S(i){for(var n=i;;){var o=n.tag;if((o===0||o===11||o===15)&&n.flags&16384&&(o=n.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var f=0;f<o.length;f++){var p=o[f],y=p.getSnapshot;p=p.value;try{if(!zt(y(),p))return!1}catch{return!1}}if(o=n.child,n.subtreeFlags&16384&&o!==null)o.return=n,n=o;else{if(n===i)break;for(;n.sibling===null;){if(n.return===null||n.return===i)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Cs(i,n,o,f){n&=~Tc,n&=~fn,i.suspendedLanes|=n,i.pingedLanes&=~n,f&&(i.warmLanes|=n),f=i.expirationTimes;for(var p=n;0<p;){var y=31-Kt(p),A=1<<y;f[y]=-1,p&=~A}o!==0&&Md(i,o,n)}function Ol(){return(Fe&6)===0?(na(0),!1):!0}function Rc(){if(De!==null){if(Be===0)var i=De.return;else i=De,Vi=tn=null,ju(i),$n=null,$r=0,i=De;for(;i!==null;)em(i.alternate,i),i=i.return;De=null}}function Qn(i,n){var o=i.timeoutHandle;o!==-1&&(i.timeoutHandle=-1,YS(o)),o=i.cancelPendingCommit,o!==null&&(i.cancelPendingCommit=null,o()),ss=0,Rc(),Ye=i,De=o=Ki(i.current,null),Oe=n,Be=0,Xt=null,Rs=!1,Yn=Ar(i,n),Sc=!1,qn=Qt=Tc=fn=_s=st=0,Bt=ia=null,xc=!1,(n&8)!==0&&(n|=n&32);var f=i.entangledLanes;if(f!==0)for(i=i.entanglements,f&=n;0<f;){var p=31-Kt(f),y=1<<p;n|=i[p],f&=~y}return is=n,Za(),o}function bm(i,n){be=null,N.H=qr,n===Bn||n===al?(n=$h(),Be=3):n===Cu?(n=$h(),Be=4):Be=n===nc?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,Xt=n,De===null&&(st=1,Sl(i,oi(n,i.current)))}function Lm(){var i=Yt.current;return i===null?!0:(Oe&4194048)===Oe?di===null:(Oe&62914560)===Oe||(Oe&536870912)!==0?i===di:!1}function Rm(){var i=N.H;return N.H=qr,i===null?qr:i}function _m(){var i=N.A;return N.A=LS,i}function wl(){st=4,Rs||(Oe&4194048)!==Oe&&Yt.current!==null||(Yn=!0),(_s&134217727)===0&&(fn&134217727)===0||Ye===null||Cs(Ye,Oe,Qt,!1)}function _c(i,n,o){var f=Fe;Fe|=2;var p=Rm(),y=_m();(Ye!==i||Oe!==n)&&(Cl=null,Qn(i,n)),n=!1;var A=st;e:do try{if(Be!==0&&De!==null){var D=De,M=Xt;switch(Be){case 8:Rc(),A=6;break e;case 3:case 2:case 9:case 6:Yt.current===null&&(n=!0);var V=Be;if(Be=0,Xt=null,Wn(i,D,M,V),o&&Yn){A=0;break e}break;default:V=Be,Be=0,Xt=null,Wn(i,D,M,V)}}DS(),A=st;break}catch(Z){bm(i,Z)}while(!0);return n&&i.shellSuspendCounter++,Vi=tn=null,Fe=f,N.H=p,N.A=y,De===null&&(Ye=null,Oe=0,Za()),A}function DS(){for(;De!==null;)Dm(De)}function IS(i,n){var o=Fe;Fe|=2;var f=Rm(),p=_m();Ye!==i||Oe!==n?(Cl=null,Il=pt()+500,Qn(i,n)):Yn=Ar(i,n);e:do try{if(Be!==0&&De!==null){n=De;var y=Xt;t:switch(Be){case 1:Be=0,Xt=null,Wn(i,n,y,1);break;case 2:case 9:if(Fh(y)){Be=0,Xt=null,Im(n);break}n=function(){Be!==2&&Be!==9||Ye!==i||(Be=7),Ci(i)},y.then(n,n);break e;case 3:Be=7;break e;case 4:Be=5;break e;case 7:Fh(y)?(Be=0,Xt=null,Im(n)):(Be=0,Xt=null,Wn(i,n,y,7));break;case 5:var A=null;switch(De.tag){case 26:A=De.memoizedState;case 5:case 27:var D=De;if(A?g0(A):D.stateNode.complete){Be=0,Xt=null;var M=D.sibling;if(M!==null)De=M;else{var V=D.return;V!==null?(De=V,Ml(V)):De=null}break t}}Be=0,Xt=null,Wn(i,n,y,5);break;case 6:Be=0,Xt=null,Wn(i,n,y,6);break;case 8:Rc(),st=6;break e;default:throw Error(s(462))}}CS();break}catch(Z){bm(i,Z)}while(!0);return Vi=tn=null,N.H=f,N.A=p,Fe=o,De!==null?0:(Ye=null,Oe=0,Za(),st)}function CS(){for(;De!==null&&!$i();)Dm(De)}function Dm(i){var n=Zg(i.alternate,i,is);i.memoizedProps=i.pendingProps,n===null?Ml(i):De=n}function Im(i){var n=i,o=n.alternate;switch(n.tag){case 15:case 0:n=Vg(o,n,n.pendingProps,n.type,void 0,Oe);break;case 11:n=Vg(o,n,n.pendingProps,n.type.render,n.ref,Oe);break;case 5:ju(n);default:em(o,n),n=De=_h(n,is),n=Zg(o,n,is)}i.memoizedProps=i.pendingProps,n===null?Ml(i):De=n}function Wn(i,n,o,f){Vi=tn=null,ju(n),$n=null,$r=0;var p=n.return;try{if(vS(i,p,n,o,Oe)){st=1,Sl(i,oi(o,i.current)),De=null;return}}catch(y){if(p!==null)throw De=p,y;st=1,Sl(i,oi(o,i.current)),De=null;return}n.flags&32768?(Me||f===1?i=!0:Yn||(Oe&536870912)!==0?i=!1:(Rs=i=!0,(f===2||f===9||f===3||f===6)&&(f=Yt.current,f!==null&&f.tag===13&&(f.flags|=16384))),Cm(n,i)):Ml(n)}function Ml(i){var n=i;do{if((n.flags&32768)!==0){Cm(n,Rs);return}i=n.return;var o=TS(n.alternate,n,is);if(o!==null){De=o;return}if(n=n.sibling,n!==null){De=n;return}De=n=i}while(n!==null);st===0&&(st=5)}function Cm(i,n){do{var o=xS(i.alternate,i);if(o!==null){o.flags&=32767,De=o;return}if(o=i.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!n&&(i=i.sibling,i!==null)){De=i;return}De=i=o}while(i!==null);st=6,De=null}function Om(i,n,o,f,p,y,A,D,M){i.cancelPendingCommit=null;do kl();while(dt!==0);if((Fe&6)!==0)throw Error(s(327));if(n!==null){if(n===i.current)throw Error(s(177));if(y=n.lanes|n.childLanes,y|=mu,uE(i,o,y,A,D,M),i===Ye&&(De=Ye=null,Oe=0),Xn=n,Is=i,ss=o,Ac=y,bc=p,Sm=f,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,kS(vn,function(){return Pm(),null})):(i.callbackNode=null,i.callbackPriority=0),f=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||f){f=N.T,N.T=null,p=X.p,X.p=2,A=Fe,Fe|=4;try{AS(i,n,o)}finally{Fe=A,X.p=p,N.T=f}}dt=1,wm(),Mm(),km()}}function wm(){if(dt===1){dt=0;var i=Is,n=Xn,o=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||o){o=N.T,N.T=null;var f=X.p;X.p=2;var p=Fe;Fe|=4;try{dm(n,i);var y=Bc,A=vh(i.containerInfo),D=y.focusedElem,M=y.selectionRange;if(A!==D&&D&&D.ownerDocument&&yh(D.ownerDocument.documentElement,D)){if(M!==null&&cu(D)){var V=M.start,Z=M.end;if(Z===void 0&&(Z=V),"selectionStart"in D)D.selectionStart=V,D.selectionEnd=Math.min(Z,D.value.length);else{var ie=D.ownerDocument||document,Y=ie&&ie.defaultView||window;if(Y.getSelection){var q=Y.getSelection(),me=D.textContent.length,Ee=Math.min(M.start,me),ze=M.end===void 0?Ee:Math.min(M.end,me);!q.extend&&Ee>ze&&(A=ze,ze=Ee,Ee=A);var G=ph(D,Ee),P=ph(D,ze);if(G&&P&&(q.rangeCount!==1||q.anchorNode!==G.node||q.anchorOffset!==G.offset||q.focusNode!==P.node||q.focusOffset!==P.offset)){var z=ie.createRange();z.setStart(G.node,G.offset),q.removeAllRanges(),Ee>ze?(q.addRange(z),q.extend(P.node,P.offset)):(z.setEnd(P.node,P.offset),q.addRange(z))}}}}for(ie=[],q=D;q=q.parentNode;)q.nodeType===1&&ie.push({element:q,left:q.scrollLeft,top:q.scrollTop});for(typeof D.focus=="function"&&D.focus(),D=0;D<ie.length;D++){var te=ie[D];te.element.scrollLeft=te.left,te.element.scrollTop=te.top}}Vl=!!Fc,Bc=Fc=null}finally{Fe=p,X.p=f,N.T=o}}i.current=n,dt=2}}function Mm(){if(dt===2){dt=0;var i=Is,n=Xn,o=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||o){o=N.T,N.T=null;var f=X.p;X.p=2;var p=Fe;Fe|=4;try{lm(i,n.alternate,n)}finally{Fe=p,X.p=f,N.T=o}}dt=3}}function km(){if(dt===4||dt===3){dt=0,ka();var i=Is,n=Xn,o=ss,f=Sm;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?dt=5:(dt=0,Xn=Is=null,Nm(i,i.pendingLanes));var p=i.pendingLanes;if(p===0&&(Ds=null),zo(o),n=n.stateNode,Ht&&typeof Ht.onCommitFiberRoot=="function")try{Ht.onCommitFiberRoot(xr,n,void 0,(n.current.flags&128)===128)}catch{}if(f!==null){n=N.T,p=X.p,X.p=2,N.T=null;try{for(var y=i.onRecoverableError,A=0;A<f.length;A++){var D=f[A];y(D.value,{componentStack:D.stack})}}finally{N.T=n,X.p=p}}(ss&3)!==0&&kl(),Ci(i),p=i.pendingLanes,(o&261930)!==0&&(p&42)!==0?i===Lc?sa++:(sa=0,Lc=i):sa=0,na(0)}}function Nm(i,n){(i.pooledCacheLanes&=n)===0&&(n=i.pooledCache,n!=null&&(i.pooledCache=null,Fr(n)))}function kl(){return wm(),Mm(),km(),Pm()}function Pm(){if(dt!==5)return!1;var i=Is,n=Ac;Ac=0;var o=zo(ss),f=N.T,p=X.p;try{X.p=32>o?32:o,N.T=null,o=bc,bc=null;var y=Is,A=ss;if(dt=0,Xn=Is=null,ss=0,(Fe&6)!==0)throw Error(s(331));var D=Fe;if(Fe|=4,ym(y.current),gm(y,y.current,A,o),Fe=D,na(0,!1),Ht&&typeof Ht.onPostCommitFiberRoot=="function")try{Ht.onPostCommitFiberRoot(xr,y)}catch{}return!0}finally{X.p=p,N.T=f,Nm(i,n)}}function Um(i,n,o){n=oi(o,n),n=sc(i.stateNode,n,2),i=xs(i,n,2),i!==null&&(br(i,2),Ci(i))}function $e(i,n,o){if(i.tag===3)Um(i,i,o);else for(;n!==null;){if(n.tag===3){Um(n,i,o);break}else if(n.tag===1){var f=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Ds===null||!Ds.has(f))){i=oi(o,i),o=Fg(2),f=xs(n,o,2),f!==null&&(Bg(o,f,n,i),br(f,2),Ci(f));break}}n=n.return}}function Dc(i,n,o){var f=i.pingCache;if(f===null){f=i.pingCache=new RS;var p=new Set;f.set(n,p)}else p=f.get(n),p===void 0&&(p=new Set,f.set(n,p));p.has(o)||(Sc=!0,p.add(o),i=OS.bind(null,i,n,o),n.then(i,i))}function OS(i,n,o){var f=i.pingCache;f!==null&&f.delete(n),i.pingedLanes|=i.suspendedLanes&o,i.warmLanes&=~o,Ye===i&&(Oe&o)===o&&(st===4||st===3&&(Oe&62914560)===Oe&&300>pt()-Dl?(Fe&2)===0&&Qn(i,0):Tc|=o,qn===Oe&&(qn=0)),Ci(i)}function Fm(i,n){n===0&&(n=wd()),i=Zs(i,n),i!==null&&(br(i,n),Ci(i))}function wS(i){var n=i.memoizedState,o=0;n!==null&&(o=n.retryLane),Fm(i,o)}function MS(i,n){var o=0;switch(i.tag){case 31:case 13:var f=i.stateNode,p=i.memoizedState;p!==null&&(o=p.retryLane);break;case 19:f=i.stateNode;break;case 22:f=i.stateNode._retryCache;break;default:throw Error(s(314))}f!==null&&f.delete(n),Fm(i,o)}function kS(i,n){return Ot(i,n)}var Nl=null,Zn=null,Ic=!1,Pl=!1,Cc=!1,Os=0;function Ci(i){i!==Zn&&i.next===null&&(Zn===null?Nl=Zn=i:Zn=Zn.next=i),Pl=!0,Ic||(Ic=!0,PS())}function na(i,n){if(!Cc&&Pl){Cc=!0;do for(var o=!1,f=Nl;f!==null;){if(i!==0){var p=f.pendingLanes;if(p===0)var y=0;else{var A=f.suspendedLanes,D=f.pingedLanes;y=(1<<31-Kt(42|i)+1)-1,y&=p&~(A&~D),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(o=!0,jm(f,y))}else y=Oe,y=$a(f,f===Ye?y:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(y&3)===0||Ar(f,y)||(o=!0,jm(f,y));f=f.next}while(o);Cc=!1}}function NS(){Bm()}function Bm(){Pl=Ic=!1;var i=0;Os!==0&&VS()&&(i=Os);for(var n=pt(),o=null,f=Nl;f!==null;){var p=f.next,y=$m(f,n);y===0?(f.next=null,o===null?Nl=p:o.next=p,p===null&&(Zn=o)):(o=f,(i!==0||(y&3)!==0)&&(Pl=!0)),f=p}dt!==0&&dt!==5||na(i),Os!==0&&(Os=0)}function $m(i,n){for(var o=i.suspendedLanes,f=i.pingedLanes,p=i.expirationTimes,y=i.pendingLanes&-62914561;0<y;){var A=31-Kt(y),D=1<<A,M=p[A];M===-1?((D&o)===0||(D&f)!==0)&&(p[A]=oE(D,n)):M<=n&&(i.expiredLanes|=D),y&=~D}if(n=Ye,o=Oe,o=$a(i,i===n?o:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),f=i.callbackNode,o===0||i===n&&(Be===2||Be===9)||i.cancelPendingCommit!==null)return f!==null&&f!==null&&Ri(f),i.callbackNode=null,i.callbackPriority=0;if((o&3)===0||Ar(i,o)){if(n=o&-o,n===i.callbackPriority)return n;switch(f!==null&&Ri(f),zo(o)){case 2:case 8:o=Sr;break;case 32:o=vn;break;case 268435456:o=Tr;break;default:o=vn}return f=Gm.bind(null,i),o=Ot(o,f),i.callbackPriority=n,i.callbackNode=o,n}return f!==null&&f!==null&&Ri(f),i.callbackPriority=2,i.callbackNode=null,2}function Gm(i,n){if(dt!==0&&dt!==5)return i.callbackNode=null,i.callbackPriority=0,null;var o=i.callbackNode;if(kl()&&i.callbackNode!==o)return null;var f=Oe;return f=$a(i,i===Ye?f:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),f===0?null:(xm(i,f,n),$m(i,pt()),i.callbackNode!=null&&i.callbackNode===o?Gm.bind(null,i):null)}function jm(i,n){if(kl())return null;xm(i,n,!0)}function PS(){qS(function(){(Fe&6)!==0?Ot(ds,NS):Bm()})}function Oc(){if(Os===0){var i=Un;i===0&&(i=Ua,Ua<<=1,(Ua&261888)===0&&(Ua=256)),Os=i}return Os}function Hm(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:Ka(""+i)}function Km(i,n){var o=n.ownerDocument.createElement("input");return o.name=n.name,o.value=n.value,i.id&&o.setAttribute("form",i.id),n.parentNode.insertBefore(o,n),i=new FormData(i),o.parentNode.removeChild(o),i}function US(i,n,o,f,p){if(n==="submit"&&o&&o.stateNode===p){var y=Hm((p[kt]||null).action),A=f.submitter;A&&(n=(n=A[kt]||null)?Hm(n.formAction):A.getAttribute("formAction"),n!==null&&(y=n,A=null));var D=new qa("action","action",null,f,p);i.push({event:D,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(Os!==0){var M=A?Km(p,A):new FormData(p);Wu(o,{pending:!0,data:M,method:p.method,action:y},null,M)}}else typeof y=="function"&&(D.preventDefault(),M=A?Km(p,A):new FormData(p),Wu(o,{pending:!0,data:M,method:p.method,action:y},y,M))},currentTarget:p}]})}}for(var wc=0;wc<gu.length;wc++){var Mc=gu[wc],FS=Mc.toLowerCase(),BS=Mc[0].toUpperCase()+Mc.slice(1);Ti(FS,"on"+BS)}Ti(Th,"onAnimationEnd"),Ti(xh,"onAnimationIteration"),Ti(Ah,"onAnimationStart"),Ti("dblclick","onDoubleClick"),Ti("focusin","onFocus"),Ti("focusout","onBlur"),Ti(tS,"onTransitionRun"),Ti(iS,"onTransitionStart"),Ti(sS,"onTransitionCancel"),Ti(bh,"onTransitionEnd"),An("onMouseEnter",["mouseout","mouseover"]),An("onMouseLeave",["mouseout","mouseover"]),An("onPointerEnter",["pointerout","pointerover"]),An("onPointerLeave",["pointerout","pointerover"]),qs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),qs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),qs("onBeforeInput",["compositionend","keypress","textInput","paste"]),qs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),qs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),qs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ra="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$S=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ra));function zm(i,n){n=(n&4)!==0;for(var o=0;o<i.length;o++){var f=i[o],p=f.event;f=f.listeners;e:{var y=void 0;if(n)for(var A=f.length-1;0<=A;A--){var D=f[A],M=D.instance,V=D.currentTarget;if(D=D.listener,M!==y&&p.isPropagationStopped())break e;y=D,p.currentTarget=V;try{y(p)}catch(Z){Wa(Z)}p.currentTarget=null,y=M}else for(A=0;A<f.length;A++){if(D=f[A],M=D.instance,V=D.currentTarget,D=D.listener,M!==y&&p.isPropagationStopped())break e;y=D,p.currentTarget=V;try{y(p)}catch(Z){Wa(Z)}p.currentTarget=null,y=M}}}}function Ie(i,n){var o=n[Vo];o===void 0&&(o=n[Vo]=new Set);var f=i+"__bubble";o.has(f)||(Vm(n,i,2,!1),o.add(f))}function kc(i,n,o){var f=0;n&&(f|=4),Vm(o,i,f,n)}var Ul="_reactListening"+Math.random().toString(36).slice(2);function Nc(i){if(!i[Ul]){i[Ul]=!0,Bd.forEach(function(o){o!=="selectionchange"&&($S.has(o)||kc(o,!1,i),kc(o,!0,i))});var n=i.nodeType===9?i:i.ownerDocument;n===null||n[Ul]||(n[Ul]=!0,kc("selectionchange",!1,n))}}function Vm(i,n,o,f){switch(T0(n)){case 2:var p=gT;break;case 8:p=mT;break;default:p=Qc}o=p.bind(null,n,o,i),p=void 0,!tu||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(p=!0),f?p!==void 0?i.addEventListener(n,o,{capture:!0,passive:p}):i.addEventListener(n,o,!0):p!==void 0?i.addEventListener(n,o,{passive:p}):i.addEventListener(n,o,!1)}function Pc(i,n,o,f,p){var y=f;if((n&1)===0&&(n&2)===0&&f!==null)e:for(;;){if(f===null)return;var A=f.tag;if(A===3||A===4){var D=f.stateNode.containerInfo;if(D===p)break;if(A===4)for(A=f.return;A!==null;){var M=A.tag;if((M===3||M===4)&&A.stateNode.containerInfo===p)return;A=A.return}for(;D!==null;){if(A=Sn(D),A===null)return;if(M=A.tag,M===5||M===6||M===26||M===27){f=y=A;continue e}D=D.parentNode}}f=f.return}Wd(function(){var V=y,Z=Jo(o),ie=[];e:{var Y=Lh.get(i);if(Y!==void 0){var q=qa,me=i;switch(i){case"keypress":if(Va(o)===0)break e;case"keydown":case"keyup":q=ME;break;case"focusin":me="focus",q=ru;break;case"focusout":me="blur",q=ru;break;case"beforeblur":case"afterblur":q=ru;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":q=eh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":q=TE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":q=PE;break;case Th:case xh:case Ah:q=bE;break;case bh:q=FE;break;case"scroll":case"scrollend":q=EE;break;case"wheel":q=$E;break;case"copy":case"cut":case"paste":q=RE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":q=ih;break;case"toggle":case"beforetoggle":q=jE}var Ee=(n&4)!==0,ze=!Ee&&(i==="scroll"||i==="scrollend"),G=Ee?Y!==null?Y+"Capture":null:Y;Ee=[];for(var P=V,z;P!==null;){var te=P;if(z=te.stateNode,te=te.tag,te!==5&&te!==26&&te!==27||z===null||G===null||(te=_r(P,G),te!=null&&Ee.push(aa(P,te,z))),ze)break;P=P.return}0<Ee.length&&(Y=new q(Y,me,null,o,Z),ie.push({event:Y,listeners:Ee}))}}if((n&7)===0){e:{if(Y=i==="mouseover"||i==="pointerover",q=i==="mouseout"||i==="pointerout",Y&&o!==Zo&&(me=o.relatedTarget||o.fromElement)&&(Sn(me)||me[En]))break e;if((q||Y)&&(Y=Z.window===Z?Z:(Y=Z.ownerDocument)?Y.defaultView||Y.parentWindow:window,q?(me=o.relatedTarget||o.toElement,q=V,me=me?Sn(me):null,me!==null&&(ze=a(me),Ee=me.tag,me!==ze||Ee!==5&&Ee!==27&&Ee!==6)&&(me=null)):(q=null,me=V),q!==me)){if(Ee=eh,te="onMouseLeave",G="onMouseEnter",P="mouse",(i==="pointerout"||i==="pointerover")&&(Ee=ih,te="onPointerLeave",G="onPointerEnter",P="pointer"),ze=q==null?Y:Rr(q),z=me==null?Y:Rr(me),Y=new Ee(te,P+"leave",q,o,Z),Y.target=ze,Y.relatedTarget=z,te=null,Sn(Z)===V&&(Ee=new Ee(G,P+"enter",me,o,Z),Ee.target=z,Ee.relatedTarget=ze,te=Ee),ze=te,q&&me)t:{for(Ee=GS,G=q,P=me,z=0,te=G;te;te=Ee(te))z++;te=0;for(var ve=P;ve;ve=Ee(ve))te++;for(;0<z-te;)G=Ee(G),z--;for(;0<te-z;)P=Ee(P),te--;for(;z--;){if(G===P||P!==null&&G===P.alternate){Ee=G;break t}G=Ee(G),P=Ee(P)}Ee=null}else Ee=null;q!==null&&Ym(ie,Y,q,Ee,!1),me!==null&&ze!==null&&Ym(ie,ze,me,Ee,!0)}}e:{if(Y=V?Rr(V):window,q=Y.nodeName&&Y.nodeName.toLowerCase(),q==="select"||q==="input"&&Y.type==="file")var Pe=ch;else if(oh(Y))if(fh)Pe=ZE;else{Pe=QE;var pe=XE}else q=Y.nodeName,!q||q.toLowerCase()!=="input"||Y.type!=="checkbox"&&Y.type!=="radio"?V&&Wo(V.elementType)&&(Pe=ch):Pe=WE;if(Pe&&(Pe=Pe(i,V))){uh(ie,Pe,o,Z);break e}pe&&pe(i,Y,V),i==="focusout"&&V&&Y.type==="number"&&V.memoizedProps.value!=null&&Qo(Y,"number",Y.value)}switch(pe=V?Rr(V):window,i){case"focusin":(oh(pe)||pe.contentEditable==="true")&&(In=pe,fu=V,Nr=null);break;case"focusout":Nr=fu=In=null;break;case"mousedown":du=!0;break;case"contextmenu":case"mouseup":case"dragend":du=!1,Eh(ie,o,Z);break;case"selectionchange":if(eS)break;case"keydown":case"keyup":Eh(ie,o,Z)}var Le;if(lu)e:{switch(i){case"compositionstart":var we="onCompositionStart";break e;case"compositionend":we="onCompositionEnd";break e;case"compositionupdate":we="onCompositionUpdate";break e}we=void 0}else Dn?ah(i,o)&&(we="onCompositionEnd"):i==="keydown"&&o.keyCode===229&&(we="onCompositionStart");we&&(sh&&o.locale!=="ko"&&(Dn||we!=="onCompositionStart"?we==="onCompositionEnd"&&Dn&&(Le=Zd()):(ms=Z,iu="value"in ms?ms.value:ms.textContent,Dn=!0)),pe=Fl(V,we),0<pe.length&&(we=new th(we,i,null,o,Z),ie.push({event:we,listeners:pe}),Le?we.data=Le:(Le=lh(o),Le!==null&&(we.data=Le)))),(Le=KE?zE(i,o):VE(i,o))&&(we=Fl(V,"onBeforeInput"),0<we.length&&(pe=new th("onBeforeInput","beforeinput",null,o,Z),ie.push({event:pe,listeners:we}),pe.data=Le)),US(ie,i,V,o,Z)}zm(ie,n)})}function aa(i,n,o){return{instance:i,listener:n,currentTarget:o}}function Fl(i,n){for(var o=n+"Capture",f=[];i!==null;){var p=i,y=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||y===null||(p=_r(i,o),p!=null&&f.unshift(aa(i,p,y)),p=_r(i,n),p!=null&&f.push(aa(i,p,y))),i.tag===3)return f;i=i.return}return[]}function GS(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function Ym(i,n,o,f,p){for(var y=n._reactName,A=[];o!==null&&o!==f;){var D=o,M=D.alternate,V=D.stateNode;if(D=D.tag,M!==null&&M===f)break;D!==5&&D!==26&&D!==27||V===null||(M=V,p?(V=_r(o,y),V!=null&&A.unshift(aa(o,V,M))):p||(V=_r(o,y),V!=null&&A.push(aa(o,V,M)))),o=o.return}A.length!==0&&i.push({event:n,listeners:A})}var jS=/\r\n?/g,HS=/\u0000|\uFFFD/g;function qm(i){return(typeof i=="string"?i:""+i).replace(jS,`
`).replace(HS,"")}function Xm(i,n){return n=qm(n),qm(i)===n}function Ke(i,n,o,f,p,y){switch(o){case"children":typeof f=="string"?n==="body"||n==="textarea"&&f===""||Ln(i,f):(typeof f=="number"||typeof f=="bigint")&&n!=="body"&&Ln(i,""+f);break;case"className":ja(i,"class",f);break;case"tabIndex":ja(i,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":ja(i,o,f);break;case"style":Xd(i,f,y);break;case"data":if(n!=="object"){ja(i,"data",f);break}case"src":case"href":if(f===""&&(n!=="a"||o!=="href")){i.removeAttribute(o);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){i.removeAttribute(o);break}f=Ka(""+f),i.setAttribute(o,f);break;case"action":case"formAction":if(typeof f=="function"){i.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(o==="formAction"?(n!=="input"&&Ke(i,n,"name",p.name,p,null),Ke(i,n,"formEncType",p.formEncType,p,null),Ke(i,n,"formMethod",p.formMethod,p,null),Ke(i,n,"formTarget",p.formTarget,p,null)):(Ke(i,n,"encType",p.encType,p,null),Ke(i,n,"method",p.method,p,null),Ke(i,n,"target",p.target,p,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){i.removeAttribute(o);break}f=Ka(""+f),i.setAttribute(o,f);break;case"onClick":f!=null&&(i.onclick=ji);break;case"onScroll":f!=null&&Ie("scroll",i);break;case"onScrollEnd":f!=null&&Ie("scrollend",i);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(s(61));if(o=f.__html,o!=null){if(p.children!=null)throw Error(s(60));i.innerHTML=o}}break;case"multiple":i.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":i.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){i.removeAttribute("xlink:href");break}o=Ka(""+f),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?i.setAttribute(o,""+f):i.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?i.setAttribute(o,""):i.removeAttribute(o);break;case"capture":case"download":f===!0?i.setAttribute(o,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?i.setAttribute(o,f):i.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?i.setAttribute(o,f):i.removeAttribute(o);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?i.removeAttribute(o):i.setAttribute(o,f);break;case"popover":Ie("beforetoggle",i),Ie("toggle",i),Ga(i,"popover",f);break;case"xlinkActuate":Gi(i,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":Gi(i,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":Gi(i,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":Gi(i,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":Gi(i,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":Gi(i,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":Gi(i,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":Gi(i,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":Gi(i,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":Ga(i,"is",f);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=yE.get(o)||o,Ga(i,o,f))}}function Uc(i,n,o,f,p,y){switch(o){case"style":Xd(i,f,y);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(s(61));if(o=f.__html,o!=null){if(p.children!=null)throw Error(s(60));i.innerHTML=o}}break;case"children":typeof f=="string"?Ln(i,f):(typeof f=="number"||typeof f=="bigint")&&Ln(i,""+f);break;case"onScroll":f!=null&&Ie("scroll",i);break;case"onScrollEnd":f!=null&&Ie("scrollend",i);break;case"onClick":f!=null&&(i.onclick=ji);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!$d.hasOwnProperty(o))e:{if(o[0]==="o"&&o[1]==="n"&&(p=o.endsWith("Capture"),n=o.slice(2,p?o.length-7:void 0),y=i[kt]||null,y=y!=null?y[o]:null,typeof y=="function"&&i.removeEventListener(n,y,p),typeof f=="function")){typeof y!="function"&&y!==null&&(o in i?i[o]=null:i.hasAttribute(o)&&i.removeAttribute(o)),i.addEventListener(n,f,p);break e}o in i?i[o]=f:f===!0?i.setAttribute(o,""):Ga(i,o,f)}}}function bt(i,n,o){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ie("error",i),Ie("load",i);var f=!1,p=!1,y;for(y in o)if(o.hasOwnProperty(y)){var A=o[y];if(A!=null)switch(y){case"src":f=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,n));default:Ke(i,n,y,A,o,null)}}p&&Ke(i,n,"srcSet",o.srcSet,o,null),f&&Ke(i,n,"src",o.src,o,null);return;case"input":Ie("invalid",i);var D=y=A=p=null,M=null,V=null;for(f in o)if(o.hasOwnProperty(f)){var Z=o[f];if(Z!=null)switch(f){case"name":p=Z;break;case"type":A=Z;break;case"checked":M=Z;break;case"defaultChecked":V=Z;break;case"value":y=Z;break;case"defaultValue":D=Z;break;case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(s(137,n));break;default:Ke(i,n,f,Z,o,null)}}zd(i,y,D,M,V,A,p,!1);return;case"select":Ie("invalid",i),f=A=y=null;for(p in o)if(o.hasOwnProperty(p)&&(D=o[p],D!=null))switch(p){case"value":y=D;break;case"defaultValue":A=D;break;case"multiple":f=D;default:Ke(i,n,p,D,o,null)}n=y,o=A,i.multiple=!!f,n!=null?bn(i,!!f,n,!1):o!=null&&bn(i,!!f,o,!0);return;case"textarea":Ie("invalid",i),y=p=f=null;for(A in o)if(o.hasOwnProperty(A)&&(D=o[A],D!=null))switch(A){case"value":f=D;break;case"defaultValue":p=D;break;case"children":y=D;break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(s(91));break;default:Ke(i,n,A,D,o,null)}Yd(i,f,p,y);return;case"option":for(M in o)o.hasOwnProperty(M)&&(f=o[M],f!=null)&&(M==="selected"?i.selected=f&&typeof f!="function"&&typeof f!="symbol":Ke(i,n,M,f,o,null));return;case"dialog":Ie("beforetoggle",i),Ie("toggle",i),Ie("cancel",i),Ie("close",i);break;case"iframe":case"object":Ie("load",i);break;case"video":case"audio":for(f=0;f<ra.length;f++)Ie(ra[f],i);break;case"image":Ie("error",i),Ie("load",i);break;case"details":Ie("toggle",i);break;case"embed":case"source":case"link":Ie("error",i),Ie("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(V in o)if(o.hasOwnProperty(V)&&(f=o[V],f!=null))switch(V){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,n));default:Ke(i,n,V,f,o,null)}return;default:if(Wo(n)){for(Z in o)o.hasOwnProperty(Z)&&(f=o[Z],f!==void 0&&Uc(i,n,Z,f,o,void 0));return}}for(D in o)o.hasOwnProperty(D)&&(f=o[D],f!=null&&Ke(i,n,D,f,o,null))}function KS(i,n,o,f){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,y=null,A=null,D=null,M=null,V=null,Z=null;for(q in o){var ie=o[q];if(o.hasOwnProperty(q)&&ie!=null)switch(q){case"checked":break;case"value":break;case"defaultValue":M=ie;default:f.hasOwnProperty(q)||Ke(i,n,q,null,f,ie)}}for(var Y in f){var q=f[Y];if(ie=o[Y],f.hasOwnProperty(Y)&&(q!=null||ie!=null))switch(Y){case"type":y=q;break;case"name":p=q;break;case"checked":V=q;break;case"defaultChecked":Z=q;break;case"value":A=q;break;case"defaultValue":D=q;break;case"children":case"dangerouslySetInnerHTML":if(q!=null)throw Error(s(137,n));break;default:q!==ie&&Ke(i,n,Y,q,f,ie)}}Xo(i,A,D,M,V,Z,y,p);return;case"select":q=A=D=Y=null;for(y in o)if(M=o[y],o.hasOwnProperty(y)&&M!=null)switch(y){case"value":break;case"multiple":q=M;default:f.hasOwnProperty(y)||Ke(i,n,y,null,f,M)}for(p in f)if(y=f[p],M=o[p],f.hasOwnProperty(p)&&(y!=null||M!=null))switch(p){case"value":Y=y;break;case"defaultValue":D=y;break;case"multiple":A=y;default:y!==M&&Ke(i,n,p,y,f,M)}n=D,o=A,f=q,Y!=null?bn(i,!!o,Y,!1):!!f!=!!o&&(n!=null?bn(i,!!o,n,!0):bn(i,!!o,o?[]:"",!1));return;case"textarea":q=Y=null;for(D in o)if(p=o[D],o.hasOwnProperty(D)&&p!=null&&!f.hasOwnProperty(D))switch(D){case"value":break;case"children":break;default:Ke(i,n,D,null,f,p)}for(A in f)if(p=f[A],y=o[A],f.hasOwnProperty(A)&&(p!=null||y!=null))switch(A){case"value":Y=p;break;case"defaultValue":q=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(s(91));break;default:p!==y&&Ke(i,n,A,p,f,y)}Vd(i,Y,q);return;case"option":for(var me in o)Y=o[me],o.hasOwnProperty(me)&&Y!=null&&!f.hasOwnProperty(me)&&(me==="selected"?i.selected=!1:Ke(i,n,me,null,f,Y));for(M in f)Y=f[M],q=o[M],f.hasOwnProperty(M)&&Y!==q&&(Y!=null||q!=null)&&(M==="selected"?i.selected=Y&&typeof Y!="function"&&typeof Y!="symbol":Ke(i,n,M,Y,f,q));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ee in o)Y=o[Ee],o.hasOwnProperty(Ee)&&Y!=null&&!f.hasOwnProperty(Ee)&&Ke(i,n,Ee,null,f,Y);for(V in f)if(Y=f[V],q=o[V],f.hasOwnProperty(V)&&Y!==q&&(Y!=null||q!=null))switch(V){case"children":case"dangerouslySetInnerHTML":if(Y!=null)throw Error(s(137,n));break;default:Ke(i,n,V,Y,f,q)}return;default:if(Wo(n)){for(var ze in o)Y=o[ze],o.hasOwnProperty(ze)&&Y!==void 0&&!f.hasOwnProperty(ze)&&Uc(i,n,ze,void 0,f,Y);for(Z in f)Y=f[Z],q=o[Z],!f.hasOwnProperty(Z)||Y===q||Y===void 0&&q===void 0||Uc(i,n,Z,Y,f,q);return}}for(var G in o)Y=o[G],o.hasOwnProperty(G)&&Y!=null&&!f.hasOwnProperty(G)&&Ke(i,n,G,null,f,Y);for(ie in f)Y=f[ie],q=o[ie],!f.hasOwnProperty(ie)||Y===q||Y==null&&q==null||Ke(i,n,ie,Y,f,q)}function Qm(i){switch(i){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function zS(){if(typeof performance.getEntriesByType=="function"){for(var i=0,n=0,o=performance.getEntriesByType("resource"),f=0;f<o.length;f++){var p=o[f],y=p.transferSize,A=p.initiatorType,D=p.duration;if(y&&D&&Qm(A)){for(A=0,D=p.responseEnd,f+=1;f<o.length;f++){var M=o[f],V=M.startTime;if(V>D)break;var Z=M.transferSize,ie=M.initiatorType;Z&&Qm(ie)&&(M=M.responseEnd,A+=Z*(M<D?1:(D-V)/(M-V)))}if(--f,n+=8*(y+A)/(p.duration/1e3),i++,10<i)break}}if(0<i)return n/i/1e6}return navigator.connection&&(i=navigator.connection.downlink,typeof i=="number")?i:5}var Fc=null,Bc=null;function Bl(i){return i.nodeType===9?i:i.ownerDocument}function Wm(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Zm(i,n){if(i===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&n==="foreignObject"?0:i}function $c(i,n){return i==="textarea"||i==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var Gc=null;function VS(){var i=window.event;return i&&i.type==="popstate"?i===Gc?!1:(Gc=i,!0):(Gc=null,!1)}var Jm=typeof setTimeout=="function"?setTimeout:void 0,YS=typeof clearTimeout=="function"?clearTimeout:void 0,e0=typeof Promise=="function"?Promise:void 0,qS=typeof queueMicrotask=="function"?queueMicrotask:typeof e0<"u"?function(i){return e0.resolve(null).then(i).catch(XS)}:Jm;function XS(i){setTimeout(function(){throw i})}function ws(i){return i==="head"}function t0(i,n){var o=n,f=0;do{var p=o.nextSibling;if(i.removeChild(o),p&&p.nodeType===8)if(o=p.data,o==="/$"||o==="/&"){if(f===0){i.removeChild(p),ir(n);return}f--}else if(o==="$"||o==="$?"||o==="$~"||o==="$!"||o==="&")f++;else if(o==="html")la(i.ownerDocument.documentElement);else if(o==="head"){o=i.ownerDocument.head,la(o);for(var y=o.firstChild;y;){var A=y.nextSibling,D=y.nodeName;y[Lr]||D==="SCRIPT"||D==="STYLE"||D==="LINK"&&y.rel.toLowerCase()==="stylesheet"||o.removeChild(y),y=A}}else o==="body"&&la(i.ownerDocument.body);o=p}while(o);ir(n)}function i0(i,n){var o=i;i=0;do{var f=o.nextSibling;if(o.nodeType===1?n?(o._stashedDisplay=o.style.display,o.style.display="none"):(o.style.display=o._stashedDisplay||"",o.getAttribute("style")===""&&o.removeAttribute("style")):o.nodeType===3&&(n?(o._stashedText=o.nodeValue,o.nodeValue=""):o.nodeValue=o._stashedText||""),f&&f.nodeType===8)if(o=f.data,o==="/$"){if(i===0)break;i--}else o!=="$"&&o!=="$?"&&o!=="$~"&&o!=="$!"||i++;o=f}while(o)}function jc(i){var n=i.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var o=n;switch(n=n.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":jc(o),Yo(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}i.removeChild(o)}}function QS(i,n,o,f){for(;i.nodeType===1;){var p=o;if(i.nodeName.toLowerCase()!==n.toLowerCase()){if(!f&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(f){if(!i[Lr])switch(n){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(y=i.getAttribute("rel"),y==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(y!==p.rel||i.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||i.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||i.getAttribute("title")!==(p.title==null?null:p.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(y=i.getAttribute("src"),(y!==(p.src==null?null:p.src)||i.getAttribute("type")!==(p.type==null?null:p.type)||i.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&y&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(n==="input"&&i.type==="hidden"){var y=p.name==null?null:""+p.name;if(p.type==="hidden"&&i.getAttribute("name")===y)return i}else return i;if(i=hi(i.nextSibling),i===null)break}return null}function WS(i,n,o){if(n==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!o||(i=hi(i.nextSibling),i===null))return null;return i}function s0(i,n){for(;i.nodeType!==8;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!n||(i=hi(i.nextSibling),i===null))return null;return i}function Hc(i){return i.data==="$?"||i.data==="$~"}function Kc(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState!=="loading"}function ZS(i,n){var o=i.ownerDocument;if(i.data==="$~")i._reactRetry=n;else if(i.data!=="$?"||o.readyState!=="loading")n();else{var f=function(){n(),o.removeEventListener("DOMContentLoaded",f)};o.addEventListener("DOMContentLoaded",f),i._reactRetry=f}}function hi(i){for(;i!=null;i=i.nextSibling){var n=i.nodeType;if(n===1||n===3)break;if(n===8){if(n=i.data,n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"||n==="F!"||n==="F")break;if(n==="/$"||n==="/&")return null}}return i}var zc=null;function n0(i){i=i.nextSibling;for(var n=0;i;){if(i.nodeType===8){var o=i.data;if(o==="/$"||o==="/&"){if(n===0)return hi(i.nextSibling);n--}else o!=="$"&&o!=="$!"&&o!=="$?"&&o!=="$~"&&o!=="&"||n++}i=i.nextSibling}return null}function r0(i){i=i.previousSibling;for(var n=0;i;){if(i.nodeType===8){var o=i.data;if(o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"){if(n===0)return i;n--}else o!=="/$"&&o!=="/&"||n++}i=i.previousSibling}return null}function a0(i,n,o){switch(n=Bl(o),i){case"html":if(i=n.documentElement,!i)throw Error(s(452));return i;case"head":if(i=n.head,!i)throw Error(s(453));return i;case"body":if(i=n.body,!i)throw Error(s(454));return i;default:throw Error(s(451))}}function la(i){for(var n=i.attributes;n.length;)i.removeAttributeNode(n[0]);Yo(i)}var gi=new Map,l0=new Set;function $l(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var ns=X.d;X.d={f:JS,r:eT,D:tT,C:iT,L:sT,m:nT,X:aT,S:rT,M:lT};function JS(){var i=ns.f(),n=Ol();return i||n}function eT(i){var n=Tn(i);n!==null&&n.tag===5&&n.type==="form"?bg(n):ns.r(i)}var Jn=typeof document>"u"?null:document;function o0(i,n,o){var f=Jn;if(f&&typeof n=="string"&&n){var p=ai(n);p='link[rel="'+i+'"][href="'+p+'"]',typeof o=="string"&&(p+='[crossorigin="'+o+'"]'),l0.has(p)||(l0.add(p),i={rel:i,crossOrigin:o,href:n},f.querySelector(p)===null&&(n=f.createElement("link"),bt(n,"link",i),yt(n),f.head.appendChild(n)))}}function tT(i){ns.D(i),o0("dns-prefetch",i,null)}function iT(i,n){ns.C(i,n),o0("preconnect",i,n)}function sT(i,n,o){ns.L(i,n,o);var f=Jn;if(f&&i&&n){var p='link[rel="preload"][as="'+ai(n)+'"]';n==="image"&&o&&o.imageSrcSet?(p+='[imagesrcset="'+ai(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(p+='[imagesizes="'+ai(o.imageSizes)+'"]')):p+='[href="'+ai(i)+'"]';var y=p;switch(n){case"style":y=er(i);break;case"script":y=tr(i)}gi.has(y)||(i=m({rel:"preload",href:n==="image"&&o&&o.imageSrcSet?void 0:i,as:n},o),gi.set(y,i),f.querySelector(p)!==null||n==="style"&&f.querySelector(oa(y))||n==="script"&&f.querySelector(ua(y))||(n=f.createElement("link"),bt(n,"link",i),yt(n),f.head.appendChild(n)))}}function nT(i,n){ns.m(i,n);var o=Jn;if(o&&i){var f=n&&typeof n.as=="string"?n.as:"script",p='link[rel="modulepreload"][as="'+ai(f)+'"][href="'+ai(i)+'"]',y=p;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=tr(i)}if(!gi.has(y)&&(i=m({rel:"modulepreload",href:i},n),gi.set(y,i),o.querySelector(p)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(ua(y)))return}f=o.createElement("link"),bt(f,"link",i),yt(f),o.head.appendChild(f)}}}function rT(i,n,o){ns.S(i,n,o);var f=Jn;if(f&&i){var p=xn(f).hoistableStyles,y=er(i);n=n||"default";var A=p.get(y);if(!A){var D={loading:0,preload:null};if(A=f.querySelector(oa(y)))D.loading=5;else{i=m({rel:"stylesheet",href:i,"data-precedence":n},o),(o=gi.get(y))&&Vc(i,o);var M=A=f.createElement("link");yt(M),bt(M,"link",i),M._p=new Promise(function(V,Z){M.onload=V,M.onerror=Z}),M.addEventListener("load",function(){D.loading|=1}),M.addEventListener("error",function(){D.loading|=2}),D.loading|=4,Gl(A,n,f)}A={type:"stylesheet",instance:A,count:1,state:D},p.set(y,A)}}}function aT(i,n){ns.X(i,n);var o=Jn;if(o&&i){var f=xn(o).hoistableScripts,p=tr(i),y=f.get(p);y||(y=o.querySelector(ua(p)),y||(i=m({src:i,async:!0},n),(n=gi.get(p))&&Yc(i,n),y=o.createElement("script"),yt(y),bt(y,"link",i),o.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},f.set(p,y))}}function lT(i,n){ns.M(i,n);var o=Jn;if(o&&i){var f=xn(o).hoistableScripts,p=tr(i),y=f.get(p);y||(y=o.querySelector(ua(p)),y||(i=m({src:i,async:!0,type:"module"},n),(n=gi.get(p))&&Yc(i,n),y=o.createElement("script"),yt(y),bt(y,"link",i),o.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},f.set(p,y))}}function u0(i,n,o,f){var p=(p=de.current)?$l(p):null;if(!p)throw Error(s(446));switch(i){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(n=er(o.href),o=xn(p).hoistableStyles,f=o.get(n),f||(f={type:"style",instance:null,count:0,state:null},o.set(n,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){i=er(o.href);var y=xn(p).hoistableStyles,A=y.get(i);if(A||(p=p.ownerDocument||p,A={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(i,A),(y=p.querySelector(oa(i)))&&!y._p&&(A.instance=y,A.state.loading=5),gi.has(i)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},gi.set(i,o),y||oT(p,i,o,A.state))),n&&f===null)throw Error(s(528,""));return A}if(n&&f!==null)throw Error(s(529,""));return null;case"script":return n=o.async,o=o.src,typeof o=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=tr(o),o=xn(p).hoistableScripts,f=o.get(n),f||(f={type:"script",instance:null,count:0,state:null},o.set(n,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,i))}}function er(i){return'href="'+ai(i)+'"'}function oa(i){return'link[rel="stylesheet"]['+i+"]"}function c0(i){return m({},i,{"data-precedence":i.precedence,precedence:null})}function oT(i,n,o,f){i.querySelector('link[rel="preload"][as="style"]['+n+"]")?f.loading=1:(n=i.createElement("link"),f.preload=n,n.addEventListener("load",function(){return f.loading|=1}),n.addEventListener("error",function(){return f.loading|=2}),bt(n,"link",o),yt(n),i.head.appendChild(n))}function tr(i){return'[src="'+ai(i)+'"]'}function ua(i){return"script[async]"+i}function f0(i,n,o){if(n.count++,n.instance===null)switch(n.type){case"style":var f=i.querySelector('style[data-href~="'+ai(o.href)+'"]');if(f)return n.instance=f,yt(f),f;var p=m({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return f=(i.ownerDocument||i).createElement("style"),yt(f),bt(f,"style",p),Gl(f,o.precedence,i),n.instance=f;case"stylesheet":p=er(o.href);var y=i.querySelector(oa(p));if(y)return n.state.loading|=4,n.instance=y,yt(y),y;f=c0(o),(p=gi.get(p))&&Vc(f,p),y=(i.ownerDocument||i).createElement("link"),yt(y);var A=y;return A._p=new Promise(function(D,M){A.onload=D,A.onerror=M}),bt(y,"link",f),n.state.loading|=4,Gl(y,o.precedence,i),n.instance=y;case"script":return y=tr(o.src),(p=i.querySelector(ua(y)))?(n.instance=p,yt(p),p):(f=o,(p=gi.get(y))&&(f=m({},o),Yc(f,p)),i=i.ownerDocument||i,p=i.createElement("script"),yt(p),bt(p,"link",f),i.head.appendChild(p),n.instance=p);case"void":return null;default:throw Error(s(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(f=n.instance,n.state.loading|=4,Gl(f,o.precedence,i));return n.instance}function Gl(i,n,o){for(var f=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=f.length?f[f.length-1]:null,y=p,A=0;A<f.length;A++){var D=f[A];if(D.dataset.precedence===n)y=D;else if(y!==p)break}y?y.parentNode.insertBefore(i,y.nextSibling):(n=o.nodeType===9?o.head:o,n.insertBefore(i,n.firstChild))}function Vc(i,n){i.crossOrigin==null&&(i.crossOrigin=n.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=n.referrerPolicy),i.title==null&&(i.title=n.title)}function Yc(i,n){i.crossOrigin==null&&(i.crossOrigin=n.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=n.referrerPolicy),i.integrity==null&&(i.integrity=n.integrity)}var jl=null;function d0(i,n,o){if(jl===null){var f=new Map,p=jl=new Map;p.set(o,f)}else p=jl,f=p.get(o),f||(f=new Map,p.set(o,f));if(f.has(i))return f;for(f.set(i,null),o=o.getElementsByTagName(i),p=0;p<o.length;p++){var y=o[p];if(!(y[Lr]||y[St]||i==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var A=y.getAttribute(n)||"";A=i+A;var D=f.get(A);D?D.push(y):f.set(A,[y])}}return f}function h0(i,n,o){i=i.ownerDocument||i,i.head.insertBefore(o,n==="title"?i.querySelector("head > title"):null)}function uT(i,n,o){if(o===1||n.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;return n.rel==="stylesheet"?(i=n.disabled,typeof n.precedence=="string"&&i==null):!0;case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function g0(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}function cT(i,n,o,f){if(o.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var p=er(f.href),y=n.querySelector(oa(p));if(y){n=y._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(i.count++,i=Hl.bind(i),n.then(i,i)),o.state.loading|=4,o.instance=y,yt(y);return}y=n.ownerDocument||n,f=c0(f),(p=gi.get(p))&&Vc(f,p),y=y.createElement("link"),yt(y);var A=y;A._p=new Promise(function(D,M){A.onload=D,A.onerror=M}),bt(y,"link",f),o.instance=y}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(o,n),(n=o.state.preload)&&(o.state.loading&3)===0&&(i.count++,o=Hl.bind(i),n.addEventListener("load",o),n.addEventListener("error",o))}}var qc=0;function fT(i,n){return i.stylesheets&&i.count===0&&zl(i,i.stylesheets),0<i.count||0<i.imgCount?function(o){var f=setTimeout(function(){if(i.stylesheets&&zl(i,i.stylesheets),i.unsuspend){var y=i.unsuspend;i.unsuspend=null,y()}},6e4+n);0<i.imgBytes&&qc===0&&(qc=62500*zS());var p=setTimeout(function(){if(i.waitingForImages=!1,i.count===0&&(i.stylesheets&&zl(i,i.stylesheets),i.unsuspend)){var y=i.unsuspend;i.unsuspend=null,y()}},(i.imgBytes>qc?50:800)+n);return i.unsuspend=o,function(){i.unsuspend=null,clearTimeout(f),clearTimeout(p)}}:null}function Hl(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)zl(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var Kl=null;function zl(i,n){i.stylesheets=null,i.unsuspend!==null&&(i.count++,Kl=new Map,n.forEach(dT,i),Kl=null,Hl.call(i))}function dT(i,n){if(!(n.state.loading&4)){var o=Kl.get(i);if(o)var f=o.get(null);else{o=new Map,Kl.set(i,o);for(var p=i.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<p.length;y++){var A=p[y];(A.nodeName==="LINK"||A.getAttribute("media")!=="not all")&&(o.set(A.dataset.precedence,A),f=A)}f&&o.set(null,f)}p=n.instance,A=p.getAttribute("data-precedence"),y=o.get(A)||f,y===f&&o.set(null,p),o.set(A,p),this.count++,f=Hl.bind(this),p.addEventListener("load",f),p.addEventListener("error",f),y?y.parentNode.insertBefore(p,y.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(p,i.firstChild)),n.state.loading|=4}}var ca={$$typeof:I,Provider:null,Consumer:null,_currentValue:J,_currentValue2:J,_threadCount:0};function hT(i,n,o,f,p,y,A,D,M){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ho(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ho(0),this.hiddenUpdates=Ho(null),this.identifierPrefix=f,this.onUncaughtError=p,this.onCaughtError=y,this.onRecoverableError=A,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=M,this.incompleteTransitions=new Map}function m0(i,n,o,f,p,y,A,D,M,V,Z,ie){return i=new hT(i,n,o,A,M,V,Z,ie,D),n=1,y===!0&&(n|=24),y=Vt(3,null,null,n),i.current=y,y.stateNode=i,n=_u(),n.refCount++,i.pooledCache=n,n.refCount++,y.memoizedState={element:f,isDehydrated:o,cache:n},Ou(y),i}function p0(i){return i?(i=wn,i):wn}function y0(i,n,o,f,p,y){p=p0(p),f.context===null?f.context=p:f.pendingContext=p,f=Ts(n),f.payload={element:o},y=y===void 0?null:y,y!==null&&(f.callback=y),o=xs(i,f,n),o!==null&&($t(o,i,n),jr(o,i,n))}function v0(i,n){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var o=i.retryLane;i.retryLane=o!==0&&o<n?o:n}}function Xc(i,n){v0(i,n),(i=i.alternate)&&v0(i,n)}function E0(i){if(i.tag===13||i.tag===31){var n=Zs(i,67108864);n!==null&&$t(n,i,67108864),Xc(i,67108864)}}function S0(i){if(i.tag===13||i.tag===31){var n=Wt();n=Ko(n);var o=Zs(i,n);o!==null&&$t(o,i,n),Xc(i,n)}}var Vl=!0;function gT(i,n,o,f){var p=N.T;N.T=null;var y=X.p;try{X.p=2,Qc(i,n,o,f)}finally{X.p=y,N.T=p}}function mT(i,n,o,f){var p=N.T;N.T=null;var y=X.p;try{X.p=8,Qc(i,n,o,f)}finally{X.p=y,N.T=p}}function Qc(i,n,o,f){if(Vl){var p=Wc(f);if(p===null)Pc(i,n,f,Yl,o),x0(i,f);else if(yT(p,i,n,o,f))f.stopPropagation();else if(x0(i,f),n&4&&-1<pT.indexOf(i)){for(;p!==null;){var y=Tn(p);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var A=Ys(y.pendingLanes);if(A!==0){var D=y;for(D.pendingLanes|=2,D.entangledLanes|=2;A;){var M=1<<31-Kt(A);D.entanglements[1]|=M,A&=~M}Ci(y),(Fe&6)===0&&(Il=pt()+500,na(0))}}break;case 31:case 13:D=Zs(y,2),D!==null&&$t(D,y,2),Ol(),Xc(y,2)}if(y=Wc(f),y===null&&Pc(i,n,f,Yl,o),y===p)break;p=y}p!==null&&f.stopPropagation()}else Pc(i,n,f,null,o)}}function Wc(i){return i=Jo(i),Zc(i)}var Yl=null;function Zc(i){if(Yl=null,i=Sn(i),i!==null){var n=a(i);if(n===null)i=null;else{var o=n.tag;if(o===13){if(i=u(n),i!==null)return i;i=null}else if(o===31){if(i=c(n),i!==null)return i;i=null}else if(o===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;i=null}else n!==i&&(i=null)}}return Yl=i,null}function T0(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Na()){case ds:return 2;case Sr:return 8;case vn:case Pa:return 32;case Tr:return 268435456;default:return 32}default:return 32}}var Jc=!1,Ms=null,ks=null,Ns=null,fa=new Map,da=new Map,Ps=[],pT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function x0(i,n){switch(i){case"focusin":case"focusout":Ms=null;break;case"dragenter":case"dragleave":ks=null;break;case"mouseover":case"mouseout":Ns=null;break;case"pointerover":case"pointerout":fa.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":da.delete(n.pointerId)}}function ha(i,n,o,f,p,y){return i===null||i.nativeEvent!==y?(i={blockedOn:n,domEventName:o,eventSystemFlags:f,nativeEvent:y,targetContainers:[p]},n!==null&&(n=Tn(n),n!==null&&E0(n)),i):(i.eventSystemFlags|=f,n=i.targetContainers,p!==null&&n.indexOf(p)===-1&&n.push(p),i)}function yT(i,n,o,f,p){switch(n){case"focusin":return Ms=ha(Ms,i,n,o,f,p),!0;case"dragenter":return ks=ha(ks,i,n,o,f,p),!0;case"mouseover":return Ns=ha(Ns,i,n,o,f,p),!0;case"pointerover":var y=p.pointerId;return fa.set(y,ha(fa.get(y)||null,i,n,o,f,p)),!0;case"gotpointercapture":return y=p.pointerId,da.set(y,ha(da.get(y)||null,i,n,o,f,p)),!0}return!1}function A0(i){var n=Sn(i.target);if(n!==null){var o=a(n);if(o!==null){if(n=o.tag,n===13){if(n=u(o),n!==null){i.blockedOn=n,Ud(i.priority,function(){S0(o)});return}}else if(n===31){if(n=c(o),n!==null){i.blockedOn=n,Ud(i.priority,function(){S0(o)});return}}else if(n===3&&o.stateNode.current.memoizedState.isDehydrated){i.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}i.blockedOn=null}function ql(i){if(i.blockedOn!==null)return!1;for(var n=i.targetContainers;0<n.length;){var o=Wc(i.nativeEvent);if(o===null){o=i.nativeEvent;var f=new o.constructor(o.type,o);Zo=f,o.target.dispatchEvent(f),Zo=null}else return n=Tn(o),n!==null&&E0(n),i.blockedOn=o,!1;n.shift()}return!0}function b0(i,n,o){ql(i)&&o.delete(n)}function vT(){Jc=!1,Ms!==null&&ql(Ms)&&(Ms=null),ks!==null&&ql(ks)&&(ks=null),Ns!==null&&ql(Ns)&&(Ns=null),fa.forEach(b0),da.forEach(b0)}function Xl(i,n){i.blockedOn===n&&(i.blockedOn=null,Jc||(Jc=!0,l.unstable_scheduleCallback(l.unstable_NormalPriority,vT)))}var Ql=null;function L0(i){Ql!==i&&(Ql=i,l.unstable_scheduleCallback(l.unstable_NormalPriority,function(){Ql===i&&(Ql=null);for(var n=0;n<i.length;n+=3){var o=i[n],f=i[n+1],p=i[n+2];if(typeof f!="function"){if(Zc(f||o)===null)continue;break}var y=Tn(o);y!==null&&(i.splice(n,3),n-=3,Wu(y,{pending:!0,data:p,method:o.method,action:f},f,p))}}))}function ir(i){function n(M){return Xl(M,i)}Ms!==null&&Xl(Ms,i),ks!==null&&Xl(ks,i),Ns!==null&&Xl(Ns,i),fa.forEach(n),da.forEach(n);for(var o=0;o<Ps.length;o++){var f=Ps[o];f.blockedOn===i&&(f.blockedOn=null)}for(;0<Ps.length&&(o=Ps[0],o.blockedOn===null);)A0(o),o.blockedOn===null&&Ps.shift();if(o=(i.ownerDocument||i).$$reactFormReplay,o!=null)for(f=0;f<o.length;f+=3){var p=o[f],y=o[f+1],A=p[kt]||null;if(typeof y=="function")A||L0(o);else if(A){var D=null;if(y&&y.hasAttribute("formAction")){if(p=y,A=y[kt]||null)D=A.formAction;else if(Zc(p)!==null)continue}else D=A.action;typeof D=="function"?o[f+1]=D:(o.splice(f,3),f-=3),L0(o)}}}function R0(){function i(y){y.canIntercept&&y.info==="react-transition"&&y.intercept({handler:function(){return new Promise(function(A){return p=A})},focusReset:"manual",scroll:"manual"})}function n(){p!==null&&(p(),p=null),f||setTimeout(o,20)}function o(){if(!f&&!navigation.transition){var y=navigation.currentEntry;y&&y.url!=null&&navigation.navigate(y.url,{state:y.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,p=null;return navigation.addEventListener("navigate",i),navigation.addEventListener("navigatesuccess",n),navigation.addEventListener("navigateerror",n),setTimeout(o,100),function(){f=!0,navigation.removeEventListener("navigate",i),navigation.removeEventListener("navigatesuccess",n),navigation.removeEventListener("navigateerror",n),p!==null&&(p(),p=null)}}}function ef(i){this._internalRoot=i}Wl.prototype.render=ef.prototype.render=function(i){var n=this._internalRoot;if(n===null)throw Error(s(409));var o=n.current,f=Wt();y0(o,f,i,n,null,null)},Wl.prototype.unmount=ef.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var n=i.containerInfo;y0(i.current,2,null,i,null,null),Ol(),n[En]=null}};function Wl(i){this._internalRoot=i}Wl.prototype.unstable_scheduleHydration=function(i){if(i){var n=Pd();i={blockedOn:null,target:i,priority:n};for(var o=0;o<Ps.length&&n!==0&&n<Ps[o].priority;o++);Ps.splice(o,0,i),o===0&&A0(i)}};var _0=e.version;if(_0!=="19.2.4")throw Error(s(527,_0,"19.2.4"));X.findDOMNode=function(i){var n=i._reactInternals;if(n===void 0)throw typeof i.render=="function"?Error(s(188)):(i=Object.keys(i).join(","),Error(s(268,i)));return i=d(n),i=i!==null?g(i):null,i=i===null?null:i.stateNode,i};var ET={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:N,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zl.isDisabled&&Zl.supportsFiber)try{xr=Zl.inject(ET),Ht=Zl}catch{}}return ma.createRoot=function(i,n){if(!r(i))throw Error(s(299));var o=!1,f="",p=kg,y=Ng,A=Pg;return n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(f=n.identifierPrefix),n.onUncaughtError!==void 0&&(p=n.onUncaughtError),n.onCaughtError!==void 0&&(y=n.onCaughtError),n.onRecoverableError!==void 0&&(A=n.onRecoverableError)),n=m0(i,1,!1,null,null,o,f,null,p,y,A,R0),i[En]=n.current,Nc(i),new ef(n)},ma.hydrateRoot=function(i,n,o){if(!r(i))throw Error(s(299));var f=!1,p="",y=kg,A=Ng,D=Pg,M=null;return o!=null&&(o.unstable_strictMode===!0&&(f=!0),o.identifierPrefix!==void 0&&(p=o.identifierPrefix),o.onUncaughtError!==void 0&&(y=o.onUncaughtError),o.onCaughtError!==void 0&&(A=o.onCaughtError),o.onRecoverableError!==void 0&&(D=o.onRecoverableError),o.formState!==void 0&&(M=o.formState)),n=m0(i,1,!0,n,o??null,f,p,M,y,A,D,R0),n.context=p0(null),o=n.current,f=Wt(),f=Ko(f),p=Ts(f),p.callback=null,xs(o,p,f),o=f,n.current.lanes=o,br(n,o),Ci(n),i[En]=n.current,Nc(i),new Wl(n)},ma.version="19.2.4",ma}var U0;function IT(){if(U0)return nf.exports;U0=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(e){console.error(e)}}return l(),nf.exports=DT(),nf.exports}var CT=IT();var F0="popstate";function OT(l={}){function e(s,r){let{pathname:a,search:u,hash:c}=s.location;return Nf("",{pathname:a,search:u,hash:c},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(s,r){return typeof r=="string"?r:xa(r)}return MT(e,t,null,l)}function tt(l,e){if(l===!1||l===null||typeof l>"u")throw new Error(e)}function Ui(l,e){if(!l){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function wT(){return Math.random().toString(36).substring(2,10)}function B0(l,e){return{usr:l.state,key:l.key,idx:e}}function Nf(l,e,t=null,s){return{pathname:typeof l=="string"?l:l.pathname,search:"",hash:"",...typeof e=="string"?yr(e):e,state:t,key:e&&e.key||s||wT()}}function xa({pathname:l="/",search:e="",hash:t=""}){return e&&e!=="?"&&(l+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(l+=t.charAt(0)==="#"?t:"#"+t),l}function yr(l){let e={};if(l){let t=l.indexOf("#");t>=0&&(e.hash=l.substring(t),l=l.substring(0,t));let s=l.indexOf("?");s>=0&&(e.search=l.substring(s),l=l.substring(0,s)),l&&(e.pathname=l)}return e}function MT(l,e,t,s={}){let{window:r=document.defaultView,v5Compat:a=!1}=s,u=r.history,c="POP",h=null,d=g();d==null&&(d=0,u.replaceState({...u.state,idx:d},""));function g(){return(u.state||{idx:null}).idx}function m(){c="POP";let T=g(),L=T==null?null:T-d;d=T,h&&h({action:c,location:x.location,delta:L})}function v(T,L){c="PUSH";let _=Nf(x.location,T,L);d=g()+1;let I=B0(_,d),O=x.createHref(_);try{u.pushState(I,"",O)}catch(k){if(k instanceof DOMException&&k.name==="DataCloneError")throw k;r.location.assign(O)}a&&h&&h({action:c,location:x.location,delta:1})}function E(T,L){c="REPLACE";let _=Nf(x.location,T,L);d=g();let I=B0(_,d),O=x.createHref(_);u.replaceState(I,"",O),a&&h&&h({action:c,location:x.location,delta:0})}function S(T){return kT(T)}let x={get action(){return c},get location(){return l(r,u)},listen(T){if(h)throw new Error("A history only accepts one active listener");return r.addEventListener(F0,m),h=T,()=>{r.removeEventListener(F0,m),h=null}},createHref(T){return e(r,T)},createURL:S,encodeLocation(T){let L=S(T);return{pathname:L.pathname,search:L.search,hash:L.hash}},push:v,replace:E,go(T){return u.go(T)}};return x}function kT(l,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),tt(t,"No window.location.(origin|href) available to create URL");let s=typeof l=="string"?l:xa(l);return s=s.replace(/ $/,"%20"),!e&&s.startsWith("//")&&(s=t+s),new URL(s,t)}function oy(l,e,t="/"){return NT(l,e,t,!1)}function NT(l,e,t,s){let r=typeof e=="string"?yr(e):e,a=cs(r.pathname||"/",t);if(a==null)return null;let u=uy(l);PT(u);let c=null;for(let h=0;c==null&&h<u.length;++h){let d=YT(a);c=zT(u[h],d,s)}return c}function uy(l,e=[],t=[],s="",r=!1){let a=(u,c,h=r,d)=>{let g={relativePath:d===void 0?u.path||"":d,caseSensitive:u.caseSensitive===!0,childrenIndex:c,route:u};if(g.relativePath.startsWith("/")){if(!g.relativePath.startsWith(s)&&h)return;tt(g.relativePath.startsWith(s),`Absolute route path "${g.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),g.relativePath=g.relativePath.slice(s.length)}let m=us([s,g.relativePath]),v=t.concat(g);u.children&&u.children.length>0&&(tt(u.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${m}".`),uy(u.children,e,v,m,h)),!(u.path==null&&!u.index)&&e.push({path:m,score:HT(m,u.index),routesMeta:v})};return l.forEach((u,c)=>{if(u.path===""||!u.path?.includes("?"))a(u,c);else for(let h of cy(u.path))a(u,c,!0,h)}),e}function cy(l){let e=l.split("/");if(e.length===0)return[];let[t,...s]=e,r=t.endsWith("?"),a=t.replace(/\?$/,"");if(s.length===0)return r?[a,""]:[a];let u=cy(s.join("/")),c=[];return c.push(...u.map(h=>h===""?a:[a,h].join("/"))),r&&c.push(...u),c.map(h=>l.startsWith("/")&&h===""?"/":h)}function PT(l){l.sort((e,t)=>e.score!==t.score?t.score-e.score:KT(e.routesMeta.map(s=>s.childrenIndex),t.routesMeta.map(s=>s.childrenIndex)))}var UT=/^:[\w-]+$/,FT=3,BT=2,$T=1,GT=10,jT=-2,$0=l=>l==="*";function HT(l,e){let t=l.split("/"),s=t.length;return t.some($0)&&(s+=jT),e&&(s+=BT),t.filter(r=>!$0(r)).reduce((r,a)=>r+(UT.test(a)?FT:a===""?$T:GT),s)}function KT(l,e){return l.length===e.length&&l.slice(0,-1).every((s,r)=>s===e[r])?l[l.length-1]-e[e.length-1]:0}function zT(l,e,t=!1){let{routesMeta:s}=l,r={},a="/",u=[];for(let c=0;c<s.length;++c){let h=s[c],d=c===s.length-1,g=a==="/"?e:e.slice(a.length)||"/",m=Ro({path:h.relativePath,caseSensitive:h.caseSensitive,end:d},g),v=h.route;if(!m&&d&&t&&!s[s.length-1].route.index&&(m=Ro({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},g)),!m)return null;Object.assign(r,m.params),u.push({params:r,pathname:us([a,m.pathname]),pathnameBase:WT(us([a,m.pathnameBase])),route:v}),m.pathnameBase!=="/"&&(a=us([a,m.pathnameBase]))}return u}function Ro(l,e){typeof l=="string"&&(l={path:l,caseSensitive:!1,end:!0});let[t,s]=VT(l.path,l.caseSensitive,l.end),r=e.match(t);if(!r)return null;let a=r[0],u=a.replace(/(.)\/+$/,"$1"),c=r.slice(1);return{params:s.reduce((d,{paramName:g,isOptional:m},v)=>{if(g==="*"){let S=c[v]||"";u=a.slice(0,a.length-S.length).replace(/(.)\/+$/,"$1")}const E=c[v];return m&&!E?d[g]=void 0:d[g]=(E||"").replace(/%2F/g,"/"),d},{}),pathname:a,pathnameBase:u,pattern:l}}function VT(l,e=!1,t=!0){Ui(l==="*"||!l.endsWith("*")||l.endsWith("/*"),`Route path "${l}" will be treated as if it were "${l.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${l.replace(/\*$/,"/*")}".`);let s=[],r="^"+l.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(u,c,h)=>(s.push({paramName:c,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return l.endsWith("*")?(s.push({paramName:"*"}),r+=l==="*"||l==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":l!==""&&l!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),s]}function YT(l){try{return l.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ui(!1,`The URL path "${l}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),l}}function cs(l,e){if(e==="/")return l;if(!l.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,s=l.charAt(t);return s&&s!=="/"?null:l.slice(t)||"/"}var qT=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function XT(l,e="/"){let{pathname:t,search:s="",hash:r=""}=typeof l=="string"?yr(l):l,a;return t?(t=t.replace(/\/\/+/g,"/"),t.startsWith("/")?a=G0(t.substring(1),"/"):a=G0(t,e)):a=e,{pathname:a,search:ZT(s),hash:JT(r)}}function G0(l,e){let t=e.replace(/\/+$/,"").split("/");return l.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function of(l,e,t,s){return`Cannot include a '${l}' character in a manually specified \`to.${e}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function QT(l){return l.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function fy(l){let e=QT(l);return e.map((t,s)=>s===e.length-1?t.pathname:t.pathnameBase)}function dy(l,e,t,s=!1){let r;typeof l=="string"?r=yr(l):(r={...l},tt(!r.pathname||!r.pathname.includes("?"),of("?","pathname","search",r)),tt(!r.pathname||!r.pathname.includes("#"),of("#","pathname","hash",r)),tt(!r.search||!r.search.includes("#"),of("#","search","hash",r)));let a=l===""||r.pathname==="",u=a?"/":r.pathname,c;if(u==null)c=t;else{let m=e.length-1;if(!s&&u.startsWith("..")){let v=u.split("/");for(;v[0]==="..";)v.shift(),m-=1;r.pathname=v.join("/")}c=m>=0?e[m]:"/"}let h=XT(r,c),d=u&&u!=="/"&&u.endsWith("/"),g=(a||u===".")&&t.endsWith("/");return!h.pathname.endsWith("/")&&(d||g)&&(h.pathname+="/"),h}var us=l=>l.join("/").replace(/\/\/+/g,"/"),WT=l=>l.replace(/\/+$/,"").replace(/^\/*/,"/"),ZT=l=>!l||l==="?"?"":l.startsWith("?")?l:"?"+l,JT=l=>!l||l==="#"?"":l.startsWith("#")?l:"#"+l,ex=class{constructor(l,e,t,s=!1){this.status=l,this.statusText=e||"",this.internal=s,t instanceof Error?(this.data=t.toString(),this.error=t):this.data=t}};function tx(l){return l!=null&&typeof l.status=="number"&&typeof l.statusText=="string"&&typeof l.internal=="boolean"&&"data"in l}function ix(l){return l.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var hy=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function gy(l,e){let t=l;if(typeof t!="string"||!qT.test(t))return{absoluteURL:void 0,isExternal:!1,to:t};let s=t,r=!1;if(hy)try{let a=new URL(window.location.href),u=t.startsWith("//")?new URL(a.protocol+t):new URL(t),c=cs(u.pathname,e);u.origin===a.origin&&c!=null?t=c+u.search+u.hash:r=!0}catch{Ui(!1,`<Link to="${t}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:s,isExternal:r,to:t}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var my=["POST","PUT","PATCH","DELETE"];new Set(my);var sx=["GET",...my];new Set(sx);var vr=Q.createContext(null);vr.displayName="DataRouter";var Fo=Q.createContext(null);Fo.displayName="DataRouterState";var nx=Q.createContext(!1),py=Q.createContext({isTransitioning:!1});py.displayName="ViewTransition";var rx=Q.createContext(new Map);rx.displayName="Fetchers";var ax=Q.createContext(null);ax.displayName="Await";var yi=Q.createContext(null);yi.displayName="Navigation";var Ca=Q.createContext(null);Ca.displayName="Location";var fs=Q.createContext({outlet:null,matches:[],isDataRoute:!1});fs.displayName="Route";var sd=Q.createContext(null);sd.displayName="RouteError";var yy="REACT_ROUTER_ERROR",lx="REDIRECT",ox="ROUTE_ERROR_RESPONSE";function ux(l){if(l.startsWith(`${yy}:${lx}:{`))try{let e=JSON.parse(l.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function cx(l){if(l.startsWith(`${yy}:${ox}:{`))try{let e=JSON.parse(l.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new ex(e.status,e.statusText,e.data)}catch{}}function fx(l,{relative:e}={}){tt(Oa(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:s}=Q.useContext(yi),{hash:r,pathname:a,search:u}=wa(l,{relative:e}),c=a;return t!=="/"&&(c=a==="/"?t:us([t,a])),s.createHref({pathname:c,search:u,hash:r})}function Oa(){return Q.useContext(Ca)!=null}function zs(){return tt(Oa(),"useLocation() may be used only in the context of a <Router> component."),Q.useContext(Ca).location}var vy="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Ey(l){Q.useContext(yi).static||Q.useLayoutEffect(l)}function dx(){let{isDataRoute:l}=Q.useContext(fs);return l?Lx():hx()}function hx(){tt(Oa(),"useNavigate() may be used only in the context of a <Router> component.");let l=Q.useContext(vr),{basename:e,navigator:t}=Q.useContext(yi),{matches:s}=Q.useContext(fs),{pathname:r}=zs(),a=JSON.stringify(fy(s)),u=Q.useRef(!1);return Ey(()=>{u.current=!0}),Q.useCallback((h,d={})=>{if(Ui(u.current,vy),!u.current)return;if(typeof h=="number"){t.go(h);return}let g=dy(h,JSON.parse(a),r,d.relative==="path");l==null&&e!=="/"&&(g.pathname=g.pathname==="/"?e:us([e,g.pathname])),(d.replace?t.replace:t.push)(g,d.state,d)},[e,t,a,r,l])}Q.createContext(null);function wa(l,{relative:e}={}){let{matches:t}=Q.useContext(fs),{pathname:s}=zs(),r=JSON.stringify(fy(t));return Q.useMemo(()=>dy(l,JSON.parse(r),s,e==="path"),[l,r,s,e])}function gx(l,e){return Sy(l,e)}function Sy(l,e,t,s,r){tt(Oa(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:a}=Q.useContext(yi),{matches:u}=Q.useContext(fs),c=u[u.length-1],h=c?c.params:{},d=c?c.pathname:"/",g=c?c.pathnameBase:"/",m=c&&c.route;{let _=m&&m.path||"";xy(d,!m||_.endsWith("*")||_.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${_}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${_}"> to <Route path="${_==="/"?"*":`${_}/*`}">.`)}let v=zs(),E;if(e){let _=typeof e=="string"?yr(e):e;tt(g==="/"||_.pathname?.startsWith(g),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${g}" but pathname "${_.pathname}" was given in the \`location\` prop.`),E=_}else E=v;let S=E.pathname||"/",x=S;if(g!=="/"){let _=g.replace(/^\//,"").split("/");x="/"+S.replace(/^\//,"").split("/").slice(_.length).join("/")}let T=oy(l,{pathname:x});Ui(m||T!=null,`No routes matched location "${E.pathname}${E.search}${E.hash}" `),Ui(T==null||T[T.length-1].route.element!==void 0||T[T.length-1].route.Component!==void 0||T[T.length-1].route.lazy!==void 0,`Matched leaf route at location "${E.pathname}${E.search}${E.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let L=Ex(T&&T.map(_=>Object.assign({},_,{params:Object.assign({},h,_.params),pathname:us([g,a.encodeLocation?a.encodeLocation(_.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:_.pathname]),pathnameBase:_.pathnameBase==="/"?g:us([g,a.encodeLocation?a.encodeLocation(_.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:_.pathnameBase])})),u,t,s,r);return e&&L?Q.createElement(Ca.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...E},navigationType:"POP"}},L):L}function mx(){let l=bx(),e=tx(l)?`${l.status} ${l.statusText}`:l instanceof Error?l.message:JSON.stringify(l),t=l instanceof Error?l.stack:null,s="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:s},a={padding:"2px 4px",backgroundColor:s},u=null;return console.error("Error handled by React Router default ErrorBoundary:",l),u=Q.createElement(Q.Fragment,null,Q.createElement("p",null," Hey developer "),Q.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Q.createElement("code",{style:a},"ErrorBoundary")," or"," ",Q.createElement("code",{style:a},"errorElement")," prop on your route.")),Q.createElement(Q.Fragment,null,Q.createElement("h2",null,"Unexpected Application Error!"),Q.createElement("h3",{style:{fontStyle:"italic"}},e),t?Q.createElement("pre",{style:r},t):null,u)}var px=Q.createElement(mx,null),Ty=class extends Q.Component{constructor(l){super(l),this.state={location:l.location,revalidation:l.revalidation,error:l.error}}static getDerivedStateFromError(l){return{error:l}}static getDerivedStateFromProps(l,e){return e.location!==l.location||e.revalidation!=="idle"&&l.revalidation==="idle"?{error:l.error,location:l.location,revalidation:l.revalidation}:{error:l.error!==void 0?l.error:e.error,location:e.location,revalidation:l.revalidation||e.revalidation}}componentDidCatch(l,e){this.props.onError?this.props.onError(l,e):console.error("React Router caught the following error during render",l)}render(){let l=this.state.error;if(this.context&&typeof l=="object"&&l&&"digest"in l&&typeof l.digest=="string"){const t=cx(l.digest);t&&(l=t)}let e=l!==void 0?Q.createElement(fs.Provider,{value:this.props.routeContext},Q.createElement(sd.Provider,{value:l,children:this.props.component})):this.props.children;return this.context?Q.createElement(yx,{error:l},e):e}};Ty.contextType=nx;var uf=new WeakMap;function yx({children:l,error:e}){let{basename:t}=Q.useContext(yi);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let s=ux(e.digest);if(s){let r=uf.get(e);if(r)throw r;let a=gy(s.location,t);if(hy&&!uf.get(e))if(a.isExternal||s.reloadDocument)window.location.href=a.absoluteURL||a.to;else{const u=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(a.to,{replace:s.replace}));throw uf.set(e,u),u}return Q.createElement("meta",{httpEquiv:"refresh",content:`0;url=${a.absoluteURL||a.to}`})}}return l}function vx({routeContext:l,match:e,children:t}){let s=Q.useContext(vr);return s&&s.static&&s.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=e.route.id),Q.createElement(fs.Provider,{value:l},t)}function Ex(l,e=[],t=null,s=null,r=null){if(l==null){if(!t)return null;if(t.errors)l=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)l=t.matches;else return null}let a=l,u=t?.errors;if(u!=null){let g=a.findIndex(m=>m.route.id&&u?.[m.route.id]!==void 0);tt(g>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(u).join(",")}`),a=a.slice(0,Math.min(a.length,g+1))}let c=!1,h=-1;if(t)for(let g=0;g<a.length;g++){let m=a[g];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(h=g),m.route.id){let{loaderData:v,errors:E}=t,S=m.route.loader&&!v.hasOwnProperty(m.route.id)&&(!E||E[m.route.id]===void 0);if(m.route.lazy||S){c=!0,h>=0?a=a.slice(0,h+1):a=[a[0]];break}}}let d=t&&s?(g,m)=>{s(g,{location:t.location,params:t.matches?.[0]?.params??{},unstable_pattern:ix(t.matches),errorInfo:m})}:void 0;return a.reduceRight((g,m,v)=>{let E,S=!1,x=null,T=null;t&&(E=u&&m.route.id?u[m.route.id]:void 0,x=m.route.errorElement||px,c&&(h<0&&v===0?(xy("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),S=!0,T=null):h===v&&(S=!0,T=m.route.hydrateFallbackElement||null)));let L=e.concat(a.slice(0,v+1)),_=()=>{let I;return E?I=x:S?I=T:m.route.Component?I=Q.createElement(m.route.Component,null):m.route.element?I=m.route.element:I=g,Q.createElement(vx,{match:m,routeContext:{outlet:g,matches:L,isDataRoute:t!=null},children:I})};return t&&(m.route.ErrorBoundary||m.route.errorElement||v===0)?Q.createElement(Ty,{location:t.location,revalidation:t.revalidation,component:x,error:E,children:_(),routeContext:{outlet:null,matches:L,isDataRoute:!0},onError:d}):_()},null)}function nd(l){return`${l} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Sx(l){let e=Q.useContext(vr);return tt(e,nd(l)),e}function Tx(l){let e=Q.useContext(Fo);return tt(e,nd(l)),e}function xx(l){let e=Q.useContext(fs);return tt(e,nd(l)),e}function rd(l){let e=xx(l),t=e.matches[e.matches.length-1];return tt(t.route.id,`${l} can only be used on routes that contain a unique "id"`),t.route.id}function Ax(){return rd("useRouteId")}function bx(){let l=Q.useContext(sd),e=Tx("useRouteError"),t=rd("useRouteError");return l!==void 0?l:e.errors?.[t]}function Lx(){let{router:l}=Sx("useNavigate"),e=rd("useNavigate"),t=Q.useRef(!1);return Ey(()=>{t.current=!0}),Q.useCallback(async(r,a={})=>{Ui(t.current,vy),t.current&&(typeof r=="number"?await l.navigate(r):await l.navigate(r,{fromRouteId:e,...a}))},[l,e])}var j0={};function xy(l,e,t){!e&&!j0[l]&&(j0[l]=!0,Ui(!1,t))}Q.memo(Rx);function Rx({routes:l,future:e,state:t,onError:s}){return Sy(l,void 0,t,s,e)}function or(l){tt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function _x({basename:l="/",children:e=null,location:t,navigationType:s="POP",navigator:r,static:a=!1,unstable_useTransitions:u}){tt(!Oa(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let c=l.replace(/^\/*/,"/"),h=Q.useMemo(()=>({basename:c,navigator:r,static:a,unstable_useTransitions:u,future:{}}),[c,r,a,u]);typeof t=="string"&&(t=yr(t));let{pathname:d="/",search:g="",hash:m="",state:v=null,key:E="default"}=t,S=Q.useMemo(()=>{let x=cs(d,c);return x==null?null:{location:{pathname:x,search:g,hash:m,state:v,key:E},navigationType:s}},[c,d,g,m,v,E,s]);return Ui(S!=null,`<Router basename="${c}"> is not able to match the URL "${d}${g}${m}" because it does not start with the basename, so the <Router> won't render anything.`),S==null?null:Q.createElement(yi.Provider,{value:h},Q.createElement(Ca.Provider,{children:e,value:S}))}function Dx({children:l,location:e}){return gx(Pf(l),e)}function Pf(l,e=[]){let t=[];return Q.Children.forEach(l,(s,r)=>{if(!Q.isValidElement(s))return;let a=[...e,r];if(s.type===Q.Fragment){t.push.apply(t,Pf(s.props.children,a));return}tt(s.type===or,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),tt(!s.props.index||!s.props.children,"An index route cannot have child routes.");let u={id:s.props.id||a.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,middleware:s.props.middleware,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(u.children=Pf(s.props.children,a)),t.push(u)}),t}var po="get",yo="application/x-www-form-urlencoded";function Bo(l){return typeof HTMLElement<"u"&&l instanceof HTMLElement}function Ix(l){return Bo(l)&&l.tagName.toLowerCase()==="button"}function Cx(l){return Bo(l)&&l.tagName.toLowerCase()==="form"}function Ox(l){return Bo(l)&&l.tagName.toLowerCase()==="input"}function wx(l){return!!(l.metaKey||l.altKey||l.ctrlKey||l.shiftKey)}function Mx(l,e){return l.button===0&&(!e||e==="_self")&&!wx(l)}var Jl=null;function kx(){if(Jl===null)try{new FormData(document.createElement("form"),0),Jl=!1}catch{Jl=!0}return Jl}var Nx=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function cf(l){return l!=null&&!Nx.has(l)?(Ui(!1,`"${l}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${yo}"`),null):l}function Px(l,e){let t,s,r,a,u;if(Cx(l)){let c=l.getAttribute("action");s=c?cs(c,e):null,t=l.getAttribute("method")||po,r=cf(l.getAttribute("enctype"))||yo,a=new FormData(l)}else if(Ix(l)||Ox(l)&&(l.type==="submit"||l.type==="image")){let c=l.form;if(c==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=l.getAttribute("formaction")||c.getAttribute("action");if(s=h?cs(h,e):null,t=l.getAttribute("formmethod")||c.getAttribute("method")||po,r=cf(l.getAttribute("formenctype"))||cf(c.getAttribute("enctype"))||yo,a=new FormData(c,l),!kx()){let{name:d,type:g,value:m}=l;if(g==="image"){let v=d?`${d}.`:"";a.append(`${v}x`,"0"),a.append(`${v}y`,"0")}else d&&a.append(d,m)}}else{if(Bo(l))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=po,s=null,r=yo,u=l}return a&&r==="text/plain"&&(u=a,a=void 0),{action:s,method:t.toLowerCase(),encType:r,formData:a,body:u}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function ad(l,e){if(l===!1||l===null||typeof l>"u")throw new Error(e)}function Ux(l,e,t,s){let r=typeof l=="string"?new URL(l,typeof window>"u"?"server://singlefetch/":window.location.origin):l;return t?r.pathname.endsWith("/")?r.pathname=`${r.pathname}_.${s}`:r.pathname=`${r.pathname}.${s}`:r.pathname==="/"?r.pathname=`_root.${s}`:e&&cs(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${s}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${s}`,r}async function Fx(l,e){if(l.id in e)return e[l.id];try{let t=await import(l.module);return e[l.id]=t,t}catch(t){return console.error(`Error loading route module \`${l.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Bx(l){return l==null?!1:l.href==null?l.rel==="preload"&&typeof l.imageSrcSet=="string"&&typeof l.imageSizes=="string":typeof l.rel=="string"&&typeof l.href=="string"}async function $x(l,e,t){let s=await Promise.all(l.map(async r=>{let a=e.routes[r.route.id];if(a){let u=await Fx(a,t);return u.links?u.links():[]}return[]}));return Kx(s.flat(1).filter(Bx).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function H0(l,e,t,s,r,a){let u=(h,d)=>t[d]?h.route.id!==t[d].route.id:!0,c=(h,d)=>t[d].pathname!==h.pathname||t[d].route.path?.endsWith("*")&&t[d].params["*"]!==h.params["*"];return a==="assets"?e.filter((h,d)=>u(h,d)||c(h,d)):a==="data"?e.filter((h,d)=>{let g=s.routes[h.route.id];if(!g||!g.hasLoader)return!1;if(u(h,d)||c(h,d))return!0;if(h.route.shouldRevalidate){let m=h.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(l,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof m=="boolean")return m}return!0}):[]}function Gx(l,e,{includeHydrateFallback:t}={}){return jx(l.map(s=>{let r=e.routes[s.route.id];if(!r)return[];let a=[r.module];return r.clientActionModule&&(a=a.concat(r.clientActionModule)),r.clientLoaderModule&&(a=a.concat(r.clientLoaderModule)),t&&r.hydrateFallbackModule&&(a=a.concat(r.hydrateFallbackModule)),r.imports&&(a=a.concat(r.imports)),a}).flat(1))}function jx(l){return[...new Set(l)]}function Hx(l){let e={},t=Object.keys(l).sort();for(let s of t)e[s]=l[s];return e}function Kx(l,e){let t=new Set;return new Set(e),l.reduce((s,r)=>{let a=JSON.stringify(Hx(r));return t.has(a)||(t.add(a),s.push({key:a,link:r})),s},[])}function Ay(){let l=Q.useContext(vr);return ad(l,"You must render this element inside a <DataRouterContext.Provider> element"),l}function zx(){let l=Q.useContext(Fo);return ad(l,"You must render this element inside a <DataRouterStateContext.Provider> element"),l}var ld=Q.createContext(void 0);ld.displayName="FrameworkContext";function by(){let l=Q.useContext(ld);return ad(l,"You must render this element inside a <HydratedRouter> element"),l}function Vx(l,e){let t=Q.useContext(ld),[s,r]=Q.useState(!1),[a,u]=Q.useState(!1),{onFocus:c,onBlur:h,onMouseEnter:d,onMouseLeave:g,onTouchStart:m}=e,v=Q.useRef(null);Q.useEffect(()=>{if(l==="render"&&u(!0),l==="viewport"){let x=L=>{L.forEach(_=>{u(_.isIntersecting)})},T=new IntersectionObserver(x,{threshold:.5});return v.current&&T.observe(v.current),()=>{T.disconnect()}}},[l]),Q.useEffect(()=>{if(s){let x=setTimeout(()=>{u(!0)},100);return()=>{clearTimeout(x)}}},[s]);let E=()=>{r(!0)},S=()=>{r(!1),u(!1)};return t?l!=="intent"?[a,v,{}]:[a,v,{onFocus:pa(c,E),onBlur:pa(h,S),onMouseEnter:pa(d,E),onMouseLeave:pa(g,S),onTouchStart:pa(m,E)}]:[!1,v,{}]}function pa(l,e){return t=>{l&&l(t),t.defaultPrevented||e(t)}}function Yx({page:l,...e}){let{router:t}=Ay(),s=Q.useMemo(()=>oy(t.routes,l,t.basename),[t.routes,l,t.basename]);return s?Q.createElement(Xx,{page:l,matches:s,...e}):null}function qx(l){let{manifest:e,routeModules:t}=by(),[s,r]=Q.useState([]);return Q.useEffect(()=>{let a=!1;return $x(l,e,t).then(u=>{a||r(u)}),()=>{a=!0}},[l,e,t]),s}function Xx({page:l,matches:e,...t}){let s=zs(),{future:r,manifest:a,routeModules:u}=by(),{basename:c}=Ay(),{loaderData:h,matches:d}=zx(),g=Q.useMemo(()=>H0(l,e,d,a,s,"data"),[l,e,d,a,s]),m=Q.useMemo(()=>H0(l,e,d,a,s,"assets"),[l,e,d,a,s]),v=Q.useMemo(()=>{if(l===s.pathname+s.search+s.hash)return[];let x=new Set,T=!1;if(e.forEach(_=>{let I=a.routes[_.route.id];!I||!I.hasLoader||(!g.some(O=>O.route.id===_.route.id)&&_.route.id in h&&u[_.route.id]?.shouldRevalidate||I.hasClientLoader?T=!0:x.add(_.route.id))}),x.size===0)return[];let L=Ux(l,c,r.unstable_trailingSlashAwareDataRequests,"data");return T&&x.size>0&&L.searchParams.set("_routes",e.filter(_=>x.has(_.route.id)).map(_=>_.route.id).join(",")),[L.pathname+L.search]},[c,r.unstable_trailingSlashAwareDataRequests,h,s,a,g,e,l,u]),E=Q.useMemo(()=>Gx(m,a),[m,a]),S=qx(m);return Q.createElement(Q.Fragment,null,v.map(x=>Q.createElement("link",{key:x,rel:"prefetch",as:"fetch",href:x,...t})),E.map(x=>Q.createElement("link",{key:x,rel:"modulepreload",href:x,...t})),S.map(({key:x,link:T})=>Q.createElement("link",{key:x,nonce:t.nonce,...T,crossOrigin:T.crossOrigin??t.crossOrigin})))}function Qx(...l){return e=>{l.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var Wx=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Wx&&(window.__reactRouterVersion="7.13.0")}catch{}function Zx({basename:l,children:e,unstable_useTransitions:t,window:s}){let r=Q.useRef();r.current==null&&(r.current=OT({window:s,v5Compat:!0}));let a=r.current,[u,c]=Q.useState({action:a.action,location:a.location}),h=Q.useCallback(d=>{t===!1?c(d):Q.startTransition(()=>c(d))},[t]);return Q.useLayoutEffect(()=>a.listen(h),[a,h]),Q.createElement(_x,{basename:l,children:e,location:u.location,navigationType:u.action,navigator:a,unstable_useTransitions:t})}var Ly=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,mi=Q.forwardRef(function({onClick:e,discover:t="render",prefetch:s="none",relative:r,reloadDocument:a,replace:u,state:c,target:h,to:d,preventScrollReset:g,viewTransition:m,unstable_defaultShouldRevalidate:v,...E},S){let{basename:x,unstable_useTransitions:T}=Q.useContext(yi),L=typeof d=="string"&&Ly.test(d),_=gy(d,x);d=_.to;let I=fx(d,{relative:r}),[O,k,K]=Vx(s,E),w=iA(d,{replace:u,state:c,target:h,preventScrollReset:g,relative:r,viewTransition:m,unstable_defaultShouldRevalidate:v,unstable_useTransitions:T});function B(U){e&&e(U),U.defaultPrevented||w(U)}let $=Q.createElement("a",{...E,...K,href:_.absoluteURL||I,onClick:_.isExternal||a?e:B,ref:Qx(S,k),target:h,"data-discover":!L&&t==="render"?"true":void 0});return O&&!L?Q.createElement(Q.Fragment,null,$,Q.createElement(Yx,{page:I})):$});mi.displayName="Link";var Jx=Q.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:s="",end:r=!1,style:a,to:u,viewTransition:c,children:h,...d},g){let m=wa(u,{relative:d.relative}),v=zs(),E=Q.useContext(Fo),{navigator:S,basename:x}=Q.useContext(yi),T=E!=null&&lA(m)&&c===!0,L=S.encodeLocation?S.encodeLocation(m).pathname:m.pathname,_=v.pathname,I=E&&E.navigation&&E.navigation.location?E.navigation.location.pathname:null;t||(_=_.toLowerCase(),I=I?I.toLowerCase():null,L=L.toLowerCase()),I&&x&&(I=cs(I,x)||I);const O=L!=="/"&&L.endsWith("/")?L.length-1:L.length;let k=_===L||!r&&_.startsWith(L)&&_.charAt(O)==="/",K=I!=null&&(I===L||!r&&I.startsWith(L)&&I.charAt(L.length)==="/"),w={isActive:k,isPending:K,isTransitioning:T},B=k?e:void 0,$;typeof s=="function"?$=s(w):$=[s,k?"active":null,K?"pending":null,T?"transitioning":null].filter(Boolean).join(" ");let U=typeof a=="function"?a(w):a;return Q.createElement(mi,{...d,"aria-current":B,className:$,ref:g,style:U,to:u,viewTransition:c},typeof h=="function"?h(w):h)});Jx.displayName="NavLink";var eA=Q.forwardRef(({discover:l="render",fetcherKey:e,navigate:t,reloadDocument:s,replace:r,state:a,method:u=po,action:c,onSubmit:h,relative:d,preventScrollReset:g,viewTransition:m,unstable_defaultShouldRevalidate:v,...E},S)=>{let{unstable_useTransitions:x}=Q.useContext(yi),T=rA(),L=aA(c,{relative:d}),_=u.toLowerCase()==="get"?"get":"post",I=typeof c=="string"&&Ly.test(c),O=k=>{if(h&&h(k),k.defaultPrevented)return;k.preventDefault();let K=k.nativeEvent.submitter,w=K?.getAttribute("formmethod")||u,B=()=>T(K||k.currentTarget,{fetcherKey:e,method:w,navigate:t,replace:r,state:a,relative:d,preventScrollReset:g,viewTransition:m,unstable_defaultShouldRevalidate:v});x&&t!==!1?Q.startTransition(()=>B()):B()};return Q.createElement("form",{ref:S,method:_,action:L,onSubmit:s?h:O,...E,"data-discover":!I&&l==="render"?"true":void 0})});eA.displayName="Form";function tA(l){return`${l} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Ry(l){let e=Q.useContext(vr);return tt(e,tA(l)),e}function iA(l,{target:e,replace:t,state:s,preventScrollReset:r,relative:a,viewTransition:u,unstable_defaultShouldRevalidate:c,unstable_useTransitions:h}={}){let d=dx(),g=zs(),m=wa(l,{relative:a});return Q.useCallback(v=>{if(Mx(v,e)){v.preventDefault();let E=t!==void 0?t:xa(g)===xa(m),S=()=>d(l,{replace:E,state:s,preventScrollReset:r,relative:a,viewTransition:u,unstable_defaultShouldRevalidate:c});h?Q.startTransition(()=>S()):S()}},[g,d,m,t,s,e,l,r,a,u,c,h])}var sA=0,nA=()=>`__${String(++sA)}__`;function rA(){let{router:l}=Ry("useSubmit"),{basename:e}=Q.useContext(yi),t=Ax(),s=l.fetch,r=l.navigate;return Q.useCallback(async(a,u={})=>{let{action:c,method:h,encType:d,formData:g,body:m}=Px(a,e);if(u.navigate===!1){let v=u.fetcherKey||nA();await s(v,t,u.action||c,{unstable_defaultShouldRevalidate:u.unstable_defaultShouldRevalidate,preventScrollReset:u.preventScrollReset,formData:g,body:m,formMethod:u.method||h,formEncType:u.encType||d,flushSync:u.flushSync})}else await r(u.action||c,{unstable_defaultShouldRevalidate:u.unstable_defaultShouldRevalidate,preventScrollReset:u.preventScrollReset,formData:g,body:m,formMethod:u.method||h,formEncType:u.encType||d,replace:u.replace,state:u.state,fromRouteId:t,flushSync:u.flushSync,viewTransition:u.viewTransition})},[s,r,e,t])}function aA(l,{relative:e}={}){let{basename:t}=Q.useContext(yi),s=Q.useContext(fs);tt(s,"useFormAction must be used inside a RouteContext");let[r]=s.matches.slice(-1),a={...wa(l||".",{relative:e})},u=zs();if(l==null){a.search=u.search;let c=new URLSearchParams(a.search),h=c.getAll("index");if(h.some(g=>g==="")){c.delete("index"),h.filter(m=>m).forEach(m=>c.append("index",m));let g=c.toString();a.search=g?`?${g}`:""}}return(!l||l===".")&&r.route.index&&(a.search=a.search?a.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(a.pathname=a.pathname==="/"?t:us([t,a.pathname])),xa(a)}function lA(l,{relative:e}={}){let t=Q.useContext(py);tt(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=Ry("useViewTransitionState"),r=wa(l,{relative:e});if(!t.isTransitioning)return!1;let a=cs(t.currentLocation.pathname,s)||t.currentLocation.pathname,u=cs(t.nextLocation.pathname,s)||t.nextLocation.pathname;return Ro(r.pathname,u)!=null||Ro(r.pathname,a)!=null}const oA=()=>{const l=zs(),e=t=>l.pathname===t?"nav-link active":"nav-link";return R.jsx("nav",{className:"navbar navbar-expand-lg navbar-dark sticky-top",children:R.jsxs("div",{className:"container",children:[R.jsxs(mi,{className:"navbar-brand d-flex align-items-center",to:"/",children:[R.jsx("img",{src:"/logo.png",alt:"InfinityGrab Logo",width:"40",height:"40",className:"d-inline-block align-text-top me-2 rounded-circle"}),"InfinityGrab"]}),R.jsx("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav",children:R.jsx("span",{className:"navbar-toggler-icon"})}),R.jsxs("div",{className:"collapse navbar-collapse",id:"navbarNav",children:[R.jsxs("ul",{className:"navbar-nav mx-auto",children:[R.jsx("li",{className:"nav-item",children:R.jsx(mi,{className:e("/"),to:"/",children:"Home"})}),R.jsx("li",{className:"nav-item",children:R.jsx(mi,{className:e("/about"),to:"/about",children:"About"})}),R.jsx("li",{className:"nav-item",children:R.jsx("a",{className:"nav-link",href:"/#features",children:"Features"})}),R.jsx("li",{className:"nav-item",children:R.jsx("a",{className:"nav-link",href:"/#faq",children:"FAQ"})}),R.jsx("li",{className:"nav-item",children:R.jsx(mi,{className:e("/contact"),to:"/contact",children:"Contact"})})]}),R.jsxs(mi,{to:"/",className:"btn btn-primary btn-download-header",children:[R.jsx("i",{className:"bi bi-download me-2"}),"Download Now"]})]})]})})},fe=Number.isFinite||function(l){return typeof l=="number"&&isFinite(l)},uA=Number.isSafeInteger||function(l){return typeof l=="number"&&Math.abs(l)<=cA},cA=Number.MAX_SAFE_INTEGER||9007199254740991;let ye=(function(l){return l.NETWORK_ERROR="networkError",l.MEDIA_ERROR="mediaError",l.KEY_SYSTEM_ERROR="keySystemError",l.MUX_ERROR="muxError",l.OTHER_ERROR="otherError",l})({}),H=(function(l){return l.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",l.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",l.KEY_SYSTEM_NO_SESSION="keySystemNoSession",l.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",l.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",l.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",l.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",l.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",l.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",l.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",l.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",l.MANIFEST_LOAD_ERROR="manifestLoadError",l.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",l.MANIFEST_PARSING_ERROR="manifestParsingError",l.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",l.LEVEL_EMPTY_ERROR="levelEmptyError",l.LEVEL_LOAD_ERROR="levelLoadError",l.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",l.LEVEL_PARSING_ERROR="levelParsingError",l.LEVEL_SWITCH_ERROR="levelSwitchError",l.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",l.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",l.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",l.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",l.FRAG_LOAD_ERROR="fragLoadError",l.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",l.FRAG_DECRYPT_ERROR="fragDecryptError",l.FRAG_PARSING_ERROR="fragParsingError",l.FRAG_GAP="fragGap",l.REMUX_ALLOC_ERROR="remuxAllocError",l.KEY_LOAD_ERROR="keyLoadError",l.KEY_LOAD_TIMEOUT="keyLoadTimeOut",l.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",l.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",l.BUFFER_APPEND_ERROR="bufferAppendError",l.BUFFER_APPENDING_ERROR="bufferAppendingError",l.BUFFER_STALLED_ERROR="bufferStalledError",l.BUFFER_FULL_ERROR="bufferFullError",l.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",l.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",l.ASSET_LIST_LOAD_ERROR="assetListLoadError",l.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",l.ASSET_LIST_PARSING_ERROR="assetListParsingError",l.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",l.INTERNAL_EXCEPTION="internalException",l.INTERNAL_ABORTED="aborted",l.ATTACH_MEDIA_ERROR="attachMediaError",l.UNKNOWN="unknown",l})({}),b=(function(l){return l.MEDIA_ATTACHING="hlsMediaAttaching",l.MEDIA_ATTACHED="hlsMediaAttached",l.MEDIA_DETACHING="hlsMediaDetaching",l.MEDIA_DETACHED="hlsMediaDetached",l.MEDIA_ENDED="hlsMediaEnded",l.STALL_RESOLVED="hlsStallResolved",l.BUFFER_RESET="hlsBufferReset",l.BUFFER_CODECS="hlsBufferCodecs",l.BUFFER_CREATED="hlsBufferCreated",l.BUFFER_APPENDING="hlsBufferAppending",l.BUFFER_APPENDED="hlsBufferAppended",l.BUFFER_EOS="hlsBufferEos",l.BUFFERED_TO_END="hlsBufferedToEnd",l.BUFFER_FLUSHING="hlsBufferFlushing",l.BUFFER_FLUSHED="hlsBufferFlushed",l.MANIFEST_LOADING="hlsManifestLoading",l.MANIFEST_LOADED="hlsManifestLoaded",l.MANIFEST_PARSED="hlsManifestParsed",l.LEVEL_SWITCHING="hlsLevelSwitching",l.LEVEL_SWITCHED="hlsLevelSwitched",l.LEVEL_LOADING="hlsLevelLoading",l.LEVEL_LOADED="hlsLevelLoaded",l.LEVEL_UPDATED="hlsLevelUpdated",l.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",l.LEVELS_UPDATED="hlsLevelsUpdated",l.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",l.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",l.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",l.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",l.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",l.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",l.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",l.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",l.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",l.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",l.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",l.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",l.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",l.CUES_PARSED="hlsCuesParsed",l.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",l.INIT_PTS_FOUND="hlsInitPtsFound",l.FRAG_LOADING="hlsFragLoading",l.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",l.FRAG_LOADED="hlsFragLoaded",l.FRAG_DECRYPTED="hlsFragDecrypted",l.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",l.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",l.FRAG_PARSING_METADATA="hlsFragParsingMetadata",l.FRAG_PARSED="hlsFragParsed",l.FRAG_BUFFERED="hlsFragBuffered",l.FRAG_CHANGED="hlsFragChanged",l.FPS_DROP="hlsFpsDrop",l.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",l.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",l.ERROR="hlsError",l.DESTROYING="hlsDestroying",l.KEY_LOADING="hlsKeyLoading",l.KEY_LOADED="hlsKeyLoaded",l.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",l.BACK_BUFFER_REACHED="hlsBackBufferReached",l.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",l.ASSET_LIST_LOADING="hlsAssetListLoading",l.ASSET_LIST_LOADED="hlsAssetListLoaded",l.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",l.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",l.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",l.INTERSTITIAL_STARTED="hlsInterstitialStarted",l.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",l.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",l.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",l.INTERSTITIAL_ENDED="hlsInterstitialEnded",l.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",l.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",l.EVENT_CUE_ENTER="hlsEventCueEnter",l})({});var _e={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ge={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class sr{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class fA{constructor(e,t,s,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new sr(e),this.fast_=new sr(t),this.defaultTTFB_=r,this.ttfb_=new sr(e)}update(e,t){const{slow_:s,fast_:r,ttfb_:a}=this;s.halfLife!==e&&(this.slow_=new sr(e,s.getEstimate(),s.getTotalWeight())),r.halfLife!==t&&(this.fast_=new sr(t,r.getEstimate(),r.getTotalWeight())),a.halfLife!==e&&(this.ttfb_=new sr(e,a.getEstimate(),a.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const s=8*t,r=e/1e3,a=s/r;this.fast_.sample(r,a),this.slow_.sample(r,a)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function dA(l,e,t){return(e=gA(e))in l?Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[e]=t,l}function Ve(){return Ve=Object.assign?Object.assign.bind():function(l){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(l[s]=t[s])}return l},Ve.apply(null,arguments)}function K0(l,e){var t=Object.keys(l);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(l);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(l,r).enumerable})),t.push.apply(t,s)}return t}function Ge(l){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?K0(Object(t),!0).forEach(function(s){dA(l,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(t)):K0(Object(t)).forEach(function(s){Object.defineProperty(l,s,Object.getOwnPropertyDescriptor(t,s))})}return l}function hA(l,e){if(typeof l!="object"||!l)return l;var t=l[Symbol.toPrimitive];if(t!==void 0){var s=t.call(l,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(l)}function gA(l){var e=hA(l,"string");return typeof e=="symbol"?e:e+""}class vi{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=$s,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const $s=function(){},mA={trace:$s,debug:$s,log:$s,warn:$s,info:$s,error:$s};function Uf(){return Ve({},mA)}function pA(l,e){const t=self.console[l];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${l}] >`):$s}function z0(l,e,t){return e[l]?e[l].bind(e):pA(l,t)}const Ff=Uf();function yA(l,e,t){const s=Uf();if(typeof console=="object"&&l===!0||typeof l=="object"){const r=["debug","log","info","warn","error"];r.forEach(a=>{s[a]=z0(a,l,t)});try{s.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return Uf()}r.forEach(a=>{Ff[a]=z0(a,l)})}else Ve(Ff,s);return s}const je=Ff;function Hs(l=!0){return typeof self>"u"?void 0:(l||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function vA(l){return typeof self<"u"&&l===self.ManagedMediaSource}function _y(l,e){const t=Object.keys(l),s=Object.keys(e),r=t.length,a=s.length;return!r||!a||r===a&&!t.some(u=>s.indexOf(u)===-1)}function si(l,e=!1){if(typeof TextDecoder<"u"){const d=new TextDecoder("utf-8").decode(l);if(e){const g=d.indexOf("\0");return g!==-1?d.substring(0,g):d}return d.replace(/\0/g,"")}const t=l.length;let s,r,a,u="",c=0;for(;c<t;){if(s=l[c++],s===0&&e)return u;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(s);break;case 12:case 13:r=l[c++],u+=String.fromCharCode((s&31)<<6|r&63);break;case 14:r=l[c++],a=l[c++],u+=String.fromCharCode((s&15)<<12|(r&63)<<6|(a&63)<<0);break}}return u}function Rt(l){let e="";for(let t=0;t<l.length;t++){let s=l[t].toString(16);s.length<2&&(s="0"+s),e+=s}return e}function Dy(l){return Uint8Array.from(l.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function EA(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var ff={exports:{}},V0;function SA(){return V0||(V0=1,(function(l,e){(function(t){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,u=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(h,d,g){if(g=g||{},h=h.trim(),d=d.trim(),!d){if(!g.alwaysNormalize)return h;var m=c.parseURL(h);if(!m)throw new Error("Error trying to parse base URL.");return m.path=c.normalizePath(m.path),c.buildURLFromParts(m)}var v=c.parseURL(d);if(!v)throw new Error("Error trying to parse relative URL.");if(v.scheme)return g.alwaysNormalize?(v.path=c.normalizePath(v.path),c.buildURLFromParts(v)):d;var E=c.parseURL(h);if(!E)throw new Error("Error trying to parse base URL.");if(!E.netLoc&&E.path&&E.path[0]!=="/"){var S=r.exec(E.path);E.netLoc=S[1],E.path=S[2]}E.netLoc&&!E.path&&(E.path="/");var x={scheme:E.scheme,netLoc:v.netLoc,path:null,params:v.params,query:v.query,fragment:v.fragment};if(!v.netLoc&&(x.netLoc=E.netLoc,v.path[0]!=="/"))if(!v.path)x.path=E.path,v.params||(x.params=E.params,v.query||(x.query=E.query));else{var T=E.path,L=T.substring(0,T.lastIndexOf("/")+1)+v.path;x.path=c.normalizePath(L)}return x.path===null&&(x.path=g.alwaysNormalize?c.normalizePath(v.path):v.path),c.buildURLFromParts(x)},parseURL:function(h){var d=s.exec(h);return d?{scheme:d[1]||"",netLoc:d[2]||"",path:d[3]||"",params:d[4]||"",query:d[5]||"",fragment:d[6]||""}:null},normalizePath:function(h){for(h=h.split("").reverse().join("").replace(a,"");h.length!==(h=h.replace(u,"")).length;);return h.split("").reverse().join("")},buildURLFromParts:function(h){return h.scheme+h.netLoc+h.path+h.params+h.query+h.fragment}};l.exports=c})()})(ff)),ff.exports}var od=SA();class ud{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var qe={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Iy{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,xA(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let r;s.length===1?r=t?.byteRangeEndOffset||0:r=parseInt(s[1]),this._byteRange=[r,parseInt(s[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[qe.AUDIO]:null,[qe.VIDEO]:null,[qe.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new ud),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=od.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[qe.AUDIO]=null,e[qe.VIDEO]=null,e[qe.AUDIOVIDEO]=null}}function lt(l){return l.sn!=="initSegment"}class df extends Iy{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(fe(e)&&fe(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const s=Object.keys(t);if(s.length===1){const r=this._decryptdata=t[s[0]]||null;r&&(this._decryptdata=r.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=fe(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const s=Object.keys(this.levelkeys),r=s.length;if(r>1||r===1&&(t=this.levelkeys[s[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!fe(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return lt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var s;const r=t[e];r&&!((s=this._decryptdata)!=null&&s.keyId)&&(this._decryptdata=r.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,s,r,a,u=!1){const{elementaryStreams:c}=this,h=c[e];if(!h){c[e]={startPTS:t,endPTS:s,startDTS:r,endDTS:a,partial:u};return}h.startPTS=Math.min(h.startPTS,t),h.endPTS=Math.max(h.endPTS,s),h.startDTS=Math.min(h.startDTS,r),h.endDTS=Math.max(h.endDTS,a)}}class TA extends Iy{constructor(e,t,s,r,a){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const u=e.enumeratedString("BYTERANGE");u&&this.setByteRange(u,a),a&&(this.fragOffset=a.fragOffset+a.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function Cy(l,e){const t=Object.getPrototypeOf(l);if(t){const s=Object.getOwnPropertyDescriptor(t,e);return s||Cy(t,e)}}function xA(l,e){const t=Cy(l,e);t&&(t.enumerable=!0,Object.defineProperty(l,e,t))}const Y0=Math.pow(2,32)-1,AA=[].push,Oy={video:1,audio:2,id3:3,text:4};function ht(l){return String.fromCharCode.apply(null,l)}function wy(l,e){const t=l[e]<<8|l[e+1];return t<0?65536+t:t}function Te(l,e){const t=My(l,e);return t<0?4294967296+t:t}function q0(l,e){let t=Te(l,e);return t*=Math.pow(2,32),t+=Te(l,e+4),t}function My(l,e){return l[e]<<24|l[e+1]<<16|l[e+2]<<8|l[e+3]}function bA(l){const e=l.byteLength;for(let t=0;t<e;){const s=Te(l,t);if(s>8&&l[t+4]===109&&l[t+5]===111&&l[t+6]===111&&l[t+7]===102)return!0;t=s>1?t+s:e}return!1}function Re(l,e){const t=[];if(!e.length)return t;const s=l.byteLength;for(let r=0;r<s;){const a=Te(l,r),u=ht(l.subarray(r+4,r+8)),c=a>1?r+a:s;if(u===e[0])if(e.length===1)t.push(l.subarray(r+8,c));else{const h=Re(l.subarray(r+8,c),e.slice(1));h.length&&AA.apply(t,h)}r=c}return t}function LA(l){const e=[],t=l[0];let s=8;const r=Te(l,s);s+=4;let a=0,u=0;t===0?(a=Te(l,s),u=Te(l,s+4),s+=8):(a=q0(l,s),u=q0(l,s+8),s+=16),s+=2;let c=l.length+u;const h=wy(l,s);s+=2;for(let d=0;d<h;d++){let g=s;const m=Te(l,g);g+=4;const v=m&2147483647;if((m&2147483648)>>>31===1)return je.warn("SIDX has hierarchical references (not supported)"),null;const S=Te(l,g);g+=4,e.push({referenceSize:v,subsegmentDuration:S,info:{duration:S/r,start:c,end:c+v-1}}),c+=v,g+=4,s=g}return{earliestPresentationTime:a,timescale:r,version:t,referencesCount:h,references:e}}function ky(l){const e=[],t=Re(l,["moov","trak"]);for(let r=0;r<t.length;r++){const a=t[r],u=Re(a,["tkhd"])[0];if(u){let c=u[0];const h=Te(u,c===0?12:20),d=Re(a,["mdia","mdhd"])[0];if(d){c=d[0];const g=Te(d,c===0?12:20),m=Re(a,["mdia","hdlr"])[0];if(m){const v=ht(m.subarray(8,12)),E={soun:qe.AUDIO,vide:qe.VIDEO}[v],S=Re(a,["mdia","minf","stbl","stsd"])[0],x=RA(S);E?(e[h]={timescale:g,type:E,stsd:x},e[E]=Ge({timescale:g,id:h},x)):e[h]={timescale:g,type:v,stsd:x}}}}}return Re(l,["moov","mvex","trex"]).forEach(r=>{const a=Te(r,4),u=e[a];u&&(u.default={duration:Te(r,12),flags:Te(r,20)})}),e}function RA(l){const e=l.subarray(8),t=e.subarray(86),s=ht(e.subarray(4,8));let r=s,a;const u=s==="enca"||s==="encv";if(u){const d=Re(e,[s])[0].subarray(s==="enca"?28:78);Re(d,["sinf"]).forEach(m=>{const v=Re(m,["schm"])[0];if(v){const E=ht(v.subarray(4,8));if(E==="cbcs"||E==="cenc"){const S=Re(m,["frma"])[0];S&&(r=ht(S))}}})}const c=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const h=Re(t,["avcC"])[0];h&&h.length>3&&(r+="."+to(h[1])+to(h[2])+to(h[3]),a=eo(c==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const h=Re(e,[s])[0],d=Re(h.subarray(28),["esds"])[0];if(d&&d.length>7){let g=4;if(d[g++]!==3)break;g=hf(d,g),g+=2;const m=d[g++];if(m&128&&(g+=2),m&64&&(g+=d[g++]),d[g++]!==4)break;g=hf(d,g);const v=d[g++];if(v===64)r+="."+to(v);else break;if(g+=12,d[g++]!==5)break;g=hf(d,g);const E=d[g++];let S=(E&248)>>3;S===31&&(S+=1+((E&7)<<3)+((d[g]&224)>>5)),r+="."+S}break}case"hvc1":case"hev1":{const h=Re(t,["hvcC"])[0];if(h&&h.length>12){const d=h[1],g=["","A","B","C"][d>>6],m=d&31,v=Te(h,2),E=(d&32)>>5?"H":"L",S=h[12],x=h.subarray(6,12);r+="."+g+m,r+="."+_A(v).toString(16).toUpperCase(),r+="."+E+S;let T="";for(let L=x.length;L--;){const _=x[L];(_||T)&&(T="."+_.toString(16).toUpperCase()+T)}r+=T}a=eo(c=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=eo(r,t)||r;break}case"vp09":{const h=Re(t,["vpcC"])[0];if(h&&h.length>6){const d=h[4],g=h[5],m=h[6]>>4&15;r+="."+Mi(d)+"."+Mi(g)+"."+Mi(m)}break}case"av01":{const h=Re(t,["av1C"])[0];if(h&&h.length>2){const d=h[1]>>>5,g=h[1]&31,m=h[2]>>>7?"H":"M",v=(h[2]&64)>>6,E=(h[2]&32)>>5,S=d===2&&v?E?12:10:v?10:8,x=(h[2]&16)>>4,T=(h[2]&8)>>3,L=(h[2]&4)>>2,_=h[2]&3;r+="."+d+"."+Mi(g)+m+"."+Mi(S)+"."+x+"."+T+L+_+"."+Mi(1)+"."+Mi(1)+"."+Mi(1)+"."+0,a=eo("dav1",t)}break}}return{codec:r,encrypted:u,supplemental:a}}function eo(l,e){const t=Re(e,["dvvC"]),s=t.length?t[0]:Re(e,["dvcC"])[0];if(s){const r=s[2]>>1&127,a=s[2]<<5&32|s[3]>>3&31;return l+"."+Mi(r)+"."+Mi(a)}}function _A(l){let e=0;for(let t=0;t<32;t++)e|=(l>>t&1)<<31-t;return e>>>0}function hf(l,e){const t=e+5;for(;l[e++]&128&&e<t;);return e}function to(l){return("0"+l.toString(16).toUpperCase()).slice(-2)}function Mi(l){return(l<10?"0":"")+l}function DA(l,e){if(!l||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&Ny(l,(s,r)=>{const a=s.subarray(8,24);a.some(u=>u!==0)||(je.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${Rt(a)} -> ${Rt(t)}`),s.set(t,8))})}function IA(l){const e=[];return Ny(l,t=>e.push(t.subarray(8,24))),e}function Ny(l,e){Re(l,["moov","trak"]).forEach(s=>{const r=Re(s,["mdia","minf","stbl","stsd"])[0];if(!r)return;const a=r.subarray(8);let u=Re(a,["enca"]);const c=u.length>0;c||(u=Re(a,["encv"])),u.forEach(h=>{const d=c?h.subarray(28):h.subarray(78);Re(d,["sinf"]).forEach(m=>{const v=Py(m);v&&e(v,c)})})})}function Py(l){const e=Re(l,["schm"])[0];if(e){const t=ht(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const s=Re(l,["schi","tenc"])[0];if(s)return s}}}function CA(l,e,t){const s={},r=Re(l,["moof","traf"]);for(let a=0;a<r.length;a++){const u=r[a],c=Re(u,["tfhd"])[0],h=Te(c,4),d=e[h];if(!d)continue;s[h]||(s[h]={start:NaN,duration:0,sampleCount:0,timescale:d.timescale,type:d.type});const g=s[h],m=Re(u,["tfdt"])[0];if(m){const I=m[0];let O=Te(m,4);I===1&&(O===Y0?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(O*=Y0+1,O+=Te(m,8))),fe(O)&&(!fe(g.start)||O<g.start)&&(g.start=O)}const v=d.default,E=Te(c,0)|v?.flags;let S=v?.duration||0;E&8&&(E&2?S=Te(c,12):S=Te(c,8));const x=Re(u,["trun"]);let T=g.start||0,L=0,_=S;for(let I=0;I<x.length;I++){const O=x[I],k=Te(O,4),K=g.sampleCount;g.sampleCount+=k;const w=O[3]&1,B=O[3]&4,$=O[2]&1,U=O[2]&2,W=O[2]&4,ne=O[2]&8;let ce=8,he=k;for(w&&(ce+=4),B&&k&&(!(O[ce+1]&1)&&g.keyFrameIndex===void 0&&(g.keyFrameIndex=K),ce+=4,$?(_=Te(O,ce),ce+=4):_=S,U&&(ce+=4),ne&&(ce+=4),T+=_,L+=_,he--);he--;)$?(_=Te(O,ce),ce+=4):_=S,U&&(ce+=4),W&&(O[ce+1]&1||g.keyFrameIndex===void 0&&(g.keyFrameIndex=g.sampleCount-(he+1),g.keyFrameStart=T),ce+=4),ne&&(ce+=4),T+=_,L+=_;!L&&S&&(L+=S*k)}g.duration+=L}if(!Object.keys(s).some(a=>s[a].duration)){let a=1/0,u=0;const c=Re(l,["sidx"]);for(let h=0;h<c.length;h++){const d=LA(c[h]);if(d!=null&&d.references){a=Math.min(a,d.earliestPresentationTime/d.timescale);const g=d.references.reduce((m,v)=>m+v.info.duration||0,0);u=Math.max(u,g+d.earliestPresentationTime/d.timescale)}}u&&fe(u)&&Object.keys(s).forEach(h=>{s[h].duration||(s[h].duration=u*s[h].timescale-s[h].start)})}return s}function OA(l){const e={valid:null,remainder:null},t=Re(l,["moof"]);if(t.length<2)return e.remainder=l,e;const s=t[t.length-1];return e.valid=l.slice(0,s.byteOffset-8),e.remainder=l.slice(s.byteOffset-8),e}function pi(l,e){const t=new Uint8Array(l.length+e.length);return t.set(l),t.set(e,l.length),t}function X0(l,e){const t=[],s=e.samples,r=e.timescale,a=e.id;let u=!1;return Re(s,["moof"]).map(h=>{const d=h.byteOffset-8;Re(h,["traf"]).map(m=>{const v=Re(m,["tfdt"]).map(E=>{const S=E[0];let x=Te(E,4);return S===1&&(x*=Math.pow(2,32),x+=Te(E,8)),x/r})[0];return v!==void 0&&(l=v),Re(m,["tfhd"]).map(E=>{const S=Te(E,4),x=Te(E,0)&16777215,T=(x&1)!==0,L=(x&2)!==0,_=(x&8)!==0;let I=0;const O=(x&16)!==0;let k=0;const K=(x&32)!==0;let w=8;S===a&&(T&&(w+=8),L&&(w+=4),_&&(I=Te(E,w),w+=4),O&&(k=Te(E,w),w+=4),K&&(w+=4),e.type==="video"&&(u=$o(e.codec)),Re(m,["trun"]).map(B=>{const $=B[0],U=Te(B,0)&16777215,W=(U&1)!==0;let ne=0;const ce=(U&4)!==0,he=(U&256)!==0;let oe=0;const N=(U&512)!==0;let X=0;const J=(U&1024)!==0,ae=(U&2048)!==0;let ue=0;const C=Te(B,4);let F=8;W&&(ne=Te(B,F),F+=4),ce&&(F+=4);let se=ne+d;for(let re=0;re<C;re++){if(he?(oe=Te(B,F),F+=4):oe=I,N?(X=Te(B,F),F+=4):X=k,J&&(F+=4),ae&&($===0?ue=Te(B,F):ue=My(B,F),F+=4),e.type===qe.VIDEO){let le=0;for(;le<X;){const de=Te(s,se);if(se+=4,wA(u,s[se])){const Se=s.subarray(se,se+de);cd(Se,u?2:1,l+ue/r,t)}se+=de,le+=de+4}}l+=oe/r}}))})})}),t}function $o(l){if(!l)return!1;const e=l.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function wA(l,e){if(l){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function cd(l,e,t,s){const r=Uy(l);let a=0;a+=e;let u=0,c=0,h=0;for(;a<r.length;){u=0;do{if(a>=r.length)break;h=r[a++],u+=h}while(h===255);c=0;do{if(a>=r.length)break;h=r[a++],c+=h}while(h===255);const d=r.length-a;let g=a;if(c<d)a+=c;else if(c>d){je.error(`Malformed SEI payload. ${c} is too small, only ${d} bytes left to parse.`);break}if(u===4){if(r[g++]===181){const v=wy(r,g);if(g+=2,v===49){const E=Te(r,g);if(g+=4,E===1195456820){const S=r[g++];if(S===3){const x=r[g++],T=31&x,L=64&x,_=L?2+T*3:0,I=new Uint8Array(_);if(L){I[0]=x;for(let O=1;O<_;O++)I[O]=r[g++]}s.push({type:S,payloadType:u,pts:t,bytes:I})}}}}}else if(u===5&&c>16){const m=[];for(let S=0;S<16;S++){const x=r[g++].toString(16);m.push(x.length==1?"0"+x:x),(S===3||S===5||S===7||S===9)&&m.push("-")}const v=c-16,E=new Uint8Array(v);for(let S=0;S<v;S++)E[S]=r[g++];s.push({payloadType:u,pts:t,uuid:m.join(""),userData:si(E),userDataBytes:E})}}}function Uy(l){const e=l.byteLength,t=[];let s=1;for(;s<e-2;)l[s]===0&&l[s+1]===0&&l[s+2]===3?(t.push(s+2),s+=2):s++;if(t.length===0)return l;const r=e-t.length,a=new Uint8Array(r);let u=0;for(s=0;s<r;u++,s++)u===t[0]&&(u++,t.shift()),a[s]=l[u];return a}function MA(l){const e=l[0];let t="",s="",r=0,a=0,u=0,c=0,h=0,d=0;if(e===0){for(;ht(l.subarray(d,d+1))!=="\0";)t+=ht(l.subarray(d,d+1)),d+=1;for(t+=ht(l.subarray(d,d+1)),d+=1;ht(l.subarray(d,d+1))!=="\0";)s+=ht(l.subarray(d,d+1)),d+=1;s+=ht(l.subarray(d,d+1)),d+=1,r=Te(l,12),a=Te(l,16),c=Te(l,20),h=Te(l,24),d=28}else if(e===1){d+=4,r=Te(l,d),d+=4;const m=Te(l,d);d+=4;const v=Te(l,d);for(d+=4,u=2**32*m+v,uA(u)||(u=Number.MAX_SAFE_INTEGER,je.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),c=Te(l,d),d+=4,h=Te(l,d),d+=4;ht(l.subarray(d,d+1))!=="\0";)t+=ht(l.subarray(d,d+1)),d+=1;for(t+=ht(l.subarray(d,d+1)),d+=1;ht(l.subarray(d,d+1))!=="\0";)s+=ht(l.subarray(d,d+1)),d+=1;s+=ht(l.subarray(d,d+1)),d+=1}const g=l.subarray(d,l.byteLength);return{schemeIdUri:t,value:s,timeScale:r,presentationTime:u,presentationTimeDelta:a,eventDuration:c,id:h,payload:g}}function kA(l,...e){const t=e.length;let s=8,r=t;for(;r--;)s+=e[r].byteLength;const a=new Uint8Array(s);for(a[0]=s>>24&255,a[1]=s>>16&255,a[2]=s>>8&255,a[3]=s&255,a.set(l,4),r=0,s=8;r<t;r++)a.set(e[r],s),s+=e[r].byteLength;return a}function NA(l,e,t){if(l.byteLength!==16)throw new RangeError("Invalid system id");let s,r;s=0,r=new Uint8Array;let a;s>0?(a=new Uint8Array(4),e.length>0&&new DataView(a.buffer).setUint32(0,e.length,!1)):a=new Uint8Array;const u=new Uint8Array(4);return t.byteLength>0&&new DataView(u.buffer).setUint32(0,t.byteLength,!1),kA([112,115,115,104],new Uint8Array([s,0,0,0]),l,a,r,u,t)}function PA(l){const e=[];if(l instanceof ArrayBuffer){const t=l.byteLength;let s=0;for(;s+32<t;){const r=new DataView(l,s),a=UA(r);e.push(a),s+=a.size}}return e}function UA(l){const e=l.getUint32(0),t=l.byteOffset,s=l.byteLength;if(s<e)return{offset:t,size:s};if(l.getUint32(4)!==1886614376)return{offset:t,size:e};const a=l.getUint32(8)>>>24;if(a!==0&&a!==1)return{offset:t,size:e};const u=l.buffer,c=Rt(new Uint8Array(u,t+12,16));let h=null,d=null,g=0;if(a===0)g=28;else{const v=l.getUint32(28);if(!v||s<32+v*16)return{offset:t,size:e};h=[];for(let E=0;E<v;E++)h.push(new Uint8Array(u,t+32+E*16,16));g=32+v*16}if(!g)return{offset:t,size:e};const m=l.getUint32(g);return e-32<m?{offset:t,size:e}:(d=new Uint8Array(u,t+g+4,m),{version:a,systemId:c,kids:h,data:d,offset:t,size:e})}const Fy=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),mr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function fd(l,e){const t=mr[e];return!!t&&!!t[l.slice(0,4)]}function Aa(l,e,t=!0){return!l.split(",").some(s=>!dd(s,e,t))}function dd(l,e,t=!0){var s;const r=Hs(t);return(s=r?.isTypeSupported(ba(l,e)))!=null?s:!1}function ba(l,e){return`${e}/mp4;codecs=${l}`}function Q0(l){if(l){const e=l.substring(0,4);return mr.video[e]}return 2}function _o(l){const e=Fy();return l.split(",").reduce((t,s)=>{const a=e&&$o(s)?9:mr.video[s];return a?(a*2+t)/(t?3:2):(mr.audio[s]+t)/(t?2:1)},0)}const gf={};function FA(l,e=!0){if(gf[l])return gf[l];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[l];for(let r=0;r<t.length;r++){var s;if(dd(t[r],"audio",e))return gf[l]=t[r],t[r];if(t[r]==="mp3"&&(s=Hs(e))!=null&&s.isTypeSupported("audio/mpeg"))return""}return l}const BA=/flac|opus|mp4a\.40\.34/i;function Do(l,e=!0){return l.replace(BA,t=>FA(t.toLowerCase(),e))}function $A(l,e){const t=[];if(l){const s=l.split(",");for(let r=0;r<s.length;r++)fd(s[r],"video")||t.push(s[r])}return e&&t.push(e),t.join(",")}function vo(l,e){if(l&&(l.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(l)!==-1)&&(W0(l,"audio")||W0(l,"video")))return l;if(e){const t=e.split(",");if(t.length>1){if(l){for(let s=t.length;s--;)if(t[s].substring(0,4)===l.substring(0,4))return t[s]}return t[0]}}return e||l}function W0(l,e){return fd(l,e)&&dd(l,e)}function GA(l){const e=l.split(",");for(let t=0;t<e.length;t++){const s=e[t].split(".");s.length>2&&s[0]==="avc1"&&(e[t]=`avc1.${parseInt(s[1]).toString(16)}${("000"+parseInt(s[2]).toString(16)).slice(-4)}`)}return e.join(",")}function jA(l){if(l.startsWith("av01.")){const e=l.split("."),t=["0","111","01","01","01","0"];for(let s=e.length;s>4&&s<10;s++)e[s]=t[s-4];return e.join(".")}return l}function Z0(l){const e=Hs(l)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Bf(l){return l.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const HA={supported:!0,powerEfficient:!0,smooth:!0},KA={supported:!1,smooth:!1,powerEfficient:!1},By={supported:!0,configurations:[],decodingInfoResults:[HA]};function $y(l,e){return{supported:!1,configurations:e,decodingInfoResults:[KA],error:l}}function zA(l,e,t,s,r,a){const u=l.videoCodec,c=l.audioCodec?l.audioGroups:null,h=a?.audioCodec,d=a?.channels,g=d?parseInt(d):h?1/0:2;let m=null;if(c!=null&&c.length)try{c.length===1&&c[0]?m=e.groups[c[0]].channels:m=c.reduce((v,E)=>{if(E){const S=e.groups[E];if(!S)throw new Error(`Audio track group ${E} not found`);Object.keys(S.channels).forEach(x=>{v[x]=(v[x]||0)+S.channels[x]})}return v},{2:0})}catch{return!0}return u!==void 0&&(u.split(",").some(v=>$o(v))||l.width>1920&&l.height>1088||l.height>1920&&l.width>1088||l.frameRate>Math.max(s,30)||l.videoRange!=="SDR"&&l.videoRange!==t||l.bitrate>Math.max(r,8e6))||!!m&&fe(g)&&Object.keys(m).some(v=>parseInt(v)>g)}function Gy(l,e,t,s={}){const r=l.videoCodec;if(!r&&!l.audioCodec||!t)return Promise.resolve(By);const a=[],u=VA(l),c=u.length,h=YA(l,e,c>0),d=h.length;for(let g=c||1*d||1;g--;){const m={type:"media-source"};if(c&&(m.video=u[g%c]),d){m.audio=h[g%d];const v=m.audio.bitrate;m.video&&v&&(m.video.bitrate-=v)}a.push(m)}if(r){const g=navigator.userAgent;if(r.split(",").some(m=>$o(m))&&Fy())return Promise.resolve($y(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${g})`),a))}return Promise.all(a.map(g=>{const m=XA(g);return s[m]||(s[m]=t.decodingInfo(g))})).then(g=>({supported:!g.some(m=>!m.supported),configurations:a,decodingInfoResults:g})).catch(g=>({supported:!1,configurations:a,decodingInfoResults:[],error:g}))}function VA(l){var e;const t=(e=l.videoCodec)==null?void 0:e.split(","),s=jy(l),r=l.width||640,a=l.height||480,u=l.frameRate||30,c=l.videoRange.toLowerCase();return t?t.map(h=>{const d={contentType:ba(jA(h),"video"),width:r,height:a,bitrate:s,framerate:u};return c!=="sdr"&&(d.transferFunction=c),d}):[]}function YA(l,e,t){var s;const r=(s=l.audioCodec)==null?void 0:s.split(","),a=jy(l);return r&&l.audioGroups?l.audioGroups.reduce((u,c)=>{var h;const d=c?(h=e.groups[c])==null?void 0:h.tracks:null;return d?d.reduce((g,m)=>{if(m.groupId===c){const v=parseFloat(m.channels||"");r.forEach(E=>{const S={contentType:ba(E,"audio"),bitrate:t?qA(E,a):a};v&&(S.channels=""+v),g.push(S)})}return g},u):u},[]):[]}function qA(l,e){if(e<=1)return 1;let t=128e3;return l==="ec-3"?t=768e3:l==="ac-3"&&(t=64e4),Math.min(e/2,t)}function jy(l){return Math.ceil(Math.max(l.bitrate*.9,l.averageBitrate)/1e3)*1e3||1}function XA(l){let e="";const{audio:t,video:s}=l;if(s){const r=Bf(s.contentType);e+=`${r}_r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${Math.ceil(s.bitrate/1e5)}`}if(t){const r=Bf(t.contentType);e+=`${s?"_":""}${r}_c${t.channels}`}return e}const $f=["NONE","TYPE-0","TYPE-1",null];function QA(l){return $f.indexOf(l)>-1}const Io=["SDR","PQ","HLG"];function WA(l){return!!l&&Io.indexOf(l)>-1}var Eo={No:"",Yes:"YES",v2:"v2"};function J0(l){const{canSkipUntil:e,canSkipDateRanges:t,age:s}=l,r=s<e/2;return e&&r?t?Eo.v2:Eo.Yes:Eo.No}class ep{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class La{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(s=>!!s).map(s=>s.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=(t=e.supplemental)==null?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return tp(this._audioGroups,e)}hasSubtitleGroup(e){return tp(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let s=this._audioGroups;s||(s=this._audioGroups=[]),s.indexOf(t)===-1&&s.push(t)}else if(e==="text"){let s=this._subtitleGroups;s||(s=this._subtitleGroups=[]),s.indexOf(t)===-1&&s.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function tp(l,e){return!e||!l?!1:l.indexOf(e)!==-1}function ZA(){if(typeof matchMedia=="function"){const l=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(l.media!==e.media)return l.matches===!0}return!1}function JA(l,e){let t=!1,s=[];if(l&&(t=l!=="SDR",s=[l]),e){s=e.allowedVideoRanges||Io.slice(0);const r=s.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:r&&ZA(),t||(s=["SDR"])}return{preferHDR:t,allowedVideoRanges:s}}const eb=l=>{const e=new WeakSet;return(t,s)=>{if(l&&(s=l(t,s)),typeof s=="object"&&s!==null){if(e.has(s))return;e.add(s)}return s}},Xe=(l,e)=>JSON.stringify(l,eb(e));function tb(l,e,t,s,r){const a=Object.keys(l),u=s?.channels,c=s?.audioCodec,h=r?.videoCodec,d=u&&parseInt(u)===2;let g=!1,m=!1,v=1/0,E=1/0,S=1/0,x=1/0,T=0,L=[];const{preferHDR:_,allowedVideoRanges:I}=JA(e,r);for(let B=a.length;B--;){const $=l[a[B]];g||(g=$.channels[2]>0),v=Math.min(v,$.minHeight),E=Math.min(E,$.minFramerate),S=Math.min(S,$.minBitrate),I.filter(W=>$.videoRanges[W]>0).length>0&&(m=!0)}v=fe(v)?v:0,E=fe(E)?E:0;const O=Math.max(1080,v),k=Math.max(30,E);S=fe(S)?S:t,t=Math.max(S,t),m||(e=void 0);const K=a.length>1;return{codecSet:a.reduce((B,$)=>{const U=l[$];if($===B)return B;if(L=m?I.filter(W=>U.videoRanges[W]>0):[],K){if(U.minBitrate>t)return Oi($,`min bitrate of ${U.minBitrate} > current estimate of ${t}`),B;if(!U.hasDefaultAudio)return Oi($,"no renditions with default or auto-select sound found"),B;if(c&&$.indexOf(c.substring(0,4))%5!==0)return Oi($,`audio codec preference "${c}" not found`),B;if(u&&!d){if(!U.channels[u])return Oi($,`no renditions with ${u} channel sound found (channels options: ${Object.keys(U.channels)})`),B}else if((!c||d)&&g&&U.channels[2]===0)return Oi($,"no renditions with stereo sound found"),B;if(U.minHeight>O)return Oi($,`min resolution of ${U.minHeight} > maximum of ${O}`),B;if(U.minFramerate>k)return Oi($,`min framerate of ${U.minFramerate} > maximum of ${k}`),B;if(!L.some(W=>U.videoRanges[W]>0))return Oi($,`no variants with VIDEO-RANGE of ${Xe(L)} found`),B;if(h&&$.indexOf(h.substring(0,4))%5!==0)return Oi($,`video codec preference "${h}" not found`),B;if(U.maxScore<T)return Oi($,`max score of ${U.maxScore} < selected max of ${T}`),B}return B&&(_o($)>=_o(B)||U.fragmentError>l[B].fragmentError)?B:(x=U.minIndex,T=U.maxScore,$)},void 0),videoRanges:L,preferHDR:_,minFramerate:E,minBitrate:S,minIndex:x}}function Oi(l,e){je.log(`[abr] start candidates with "${l}" ignored because ${e}`)}function Hy(l){return l.reduce((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const r=t.channels||"2";return s.channels[r]=(s.channels[r]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function ib(l,e,t,s){return l.slice(t,s+1).reduce((r,a,u)=>{if(!a.codecSet)return r;const c=a.audioGroups;let h=r[a.codecSet];h||(r[a.codecSet]=h={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:u,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!c,fragmentError:0}),h.minBitrate=Math.min(h.minBitrate,a.bitrate);const d=Math.min(a.height,a.width);return h.minHeight=Math.min(h.minHeight,d),h.minFramerate=Math.min(h.minFramerate,a.frameRate),h.minIndex=Math.min(h.minIndex,u),h.maxScore=Math.max(h.maxScore,a.score),h.fragmentError+=a.fragmentError,h.videoRanges[a.videoRange]=(h.videoRanges[a.videoRange]||0)+1,c&&c.forEach(g=>{if(!g)return;const m=e.groups[g];m&&(h.hasDefaultAudio=h.hasDefaultAudio||e.hasDefaultAudio?m.hasDefault:m.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(m.channels).forEach(v=>{h.channels[v]=(h.channels[v]||0)+m.channels[v]}))}),r},{})}function ip(l){if(!l)return l;const{lang:e,assocLang:t,characteristics:s,channels:r,audioCodec:a}=l;return{lang:e,assocLang:t,characteristics:s,channels:r,audioCodec:a}}function Ni(l,e,t){if("attrs"in l){const s=e.indexOf(l);if(s!==-1)return s}for(let s=0;s<e.length;s++){const r=e[s];if(mn(l,r,t))return s}return-1}function mn(l,e,t){const{groupId:s,name:r,lang:a,assocLang:u,default:c}=l,h=l.forced;return(s===void 0||e.groupId===s)&&(r===void 0||e.name===r)&&(a===void 0||sb(a,e.lang))&&(a===void 0||e.assocLang===u)&&(c===void 0||e.default===c)&&(h===void 0||e.forced===h)&&(!("characteristics"in l)||nb(l.characteristics||"",e.characteristics))&&(t===void 0||t(l,e))}function sb(l,e="--"){return l.length===e.length?l===e:l.startsWith(e)||e.startsWith(l)}function nb(l,e=""){const t=l.split(","),s=e.split(",");return t.length===s.length&&!t.some(r=>s.indexOf(r)===-1)}function gn(l,e){const{audioCodec:t,channels:s}=l;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(s===void 0||s===(e.channels||"2"))}function rb(l,e,t,s,r){const a=e[s],c=e.reduce((v,E,S)=>{const x=E.uri;return(v[x]||(v[x]=[])).push(S),v},{})[a.uri];c.length>1&&(s=Math.max.apply(Math,c));const h=a.videoRange,d=a.frameRate,g=a.codecSet.substring(0,4),m=sp(e,s,v=>{if(v.videoRange!==h||v.frameRate!==d||v.codecSet.substring(0,4)!==g)return!1;const E=v.audioGroups,S=t.filter(x=>!E||E.indexOf(x.groupId)!==-1);return Ni(l,S,r)>-1});return m>-1?m:sp(e,s,v=>{const E=v.audioGroups,S=t.filter(x=>!E||E.indexOf(x.groupId)!==-1);return Ni(l,S,r)>-1})}function sp(l,e,t){for(let s=e;s>-1;s--)if(t(l[s]))return s;for(let s=e+1;s<l.length;s++)if(t(l[s]))return s;return-1}function Co(l,e){var t;return!!l&&l!==((t=e.loadLevelObj)==null?void 0:t.uri)}class ab extends vi{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var s;const{fragCurrent:r,partCurrent:a,hls:u}=this,{autoLevelEnabled:c,media:h}=u;if(!r||!h)return;const d=performance.now(),g=a?a.stats:r.stats,m=a?a.duration:r.duration,v=d-g.loading.start,E=u.minAutoLevel,S=r.level,x=this._nextAutoLevel;if(g.aborted||g.loaded&&g.loaded===g.total||S<=E){this.clearTimer(),this._nextAutoLevel=-1;return}if(!c)return;const T=x>-1&&x!==S,L=!!t||T;if(!L&&(h.paused||!h.playbackRate||!h.readyState))return;const _=u.mainForwardBufferInfo;if(!L&&_===null)return;const I=this.bwEstimator.getEstimateTTFB(),O=Math.abs(h.playbackRate);if(v<=Math.max(I,1e3*(m/(O*2))))return;const k=_?_.len/O:0,K=g.loading.first?g.loading.first-g.loading.start:-1,w=g.loaded&&K>-1,B=this.getBwEstimate(),$=u.levels,U=$[S],W=Math.max(g.loaded,Math.round(m*(r.bitrate||U.averageBitrate)/8));let ne=w?v-K:v;ne<1&&w&&(ne=Math.min(v,g.loaded*8/B));const ce=w?g.loaded*1e3/ne:0,he=I/1e3,oe=ce?(W-g.loaded)/ce:W*8/B+he;if(oe<=k)return;const N=ce?ce*8:B,X=((s=t?.details||this.hls.latestLevelDetails)==null?void 0:s.live)===!0,J=this.hls.config.abrBandWidthUpFactor;let ae=Number.POSITIVE_INFINITY,ue;for(ue=S-1;ue>E;ue--){const re=$[ue].maxBitrate,le=!$[ue].details||X;if(ae=this.getTimeToLoadFrag(he,N,m*re,le),ae<Math.min(k,m+he))break}if(ae>=oe||ae>m*10)return;w?this.bwEstimator.sample(v-Math.min(I,K),g.loaded):this.bwEstimator.sampleTTFB(v);const C=$[ue].maxBitrate;this.getBwEstimate()*J>C&&this.resetEstimator(C);const F=this.findBestLevel(C,E,ue,0,k,1,1);F>-1&&(ue=F),this.warn(`Fragment ${r.sn}${a?" part "+a.index:""} of level ${S} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${k.toFixed(3)} s
      Estimated load time for current fragment: ${oe.toFixed(3)} s
      Estimated load time for down switch fragment: ${ae.toFixed(3)} s
      TTFB estimate: ${K|0} ms
      Current BW estimate: ${fe(B)?B|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${ue} @ ${C|0} bps`),u.nextLoadLevel=u.nextAutoLevel=ue,this.clearTimer();const se=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===ue&&ue>0){const re=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${ue>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${re.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,ue>E){let le=this.findBestLevel(this.hls.levels[E].bitrate,E,ue,0,re,1,1);le===-1&&(le=E),this.hls.nextLoadLevel=this.hls.nextAutoLevel=le,this.resetEstimator(this.hls.levels[le].bitrate)}}};T||oe>ae*2?se():this.timer=self.setInterval(se,ae*1e3),u.trigger(b.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:a,stats:g})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new fA(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.FRAG_LOADING,this.onFragLoading,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.FRAG_LOADING,this.onFragLoading,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(b.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){if(!s.bitrateTest){var r;this.fragCurrent=s,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case H.BUFFER_ADD_CODEC_ERROR:case H.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case H.FRAG_LOAD_TIMEOUT:{const s=t.frag,{fragCurrent:r,partCurrent:a}=this;if(s&&r&&s.sn===r.sn&&s.level===r.level){const u=performance.now(),c=a?a.stats:s.stats,h=u-c.loading.start,d=c.loading.first?c.loading.first-c.loading.start:-1;if(c.loaded&&d>-1){const m=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(h-Math.min(m,d),c.loaded)}else this.bwEstimator.sampleTTFB(h)}break}}}getTimeToLoadFrag(e,t,s,r){const a=e+s/t,u=r?e+this.lastLevelLoadSec:0;return a+u}onLevelLoaded(e,t){const s=this.hls.config,{loading:r}=t.stats,a=r.end-r.first;fe(a)&&(this.lastLevelLoadSec=a/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const r=s?s.stats:t.stats;if(t.type===ge.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const a=s?s.duration:t.duration,u=this.hls.levels[t.level],c=(u.loaded?u.loaded.bytes:0)+r.loaded,h=(u.loaded?u.loaded.duration:0)+a;u.loaded={bytes:c,duration:h},u.realBitrate=Math.round(8*c/h)}if(t.bitrateTest){const a={stats:r,frag:t,part:s,id:t.type};this.onFragBuffered(b.FRAG_BUFFERED,a),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:r}=t,a=r!=null&&r.stats.loaded?r.stats:s.stats;if(a.aborted||this.ignoreFragment(s))return;const u=a.parsing.end-a.loading.start-Math.min(a.loading.first-a.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(u,a.loaded),a.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=u/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ge.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,a=this.findBestLevel(s,t,e,0,r,1,1);if(a>-1)return a;const u=this.hls.firstLevel,c=Math.min(Math.max(u,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${u} clamped to ${c}`),c}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,s=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!s||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const a=s&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const u=this.hls.levels;if(u.length>Math.max(e,a)&&u[e].loadError<=u[a].loadError)return e}return this._nextAutoLevel=a,this.nextAutoLevelKey=this.getAutoLevelKey(),a}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:r,config:a,minAutoLevel:u}=s,c=t?t.duration:e?e.duration:0,h=this.getBwEstimate(),d=this.getStarvationDelay();let g=a.abrBandWidthFactor,m=a.abrBandWidthUpFactor;if(d){const T=this.findBestLevel(h,u,r,d,0,g,m);if(T>=0)return this.rebufferNotice=-1,T}let v=c?Math.min(c,a.maxStarvationDelay):a.maxStarvationDelay;if(!d){const T=this.bitrateTestDelay;T&&(v=(c?Math.min(c,a.maxLoadingDelay):a.maxLoadingDelay)-T,this.info(`bitrate test took ${Math.round(1e3*T)}ms, set first fragment max fetchDuration to ${Math.round(1e3*v)} ms`),g=m=1)}const E=this.findBestLevel(h,u,r,d,v,g,m);if(this.rebufferNotice!==E&&(this.rebufferNotice=E,this.info(`${d?"rebuffering expected":"buffer is empty"}, optimal quality level ${E}`)),E>-1)return E;const S=s.levels[u],x=s.loadLevelObj;return x&&S?.bitrate<x.bitrate?u:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,r,a,u,c){var h;const d=r+a,g=this.lastLoadedFragLevel,m=g===-1?this.hls.firstLevel:g,{fragCurrent:v,partCurrent:E}=this,{levels:S,allAudioTracks:x,loadLevel:T,config:L}=this.hls;if(S.length===1)return 0;const _=S[m],I=!!((h=this.hls.latestLevelDetails)!=null&&h.live),O=T===-1||g===-1;let k,K="SDR",w=_?.frameRate||0;const{audioPreference:B,videoPreference:$}=L,U=this.audioTracksByGroup||(this.audioTracksByGroup=Hy(x));let W=-1;if(O){if(this.firstSelection!==-1)return this.firstSelection;const N=this.codecTiers||(this.codecTiers=ib(S,U,t,s)),X=tb(N,K,e,B,$),{codecSet:J,videoRanges:ae,minFramerate:ue,minBitrate:C,minIndex:F,preferHDR:se}=X;W=F,k=J,K=se?ae[ae.length-1]:ae[0],w=ue,e=Math.max(e,C),this.log(`picked start tier ${Xe(X)}`)}else k=_?.codecSet,K=_?.videoRange;const ne=E?E.duration:v?v.duration:0,ce=this.bwEstimator.getEstimateTTFB()/1e3,he=[];for(let N=s;N>=t;N--){var oe;const X=S[N],J=N>m;if(!X)continue;if(L.useMediaCapabilities&&!X.supportedResult&&!X.supportedPromise){const le=navigator.mediaCapabilities;typeof le?.decodingInfo=="function"&&zA(X,U,K,w,e,B)?(X.supportedPromise=Gy(X,U,le,this.supportedCache),X.supportedPromise.then(de=>{if(!this.hls)return;X.supportedResult=de;const Se=this.hls.levels,Ne=Se.indexOf(X);de.error?this.warn(`MediaCapabilities decodingInfo error: "${de.error}" for level ${Ne} ${Xe(de)}`):de.supported?de.decodingInfoResults.some(ke=>ke.smooth===!1||ke.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Ne} not smooth or powerEfficient: ${Xe(de)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Ne} ${Xe(de)}`),Ne>-1&&Se.length>1&&(this.log(`Removing unsupported level ${Ne}`),this.hls.removeLevel(Ne),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(de=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${de}`)})):X.supportedResult=By}if((k&&X.codecSet!==k||K&&X.videoRange!==K||J&&w>X.frameRate||!J&&w>0&&w<X.frameRate||(oe=X.supportedResult)!=null&&(oe=oe.decodingInfoResults)!=null&&oe.some(le=>le.smooth===!1))&&(!O||N!==W)){he.push(N);continue}const ae=X.details,ue=(E?ae?.partTarget:ae?.averagetargetduration)||ne;let C;J?C=c*e:C=u*e;const F=ne&&r>=ne*2&&a===0?X.averageBitrate:X.maxBitrate,se=this.getTimeToLoadFrag(ce,C,F*ue,ae===void 0);if(C>=F&&(N===g||X.loadError===0&&X.fragmentError===0)&&(se<=ce||!fe(se)||I&&!this.bitrateTestDelay||se<d)){const le=this.forcedAutoLevel;return N!==T&&(le===-1||le!==T)&&(he.length&&this.trace(`Skipped level(s) ${he.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${S[he[0]].codecs}" ${S[he[0]].videoRange}; not compatible with "${k}" ${K}`),this.info(`switch candidate:${m}->${N} adjustedbw(${Math.round(C)})-bitrate=${Math.round(C-F)} ttfb:${ce.toFixed(1)} avgDuration:${ue.toFixed(1)} maxFetchDuration:${d.toFixed(1)} fetchDuration:${se.toFixed(1)} firstSelection:${O} codecSet:${X.codecSet} videoRange:${X.videoRange} hls.loadLevel:${T}`)),O&&(this.firstSelection=N),N}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}}const Ky={search:function(l,e){let t=0,s=l.length-1,r=null,a=null;for(;t<=s;){r=(t+s)/2|0,a=l[r];const u=e(a);if(u>0)t=r+1;else if(u<0)s=r-1;else return a}return null}};function lb(l,e,t){if(e===null||!Array.isArray(l)||!l.length||!fe(e))return null;const s=l[0].programDateTime;if(e<(s||0))return null;const r=l[l.length-1].endProgramDateTime;if(e>=(r||0))return null;for(let a=0;a<l.length;++a){const u=l[a];if(ub(e,t,u))return u}return null}function pn(l,e,t=0,s=0,r=.005){let a=null;if(l){a=e[1+l.sn-e[0].sn]||null;const c=l.endDTS-t;c>0&&c<15e-7&&(t+=15e-7),a&&l.level!==a.level&&a.end<=l.end&&(a=e[2+l.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(a=e[0]);if(a&&((!l||l.level===a.level)&&np(t,s,a)===0||ob(a,l,Math.min(r,s))))return a;const u=Ky.search(e,np.bind(null,t,s));return u&&(u!==l||!a)?u:a}function ob(l,e,t){if(e&&e.start===0&&e.level<l.level&&(e.endPTS||0)>0){const s=e.tagList.reduce((r,a)=>(a[0]==="INF"&&(r+=parseFloat(a[1])),r),t);return l.start<=s}return!1}function np(l=0,e=0,t){if(t.start<=l&&t.start+t.duration>l)return 0;const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-s<=l?1:t.start-s>l&&t.start?-1:0}function ub(l,e,t){const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-s>l}function zy(l,e,t){if(l&&l.startCC<=e&&l.endCC>=e){let s=l.fragments;const{fragmentHint:r}=l;r&&(s=s.concat(r));let a;return Ky.search(s,u=>u.cc<e?1:u.cc>e?-1:(a=u,u.end<=t?1:u.start>t?-1:0)),a||null}return null}function Oo(l){switch(l.details){case H.FRAG_LOAD_TIMEOUT:case H.KEY_LOAD_TIMEOUT:case H.LEVEL_LOAD_TIMEOUT:case H.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Vy(l){return l.details.startsWith("key")}function Yy(l){return Vy(l)&&!!l.frag&&!l.frag.decryptdata}function rp(l,e){const t=Oo(e);return l.default[`${t?"timeout":"error"}Retry`]}function hd(l,e){const t=l.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*l.retryDelayMs,l.maxRetryDelayMs)}function ap(l){return Ge(Ge({},l),{errorRetry:null,timeoutRetry:null})}function wo(l,e,t,s){if(!l)return!1;const r=s?.code,a=e<l.maxNumRetry&&(cb(r)||!!t);return l.shouldRetry?l.shouldRetry(l,e,t,s,a):a}function cb(l){return Gf(l)||!!l&&(l<400||l>499)}function Gf(l){return l===0&&navigator.onLine===!1}var Lt={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Jt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class fb extends vi{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(b.ERROR,this.onError,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(b.ERROR,this.onError,this),e.off(b.ERROR,this.onErrorOut,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===ge.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,s=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||s===-1?t.loadLevel:s}variantHasKey(e,t){if(e){var s;if((s=e.details)!=null&&s.hasKey(t))return!0;const r=e.audioGroups;if(r)return this.hls.allAudioTracks.filter(u=>r.indexOf(u.groupId)>=0).some(u=>{var c;return(c=u.details)==null?void 0:c.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const r=this.hls,a=t.context;switch(t.details){case H.FRAG_LOAD_ERROR:case H.FRAG_LOAD_TIMEOUT:case H.KEY_LOAD_ERROR:case H.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case H.FRAG_PARSING_ERROR:if((s=t.frag)!=null&&s.gap){t.errorAction=fr();return}case H.FRAG_GAP:case H.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Lt.SendAlternateToPenaltyBox;return}case H.LEVEL_EMPTY_ERROR:case H.LEVEL_PARSING_ERROR:{var u;const h=t.parent===ge.MAIN?t.level:r.loadLevel;t.details===H.LEVEL_EMPTY_ERROR&&((u=t.context)!=null&&(u=u.levelDetails)!=null&&u.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,h):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,h))}return;case H.LEVEL_LOAD_ERROR:case H.LEVEL_LOAD_TIMEOUT:typeof a?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.level));return;case H.AUDIO_TRACK_LOAD_ERROR:case H.AUDIO_TRACK_LOAD_TIMEOUT:case H.SUBTITLE_LOAD_ERROR:case H.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){const h=r.loadLevelObj;if(h&&(a.type===_e.AUDIO_TRACK&&h.hasAudioGroup(a.groupId)||a.type===_e.SUBTITLE_TRACK&&h.hasSubtitleGroup(a.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=Lt.SendAlternateToPenaltyBox,t.errorAction.flags=Jt.MoveAllAlternatesMatchingHost;return}}return;case H.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Lt.SendAlternateToPenaltyBox,flags:Jt.MoveAllAlternatesMatchingHDCP};return;case H.KEY_SYSTEM_SESSION_UPDATE_FAILED:case H.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case H.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Lt.SendAlternateToPenaltyBox,flags:Jt.MoveAllAlternatesMatchingKey};return;case H.BUFFER_ADD_CODEC_ERROR:case H.REMUX_ALLOC_ERROR:case H.BUFFER_APPEND_ERROR:if(!t.errorAction){var c;t.errorAction=this.getLevelSwitchAction(t,(c=t.level)!=null?c:r.loadLevel)}return;case H.INTERNAL_EXCEPTION:case H.BUFFER_APPENDING_ERROR:case H.BUFFER_FULL_ERROR:case H.LEVEL_SWITCH_ERROR:case H.BUFFER_STALLED_ERROR:case H.BUFFER_SEEK_OVER_HOLE:case H.BUFFER_NUDGE_ON_STALL:t.errorAction=fr();return}t.type===ye.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=fr())}getPlaylistRetryOrSwitchAction(e,t){const s=this.hls,r=rp(s.config.playlistLoadPolicy,e),a=this.playlistError++;if(wo(r,a,Oo(e),e.response))return{action:Lt.RetryRequest,flags:Jt.None,retryConfig:r,retryCount:a};const c=this.getLevelSwitchAction(e,t);return r&&(c.retryConfig=r,c.retryCount=a),c}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),r=t.levels[s],{fragLoadPolicy:a,keyLoadPolicy:u}=t.config,c=rp(Vy(e)?u:a,e),h=t.levels.reduce((g,m)=>g+m.fragmentError,0);if(r&&(e.details!==H.FRAG_GAP&&r.fragmentError++,!Yy(e)&&wo(c,h,Oo(e),e.response)))return{action:Lt.RetryRequest,flags:Jt.None,retryConfig:c,retryCount:h};const d=this.getLevelSwitchAction(e,s);return c&&(d.retryConfig=c,d.retryCount=h),d}getLevelSwitchAction(e,t){const s=this.hls;t==null&&(t=s.loadLevel);const r=this.hls.levels[t];if(r){var a,u;const d=e.details;r.loadError++,d===H.BUFFER_APPEND_ERROR&&r.fragmentError++;let g=-1;const{levels:m,loadLevel:v,minAutoLevel:E,maxAutoLevel:S}=s;!s.autoLevelEnabled&&!s.config.preserveManualLevelOnError&&(s.loadLevel=-1);const x=(a=e.frag)==null?void 0:a.type,L=(x===ge.AUDIO&&d===H.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(d===H.BUFFER_ADD_CODEC_ERROR||d===H.BUFFER_APPEND_ERROR))&&m.some(({audioCodec:K})=>r.audioCodec!==K),I=e.sourceBufferName==="video"&&(d===H.BUFFER_ADD_CODEC_ERROR||d===H.BUFFER_APPEND_ERROR)&&m.some(({codecSet:K,audioCodec:w})=>r.codecSet!==K&&r.audioCodec===w),{type:O,groupId:k}=(u=e.context)!=null?u:{};for(let K=m.length;K--;){const w=(K+v)%m.length;if(w!==v&&w>=E&&w<=S&&m[w].loadError===0){var c,h;const B=m[w];if(d===H.FRAG_GAP&&x===ge.MAIN&&e.frag){const $=m[w].details;if($){const U=pn(e.frag,$.fragments,e.frag.start);if(U!=null&&U.gap)continue}}else{if(O===_e.AUDIO_TRACK&&B.hasAudioGroup(k)||O===_e.SUBTITLE_TRACK&&B.hasSubtitleGroup(k))continue;if(x===ge.AUDIO&&(c=r.audioGroups)!=null&&c.some($=>B.hasAudioGroup($))||x===ge.SUBTITLE&&(h=r.subtitleGroups)!=null&&h.some($=>B.hasSubtitleGroup($))||L&&r.audioCodec===B.audioCodec||I&&r.codecSet===B.codecSet||!L&&r.codecSet!==B.codecSet)continue}g=w;break}}if(g>-1&&s.loadLevel!==g)return e.levelRetry=!0,this.playlistError=0,{action:Lt.SendAlternateToPenaltyBox,flags:Jt.None,nextAutoLevel:g}}return{action:Lt.SendAlternateToPenaltyBox,flags:Jt.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var s;switch((s=t.errorAction)==null?void 0:s.action){case Lt.DoNothing:break;case Lt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==H.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:r}=s,a=s.nextAutoLevel;switch(r){case Jt.None:this.switchLevel(e,a);break;case Jt.MoveAllAlternatesMatchingHDCP:{const h=this.getVariantLevelIndex(e.frag),d=t.levels[h],g=d?.attrs["HDCP-LEVEL"];if(s.hdcpLevel=g,g==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(g){t.maxHdcpLevel=$f[$f.indexOf(g)-1],s.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Jt.MoveAllAlternatesMatchingKey:{const h=e.decryptdata;if(h){const d=this.hls.levels,g=d.length;for(let v=g;v--;)if(this.variantHasKey(d[v],h)){var u,c;this.log(`Banned key found in level ${v} (${d[v].bitrate}bps) or audio group "${(u=d[v].audioGroups)==null?void 0:u.join(",")}" (${(c=e.frag)==null?void 0:c.type} fragment) ${Rt(h.keyId||[])}`),d[v].fragmentError++,d[v].loadError++,this.log(`Removing level ${v} with key error (${e.error})`),this.hls.removeLevel(v)}const m=e.frag;if(this.hls.levels.length<g)s.resolved=!0;else if(m&&m.type!==ge.MAIN){const v=m.decryptdata;v&&!h.matches(v)&&(s.resolved=!0)}}break}}s.resolved||this.switchLevel(e,a)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===H.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const s=Bf(e.mimeType),r=this.hls.levels;for(let a=r.length;a--;)r[a][`${e.sourceBufferName}Codec`]===s&&(this.log(`Removing level ${a} for ${e.details} ("${s}" not supported)`),this.hls.removeLevel(a))}}}function fr(l){const e={action:Lt.DoNothing,flags:Jt.None};return l&&(e.resolved=!0),e}var gt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class db{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.BUFFER_APPENDED,this.onBufferAppended,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.BUFFER_APPENDED,this.onBufferAppended,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let r=s.length;r--;){const a=s[r];if(!a)break;if(a.start<=e&&e<=a.end&&a.loaded)return a}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:r}=this,a=Object.keys(r);for(let u=a.length;u--;){const c=r[a[u]];if(c?.body.type===t&&(!s||c.buffered)){const h=c.body;if(h.start<=e&&e<=h.end)return h}}return null}detectEvictedFragments(e,t,s,r,a){this.timeRanges&&(this.timeRanges[e]=t);const u=r?.fragment.sn||-1;Object.keys(this.fragments).forEach(c=>{const h=this.fragments[c];if(!h||u>=h.body.sn)return;if(!h.buffered&&(!h.loaded||a)){h.body.type===s&&this.removeFragment(h.body);return}const d=h.range[e];if(d){if(d.time.length===0){this.removeFragment(h.body);return}d.time.some(g=>{const m=!this.isTimeBuffered(g.startPTS,g.endPTS,t);return m&&this.removeFragment(h.body),m})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const s=e.frag,r=nr(s),a=this.fragments[r];if(!a||a.buffered&&s.gap)return;const u=!s.relurl;Object.keys(t).forEach(c=>{const h=s.elementaryStreams[c];if(!h)return;const d=t[c],g=u||h.partial===!0;a.range[c]=this.getBufferedTimes(s,e.part,g,d)}),a.loaded=null,Object.keys(a.range).length?(this.bufferedEnd(a,s),io(a)||this.removeParts(s.sn-1,s.type)):this.removeFragment(a.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=lp(s,r=>r.fragment.sn>=e))}fragBuffered(e,t){const s=nr(e);let r=this.fragments[s];!r&&t&&(r=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,this.bufferedEnd(r,e))}getBufferedTimes(e,t,s,r){const a={time:[],partial:s},u=e.start,c=e.end,h=e.minEndPTS||c,d=e.maxStartPTS||u;for(let g=0;g<r.length;g++){const m=r.start(g)-this.bufferPadding,v=r.end(g)+this.bufferPadding;if(d>=m&&h<=v){a.time.push({startPTS:Math.max(u,r.start(g)),endPTS:Math.min(c,r.end(g))});break}else if(u<v&&c>m){const E=Math.max(u,r.start(g)),S=Math.min(c,r.end(g));S>E&&(a.partial=!0,a.time.push({startPTS:E,endPTS:S}))}else if(c<=m)break}return a}getPartialFragment(e){let t=null,s,r,a,u=0;const{bufferPadding:c,fragments:h}=this;return Object.keys(h).forEach(d=>{const g=h[d];g&&io(g)&&(r=g.body.start-c,a=g.body.end+c,e>=r&&e<=a&&(s=Math.min(e-r,a-e),u<=s&&(t=g.body,u=s)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||io(t))}getState(e){const t=nr(e),s=this.fragments[t];return s?s.buffered?io(s)?gt.PARTIAL:gt.OK:gt.APPENDING:gt.NOT_LOADED}isTimeBuffered(e,t,s){let r,a;for(let u=0;u<s.length;u++){if(r=s.start(u)-this.bufferPadding,a=s.end(u)+this.bufferPadding,e>=r&&t<=a)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const s=t.frag,r=t.part?null:t,a=nr(s);this.fragments[a]={body:s,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:r,timeRanges:a,type:u}=t;if(s.sn==="initSegment")return;const c=s.type;if(r){let d=this.activePartLists[c];d||(this.activePartLists[c]=d=[]),d.push(r)}this.timeRanges=a;const h=a[u];this.detectEvictedFragments(u,h,c,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=nr(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let r=s.length;r--;){const a=t[s[r]];if(a?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,s,r,a){r&&!this.hasGaps||Object.keys(this.fragments).forEach(u=>{const c=this.fragments[u];if(!c)return;const h=c.body;h.type!==s||r&&!h.gap||h.start<t&&h.end>e&&(c.buffered||a)&&this.removeFragment(h)})}removeFragment(e){const t=nr(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const r=e.sn;this.activePartLists[e.type]=lp(s,a=>a.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(s=>s.clearElementaryStreamInfo())}}function io(l){var e,t,s;return l.buffered&&!!(l.body.gap||(e=l.range.video)!=null&&e.partial||(t=l.range.audio)!=null&&t.partial||(s=l.range.audiovideo)!=null&&s.partial)}function nr(l){return`${l.type}_${l.level}_${l.sn}`}function lp(l,e){return l.filter(t=>{const s=e(t);return s||t.clearElementaryStreamInfo(),s})}var Ks={cbc:0,ctr:1};class hb{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case Ks.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Ks.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function gb(l){const e=l.byteLength,t=e&&new DataView(l.buffer).getUint8(e-1);return t?l.slice(0,e-t):l}class mb{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let r=0;r<4;r++)s[r]=t.getUint32(r*4);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,r=s[0],a=s[1],u=s[2],c=s[3],h=this.invSubMix,d=h[0],g=h[1],m=h[2],v=h[3],E=new Uint32Array(256);let S=0,x=0,T=0;for(T=0;T<256;T++)T<128?E[T]=T<<1:E[T]=T<<1^283;for(T=0;T<256;T++){let L=x^x<<1^x<<2^x<<3^x<<4;L=L>>>8^L&255^99,e[S]=L,t[L]=S;const _=E[S],I=E[_],O=E[I];let k=E[L]*257^L*16843008;r[S]=k<<24|k>>>8,a[S]=k<<16|k>>>16,u[S]=k<<8|k>>>24,c[S]=k,k=O*16843009^I*65537^_*257^S*16843008,d[L]=k<<24|k>>>8,g[L]=k<<16|k>>>16,m[L]=k<<8|k>>>24,v[L]=k,S?(S=_^E[E[E[O^_]]],x^=E[E[x]]):S=x=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,r=0;for(;r<t.length&&s;)s=t[r]===this.key[r],r++;if(s)return;this.key=t;const a=this.keySize=t.length;if(a!==4&&a!==6&&a!==8)throw new Error("Invalid aes key size="+a);const u=this.ksRows=(a+6+1)*4;let c,h;const d=this.keySchedule=new Uint32Array(u),g=this.invKeySchedule=new Uint32Array(u),m=this.sBox,v=this.rcon,E=this.invSubMix,S=E[0],x=E[1],T=E[2],L=E[3];let _,I;for(c=0;c<u;c++){if(c<a){_=d[c]=t[c];continue}I=_,c%a===0?(I=I<<8|I>>>24,I=m[I>>>24]<<24|m[I>>>16&255]<<16|m[I>>>8&255]<<8|m[I&255],I^=v[c/a|0]<<24):a>6&&c%a===4&&(I=m[I>>>24]<<24|m[I>>>16&255]<<16|m[I>>>8&255]<<8|m[I&255]),d[c]=_=(d[c-a]^I)>>>0}for(h=0;h<u;h++)c=u-h,h&3?I=d[c]:I=d[c-4],h<4||c<=4?g[h]=I:g[h]=S[m[I>>>24]]^x[m[I>>>16&255]]^T[m[I>>>8&255]]^L[m[I&255]],g[h]=g[h]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,s){const r=this.keySize+6,a=this.invKeySchedule,u=this.invSBox,c=this.invSubMix,h=c[0],d=c[1],g=c[2],m=c[3],v=this.uint8ArrayToUint32Array_(s);let E=v[0],S=v[1],x=v[2],T=v[3];const L=new Int32Array(e),_=new Int32Array(L.length);let I,O,k,K,w,B,$,U,W,ne,ce,he,oe,N;const X=this.networkToHostOrderSwap;for(;t<L.length;){for(W=X(L[t]),ne=X(L[t+1]),ce=X(L[t+2]),he=X(L[t+3]),w=W^a[0],B=he^a[1],$=ce^a[2],U=ne^a[3],oe=4,N=1;N<r;N++)I=h[w>>>24]^d[B>>16&255]^g[$>>8&255]^m[U&255]^a[oe],O=h[B>>>24]^d[$>>16&255]^g[U>>8&255]^m[w&255]^a[oe+1],k=h[$>>>24]^d[U>>16&255]^g[w>>8&255]^m[B&255]^a[oe+2],K=h[U>>>24]^d[w>>16&255]^g[B>>8&255]^m[$&255]^a[oe+3],w=I,B=O,$=k,U=K,oe=oe+4;I=u[w>>>24]<<24^u[B>>16&255]<<16^u[$>>8&255]<<8^u[U&255]^a[oe],O=u[B>>>24]<<24^u[$>>16&255]<<16^u[U>>8&255]<<8^u[w&255]^a[oe+1],k=u[$>>>24]<<24^u[U>>16&255]<<16^u[w>>8&255]<<8^u[B&255]^a[oe+2],K=u[U>>>24]<<24^u[w>>16&255]<<16^u[B>>8&255]<<8^u[$&255]^a[oe+3],_[t]=X(I^E),_[t+1]=X(K^S),_[t+2]=X(k^x),_[t+3]=X(O^T),E=W,S=ne,x=ce,T=he,t=t+4}return _.buffer}}class pb{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=yb(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function yb(l){switch(l){case Ks.cbc:return"AES-CBC";case Ks.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${l}`)}}const vb=16;class gd{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?gb(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,r){return this.useSoftware?new Promise((a,u)=>{const c=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(c,t,s,r);const h=this.flush();h?a(h.buffer):u(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,s,r)}softwareDecrypt(e,t,s,r){const{currentIV:a,currentResult:u,remainderData:c}=this;if(r!==Ks.cbc||t.byteLength!==16)return je.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),c&&(e=pi(c,e),this.remainderData=null);const h=this.getValidChunk(e);if(!h.length)return null;a&&(s=a);let d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new mb),d.expandKey(t);const g=u;return this.currentResult=d.decrypt(h.buffer,0,s),this.currentIV=h.slice(-16).buffer,g||null}webCryptoDecrypt(e,t,s,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,r));this.key=t,this.fastAesKey=new pb(this.subtle,t,r)}return this.fastAesKey.expandKey().then(a=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new hb(this.subtle,new Uint8Array(s),r).decrypt(e.buffer,a)):Promise.reject(new Error("web crypto not initialized"))).catch(a=>(je.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${a.name}: ${a.message}`),this.onWebCryptoError(e,t,s,r)))}onWebCryptoError(e,t,s,r){const a=this.enableSoftwareAES;if(a){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,r);const u=this.flush();if(u)return u.buffer}throw new Error("WebCrypto"+(a?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%vb;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(je.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const op=Math.pow(2,17);class Eb{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new ls({type:ye.NETWORK_ERROR,details:H.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${s?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,a=r.fLoader,u=r.loader;return new Promise((c,h)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(S=>S[0]==="GAP")){h(cp(e));return}else e.gap=!1;const d=this.loader=a?new a(r):new u(r),g=up(e);e.loader=d;const m=ap(r.fragLoadPolicy.default),v={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:op};e.stats=d.stats;const E={onSuccess:(S,x,T,L)=>{this.resetLoader(e,d);let _=S.data;T.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(_.slice(0,16)),_=_.slice(16)),c({frag:e,part:null,payload:_,networkDetails:L})},onError:(S,x,T,L)=>{this.resetLoader(e,d),h(new ls({type:ye.NETWORK_ERROR,details:H.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Ge({url:s,data:void 0},S),error:new Error(`HTTP Error ${S.code} ${S.text}`),networkDetails:T,stats:L}))},onAbort:(S,x,T)=>{this.resetLoader(e,d),h(new ls({type:ye.NETWORK_ERROR,details:H.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:T,stats:S}))},onTimeout:(S,x,T)=>{this.resetLoader(e,d),h(new ls({type:ye.NETWORK_ERROR,details:H.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:T,stats:S}))}};t&&(E.onProgress=(S,x,T,L)=>t({frag:e,part:null,payload:T,networkDetails:L})),d.load(g,v,E)})}loadPart(e,t,s){this.abort();const r=this.config,a=r.fLoader,u=r.loader;return new Promise((c,h)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){h(cp(e,t));return}const d=this.loader=a?new a(r):new u(r),g=up(e,t);e.loader=d;const m=ap(r.fragLoadPolicy.default),v={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:op};t.stats=d.stats,d.load(g,v,{onSuccess:(E,S,x,T)=>{this.resetLoader(e,d),this.updateStatsFromPart(e,t);const L={frag:e,part:t,payload:E.data,networkDetails:T};s(L),c(L)},onError:(E,S,x,T)=>{this.resetLoader(e,d),h(new ls({type:ye.NETWORK_ERROR,details:H.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Ge({url:g.url,data:void 0},E),error:new Error(`HTTP Error ${E.code} ${E.text}`),networkDetails:x,stats:T}))},onAbort:(E,S,x)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,d),h(new ls({type:ye.NETWORK_ERROR,details:H.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:x,stats:E}))},onTimeout:(E,S,x)=>{this.resetLoader(e,d),h(new ls({type:ye.NETWORK_ERROR,details:H.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:x,stats:E}))}})})}updateStatsFromPart(e,t){const s=e.stats,r=t.stats,a=r.total;if(s.loaded+=r.loaded,a){const h=Math.round(e.duration/t.duration),d=Math.min(Math.round(s.loaded/a),h),m=(h-d)*Math.round(s.loaded/d);s.total=s.loaded+m}else s.total=Math.max(s.loaded,s.total);const u=s.loading,c=r.loading;u.start?u.first+=c.first-c.start:(u.start=c.start,u.first=c.first),u.end=c.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function up(l,e=null){const t=e||l,s={frag:l,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,a=t.byteRangeEndOffset;if(fe(r)&&fe(a)){var u;let c=r,h=a;if(l.sn==="initSegment"&&Sb((u=l.decryptdata)==null?void 0:u.method)){const d=a-r;d%16&&(h=a+(16-d%16)),r!==0&&(s.resetIV=!0,c=r-16)}s.rangeStart=c,s.rangeEnd=h}return s}function cp(l,e){const t=new Error(`GAP ${l.gap?"tag":"attribute"} found`),s={type:ye.MEDIA_ERROR,details:H.FRAG_GAP,fatal:!1,frag:l,error:t,networkDetails:null};return e&&(s.part=e),(e||l).stats.aborted=!0,new ls(s)}function Sb(l){return l==="AES-128"||l==="AES-256"}class ls extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class qy extends vi{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class md{constructor(e,t,s,r=0,a=-1,u=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=so(),this.buffering={audio:so(),video:so(),audiovideo:so()},this.level=e,this.sn=t,this.id=s,this.size=r,this.part=a,this.partial=u}}function so(){return{start:0,executeStart:0,executeEnd:0,end:0}}const fp={length:0,start:()=>0,end:()=>0};class xe{static isBuffered(e,t){if(e){const s=xe.getBuffered(e);for(let r=s.length;r--;)if(t>=s.start(r)&&t<=s.end(r))return!0}return!1}static bufferedRanges(e){if(e){const t=xe.getBuffered(e);return xe.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const r=xe.bufferedRanges(e);if(r.length)return xe.bufferedInfo(r,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort((g,m)=>g.start-m.start||m.end-g.end);let r=-1,a=[];if(s)for(let g=0;g<e.length;g++){t>=e[g].start&&t<=e[g].end&&(r=g);const m=a.length;if(m){const v=a[m-1].end;e[g].start-v<s?e[g].end>v&&(a[m-1].end=e[g].end):a.push(e[g])}else a.push(e[g])}else a=e;let u=0,c,h=t,d=t;for(let g=0;g<a.length;g++){const m=a[g].start,v=a[g].end;if(r===-1&&t>=m&&t<=v&&(r=g),t+s>=m&&t<v)h=m,d=v,u=d-t;else if(t+s<m){c=m;break}}return{len:u,start:h||0,end:d||0,nextStart:c,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||fp}catch(t){return je.log("failed to get media.buffered",t),fp}}}const Xy=/\{\$([a-zA-Z0-9-_]+)\}/g;function dp(l){return Xy.test(l)}function jf(l,e){if(l.variableList!==null||l.hasVariableRefs){const t=l.variableList;return e.replace(Xy,s=>{const r=s.substring(2,s.length-1),a=t?.[r];return a===void 0?(l.playlistParsingError||(l.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),s):a})}return e}function hp(l,e,t){let s=l.variableList;s||(l.variableList=s={});let r,a;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const u=new self.URL(t).searchParams;if(u.has(r))a=u.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(u){l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${u.message}`))}}else r=e.NAME,a=e.VALUE;r in s?l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):s[r]=a||""}function Tb(l,e,t){const s=e.IMPORT;if(t&&s in t){let r=l.variableList;r||(l.variableList=r={}),r[s]=t[s]}else l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}const xb=/^(\d+)x(\d+)$/,gp=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Je{constructor(e,t){typeof e=="string"&&(e=Je.parseAttrList(e,t)),Ve(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const s=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)s[r]=parseInt(t.slice(r*2,r*2+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce((r,a)=>(r[a.toLowerCase()]=!0,r),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=xb.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const r={};for(gp.lastIndex=0;(s=gp.exec(e))!==null;){const u=s[1].trim();let c=s[2];const h=c.indexOf('"')===0&&c.lastIndexOf('"')===c.length-1;let d=!1;if(h)c=c.slice(1,-1);else switch(u){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":d=!0}if(t&&(h||d))c=jf(t,c);else if(!d&&!h)switch(u){case"CLOSED-CAPTIONS":if(c==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":je.warn(`${e}: attribute ${u} is missing quotes`)}r[u]=c}return r}}const Ab="com.apple.hls.interstitial";function bb(l){return l!=="ID"&&l!=="CLASS"&&l!=="CUE"&&l!=="START-DATE"&&l!=="DURATION"&&l!=="END-DATE"&&l!=="END-ON-NEXT"}function Lb(l){return l==="SCTE35-OUT"||l==="SCTE35-IN"||l==="SCTE35-CMD"}class Qy{constructor(e,t,s=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(r=t?.tagOrder)!=null?r:s,t){const a=t.attr;for(const u in a)if(Object.prototype.hasOwnProperty.call(e,u)&&e[u]!==a[u]){je.warn(`DATERANGE tag attribute: "${u}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=u;break}e=Ve(new Je({}),a,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const a=t?.endDate||new Date(this.attr["END-DATE"]);fe(a.getTime())&&(this._endDate=a)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(je.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(fe(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===Ab}get isValid(){return!!this.id&&!this._badValueForSameId&&fe(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const Rb=10;class _b{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&s>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let s=t.decryptdata;return s||(t.setKeyFormat(e.keyFormat),s=t.decryptdata),!!s&&e.matches(s)})}get hasProgramDateTime(){return this.fragments.length?fe(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Rb}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Mo(l,e){return l.length===e.length?!l.some((t,s)=>t!==e[s]):!1}function mp(l,e){return!l&&!e?!0:!l||!e?!1:Mo(l,e)}function dr(l){return l==="AES-128"||l==="AES-256"||l==="AES-256-CTR"}function pd(l){switch(l){case"AES-128":case"AES-256":return Ks.cbc;case"AES-256-CTR":return Ks.ctr;default:throw new Error(`invalid full segment method ${l}`)}}function yd(l){return Uint8Array.from(atob(l),e=>e.charCodeAt(0))}function Hf(l){return Uint8Array.from(unescape(encodeURIComponent(l)),e=>e.charCodeAt(0))}function Db(l){const e=Hf(l).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Wy(l){const e=function(s,r,a){const u=s[r];s[r]=s[a],s[a]=u};e(l,0,3),e(l,1,2),e(l,4,5),e(l,6,7)}function Zy(l){const e=l.split(":");let t=null;if(e[0]==="data"&&e.length===2){const s=e[1].split(";"),r=s[s.length-1].split(",");if(r.length===2){const a=r[0]==="base64",u=r[1];a?(s.splice(-1,1),t=yd(u)):t=Db(u)}}return t}const ko=typeof self<"u"?self:void 0;var et={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},_t={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function So(l){switch(l){case _t.FAIRPLAY:return et.FAIRPLAY;case _t.PLAYREADY:return et.PLAYREADY;case _t.WIDEVINE:return et.WIDEVINE;case _t.CLEARKEY:return et.CLEARKEY}}function mf(l){switch(l){case et.FAIRPLAY:return _t.FAIRPLAY;case et.PLAYREADY:return _t.PLAYREADY;case et.WIDEVINE:return _t.WIDEVINE;case et.CLEARKEY:return _t.CLEARKEY}}function va(l){const{drmSystems:e,widevineLicenseUrl:t}=l,s=e?[et.FAIRPLAY,et.WIDEVINE,et.PLAYREADY,et.CLEARKEY].filter(r=>!!e[r]):[];return!s[et.WIDEVINE]&&t&&s.push(et.WIDEVINE),s}const Jy=(function(l){return ko!=null&&(l=ko.navigator)!=null&&l.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function Ib(l,e,t,s){let r;switch(l){case et.FAIRPLAY:r=["cenc","sinf"];break;case et.WIDEVINE:case et.PLAYREADY:r=["cenc"];break;case et.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${l}`)}return Cb(r,e,t,s)}function Cb(l,e,t,s){return[{initDataTypes:l,persistentState:s.persistentState||"optional",distinctiveIdentifier:s.distinctiveIdentifier||"optional",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:e.map(a=>({contentType:`audio/mp4; codecs=${a}`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:t.map(a=>({contentType:`video/mp4; codecs=${a}`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}]}function Ob(l){var e;return!!l&&(l.sessionType==="persistent-license"||!!((e=l.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function ev(l){const e=new Uint16Array(l.buffer,l.byteOffset,l.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),s=t.substring(t.indexOf("<"),t.length),u=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(u){const c=u.childNodes[0]?u.childNodes[0].nodeValue:u.getAttribute("VALUE");if(c){const h=yd(c).subarray(0,16);return Wy(h),h}}return null}let rr={};class js{static clearKeyUriToKeyIdMap(){rr={}}static setKeyIdForUri(e,t){rr[e]=t}static addKeyIdForUri(e){const t=Object.keys(rr).length%Number.MAX_SAFE_INTEGER,s=new Uint8Array(16);return new DataView(s.buffer,12,4).setUint32(0,t),rr[e]=s,s}constructor(e,t,s,r=[1],a=null,u){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=r,this.iv=a,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!dr(e),u!=null&&u.startsWith("0x")&&(this.keyId=new Uint8Array(Dy(u)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Mo(e.keyFormatVersions,this.keyFormatVersions)&&mp(e.iv,this.iv)&&mp(e.keyId,this.keyId)}isSupported(){if(this.method){if(dr(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case _t.FAIRPLAY:case _t.WIDEVINE:case _t.PLAYREADY:case _t.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(dr(this.method)){let a=this.iv;return a||(typeof e!="number"&&(je.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),a=Mb(e)),new js(this.method,this.uri,"identity",this.keyFormatVersions,a)}if(this.keyId){const a=rr[this.uri];if(a&&!Mo(this.keyId,a)&&js.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const s=Zy(this.uri);if(s)switch(this.keyFormat){case _t.WIDEVINE:if(this.pssh=s,!this.keyId){const a=PA(s.buffer);if(a.length){var r;const u=a[0];this.keyId=(r=u.kids)!=null&&r.length?u.kids[0]:null}}this.keyId||(this.keyId=pp(t));break;case _t.PLAYREADY:{const a=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=NA(a,null,s),this.keyId=ev(s);break}default:{let a=s.subarray(0,16);if(a.length!==16){const u=new Uint8Array(16);u.set(a,16-a.length),a=u}this.keyId=a;break}}if(!this.keyId||this.keyId.byteLength!==16){let a;a=wb(t),a||(a=pp(t),a||(a=rr[this.uri])),a&&(this.keyId=a,js.setKeyIdForUri(this.uri,a))}return this}}function wb(l){const e=l?.[_t.WIDEVINE];return e?e.keyId:null}function pp(l){const e=l?.[_t.PLAYREADY];if(e){const t=Zy(e.uri);if(t)return ev(t)}return null}function Mb(l){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=l>>8*(15-t)&255;return e}const yp=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,vp=/#EXT-X-MEDIA:(.*)/g,kb=/^#EXT(?:INF|-X-TARGETDURATION):/m,pf=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Nb=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Pi{static findGroup(e,t){for(let s=0;s<e.length;s++){const r=e[s];if(r.id===t)return r}}static resolve(e,t){return od.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return kb.test(e)}static parseMasterPlaylist(e,t){const s=dp(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:s},a=[];if(yp.lastIndex=0,!e.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let u;for(;(u=yp.exec(e))!=null;)if(u[1]){var c;const d=new Je(u[1],r),g=jf(r,u[2]),m={attrs:d,bitrate:d.decimalInteger("BANDWIDTH")||d.decimalInteger("AVERAGE-BANDWIDTH"),name:d.NAME,url:Pi.resolve(g,t)},v=d.decimalResolution("RESOLUTION");v&&(m.width=v.width,m.height=v.height),Tp(d.CODECS,m);const E=d["SUPPLEMENTAL-CODECS"];E&&(m.supplemental={},Tp(E,m.supplemental)),(c=m.unknownCodecs)!=null&&c.length||a.push(m),r.levels.push(m)}else if(u[3]){const d=u[3],g=u[4];switch(d){case"SESSION-DATA":{const m=new Je(g,r),v=m["DATA-ID"];v&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[v]=m);break}case"SESSION-KEY":{const m=Ep(g,t,r);m.encrypted&&m.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(m)):je.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${g}"`);break}case"DEFINE":{{const m=new Je(g,r);hp(r,m,t)}break}case"CONTENT-STEERING":{const m=new Je(g,r);r.contentSteering={uri:Pi.resolve(m["SERVER-URI"],t),pathwayId:m["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=Sp(g);break}}}const h=a.length>0&&a.length<r.levels.length;return r.levels=h?a:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,s){let r;const a={},u=s.levels,c={AUDIO:u.map(d=>({id:d.attrs.AUDIO,audioCodec:d.audioCodec})),SUBTITLES:u.map(d=>({id:d.attrs.SUBTITLES,textCodec:d.textCodec})),"CLOSED-CAPTIONS":[]};let h=0;for(vp.lastIndex=0;(r=vp.exec(e))!==null;){const d=new Je(r[1],s),g=d.TYPE;if(g){const m=c[g],v=a[g]||[];a[g]=v;const E=d.LANGUAGE,S=d["ASSOC-LANGUAGE"],x=d.CHANNELS,T=d.CHARACTERISTICS,L=d["INSTREAM-ID"],_={attrs:d,bitrate:0,id:h++,groupId:d["GROUP-ID"]||"",name:d.NAME||E||"",type:g,default:d.bool("DEFAULT"),autoselect:d.bool("AUTOSELECT"),forced:d.bool("FORCED"),lang:E,url:d.URI?Pi.resolve(d.URI,t):""};if(S&&(_.assocLang=S),x&&(_.channels=x),T&&(_.characteristics=T),L&&(_.instreamId=L),m!=null&&m.length){const I=Pi.findGroup(m,_.groupId)||m[0];xp(_,I,"audioCodec"),xp(_,I,"textCodec")}v.push(_)}}return a}static parseLevelPlaylist(e,t,s,r,a,u){var c;const h={url:t},d=new _b(t),g=d.fragments,m=[];let v=null,E=0,S=0,x=0,T=0,L=0,_=null,I=new df(r,h),O,k,K,w=-1,B=!1,$=null,U;if(pf.lastIndex=0,d.m3u8=e,d.hasVariableRefs=dp(e),((c=pf.exec(e))==null?void 0:c[0])!=="#EXTM3U")return d.playlistParsingError=new Error("Missing format identifier #EXTM3U"),d;for(;(O=pf.exec(e))!==null;){B&&(B=!1,I=new df(r,h),I.playlistOffset=x,I.setStart(x),I.sn=E,I.cc=T,L&&(I.bitrate=L),I.level=s,v&&(I.initSegment=v,v.rawProgramDateTime&&(I.rawProgramDateTime=v.rawProgramDateTime,v.rawProgramDateTime=null),$&&(I.setByteRange($),$=null)));const he=O[1];if(he){I.duration=parseFloat(he);const oe=(" "+O[2]).slice(1);I.title=oe||null,I.tagList.push(oe?["INF",he,oe]:["INF",he])}else if(O[3]){if(fe(I.duration)){I.playlistOffset=x,I.setStart(x),K&&bp(I,K,d),I.sn=E,I.level=s,I.cc=T,g.push(I);const oe=(" "+O[3]).slice(1);I.relurl=jf(d,oe),Kf(I,_,m),_=I,x+=I.duration,E++,S=0,B=!0}}else{if(O=O[0].match(Nb),!O){je.warn("No matches on slow regex match for level playlist!");continue}for(k=1;k<O.length&&O[k]===void 0;k++);const oe=(" "+O[k]).slice(1),N=(" "+O[k+1]).slice(1),X=O[k+2]?(" "+O[k+2]).slice(1):null;switch(oe){case"BYTERANGE":_?I.setByteRange(N,_):I.setByteRange(N);break;case"PROGRAM-DATE-TIME":I.rawProgramDateTime=N,I.tagList.push(["PROGRAM-DATE-TIME",N]),w===-1&&(w=g.length);break;case"PLAYLIST-TYPE":d.type&&rs(d,oe,O),d.type=N.toUpperCase();break;case"MEDIA-SEQUENCE":d.startSN!==0?rs(d,oe,O):g.length>0&&Lp(d,oe,O),E=d.startSN=parseInt(N);break;case"SKIP":{d.skippedSegments&&rs(d,oe,O);const J=new Je(N,d),ae=J.decimalInteger("SKIPPED-SEGMENTS");if(fe(ae)){d.skippedSegments+=ae;for(let C=ae;C--;)g.push(null);E+=ae}const ue=J.enumeratedString("RECENTLY-REMOVED-DATERANGES");ue&&(d.recentlyRemovedDateranges=(d.recentlyRemovedDateranges||[]).concat(ue.split("	")));break}case"TARGETDURATION":d.targetduration!==0&&rs(d,oe,O),d.targetduration=Math.max(parseInt(N),1);break;case"VERSION":d.version!==null&&rs(d,oe,O),d.version=parseInt(N);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":d.live||rs(d,oe,O),d.live=!1;break;case"#":(N||X)&&I.tagList.push(X?[N,X]:[N]);break;case"DISCONTINUITY":T++,I.tagList.push(["DIS"]);break;case"GAP":I.gap=!0,I.tagList.push([oe]);break;case"BITRATE":I.tagList.push([oe,N]),L=parseInt(N)*1e3,fe(L)?I.bitrate=L:L=0;break;case"DATERANGE":{const J=new Je(N,d),ae=new Qy(J,d.dateRanges[J.ID],d.dateRangeTagCount);d.dateRangeTagCount++,ae.isValid||d.skippedSegments?d.dateRanges[ae.id]=ae:je.warn(`Ignoring invalid DATERANGE tag: "${N}"`),I.tagList.push(["EXT-X-DATERANGE",N]);break}case"DEFINE":{{const J=new Je(N,d);"IMPORT"in J?Tb(d,J,u):hp(d,J,t)}break}case"DISCONTINUITY-SEQUENCE":d.startCC!==0?rs(d,oe,O):g.length>0&&Lp(d,oe,O),d.startCC=T=parseInt(N);break;case"KEY":{const J=Ep(N,t,d);if(J.isSupported()){if(J.method==="NONE"){K=void 0;break}K||(K={});const ae=K[J.keyFormat];ae!=null&&ae.matches(J)||(ae&&(K=Ve({},K)),K[J.keyFormat]=J)}else je.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${N}"`);break}case"START":d.startTimeOffset=Sp(N);break;case"MAP":{const J=new Je(N,d);if(I.duration){const ae=new df(r,h);Ap(ae,J,s,K),v=ae,I.initSegment=v,v.rawProgramDateTime&&!I.rawProgramDateTime&&(I.rawProgramDateTime=v.rawProgramDateTime)}else{const ae=I.byteRangeEndOffset;if(ae){const ue=I.byteRangeStartOffset;$=`${ae-ue}@${ue}`}else $=null;Ap(I,J,s,K),v=I,B=!0}v.cc=T;break}case"SERVER-CONTROL":{U&&rs(d,oe,O),U=new Je(N),d.canBlockReload=U.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=U.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&U.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=U.optionalFloat("PART-HOLD-BACK",0),d.holdBack=U.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{d.partTarget&&rs(d,oe,O);const J=new Je(N);d.partTarget=J.decimalFloatingPoint("PART-TARGET");break}case"PART":{let J=d.partList;J||(J=d.partList=[]);const ae=S>0?J[J.length-1]:void 0,ue=S++,C=new Je(N,d),F=new TA(C,I,h,ue,ae);J.push(F),I.duration+=F.duration;break}case"PRELOAD-HINT":{const J=new Je(N,d);d.preloadHint=J;break}case"RENDITION-REPORT":{const J=new Je(N,d);d.renditionReports=d.renditionReports||[],d.renditionReports.push(J);break}default:je.warn(`line parsed but not handled: ${O}`);break}}}_&&!_.relurl?(g.pop(),x-=_.duration,d.partList&&(d.fragmentHint=_)):d.partList&&(Kf(I,_,m),I.cc=T,d.fragmentHint=I,K&&bp(I,K,d)),d.targetduration||(d.playlistParsingError=new Error("Missing Target Duration"));const W=g.length,ne=g[0],ce=g[W-1];if(x+=d.skippedSegments*d.targetduration,x>0&&W&&ce){d.averagetargetduration=x/W;const he=ce.sn;d.endSN=he!=="initSegment"?he:0,d.live||(ce.endList=!0),w>0&&(Ub(g,w),ne&&m.unshift(ne))}return d.fragmentHint&&(x+=d.fragmentHint.duration),d.totalduration=x,m.length&&d.dateRangeTagCount&&ne&&tv(m,d),d.endCC=T,d}}function tv(l,e){let t=l.length;if(!t)if(e.hasProgramDateTime){const c=e.fragments[e.fragments.length-1];l.push(c),t++}else return;const s=l[t-1],r=e.live?1/0:e.totalduration,a=Object.keys(e.dateRanges);for(let c=a.length;c--;){const h=e.dateRanges[a[c]],d=h.startDate.getTime();h.tagAnchor=s.ref;for(let g=t;g--;){var u;if(((u=l[g])==null?void 0:u.sn)<e.startSN)break;const m=Pb(e,d,l,g,r);if(m!==-1){h.tagAnchor=e.fragments[m].ref;break}}}}function Pb(l,e,t,s,r){const a=t[s];if(a){const c=a.programDateTime;if(e>=c||s===0){var u;const h=(((u=t[s+1])==null?void 0:u.start)||r)-a.start;if(e<=c+h*1e3){const d=t[s].sn-l.startSN;if(d<0)return-1;const g=l.fragments;if(g.length>t.length){const v=(t[s+1]||g[g.length-1]).sn-l.startSN;for(let E=v;E>d;E--){const S=g[E].programDateTime;if(e>=S&&e<S+g[E].duration*1e3)return E}}return d}}}return-1}function Ep(l,e,t){var s,r;const a=new Je(l,t),u=(s=a.METHOD)!=null?s:"",c=a.URI,h=a.hexadecimalInteger("IV"),d=a.KEYFORMATVERSIONS,g=(r=a.KEYFORMAT)!=null?r:"identity";c&&a.IV&&!h&&je.error(`Invalid IV: ${a.IV}`);const m=c?Pi.resolve(c,e):"",v=(d||"1").split("/").map(Number).filter(Number.isFinite);return new js(u,m,g,v,h,a.KEYID)}function Sp(l){const t=new Je(l).decimalFloatingPoint("TIME-OFFSET");return fe(t)?t:null}function Tp(l,e){let t=(l||"").split(/[ ,]+/).filter(s=>s);["video","audio","text"].forEach(s=>{const r=t.filter(a=>fd(a,s));r.length&&(e[`${s}Codec`]=r.map(a=>a.split("/")[0]).join(","),t=t.filter(a=>r.indexOf(a)===-1))}),e.unknownCodecs=t}function xp(l,e,t){const s=e[t];s&&(l[t]=s)}function Ub(l,e){let t=l[e];for(let s=e;s--;){const r=l[s];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function Kf(l,e,t){l.rawProgramDateTime?t.push(l):e!=null&&e.programDateTime&&(l.programDateTime=e.endProgramDateTime)}function Ap(l,e,t,s){l.relurl=e.URI,e.BYTERANGE&&l.setByteRange(e.BYTERANGE),l.level=t,l.sn="initSegment",s&&(l.levelkeys=s),l.initSegment=null}function bp(l,e,t){l.levelkeys=e;const{encryptedFragments:s}=t;(!s.length||s[s.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&s.push(l)}function rs(l,e,t){l.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Lp(l,e,t){l.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function yf(l,e){const t=e.startPTS;if(fe(t)){let s=0,r;e.sn>l.sn?(s=t-l.start,r=l):(s=l.start-t,r=e),r.duration!==s&&r.setDuration(s)}else e.sn>l.sn?l.cc===e.cc&&l.minEndPTS?e.setStart(l.start+(l.minEndPTS-l.start)):e.setStart(l.start+l.duration):e.setStart(Math.max(l.start-e.duration,0))}function iv(l,e,t,s,r,a,u){s-t<=0&&(u.warn("Fragment should have a positive duration",e),s=t+e.duration,a=r+e.duration);let h=t,d=s;const g=e.startPTS,m=e.endPTS;if(fe(g)){const L=Math.abs(g-t);l&&L>l.totalduration?u.warn(`media timestamps and playlist times differ by ${L}s for level ${e.level} ${l.url}`):fe(e.deltaPTS)?e.deltaPTS=Math.max(L,e.deltaPTS):e.deltaPTS=L,h=Math.max(t,g),t=Math.min(t,g),r=e.startDTS!==void 0?Math.min(r,e.startDTS):r,d=Math.min(s,m),s=Math.max(s,m),a=e.endDTS!==void 0?Math.max(a,e.endDTS):a}const v=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(s-e.start),e.startPTS=t,e.maxStartPTS=h,e.startDTS=r,e.endPTS=s,e.minEndPTS=d,e.endDTS=a;const E=e.sn;if(!l||E<l.startSN||E>l.endSN)return 0;let S;const x=E-l.startSN,T=l.fragments;for(T[x]=e,S=x;S>0;S--)yf(T[S],T[S-1]);for(S=x;S<T.length-1;S++)yf(T[S],T[S+1]);return l.fragmentHint&&yf(T[T.length-1],l.fragmentHint),l.PTSKnown=l.alignedSliding=!0,v}function Fb(l,e,t){if(l===e)return;let s=null;const r=l.fragments;for(let g=r.length-1;g>=0;g--){const m=r[g].initSegment;if(m){s=m;break}}l.fragmentHint&&delete l.fragmentHint.endPTS;let a;Gb(l,e,(g,m,v,E)=>{if((!e.startCC||e.skippedSegments)&&m.cc!==g.cc){const S=g.cc-m.cc;for(let x=v;x<E.length;x++)E[x].cc+=S;e.endCC=E[E.length-1].cc}fe(g.startPTS)&&fe(g.endPTS)&&(m.setStart(m.startPTS=g.startPTS),m.startDTS=g.startDTS,m.maxStartPTS=g.maxStartPTS,m.endPTS=g.endPTS,m.endDTS=g.endDTS,m.minEndPTS=g.minEndPTS,m.setDuration(g.endPTS-g.startPTS),m.duration&&(a=m),e.PTSKnown=e.alignedSliding=!0),g.hasStreams&&(m.elementaryStreams=g.elementaryStreams),m.loader=g.loader,g.hasStats&&(m.stats=g.stats),g.initSegment&&(m.initSegment=g.initSegment,s=g.initSegment)});const u=e.fragments,c=e.fragmentHint?u.concat(e.fragmentHint):u;if(s&&c.forEach(g=>{var m;g&&(!g.initSegment||g.initSegment.relurl===((m=s)==null?void 0:m.relurl))&&(g.initSegment=s)}),e.skippedSegments){if(e.deltaUpdateFailed=u.some(g=>!g),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let g=e.skippedSegments;g--;)u.shift();e.startSN=u[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=Bb(l.dateRanges,e,t));const g=l.fragments.filter(m=>m.rawProgramDateTime);if(l.hasProgramDateTime&&!e.hasProgramDateTime)for(let m=1;m<c.length;m++)c[m].programDateTime===null&&Kf(c[m],c[m-1],g);tv(g,e)}e.endCC=u[u.length-1].cc}if(!e.startCC){var h;const g=rv(l,e.startSN-1);e.startCC=(h=g?.cc)!=null?h:u[0].cc}$b(l.partList,e.partList,(g,m)=>{m.elementaryStreams=g.elementaryStreams,m.stats=g.stats}),a?iv(e,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS,t):sv(l,e),u.length&&(e.totalduration=e.edge-u[0].start),e.driftStartTime=l.driftStartTime,e.driftStart=l.driftStart;const d=e.advancedDateTime;if(e.advanced&&d){const g=e.edge;e.driftStart||(e.driftStartTime=d,e.driftStart=g),e.driftEndTime=d,e.driftEnd=g}else e.driftEndTime=l.driftEndTime,e.driftEnd=l.driftEnd,e.advancedDateTime=l.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=l.requestScheduled)}function Bb(l,e,t){const{dateRanges:s,recentlyRemovedDateranges:r}=e,a=Ve({},l);r&&r.forEach(h=>{delete a[h]});const c=Object.keys(a).length;return c?(Object.keys(s).forEach(h=>{const d=a[h],g=new Qy(s[h].attr,d);g.isValid?(a[h]=g,d||(g.tagOrder+=c)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Xe(s[h].attr)}"`)}),a):s}function $b(l,e,t){if(l&&e){let s=0;for(let r=0,a=l.length;r<=a;r++){const u=l[r],c=e[r+s];u&&c&&u.index===c.index&&u.fragment.sn===c.fragment.sn?t(u,c):s--}}}function Gb(l,e,t){const s=e.skippedSegments,r=Math.max(l.startSN,e.startSN)-e.startSN,a=(l.fragmentHint?1:0)+(s?e.endSN:Math.min(l.endSN,e.endSN))-e.startSN,u=e.startSN-l.startSN,c=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,h=l.fragmentHint?l.fragments.concat(l.fragmentHint):l.fragments;for(let d=r;d<=a;d++){const g=h[u+d];let m=c[d];if(s&&!m&&g&&(m=e.fragments[d]=g),g&&m){t(g,m,d,c);const v=g.relurl,E=m.relurl;if(v&&jb(v,E)){e.playlistParsingError=Rp(`media sequence mismatch ${m.sn}:`,l,e,g,m);return}else if(g.cc!==m.cc){e.playlistParsingError=Rp(`discontinuity sequence mismatch (${g.cc}!=${m.cc})`,l,e,g,m);return}}}}function Rp(l,e,t,s,r){return new Error(`${l} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function sv(l,e,t=!0){const s=e.startSN+e.skippedSegments-l.startSN,r=l.fragments,a=s>=0;let u=0;if(a&&s<r.length)u=r[s].start;else if(a&&e.startSN===l.endSN+1)u=l.fragmentEnd;else if(a&&t)u=l.fragmentStart+s*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)u=l.fragmentStart;else return;zf(e,u)}function zf(l,e){if(e){const t=l.fragments;for(let s=l.skippedSegments;s<t.length;s++)t[s].addStart(e);l.fragmentHint&&l.fragmentHint.addStart(e)}}function nv(l,e=1/0){let t=1e3*l.targetduration;if(l.updated){const s=l.fragments;if(s.length&&t*4>e){const a=s[s.length-1].duration*1e3;a<t&&(t=a)}}else t/=2;return Math.round(t)}function rv(l,e,t){if(!l)return null;let s=l.fragments[e-l.startSN];return s||(s=l.fragmentHint,s&&s.sn===e)?s:e<l.startSN&&t&&t.sn===e?t:null}function _p(l,e,t){return l?av(l.partList,e,t):null}function av(l,e,t){if(l)for(let s=l.length;s--;){const r=l[s];if(r.index===t&&r.fragment.sn===e)return r}return null}function lv(l){l.forEach((e,t)=>{var s;(s=e.details)==null||s.fragments.forEach(r=>{r.level=t,r.initSegment&&(r.initSegment.level=t)})})}function jb(l,e){return l!==e&&e?Dp(l)!==Dp(e):!1}function Dp(l){return l.replace(/\?[^?]*$/,"")}function Ea(l,e){for(let s=0,r=l.length;s<r;s++){var t;if(((t=l[s])==null?void 0:t.cc)===e)return l[s]}return null}function Hb(l,e){return!!(l&&e.startCC<l.endCC&&e.endCC>l.startCC)}function Ip(l,e){const t=l.start+e;l.startPTS=t,l.setStart(t),l.endPTS=t+l.duration}function ov(l,e){const t=e.fragments;for(let s=0,r=t.length;s<r;s++)Ip(t[s],l);e.fragmentHint&&Ip(e.fragmentHint,l),e.alignedSliding=!0}function Kb(l,e){l&&(uv(e,l),e.alignedSliding||No(e,l),!e.alignedSliding&&!e.skippedSegments&&sv(l,e,!1))}function uv(l,e){if(!Hb(e,l))return;const t=Math.min(e.endCC,l.endCC),s=Ea(e.fragments,t),r=Ea(l.fragments,t);if(!s||!r)return;je.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const a=s.start-r.start;ov(a,l)}function No(l,e){if(!l.hasProgramDateTime||!e.hasProgramDateTime)return;const t=l.fragments,s=e.fragments;if(!t.length||!s.length)return;let r,a;const u=Math.min(e.endCC,l.endCC);e.startCC<u&&l.startCC<u&&(r=Ea(s,u),a=Ea(t,u)),(!r||!a)&&(r=s[Math.floor(s.length/2)],a=Ea(t,r.cc)||t[Math.floor(t.length/2)]);const c=r.programDateTime,h=a.programDateTime;if(!c||!h)return;const d=(h-c)/1e3-(a.start-r.start);ov(d,l)}function Mt(l,e,t){jt(l,e,t),l.addEventListener(e,t)}function jt(l,e,t){l.removeEventListener(e,t)}const zb={toString:function(l){let e="";const t=l.length;for(let s=0;s<t;s++)e+=`[${l.start(s).toFixed(3)}-${l.end(s).toFixed(3)}]`;return e}},ee={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class vd extends qy{constructor(e,t,s,r,a){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ee.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:u,fragCurrent:c,media:h,mediaBuffer:d,state:g}=this,m=h?h.currentTime:0,v=xe.bufferInfo(d||h,m,u.maxBufferHole),E=!v.len;if(this.log(`Media seeking to ${fe(m)?m.toFixed(3):m}, state: ${g}, ${E?"out of":"in"} buffer`),this.state===ee.ENDED)this.resetLoadingState();else if(c){const S=u.maxFragLookUpTolerance,x=c.start-S,T=c.start+c.duration+S;if(E||T<v.start||x>v.end){const L=m>T;(m<x||L)&&(L&&c.loader&&(this.log(`Cancelling fragment load for seek (sn: ${c.sn})`),c.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(h){this.fragmentTracker.removeFragmentsInRange(m,1/0,this.playlistType,!0);const S=this.lastCurrentTime;if(m>S&&(this.lastCurrentTime=m),!this.loadingParts){const x=Math.max(v.end,m),T=this.shouldLoadParts(this.getLevelDetails(),x);T&&(this.log(`LL-Part loading ON after seeking to ${m.toFixed(2)} with buffer @${x.toFixed(2)}`),this.loadingParts=T)}}this.hls.hasEnoughToStart||(this.log(`Setting ${E?"startPosition":"nextLoadPosition"} to ${m} for seek without enough to start`),this.nextLoadPosition=m,E&&(this.startPosition=m)),E&&this.state===ee.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=a,this.hls=e,this.fragmentLoader=new Eb(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new gd(e.config)}registerListeners(){const{hls:e}=this;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===ee.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ee.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,r=this.config.timelineOffset||0;if(s<=r)return!1;const a=e.buffered;this.config.maxBufferHole&&a&&a.length>1&&(e=xe.bufferedInfo(a,e.start,0));const u=e.nextStart;if(u&&u>r&&u<t.edge||this.media.currentTime<e.start)return!1;const h=t.partList;if(h!=null&&h.length){const g=h[h.length-1];return xe.isBuffered(this.media,g.start+g.duration/2)}const d=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(d)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;Mt(s,"seeking",this.onMediaSeeking),Mt(s,"ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===ee.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),jt(r,"seeking",this.onMediaSeeking),jt(r,"ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ee.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){const r=a=>{const u=a.frag;if(this.fragContextChanged(u)){this.warn(`${u.type} sn: ${u.sn}${a.part?" part: "+a.part.index:""} of ${this.fragInfo(u,!1,a.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(u);return}u.stats.chunkCount++,this._handleFragmentLoadProgress(a)};this._doFragLoad(e,t,s,r).then(a=>{if(!a)return;const u=this.state,c=a.frag;if(this.fragContextChanged(c)){(u===ee.FRAG_LOADING||!this.fragCurrent&&u===ee.PARSING)&&(this.fragmentTracker.removeFragment(c),this.state=ee.IDLE);return}"payload"in a&&(this.log(`Loaded ${c.type} sn: ${c.sn} of ${this.playlistLabel()} ${c.level}`),this.hls.trigger(b.FRAG_LOADED,a)),this._handleFragmentLoadComplete(a)}).catch(a=>{this.state===ee.STOPPED||this.state===ee.ERROR||(this.warn(`Frag error: ${a?.message||a}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===gt.APPENDING){const a=e.type,u=this.getFwdBufferInfo(this.mediaBuffer,a),c=Math.max(e.duration,u?u.len:this.config.maxBufferLength),h=this.backtrackFragment;((h?e.sn-h.sn:0)===1||this.reduceMaxBufferLength(c,e.duration))&&s.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===gt.PARTIAL&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:s};this.hls.trigger(b.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(s=>{const r=s?.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return s}).then(s=>{const{hls:r}=this,{frag:a,payload:u}=s,c=a.decryptdata;if(u&&u.byteLength>0&&c!=null&&c.key&&c.iv&&dr(c.method)){const h=self.performance.now();return this.decrypter.decrypt(new Uint8Array(u),c.key.buffer,c.iv.buffer,pd(c.method)).catch(d=>{throw r.trigger(b.ERROR,{type:ye.MEDIA_ERROR,details:H.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:a}),d}).then(d=>{const g=self.performance.now();return r.trigger(b.FRAG_DECRYPTED,{frag:a,payload:d,stats:{tstart:h,tdecrypt:g}}),s.payload=d,this.completeInitSegmentLoad(s)})}return this.completeInitSegmentLoad(s)}).catch(s=>{this.state===ee.STOPPED||this.state===ee.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==ee.STOPPED&&(this.state=ee.IDLE),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var s,r;const a=e.tracks;if(a&&!t.encrypted&&((s=a.audio)!=null&&s.encrypted||(r=a.video)!=null&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const u=this.media,c=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${u?"attached mediaKeys: "+u.mediaKeys:"detached"})`);return this.warn(c.message),!u||u.mediaKeys?!1:(this.hls.trigger(b.ERROR,{type:ye.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_NO_KEYS,fatal:!1,error:c,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?zb.toString(xe.getBuffered(s)):"(detached)"})`),lt(e)){var r;if(e.type!==ge.SUBTITLE){const u=e.elementaryStreams;if(!Object.keys(u).some(c=>!!u[c])){this.state=ee.IDLE;return}}const a=(r=this.levels)==null?void 0:r[e.level];a!=null&&a.fragmentError&&(this.log(`Resetting level fragment error count of ${a.fragmentError} on frag buffered`),a.fragmentError=0)}this.state=ee.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:r,partsLoaded:a}=e,u=!a||a.length===0||a.some(h=>!h),c=new md(s.level,s.sn,s.stats.chunkCount+1,0,r?r.index:-1,!u);t.flush(c)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,r){var a;this.fragCurrent=e;const u=t.details;if(!this.levels||!u)throw new Error(`frag load aborted, missing level${u?"":" detail"}s`);let c=null;if(e.encrypted&&!((a=e.decryptdata)!=null&&a.key)){if(this.log(`Loading key for ${e.sn} of [${u.startSN}-${u.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=ee.KEY_LOADING,this.fragCurrent=e,c=this.keyLoader.load(e).then(v=>{if(!this.fragContextChanged(v.frag))return this.hls.trigger(b.KEY_LOADED,v),this.state===ee.KEY_LOADING&&(this.state=ee.IDLE),v}),this.hls.trigger(b.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(c=this.keyLoader.loadClear(e,u.encryptedFragments,this.startFragRequested),c&&this.log("[eme] blocking frag load until media-keys acquired"));const h=this.fragPrevious;if(lt(e)&&(!h||e.sn!==h.sn)){const v=this.shouldLoadParts(t.details,e.end);v!==this.loadingParts&&(this.log(`LL-Part loading ${v?"ON":"OFF"} loading sn ${h?.sn}->${e.sn}`),this.loadingParts=v)}if(s=Math.max(e.start,s||0),this.loadingParts&&lt(e)){const v=u.partList;if(v&&r){s>u.fragmentEnd&&u.fragmentHint&&(e=u.fragmentHint);const E=this.getNextPart(v,e,s);if(E>-1){const S=v[E];e=this.fragCurrent=S.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${S.index} (${E}/${v.length-1}) of ${this.fragInfo(e,!1,S)}) cc: ${e.cc} [${u.startSN}-${u.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=S.start+S.duration,this.state=ee.FRAG_LOADING;let x;return c?x=c.then(T=>!T||this.fragContextChanged(T.frag)?null:this.doFragPartsLoad(e,S,t,r)).catch(T=>this.handleFragLoadError(T)):x=this.doFragPartsLoad(e,S,t,r).catch(T=>this.handleFragLoadError(T)),this.hls.trigger(b.FRAG_LOADING,{frag:e,part:S,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):x}else if(!e.url||this.loadedEndOfParts(v,s))return Promise.resolve(null)}}if(lt(e)&&this.loadingParts){var d;this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(d=u.partList)==null?void 0:d.filter(v=>v.loaded).map(v=>`[${v.start}-${v.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+u.startSN+"-"+u.endSN+"]"}, target: ${parseFloat(s.toFixed(3))}`),fe(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ee.FRAG_LOADING;const g=this.config.progressive&&e.type!==ge.SUBTITLE;let m;return g&&c?m=c.then(v=>!v||this.fragContextChanged(v.frag)?null:this.fragmentLoader.load(e,r)).catch(v=>this.handleFragLoadError(v)):m=Promise.all([this.fragmentLoader.load(e,g?r:void 0),c]).then(([v])=>(!g&&r&&r(v),v)).catch(v=>this.handleFragLoadError(v)),this.hls.trigger(b.FRAG_LOADING,{frag:e,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):m}doFragPartsLoad(e,t,s,r){return new Promise((a,u)=>{var c;const h=[],d=(c=s.details)==null?void 0:c.partList,g=m=>{this.fragmentLoader.loadPart(e,m,r).then(v=>{h[m.index]=v;const E=v.part;this.hls.trigger(b.FRAG_LOADED,v);const S=_p(s.details,e.sn,m.index+1)||av(d,e.sn,m.index+1);if(S)g(S);else return a({frag:e,part:E,partsLoaded:h})}).catch(u)};g(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===H.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===ye.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(b.ERROR,t)}else this.hls.trigger(b.ERROR,{type:ye.OTHER_ERROR,details:H.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ee.PARSING){!this.fragCurrent&&this.state!==ee.STOPPED&&this.state!==ee.ERROR&&(this.state=ee.IDLE);return}const{frag:s,part:r,level:a}=t,u=self.performance.now();s.stats.parsing.end=u,r&&(r.stats.parsing.end=u);const c=this.getLevelDetails(),d=c&&s.sn>c.endSN||this.shouldLoadParts(c,s.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=d),this.updateLevelTiming(s,r,a,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var s;const a=e.partList[0];if(a.fragment.type===ge.SUBTITLE)return!1;const u=a.end+(((s=e.fragmentHint)==null?void 0:s.duration)||0);if(t>=u){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>a.start-a.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:r,sn:a,part:u}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${a} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const c=t[r],h=c.details,d=u>-1?_p(h,a,u):null,g=d?d.fragment:rv(h,a,s);return g?(s&&s!==g&&(g.stats=s.stats),{frag:g,part:d,level:c}):null}bufferFragmentData(e,t,s,r,a){if(this.state!==ee.PARSING)return;const{data1:u,data2:c}=e;let h=u;if(c&&(h=pi(u,c)),!h.length)return;const d=this.initPTS[t.cc],g=d?-d.baseTime/d.timescale:void 0,m={type:e.type,frag:t,part:s,chunkMeta:r,offset:g,parent:t.type,data:h};if(this.hls.trigger(b.BUFFER_APPENDING,m),e.dropped&&e.independent&&!s){if(a)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!xe.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const s=t.currentTime,r=xe.bufferInfo(t,s,0),a=e.duration,u=Math.min(this.config.maxFragLookUpTolerance*2,a*.25),c=Math.max(Math.min(e.start-u,r.end-u),s+u);e.start-c>u&&this.flushMainBuffer(c,e.start)}getFwdBufferInfo(e,t){var s;const r=this.getLoadPosition();if(!fe(r))return null;const u=this.lastCurrentTime>r||(s=this.media)!=null&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,u)}getFwdBufferInfoAtPos(e,t,s,r){const a=xe.bufferInfo(e,t,r);if(a.len===0&&a.nextStart!==void 0){const u=this.fragmentTracker.getBufferedFrag(t,s);if(u&&(a.nextStart<=u.end||u.gap)){const c=Math.max(Math.min(a.nextStart,u.end)-t,r);return xe.bufferInfo(e,t,c)}}return a}getMaxBufferLength(e){const{config:t}=this;let s;return e?s=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):s=t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,r=Math.max(Math.min(e-t,s.maxBufferLength),t),a=Math.max(e-t*3,s.maxMaxBufferLength/2,r);return a>=r?(s.maxMaxBufferLength=a,this.warn(`Reduce max buffer length to ${a}s`),!0):!1}getAppendedFrag(e,t=ge.MAIN){const s=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return s&&"fragment"in s?s.fragment:s}getNextFragment(e,t){const s=t.fragments,r=s.length;if(!r)return null;const{config:a}=this,u=s[0].start,c=a.lowLatencyMode&&!!t.partList;let h=null;if(t.live){const m=a.initialLiveManifestSize;if(r<m)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${m})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<u){var d;c&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),h=this.getInitialLiveFragment(t);const v=this.hls.startPosition,E=this.hls.liveSyncPosition,S=h?(v!==-1&&v>=u?v:E)||h.start:e;this.log(`Setting startPosition to ${S} to match start frag at live edge. mainStart: ${v} liveSyncPosition: ${E} frag.start: ${(d=h)==null?void 0:d.start}`),this.startPosition=this.nextLoadPosition=S}}else e<=u&&(h=s[0]);if(!h){const m=this.loadingParts?t.partEnd:t.fragmentEnd;h=this.getFragmentAtPosition(e,m,t)}let g=this.filterReplacedPrimary(h,t);if(!g&&h){const m=h.sn-t.startSN;g=this.filterReplacedPrimary(s[m+1]||null,t)}return this.mapToInitFragWhenRequired(g)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===gt.OK||s===gt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,r,a){let u=null;if(e.gap&&(u=this.getNextFragment(this.nextLoadPosition,t),u&&!u.gap&&s.nextStart)){const c=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,r,0);if(c!==null&&s.len+c.len>=a){const h=u.sn;return this.loopSn!==h&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${h}`),this.loopSn=h),null}}return this.loopSn=void 0,u}get primaryPrefetch(){if(Cp(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Cp(this.config)&&e.type!==ge.SUBTITLE){const s=this.hls.interstitialsManager,r=s?.bufferingItem;if(r){const u=r.event;if(u){if(u.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&t?.live===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}const a=s?.playerQueue;if(a)for(let u=a.length;u--;){const c=a[u].interstitial;if(c.appendInPlace&&e.start>=c.startTime&&e.end<=c.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,s){let r=-1,a=!1,u=!0;for(let c=0,h=e.length;c<h;c++){const d=e[c];if(u=u&&!d.independent,r>-1&&s<d.start)break;const g=d.loaded;g?r=-1:(a||(d.independent||u)&&d.fragment===t)&&(d.fragment!==t&&this.warn(`Need buffer at ${s} but next unloaded part starts at ${d.start}`),r=c),a=g}return r}loadedEndOfParts(e,t){let s;for(let r=e.length;r--;){if(s=e[r],!s.loaded)return!1;if(t>s.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,s=this.fragPrevious;let r=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),r=lb(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const a=s.sn+1;if(a>=e.startSN&&a<=e.endSN){const u=t[a-e.startSN];s.cc===u.cc&&(r=u,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=zy(e,s.cc,s.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const a=this.hls.liveSyncPosition;a!==null&&(r=this.getFragmentAtPosition(a,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,s){const{config:r}=this;let{fragPrevious:a}=this,{fragments:u,endSN:c}=s;const{fragmentHint:h}=s,{maxFragLookUpTolerance:d}=r,g=s.partList,m=!!(this.loadingParts&&g!=null&&g.length&&h);m&&!this.bitrateTest&&g[g.length-1].fragment.sn===h.sn&&(u=u.concat(h),c=h.sn);let v;if(e<t){var E;const x=e<this.lastCurrentTime||e>t-d||(E=this.media)!=null&&E.paused||!this.startFragRequested?0:d;v=pn(a,u,e,x)}else v=u[u.length-1];if(v){const S=v.sn-s.startSN,x=this.fragmentTracker.getState(v);if((x===gt.OK||x===gt.PARTIAL&&v.gap)&&(a=v),a&&v.sn===a.sn&&(!m||g[0].fragment.sn>v.sn||!s.live)&&v.level===a.level){const L=u[S+1];v.sn<c&&this.fragmentTracker.getState(L)!==gt.OK?v=L:v=null}}return v}alignPlaylists(e,t,s){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const a=e.fragmentStart,u=!t,c=e.alignedSliding&&fe(a);if(u||!c&&!a){Kb(s,e);const h=e.fragmentStart;return this.log(`Live playlist sliding: ${h.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),h}return a}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const r=this.timelineOffset;if(s===-1){const a=this.startTimeOffset!==null,u=a?this.startTimeOffset:e.startTimeOffset;u!==null&&fe(u)?(s=t+u,u<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${u} found in ${a?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+r}this.nextLoadPosition=s+r}getLoadPosition(){var e;const{media:t}=this;let s=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&lt(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ee.FRAG_LOADING_WAITING_RETRY)&&(this.state=ee.IDLE)}onFragmentOrKeyLoadError(e,t){var s;if(t.chunkMeta&&!t.frag){const L=this.getCurrentContext(t.chunkMeta);L&&(t.frag=L.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var a;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(a=this.fragCurrent)==null?void 0:a.url}`);return}const u=t.details===H.FRAG_GAP;u&&this.fragmentTracker.fragBuffered(r,!0);const c=t.errorAction;if(!c){this.state=ee.ERROR;return}const{action:h,flags:d,retryCount:g=0,retryConfig:m}=c,v=!!m,E=v&&h===Lt.RetryRequest,S=v&&!c.resolved&&d===Jt.MoveAllAlternatesMatchingHost,x=(s=this.hls.latestLevelDetails)==null?void 0:s.live;if(!E&&S&&lt(r)&&!r.endList&&x&&!Yy(t))this.resetFragmentErrors(e),this.treatAsGap(r),c.resolved=!0;else if((E||S)&&g<m.maxNumRetry){var T;const L=Gf((T=t.response)==null?void 0:T.code),_=hd(m,g);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+_,this.state=ee.FRAG_LOADING_WAITING_RETRY,c.resolved=!0,L){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${g+1}/${m.maxNumRetry} in ${_}ms`)}else if(m)if(this.resetFragmentErrors(e),g<m.maxNumRetry)!u&&h!==Lt.RemoveAlternatePermanently&&(c.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${g})`);return}else h===Lt.SendAlternateToPenaltyBox?this.state=ee.WAITING_LEVEL:this.state=ee.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,s=t===1/0;(!t||e>=t||s&&!Gf(0))&&(s&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=ee.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===ee.PARSING||this.state===ee.PARSED){const t=e.frag,s=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,s),a=r&&r.len>.5;a&&this.reduceMaxBufferLength(r.len,t?.duration||10);const u=!a;return u&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),u}return!1}resetFragmentErrors(e){e===ge.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ee.STOPPED&&(this.state=ee.IDLE)}afterBufferFlushed(e,t,s){if(!e)return;const r=xe.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,s),this.state===ee.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ee.STOPPED&&(this.state=ee.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,r){const a=s.details;if(!a){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((h,d)=>{const g=e.elementaryStreams[d];if(g){const m=g.endPTS-g.startPTS;if(m<=0)return this.warn(`Could not parse fragment ${e.sn} ${d} duration reliably (${m})`),h||!1;const v=r?0:iv(a,e,g.startPTS,g.endPTS,g.startDTS,g.endDTS,this);return this.hls.trigger(b.LEVEL_PTS_UPDATED,{details:a,level:s,drift:v,type:d,frag:e,start:g.startPTS,end:g.endPTS}),!0}return h},!1)){var c;const h=((c=this.transmuxer)==null?void 0:c.error)===null;if((s.fragmentError===0||h&&(s.fragmentError<2||e.endList))&&this.treatAsGap(e,s),h){const d=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(d.message),this.hls.trigger(b.ERROR,{type:ye.MEDIA_ERROR,details:H.FRAG_PARSING_ERROR,fatal:!1,error:d,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=ee.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(b.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===ge.MAIN?"level":"track"}fragInfo(e,t=!0,s){var r,a;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${((r=t&&!s?e.startPTS:(s||e).start)!=null?r:NaN).toFixed(3)}-${((a=t&&!s?e.endPTS:(s||e).end)!=null?a:NaN).toFixed(3)}]${s&&e.type==="main"?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Cp(l){return!!l.interstitialsController&&l.enableInterstitialPlayback!==!1}class cv{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;if(e.length)e.length===1?s=e[0]:s=Vb(e,t);else return new Uint8Array(0);return this.reset(),s}reset(){this.chunks.length=0,this.dataLength=0}}function Vb(l,e){const t=new Uint8Array(e);let s=0;for(let r=0;r<l.length;r++){const a=l[r];t.set(a,s),s+=a.length}return t}var vf={exports:{}},Op;function Yb(){return Op||(Op=1,(function(l){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function r(h,d,g){this.fn=h,this.context=d,this.once=g||!1}function a(h,d,g,m,v){if(typeof g!="function")throw new TypeError("The listener must be a function");var E=new r(g,m||h,v),S=t?t+d:d;return h._events[S]?h._events[S].fn?h._events[S]=[h._events[S],E]:h._events[S].push(E):(h._events[S]=E,h._eventsCount++),h}function u(h,d){--h._eventsCount===0?h._events=new s:delete h._events[d]}function c(){this._events=new s,this._eventsCount=0}c.prototype.eventNames=function(){var d=[],g,m;if(this._eventsCount===0)return d;for(m in g=this._events)e.call(g,m)&&d.push(t?m.slice(1):m);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(g)):d},c.prototype.listeners=function(d){var g=t?t+d:d,m=this._events[g];if(!m)return[];if(m.fn)return[m.fn];for(var v=0,E=m.length,S=new Array(E);v<E;v++)S[v]=m[v].fn;return S},c.prototype.listenerCount=function(d){var g=t?t+d:d,m=this._events[g];return m?m.fn?1:m.length:0},c.prototype.emit=function(d,g,m,v,E,S){var x=t?t+d:d;if(!this._events[x])return!1;var T=this._events[x],L=arguments.length,_,I;if(T.fn){switch(T.once&&this.removeListener(d,T.fn,void 0,!0),L){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,g),!0;case 3:return T.fn.call(T.context,g,m),!0;case 4:return T.fn.call(T.context,g,m,v),!0;case 5:return T.fn.call(T.context,g,m,v,E),!0;case 6:return T.fn.call(T.context,g,m,v,E,S),!0}for(I=1,_=new Array(L-1);I<L;I++)_[I-1]=arguments[I];T.fn.apply(T.context,_)}else{var O=T.length,k;for(I=0;I<O;I++)switch(T[I].once&&this.removeListener(d,T[I].fn,void 0,!0),L){case 1:T[I].fn.call(T[I].context);break;case 2:T[I].fn.call(T[I].context,g);break;case 3:T[I].fn.call(T[I].context,g,m);break;case 4:T[I].fn.call(T[I].context,g,m,v);break;default:if(!_)for(k=1,_=new Array(L-1);k<L;k++)_[k-1]=arguments[k];T[I].fn.apply(T[I].context,_)}}return!0},c.prototype.on=function(d,g,m){return a(this,d,g,m,!1)},c.prototype.once=function(d,g,m){return a(this,d,g,m,!0)},c.prototype.removeListener=function(d,g,m,v){var E=t?t+d:d;if(!this._events[E])return this;if(!g)return u(this,E),this;var S=this._events[E];if(S.fn)S.fn===g&&(!v||S.once)&&(!m||S.context===m)&&u(this,E);else{for(var x=0,T=[],L=S.length;x<L;x++)(S[x].fn!==g||v&&!S[x].once||m&&S[x].context!==m)&&T.push(S[x]);T.length?this._events[E]=T.length===1?T[0]:T:u(this,E)}return this},c.prototype.removeAllListeners=function(d){var g;return d?(g=t?t+d:d,this._events[g]&&u(this,g)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,l.exports=c})(vf)),vf.exports}var qb=Yb(),Ed=EA(qb);const Ra="1.6.15",pr={};function Xb(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Qb(){const l=pr[Ra];if(l)return l.clientCount++,l;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r={worker:new self.Worker(t),objectURL:t,clientCount:1};return pr[Ra]=r,r}function Wb(l){const e=pr[l];if(e)return e.clientCount++,e;const t=new self.URL(l,self.location.href).href,r={worker:new self.Worker(t),scriptURL:t,clientCount:1};return pr[l]=r,r}function Zb(l){const e=pr[l||Ra];if(e&&e.clientCount--===1){const{worker:s,objectURL:r}=e;delete pr[l||Ra],r&&self.URL.revokeObjectURL(r),s.terminate()}}function fv(l,e){return e+10<=l.length&&l[e]===51&&l[e+1]===68&&l[e+2]===73&&l[e+3]<255&&l[e+4]<255&&l[e+6]<128&&l[e+7]<128&&l[e+8]<128&&l[e+9]<128}function Sd(l,e){return e+10<=l.length&&l[e]===73&&l[e+1]===68&&l[e+2]===51&&l[e+3]<255&&l[e+4]<255&&l[e+6]<128&&l[e+7]<128&&l[e+8]<128&&l[e+9]<128}function Go(l,e){let t=0;return t=(l[e]&127)<<21,t|=(l[e+1]&127)<<14,t|=(l[e+2]&127)<<7,t|=l[e+3]&127,t}function _a(l,e){const t=e;let s=0;for(;Sd(l,e);){s+=10;const r=Go(l,e+6);s+=r,fv(l,e+10)&&(s+=10),e+=s}if(s>0)return l.subarray(t,t+s)}function Jb(l,e,t,s){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],a=e[t+2],u=a>>2&15;if(u>12){const E=new Error(`invalid ADTS sampling index:${u}`);l.emit(b.ERROR,b.ERROR,{type:ye.MEDIA_ERROR,details:H.FRAG_PARSING_ERROR,fatal:!0,error:E,reason:E.message});return}const c=(a>>6&3)+1,h=e[t+3]>>6&3|(a&1)<<2,d="mp4a.40."+c,g=r[u];let m=u;(c===5||c===29)&&(m-=3);const v=[c<<3|(m&14)>>1,(m&1)<<7|h<<3];return je.log(`manifest codec:${s}, parsed codec:${d}, channels:${h}, rate:${g} (ADTS object type:${c} sampling index:${u})`),{config:v,samplerate:g,channelCount:h,codec:d,parsedCodec:d,manifestCodec:s}}function dv(l,e){return l[e]===255&&(l[e+1]&246)===240}function hv(l,e){return l[e+1]&1?7:9}function Td(l,e){return(l[e+3]&3)<<11|l[e+4]<<3|(l[e+5]&224)>>>5}function eL(l,e){return e+5<l.length}function Po(l,e){return e+1<l.length&&dv(l,e)}function tL(l,e){return eL(l,e)&&dv(l,e)&&Td(l,e)<=l.length-e}function iL(l,e){if(Po(l,e)){const t=hv(l,e);if(e+t>=l.length)return!1;const s=Td(l,e);if(s<=t)return!1;const r=e+s;return r===l.length||Po(l,r)}return!1}function gv(l,e,t,s,r){if(!l.samplerate){const a=Jb(e,t,s,r);if(!a)return;Ve(l,a)}}function mv(l){return 1024*9e4/l}function sL(l,e){const t=hv(l,e);if(e+t<=l.length){const s=Td(l,e)-t;if(s>0)return{headerLength:t,frameLength:s}}}function pv(l,e,t,s,r){const a=mv(l.samplerate),u=s+r*a,c=sL(e,t);let h;if(c){const{frameLength:m,headerLength:v}=c,E=v+m,S=Math.max(0,t+E-e.length);S?(h=new Uint8Array(E-v),h.set(e.subarray(t+v,e.length),0)):h=e.subarray(t+v,t+E);const x={unit:h,pts:u};return S||l.samples.push(x),{sample:x,length:E,missing:S}}const d=e.length-t;return h=new Uint8Array(d),h.set(e.subarray(t,e.length),0),{sample:{unit:h,pts:u},length:d,missing:-1}}function nL(l,e){return Sd(l,e)&&Go(l,e+6)+10<=l.length-e}function rL(l){return l instanceof ArrayBuffer?l:l.byteOffset==0&&l.byteLength==l.buffer.byteLength?l.buffer:new Uint8Array(l).buffer}function Ef(l,e=0,t=1/0){return aL(l,e,t,Uint8Array)}function aL(l,e,t,s){const r=lL(l);let a=1;"BYTES_PER_ELEMENT"in s&&(a=s.BYTES_PER_ELEMENT);const u=oL(l)?l.byteOffset:0,c=(u+l.byteLength)/a,h=(u+e)/a,d=Math.floor(Math.max(0,Math.min(h,c))),g=Math.floor(Math.min(d+Math.max(t,0),c));return new s(r,d,g-d)}function lL(l){return l instanceof ArrayBuffer?l:l.buffer}function oL(l){return l&&l.buffer instanceof ArrayBuffer&&l.byteLength!==void 0&&l.byteOffset!==void 0}function uL(l){const e={key:l.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(l.size<2)return;if(l.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const s=l.data.subarray(1).indexOf(0);if(s===-1)return;const r=si(Ef(l.data,1,s)),a=l.data[2+s],u=l.data.subarray(3+s).indexOf(0);if(u===-1)return;const c=si(Ef(l.data,3+s,u));let h;return r==="-->"?h=si(Ef(l.data,4+s+u)):h=rL(l.data.subarray(4+s+u)),e.mimeType=r,e.pictureType=a,e.description=c,e.data=h,e}function cL(l){if(l.size<2)return;const e=si(l.data,!0),t=new Uint8Array(l.data.subarray(e.length+1));return{key:l.type,info:e,data:t.buffer}}function fL(l){if(l.size<2)return;if(l.type==="TXXX"){let t=1;const s=si(l.data.subarray(t),!0);t+=s.length+1;const r=si(l.data.subarray(t));return{key:l.type,info:s,data:r}}const e=si(l.data.subarray(1));return{key:l.type,info:"",data:e}}function dL(l){if(l.type==="WXXX"){if(l.size<2)return;let t=1;const s=si(l.data.subarray(t),!0);t+=s.length+1;const r=si(l.data.subarray(t));return{key:l.type,info:s,data:r}}const e=si(l.data);return{key:l.type,info:"",data:e}}function hL(l){return l.type==="PRIV"?cL(l):l.type[0]==="W"?dL(l):l.type==="APIC"?uL(l):fL(l)}function gL(l){const e=String.fromCharCode(l[0],l[1],l[2],l[3]),t=Go(l,4),s=10;return{type:e,size:t,data:l.subarray(s,s+t)}}const no=10,mL=10;function yv(l){let e=0;const t=[];for(;Sd(l,e);){const s=Go(l,e+6);l[e+5]>>6&1&&(e+=no),e+=no;const r=e+s;for(;e+mL<r;){const a=gL(l.subarray(e)),u=hL(a);u&&t.push(u),e+=a.size+no}fv(l,e)&&(e+=no)}return t}function vv(l){return l&&l.key==="PRIV"&&l.info==="com.apple.streaming.transportStreamTimestamp"}function pL(l){if(l.data.byteLength===8){const e=new Uint8Array(l.data),t=e[3]&1;let s=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return s/=45,t&&(s+=4772185884e-2),Math.round(s)}}function xd(l){const e=yv(l);for(let t=0;t<e.length;t++){const s=e[t];if(vv(s))return pL(s)}}let ti=(function(l){return l.audioId3="org.id3",l.dateRange="com.apple.quicktime.HLS",l.emsg="https://aomedia.org/emsg/ID3",l.misbklv="urn:misb:KLV:bin:1910.1",l})({});function ki(l="",e=9e4){return{type:l,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Ad{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=pi(this.cachedData,e),this.cachedData=null);let s=_a(e,0),r=s?s.length:0,a;const u=this._audioTrack,c=this._id3Track,h=s?xd(s):void 0,d=e.length;for((this.basePTS===null||this.frameIndex===0&&fe(h))&&(this.basePTS=yL(h,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),s&&s.length>0&&c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:ti.audioId3,duration:Number.POSITIVE_INFINITY});r<d;){if(this.canParse(e,r)){const g=this.appendFrame(u,e,r);g?(this.frameIndex++,this.lastPTS=g.sample.pts,r+=g.length,a=r):r=d}else nL(e,r)?(s=_a(e,r),c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:ti.audioId3,duration:Number.POSITIVE_INFINITY}),r+=s.length,a=r):r++;if(r===d&&a!==d){const g=e.slice(a);this.cachedData?this.cachedData=pi(this.cachedData,g):this.cachedData=g}}return{audioTrack:u,videoTrack:ki(),id3Track:c,textTrack:ki()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:ki(),id3Track:this._id3Track,textTrack:ki()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const yL=(l,e,t)=>{if(fe(l))return l*90;const s=t?t.baseTime*9e4/t.timescale:0;return e*9e4+s};let ro=null;const vL=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],EL=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SL=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],TL=[0,1,1,4];function Ev(l,e,t,s,r){if(t+24>e.length)return;const a=Sv(e,t);if(a&&t+a.frameLength<=e.length){const u=a.samplesPerFrame*9e4/a.sampleRate,c=s+r*u,h={unit:e.subarray(t,t+a.frameLength),pts:c,dts:c};return l.config=[],l.channelCount=a.channelCount,l.samplerate=a.sampleRate,l.samples.push(h),{sample:h,length:a.frameLength,missing:0}}}function Sv(l,e){const t=l[e+1]>>3&3,s=l[e+1]>>1&3,r=l[e+2]>>4&15,a=l[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&a!==3){const u=l[e+2]>>1&1,c=l[e+3]>>6,h=t===3?3-s:s===3?3:4,d=vL[h*14+r-1]*1e3,m=EL[(t===3?0:t===2?1:2)*3+a],v=c===3?1:2,E=SL[t][s],S=TL[s],x=E*8*S,T=Math.floor(E*d/m+u)*S;if(ro===null){const I=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ro=I?parseInt(I[1]):0}return ro&&ro<=87&&s===2&&d>=224e3&&c===0&&(l[e+3]=l[e+3]|128),{sampleRate:m,channelCount:v,frameLength:T,samplesPerFrame:x}}}function bd(l,e){return l[e]===255&&(l[e+1]&224)===224&&(l[e+1]&6)!==0}function Tv(l,e){return e+1<l.length&&bd(l,e)}function xL(l,e){return bd(l,e)&&4<=l.length-e}function xv(l,e){if(e+1<l.length&&bd(l,e)){const s=Sv(l,e);let r=4;s!=null&&s.frameLength&&(r=s.frameLength);const a=e+r;return a===l.length||Tv(l,a)}return!1}class AL extends Ad{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,r){super.resetInitSegment(e,t,s,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=_a(e,0);let r=s?.length||0;if(xv(e,r))return!1;for(let a=e.length;r<a;r++)if(iL(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return tL(e,t)}appendFrame(e,t,s){gv(e,this.observer,t,s,e.manifestCodec);const r=pv(e,t,s,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const Av=(l,e)=>{let t=0,s=5;e+=s;const r=new Uint32Array(1),a=new Uint32Array(1),u=new Uint8Array(1);for(;s>0;){u[0]=l[e];const c=Math.min(s,8),h=8-c;a[0]=4278190080>>>24+h<<h,r[0]=(u[0]&a[0])>>h,t=t?t<<c|r[0]:r[0],e+=1,s-=c}return t};class bL extends Ad{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,r){super.resetInitSegment(e,t,s,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const r=bv(e,t,s,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;const t=_a(e,0);if(!t)return!1;const s=t.length;return e[s]===11&&e[s+1]===119&&xd(t)!==void 0&&Av(e,s)<16}}function bv(l,e,t,s,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const a=e[t+4]>>6;if(a>=3)return-1;const c=[48e3,44100,32e3][a],h=e[t+4]&63,g=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][h*3+a]*2;if(t+g>e.length)return-1;const m=e[t+6]>>5;let v=0;m===2?v+=2:(m&1&&m!==1&&(v+=2),m&4&&(v+=2));const E=(e[t+6]<<8|e[t+7])>>12-v&1,x=[2,1,2,3,3,4,4,5][m]+E,T=e[t+5]>>3,L=e[t+5]&7,_=new Uint8Array([a<<6|T<<1|L>>2,(L&3)<<6|m<<3|E<<2|h>>4,h<<4&224]),I=1536/c*9e4,O=s+r*I,k=e.subarray(t,t+g);return l.config=_,l.channelCount=x,l.samplerate=c,l.samples.push({unit:k,pts:O}),g}class LL extends Ad{resetInitSegment(e,t,s,r){super.resetInitSegment(e,t,s,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=_a(e,0);let s=t?.length||0;if(t&&e[s]===11&&e[s+1]===119&&xd(t)!==void 0&&Av(e,s)<=16)return!1;for(let r=e.length;s<r;s++)if(xv(e,s))return je.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return xL(e,t)}appendFrame(e,t,s){if(this.basePTS!==null)return Ev(e,t,s,this.basePTS,this.frameIndex)}}const RL=/\/emsg[-/]ID3/i;class _L{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,r){const a=this.videoTrack=ki("video",1),u=this.audioTrack=ki("audio",1),c=this.txtTrack=ki("text",1);if(this.id3Track=ki("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const h=ky(e);if(h.video){const{id:d,timescale:g,codec:m,supplemental:v}=h.video;a.id=d,a.timescale=c.timescale=g,a.codec=m,a.supplemental=v}if(h.audio){const{id:d,timescale:g,codec:m}=h.audio;u.id=d,u.timescale=g,u.codec=m}c.id=Oy.text,a.sampleDuration=0,a.duration=u.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return bA(e)}demux(e,t){this.timeOffset=t;let s=e;const r=this.videoTrack,a=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=pi(this.remainderData,e));const c=OA(s);this.remainderData=c.remainder,r.samples=c.valid||new Uint8Array}else r.samples=s;const u=this.extractID3Track(r,t);return a.samples=X0(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:u,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return s.samples=X0(e,t),{videoTrack:t,audioTrack:ki(),id3Track:r,textTrack:ki()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const r=Re(e.samples,["emsg"]);r&&r.forEach(a=>{const u=MA(a);if(RL.test(u.schemeIdUri)){const c=wp(u,t);let h=u.eventDuration===4294967295?Number.POSITIVE_INFINITY:u.eventDuration/u.timeScale;h<=.001&&(h=Number.POSITIVE_INFINITY);const d=u.payload;s.samples.push({data:d,len:d.byteLength,dts:c,pts:c,type:ti.emsg,duration:h})}else if(this.config.enableEmsgKLVMetadata&&u.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const c=wp(u,t);s.samples.push({data:u.payload,len:u.payload.byteLength,dts:c,pts:c,type:ti.misbklv,duration:Number.POSITIVE_INFINITY})}})}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function wp(l,e){return fe(l.presentationTime)?l.presentationTime/l.timeScale:e+l.presentationTimeDelta/l.timeScale}class DL{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new gd(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Ks.cbc)}decryptAacSample(e,t,s){const r=e[t].unit;if(r.length<=16)return;const a=r.subarray(16,r.length-r.length%16),u=a.buffer.slice(a.byteOffset,a.byteOffset+a.length);this.decryptBuffer(u).then(c=>{const h=new Uint8Array(c);r.set(h,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}).catch(s)}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length){s();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,s=new Int8Array(t);let r=0;for(let a=32;a<e.length-16;a+=160,r+=16)s.set(e.subarray(a,a+16),r);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let r=0;for(let a=32;a<e.length-16;a+=160,r+=16)e.set(s.subarray(r,r+16),a);return e}decryptAvcSample(e,t,s,r,a){const u=Uy(a.data),c=this.getAvcEncryptedData(u);this.decryptBuffer(c.buffer).then(h=>{a.data=this.getAvcDecryptedUnit(u,h),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,r)}).catch(r)}decryptAvcSamples(e,t,s,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length){r();return}const a=e[t].units;for(;!(s>=a.length);s++){const u=a[s];if(!(u.data.length<=48||u.type!==1&&u.type!==5)&&(this.decryptAvcSample(e,t,s,r,u),!this.decrypter.isSync()))return}}}}class Lv{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s=this.VideoSample,r;if((!s||s.units.length===0)&&(s=e[e.length-1]),(t=s)!=null&&t.units){const a=s.units;r=a[a.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const s=t.samples,r=s.length;if(r){const a=s[r-1];e.pts=a.pts,e.dts=a.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,s){const r=t.byteLength;let a=e.naluState||0;const u=a,c=[];let h=0,d,g,m,v=-1,E=0;for(a===-1&&(v=0,E=this.getNALuType(t,0),a=0,h=1);h<r;){if(d=t[h++],!a){a=d?0:1;continue}if(a===1){a=d?0:2;continue}if(!d)a=3;else if(d===1){if(g=h-a-1,v>=0){const S={data:t.subarray(v,g),type:E};c.push(S)}else{const S=this.getLastNalUnit(e.samples);S&&(u&&h<=4-u&&S.state&&(S.data=S.data.subarray(0,S.data.byteLength-u)),g>0&&(S.data=pi(S.data,t.subarray(0,g)),S.state=0))}h<r?(m=this.getNALuType(t,h),v=h,E=m,a=0):a=-1}else a=0}if(v>=0&&a>=0){const S={data:t.subarray(v,r),type:E,state:a};c.push(S)}if(c.length===0){const S=this.getLastNalUnit(e.samples);S&&(S.data=pi(S.data,t))}return e.naluState=a,c}}class Sa{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,r=new Uint8Array(4),a=Math.min(4,t);if(a===0)throw new Error("no bytes available");r.set(e.subarray(s,s+a)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=a*8,this.bytesAvailable-=a}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&je.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class IL extends Lv{parsePES(e,t,s,r){const a=this.parseNALu(e,s.data,r);let u=this.VideoSample,c,h=!1;s.data=null,u&&a.length&&!e.audFound&&(this.pushAccessUnit(u,e),u=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),a.forEach(d=>{var g,m;switch(d.type){case 1:{let x=!1;c=!0;const T=d.data;if(h&&T.length>4){const L=this.readSliceType(T);(L===2||L===4||L===7||L===9)&&(x=!0)}if(x){var v;(v=u)!=null&&v.frame&&!u.key&&(this.pushAccessUnit(u,e),u=this.VideoSample=null)}u||(u=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),u.frame=!0,u.key=x;break}case 5:c=!0,(g=u)!=null&&g.frame&&!u.key&&(this.pushAccessUnit(u,e),u=this.VideoSample=null),u||(u=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),u.key=!0,u.frame=!0;break;case 6:{c=!0,cd(d.data,1,s.pts,t.samples);break}case 7:{var E,S;c=!0,h=!0;const x=d.data,T=this.readSPS(x);if(!e.sps||e.width!==T.width||e.height!==T.height||((E=e.pixelRatio)==null?void 0:E[0])!==T.pixelRatio[0]||((S=e.pixelRatio)==null?void 0:S[1])!==T.pixelRatio[1]){e.width=T.width,e.height=T.height,e.pixelRatio=T.pixelRatio,e.sps=[x];const L=x.subarray(1,4);let _="avc1.";for(let I=0;I<3;I++){let O=L[I].toString(16);O.length<2&&(O="0"+O),_+=O}e.codec=_}break}case 8:c=!0,e.pps=[d.data];break;case 9:c=!0,e.audFound=!0,(m=u)!=null&&m.frame&&(this.pushAccessUnit(u,e),u=null),u||(u=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:c=!0;break;default:c=!1;break}u&&c&&u.units.push(d)}),r&&u&&(this.pushAccessUnit(u,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Sa(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s=8,r=8,a;for(let u=0;u<e;u++)r!==0&&(a=t.readEG(),r=(s+a+256)%256),s=r===0?s:r}readSPS(e){const t=new Sa(e);let s=0,r=0,a=0,u=0,c,h,d;const g=t.readUByte.bind(t),m=t.readBits.bind(t),v=t.readUEG.bind(t),E=t.readBoolean.bind(t),S=t.skipBits.bind(t),x=t.skipEG.bind(t),T=t.skipUEG.bind(t),L=this.skipScalingList.bind(this);g();const _=g();if(m(5),S(3),g(),T(),_===100||_===110||_===122||_===244||_===44||_===83||_===86||_===118||_===128){const B=v();if(B===3&&S(1),T(),T(),S(1),E())for(h=B!==3?8:12,d=0;d<h;d++)E()&&(d<6?L(16,t):L(64,t))}T();const I=v();if(I===0)v();else if(I===1)for(S(1),x(),x(),c=v(),d=0;d<c;d++)x();T(),S(1);const O=v(),k=v(),K=m(1);K===0&&S(1),S(1),E()&&(s=v(),r=v(),a=v(),u=v());let w=[1,1];if(E()&&E())switch(g()){case 1:w=[1,1];break;case 2:w=[12,11];break;case 3:w=[10,11];break;case 4:w=[16,11];break;case 5:w=[40,33];break;case 6:w=[24,11];break;case 7:w=[20,11];break;case 8:w=[32,11];break;case 9:w=[80,33];break;case 10:w=[18,11];break;case 11:w=[15,11];break;case 12:w=[64,33];break;case 13:w=[160,99];break;case 14:w=[4,3];break;case 15:w=[3,2];break;case 16:w=[2,1];break;case 255:{w=[g()<<8|g(),g()<<8|g()];break}}return{width:Math.ceil((O+1)*16-s*2-r*2),height:(2-K)*(k+1)*16-(K?2:4)*(a+u),pixelRatio:w}}}class CL extends Lv{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,r){const a=this.parseNALu(e,s.data,r);let u=this.VideoSample,c,h=!1;s.data=null,u&&a.length&&!e.audFound&&(this.pushAccessUnit(u,e),u=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),a.forEach(d=>{var g,m;switch(d.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:u||(u=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),u.frame=!0,c=!0;break;case 16:case 17:case 18:case 21:if(c=!0,h){var v;(v=u)!=null&&v.frame&&!u.key&&(this.pushAccessUnit(u,e),u=this.VideoSample=null)}u||(u=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),u.key=!0,u.frame=!0;break;case 19:case 20:c=!0,(g=u)!=null&&g.frame&&!u.key&&(this.pushAccessUnit(u,e),u=this.VideoSample=null),u||(u=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),u.key=!0,u.frame=!0;break;case 39:c=!0,cd(d.data,2,s.pts,t.samples);break;case 32:c=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Ve(e.params,this.readVPS(d.data)),this.initVPS=d.data),e.vps=[d.data];break;case 33:if(c=!0,h=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],d.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const E=this.readSPS(d.data);e.width=E.width,e.height=E.height,e.pixelRatio=E.pixelRatio,e.codec=E.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const S in E.params)e.params[S]=E.params[S]}this.pushParameterSet(e.sps,d.data,e.vps),u||(u=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),u.key=!0;break;case 34:if(c=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const E=this.readPPS(d.data);for(const S in E)e.params[S]=E[S]}this.pushParameterSet(e.pps,d.data,e.vps)}break;case 35:c=!0,e.audFound=!0,(m=u)!=null&&m.frame&&(this.pushAccessUnit(u,e),u=null),u||(u=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:c=!1;break}u&&c&&u.units.push(d)}),r&&u&&(this.pushAccessUnit(u,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(t[s]=e[r],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Sa(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const s=t.readBits(3),r=t.readBoolean();return{numTemporalLayers:s+1,temporalIdNested:r}}readSPS(e){const t=new Sa(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const r=t.readBits(2),a=t.readBoolean(),u=t.readBits(5),c=t.readUByte(),h=t.readUByte(),d=t.readUByte(),g=t.readUByte(),m=t.readUByte(),v=t.readUByte(),E=t.readUByte(),S=t.readUByte(),x=t.readUByte(),T=t.readUByte(),L=t.readUByte(),_=[],I=[];for(let Ce=0;Ce<s;Ce++)_.push(t.readBoolean()),I.push(t.readBoolean());if(s>0)for(let Ce=s;Ce<8;Ce++)t.readBits(2);for(let Ce=0;Ce<s;Ce++)_[Ce]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),I[Ce]&&t.readUByte();t.readUEG();const O=t.readUEG();O==3&&t.skipBits(1);const k=t.readUEG(),K=t.readUEG(),w=t.readBoolean();let B=0,$=0,U=0,W=0;w&&(B+=t.readUEG(),$+=t.readUEG(),U+=t.readUEG(),W+=t.readUEG());const ne=t.readUEG(),ce=t.readUEG(),he=t.readUEG(),oe=t.readBoolean();for(let Ce=oe?0:s;Ce<=s;Ce++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let mt=0;mt<4;mt++)for(let Ct=0;Ct<(mt===3?2:6);Ct++)if(!t.readBoolean())t.readUEG();else{const Ot=Math.min(64,1<<4+(mt<<1));mt>1&&t.readEG();for(let Ri=0;Ri<Ot;Ri++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const J=t.readUEG();let ae=0;for(let Ce=0;Ce<J;Ce++){let mt=!1;if(Ce!==0&&(mt=t.readBoolean()),mt){Ce===J&&t.readUEG(),t.readBoolean(),t.readUEG();let Ct=0;for(let Si=0;Si<=ae;Si++){const Ot=t.readBoolean();let Ri=!1;Ot||(Ri=t.readBoolean()),(Ot||Ri)&&Ct++}ae=Ct}else{const Ct=t.readUEG(),Si=t.readUEG();ae=Ct+Si;for(let Ot=0;Ot<Ct;Ot++)t.readUEG(),t.readBoolean();for(let Ot=0;Ot<Si;Ot++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Ce=t.readUEG();for(let mt=0;mt<Ce;mt++){for(let Ct=0;Ct<he+4;Ct++)t.readBits(1);t.readBits(1)}}let C=0,F=1,se=1,re=!0,le=1,de=0;t.readBoolean(),t.readBoolean();let Se=!1;if(t.readBoolean()){if(t.readBoolean()){const $i=t.readUByte(),ka=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],pt=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];$i>0&&$i<16?(F=ka[$i-1],se=pt[$i-1]):$i===255&&(F=t.readBits(16),se=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Se=t.readBoolean(),Se&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(le=t.readBits(32),de=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const pt=t.readBoolean(),Na=t.readBoolean();let ds=!1;(pt||Na)&&(ds=t.readBoolean(),ds&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),ds&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Sr=0;Sr<=s;Sr++){re=t.readBoolean();const vn=re||t.readBoolean();let Pa=!1;vn?t.readEG():Pa=t.readBoolean();const Tr=Pa?1:t.readUEG()+1;if(pt)for(let Vs=0;Vs<Tr;Vs++)t.readUEG(),t.readUEG(),ds&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Na)for(let Vs=0;Vs<Tr;Vs++)t.readUEG(),t.readUEG(),ds&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),C=t.readUEG())}let ke=k,Dt=K;if(w){let Ce=1,mt=1;O===1?Ce=mt=2:O==2&&(Ce=2),ke=k-Ce*$-Ce*B,Dt=K-mt*W-mt*U}const ni=r?["A","B","C"][r]:"",Er=c<<24|h<<16|d<<8|g;let yn=0;for(let Ce=0;Ce<32;Ce++)yn=(yn|(Er>>Ce&1)<<31-Ce)>>>0;let Ei=yn.toString(16);return u===1&&Ei==="2"&&(Ei="6"),{codecString:`hvc1.${ni}${u}.${Ei}.${a?"H":"L"}${L}.B0`,params:{general_tier_flag:a,general_profile_idc:u,general_profile_space:r,general_profile_compatibility_flags:[c,h,d,g],general_constraint_indicator_flags:[m,v,E,S,x,T],general_level_idc:L,bit_depth:ne+8,bit_depth_luma_minus8:ne,bit_depth_chroma_minus8:ce,min_spatial_segmentation_idc:C,chroma_format_idc:O,frame_rate:{fixed:re,fps:de/le}},width:ke,height:Dt,pixelRatio:[F,se]}}readPPS(e){const t=new Sa(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const r=t.readBoolean(),a=t.readBoolean();let u=1;return a&&r?u=0:a?u=3:r&&(u=2),{parallelismType:u}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Et=188;class Gs{constructor(e,t,s,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=r,this.videoParser=null}static probe(e,t){const s=Gs.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),s!==-1}static syncOffset(e){const t=e.length;let s=Math.min(Et*5,t-Et)+1,r=0;for(;r<s;){let a=!1,u=-1,c=0;for(let h=r;h<t;h+=Et)if(e[h]===71&&(t-h===Et||e[h+Et]===71)){if(c++,u===-1&&(u=h,u!==0&&(s=Math.min(u+Et*99,e.length-Et)+1)),a||(a=Vf(e,h)===0),a&&c>1&&(u===0&&c>2||h+Et>s))return u}else{if(c)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Oy[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,s,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Gs.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=Gs.createTrack("audio",r),this._id3Track=Gs.createTrack("id3"),this._txtTrack=Gs.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,r=!1){s||(this.sampleAes=null);let a;const u=this._videoTrack,c=this._audioTrack,h=this._id3Track,d=this._txtTrack;let g=u.pid,m=u.pesData,v=c.pid,E=h.pid,S=c.pesData,x=h.pesData,T=null,L=this.pmtParsed,_=this._pmtId,I=e.length;if(this.remainderData&&(e=pi(this.remainderData,e),I=e.length,this.remainderData=null),I<Et&&!r)return this.remainderData=e,{audioTrack:c,videoTrack:u,id3Track:h,textTrack:d};const O=Math.max(0,Gs.syncOffset(e));I-=(I-O)%Et,I<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,I,e.buffer.byteLength-I));let k=0;for(let w=O;w<I;w+=Et)if(e[w]===71){const B=!!(e[w+1]&64),$=Vf(e,w),U=(e[w+3]&48)>>4;let W;if(U>1){if(W=w+5+e[w+4],W===w+Et)continue}else W=w+4;switch($){case g:B&&(m&&(a=ar(m,this.logger))&&(this.readyVideoParser(u.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(u,d,a,!1)),m={data:[],size:0}),m&&(m.data.push(e.subarray(W,w+Et)),m.size+=w+Et-W);break;case v:if(B){if(S&&(a=ar(S,this.logger)))switch(c.segmentCodec){case"aac":this.parseAACPES(c,a);break;case"mp3":this.parseMPEGPES(c,a);break;case"ac3":this.parseAC3PES(c,a);break}S={data:[],size:0}}S&&(S.data.push(e.subarray(W,w+Et)),S.size+=w+Et-W);break;case E:B&&(x&&(a=ar(x,this.logger))&&this.parseID3PES(h,a),x={data:[],size:0}),x&&(x.data.push(e.subarray(W,w+Et)),x.size+=w+Et-W);break;case 0:B&&(W+=e[W]+1),_=this._pmtId=OL(e,W);break;case _:{B&&(W+=e[W]+1);const ne=wL(e,W,this.typeSupported,s,this.observer,this.logger);g=ne.videoPid,g>0&&(u.pid=g,u.segmentCodec=ne.segmentVideoCodec),v=ne.audioPid,v>0&&(c.pid=v,c.segmentCodec=ne.segmentAudioCodec),E=ne.id3Pid,E>0&&(h.pid=E),T!==null&&!L&&(this.logger.warn(`MPEG-TS PMT found at ${w} after unknown PID '${T}'. Backtracking to sync byte @${O} to parse all TS packets.`),T=null,w=O-188),L=this.pmtParsed=!0;break}case 17:case 8191:break;default:T=$;break}}else k++;k>0&&Yf(this.observer,new Error(`Found ${k} TS packet/s that do not start with 0x47`),void 0,this.logger),u.pesData=m,c.pesData=S,h.pesData=x;const K={audioTrack:c,videoTrack:u,id3Track:h,textTrack:d};return r&&this.extractRemainingSamples(K),K}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:r,textTrack:a}=e,u=s.pesData,c=t.pesData,h=r.pesData;let d;if(u&&(d=ar(u,this.logger))?(this.readyVideoParser(s.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(s,a,d,!0),s.pesData=null)):s.pesData=u,c&&(d=ar(c,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,d);break;case"mp3":this.parseMPEGPES(t,d);break;case"ac3":this.parseAC3PES(t,d);break}t.pesData=null}else c!=null&&c.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=c;h&&(d=ar(h,this.logger))?(this.parseID3PES(r,d),r.pesData=null):r.pesData=h}demuxSampleAes(e,t,s){const r=this.demux(e,s,!0,!this.config.progressive),a=this.sampleAes=new DL(this.observer,this.config,t);return this.decrypt(r,a)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new IL:e==="hevc"&&(this.videoParser=new CL))}decrypt(e,t){return new Promise(s=>{const{audioTrack:r,videoTrack:a}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{a.samples?t.decryptAvcSamples(a.samples,0,0,()=>{s(e)}):s(e)}):a.samples&&t.decryptAvcSamples(a.samples,0,0,()=>{s(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const r=this.aacOverFlow;let a=t.data;if(r){this.aacOverFlow=null;const m=r.missing,v=r.sample.unit.byteLength;if(m===-1)a=pi(r.sample.unit,a);else{const E=v-m;r.sample.unit.set(a.subarray(0,m),E),e.samples.push(r.sample),s=r.missing}}let u,c;for(u=s,c=a.length;u<c-1&&!Po(a,u);u++);if(u!==s){let m;const v=u<c-1;if(v?m=`AAC PES did not start with ADTS header,offset:${u}`:m="No ADTS header found in AAC PES",Yf(this.observer,new Error(m),v,this.logger),!v)return}gv(e,this.observer,a,u,this.audioCodec);let h;if(t.pts!==void 0)h=t.pts;else if(r){const m=mv(e.samplerate);h=r.sample.pts+m}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let d=0,g;for(;u<c;)if(g=pv(e,a,u,h,d),u+=g.length,g.missing){this.aacOverFlow=g;break}else for(d++;u<c-1&&!Po(a,u);u++);}parseMPEGPES(e,t){const s=t.data,r=s.length;let a=0,u=0;const c=t.pts;if(c===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;u<r;)if(Tv(s,u)){const h=Ev(e,s,u,c,a);if(h)u+=h.length,a++;else break}else u++}parseAC3PES(e,t){{const s=t.data,r=t.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const a=s.length;let u=0,c=0,h;for(;c<a&&(h=bv(e,s,c,r,u++))>0;)c+=h}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const s=Ve({},t,{type:this._videoTrack?ti.emsg:ti.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function Vf(l,e){return((l[e+1]&31)<<8)+l[e+2]}function OL(l,e){return(l[e+10]&31)<<8|l[e+11]}function wL(l,e,t,s,r,a){const u={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},c=(l[e+1]&15)<<8|l[e+2],h=e+3+c-4,d=(l[e+10]&15)<<8|l[e+11];for(e+=12+d;e<h;){const g=Vf(l,e),m=(l[e+3]&15)<<8|l[e+4];switch(l[e]){case 207:if(!s){Sf("ADTS AAC",a);break}case 15:u.audioPid===-1&&(u.audioPid=g);break;case 21:u.id3Pid===-1&&(u.id3Pid=g);break;case 219:if(!s){Sf("H.264",a);break}case 27:u.videoPid===-1&&(u.videoPid=g);break;case 3:case 4:!t.mpeg&&!t.mp3?a.log("MPEG audio found, not supported in this browser"):u.audioPid===-1&&(u.audioPid=g,u.segmentAudioCodec="mp3");break;case 193:if(!s){Sf("AC-3",a);break}case 129:t.ac3?u.audioPid===-1&&(u.audioPid=g,u.segmentAudioCodec="ac3"):a.log("AC-3 audio found, not supported in this browser");break;case 6:if(u.audioPid===-1&&m>0){let v=e+5,E=m;for(;E>2;){l[v]===106&&(t.ac3!==!0?a.log("AC-3 audio found, not supported in this browser for now"):(u.audioPid=g,u.segmentAudioCodec="ac3"));const x=l[v+1]+2;v+=x,E-=x}}break;case 194:case 135:return Yf(r,new Error("Unsupported EC-3 in M2TS found"),void 0,a),u;case 36:u.videoPid===-1&&(u.videoPid=g,u.segmentVideoCodec="hevc",a.log("HEVC in M2TS found"));break}e+=m+5}return u}function Yf(l,e,t,s){s.warn(`parsing error: ${e.message}`),l.emit(b.ERROR,b.ERROR,{type:ye.MEDIA_ERROR,details:H.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Sf(l,e){e.log(`${l} with AES-128-CBC encryption found in unencrypted stream`)}function ar(l,e){let t=0,s,r,a,u,c;const h=l.data;if(!l||l.size===0)return null;for(;h[0].length<19&&h.length>1;)h[0]=pi(h[0],h[1]),h.splice(1,1);if(s=h[0],(s[0]<<16)+(s[1]<<8)+s[2]===1){if(r=(s[4]<<8)+s[5],r&&r>l.size-6)return null;const g=s[7];g&192&&(u=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,g&64?(c=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,u-c>60*9e4&&(e.warn(`${Math.round((u-c)/9e4)}s delta between PTS and DTS, align them`),u=c)):c=u),a=s[8];let m=a+9;if(l.size<=m)return null;l.size-=m;const v=new Uint8Array(l.size);for(let E=0,S=h.length;E<S;E++){s=h[E];let x=s.byteLength;if(m)if(m>x){m-=x;continue}else s=s.subarray(m),x-=m,m=0;v.set(s,t),t+=x}return r&&(r-=a+3),{data:v,pts:u,dts:c,len:r}}return null}class ML{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Fs=Math.pow(2,32)-1;class j{static init(){j.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in j.types)j.types.hasOwnProperty(e)&&(j.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);j.HDLR_TYPES={video:t,audio:s};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);j.STTS=j.STSC=j.STCO=a,j.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),j.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),j.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),j.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const u=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),h=new Uint8Array([0,0,0,1]);j.FTYP=j.box(j.types.ftyp,u,h,u,c),j.DINF=j.box(j.types.dinf,j.box(j.types.dref,r))}static box(e,...t){let s=8,r=t.length;const a=r;for(;r--;)s+=t[r].byteLength;const u=new Uint8Array(s);for(u[0]=s>>24&255,u[1]=s>>16&255,u[2]=s>>8&255,u[3]=s&255,u.set(e,4),r=0,s=8;r<a;r++)u.set(t[r],s),s+=t[r].byteLength;return u}static hdlr(e){return j.box(j.types.hdlr,j.HDLR_TYPES[e])}static mdat(e){return j.box(j.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(Fs+1)),r=Math.floor(t%(Fs+1));return j.box(j.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return j.box(j.types.mdia,j.mdhd(e.timescale||0,e.duration||0),j.hdlr(e.type),j.minf(e))}static mfhd(e){return j.box(j.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?j.box(j.types.minf,j.box(j.types.smhd,j.SMHD),j.DINF,j.stbl(e)):j.box(j.types.minf,j.box(j.types.vmhd,j.VMHD),j.DINF,j.stbl(e))}static moof(e,t,s){return j.box(j.types.moof,j.mfhd(e),j.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=j.trak(e[t]);return j.box.apply(null,[j.types.moov,j.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(j.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=j.trex(e[t]);return j.box.apply(null,[j.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(Fs+1)),r=Math.floor(t%(Fs+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return j.box(j.types.mvhd,a)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let r,a;for(r=0;r<t.length;r++)a=t[r].flags,s[r+4]=a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy;return j.box(j.types.sdtp,s)}static stbl(e){return j.box(j.types.stbl,j.stsd(e),j.box(j.types.stts,j.STTS),j.box(j.types.stsc,j.STSC),j.box(j.types.stsz,j.STSZ),j.box(j.types.stco,j.STCO))}static avc1(e){let t=[],s=[],r,a,u;for(r=0;r<e.sps.length;r++)a=e.sps[r],u=a.byteLength,t.push(u>>>8&255),t.push(u&255),t=t.concat(Array.prototype.slice.call(a));for(r=0;r<e.pps.length;r++)a=e.pps[r],u=a.byteLength,s.push(u>>>8&255),s.push(u&255),s=s.concat(Array.prototype.slice.call(a));const c=j.box(j.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(s))),h=e.width,d=e.height,g=e.pixelRatio[0],m=e.pixelRatio[1];return j.box(j.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,j.box(j.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),j.box(j.types.pasp,new Uint8Array([g>>24,g>>16&255,g>>8&255,g&255,m>>24,m>>16&255,m>>8&255,m&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return j.box(j.types.mp4a,j.audioStsd(e),j.box(j.types.esds,j.esds(e)))}static mp3(e){return j.box(j.types[".mp3"],j.audioStsd(e))}static ac3(e){return j.box(j.types["ac-3"],j.audioStsd(e),j.box(j.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return j.box(j.types.stsd,j.STSD,j.mp4a(e));if(t==="ac3"&&e.config)return j.box(j.types.stsd,j.STSD,j.ac3(e));if(t==="mp3"&&e.codec==="mp3")return j.box(j.types.stsd,j.STSD,j.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return j.box(j.types.stsd,j.STSD,j.avc1(e));if(t==="hevc"&&e.vps)return j.box(j.types.stsd,j.STSD,j.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),r=e.width||0,a=e.height||0,u=Math.floor(s/(Fs+1)),c=Math.floor(s%(Fs+1));return j.box(j.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,u>>24,u>>16&255,u>>8&255,u&255,c>>24,c>>16&255,c>>8&255,c&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,a>>8&255,a&255,0,0]))}static traf(e,t){const s=j.sdtp(e),r=e.id,a=Math.floor(t/(Fs+1)),u=Math.floor(t%(Fs+1));return j.box(j.types.traf,j.box(j.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),j.box(j.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,u>>24,u>>16&255,u>>8&255,u&255])),j.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,j.box(j.types.trak,j.tkhd(e),j.mdia(e))}static trex(e){const t=e.id;return j.box(j.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],r=s.length,a=12+16*r,u=new Uint8Array(a);let c,h,d,g,m,v;for(t+=8+a,u.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),c=0;c<r;c++)h=s[c],d=h.duration,g=h.size,m=h.flags,v=h.cts,u.set([d>>>24&255,d>>>16&255,d>>>8&255,d&255,g>>>24&255,g>>>16&255,g>>>8&255,g&255,m.isLeading<<2|m.dependsOn,m.isDependedOn<<6|m.hasRedundancy<<4|m.paddingValue<<1|m.isNonSync,m.degradPrio&61440,m.degradPrio&15,v>>>24&255,v>>>16&255,v>>>8&255,v&255],12+16*c);return j.box(j.types.trun,u)}static initSegment(e){j.types||j.init();const t=j.moov(e);return pi(j.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],r=4,a=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),r-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let u=a.length;for(let S=0;S<s.length;S+=1){u+=3;for(let x=0;x<s[S].length;x+=1)u+=2+s[S][x].length}const c=new Uint8Array(u);c.set(a,0),u=a.length;const h=s.length-1;for(let S=0;S<s.length;S+=1){c.set(new Uint8Array([32+S|(S===h?128:0),0,s[S].length]),u),u+=3;for(let x=0;x<s[S].length;x+=1)c.set(new Uint8Array([s[S][x].length>>8,s[S][x].length&255]),u),u+=2,c.set(s[S][x],u),u+=s[S][x].length}const d=j.box(j.types.hvcC,c),g=e.width,m=e.height,v=e.pixelRatio[0],E=e.pixelRatio[1];return j.box(j.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,g>>8&255,g&255,m>>8&255,m&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,j.box(j.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),j.box(j.types.pasp,new Uint8Array([v>>24,v>>16&255,v>>8&255,v&255,E>>24,E>>16&255,E>>8&255,E&255])))}}j.types=void 0;j.HDLR_TYPES=void 0;j.STTS=void 0;j.STSC=void 0;j.STCO=void 0;j.STSZ=void 0;j.VMHD=void 0;j.SMHD=void 0;j.STSD=void 0;j.FTYP=void 0;j.DINF=void 0;const Rv=9e4;function Ld(l,e,t=1,s=!1){const r=l*e*t;return s?Math.round(r):r}function kL(l,e,t=1,s=!1){return Ld(l,e,1/t,s)}function ya(l,e=!1){return Ld(l,1e3,1/Rv,e)}function NL(l,e=1){return Ld(l,Rv,1/e)}function Mp(l){const{baseTime:e,timescale:t,trackId:s}=l;return`${e/t} (${e}/${t}) trackId: ${s}`}const PL=10*1e3,UL=1024,FL=1152,BL=1536;let lr=null,Tf=null;function kp(l,e,t,s){return{duration:e,size:t,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:l?2:1,isNonSync:l?0:1}}}class To extends vi{constructor(e,t,s,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.ISGenerated=!1,lr===null){const u=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);lr=u?parseInt(u[1]):0}if(Tf===null){const a=navigator.userAgent.match(/Safari\/(\d+)/i);Tf=a?parseInt(a[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&Mp(t)} > ${e&&Mp(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,r=e.reduce((a,u)=>{let c=u.pts,h=c-a;return h<-4294967296&&(t=!0,c=ei(c,s),h=c-a),h>0?a:c},s);return t&&this.debug("PTS rollover detected"),r}remux(e,t,s,r,a,u,c,h){let d,g,m,v,E,S,x=a,T=a;const L=e.pid>-1,_=t.pid>-1,I=t.samples.length,O=e.samples.length>0,k=c&&I>0||I>1;if((!L||O)&&(!_||k)||this.ISGenerated||c){if(this.ISGenerated){var w,B,$,U;const he=this.videoTrackConfig;(he&&(t.width!==he.width||t.height!==he.height||((w=t.pixelRatio)==null?void 0:w[0])!==((B=he.pixelRatio)==null?void 0:B[0])||(($=t.pixelRatio)==null?void 0:$[1])!==((U=he.pixelRatio)==null?void 0:U[1]))||!he&&k||this.nextAudioTs===null&&O)&&this.resetInitSegment()}this.ISGenerated||(m=this.generateIS(e,t,a,u));const W=this.isVideoContiguous;let ne=-1,ce;if(k&&(ne=$L(t.samples),!W&&this.config.forceKeyFrameOnDiscontinuity))if(S=!0,ne>0){this.warn(`Dropped ${ne} out of ${I} video samples due to a missing keyframe`);const he=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(ne),t.dropped+=ne,T+=(t.samples[0].pts-he)/t.inputTimeScale,ce=T}else ne===-1&&(this.warn(`No keyframe found out of ${I} video samples`),S=!1);if(this.ISGenerated){if(O&&k){const he=this.getVideoStartPts(t.samples),N=(ei(e.samples[0].pts,he)-he)/t.inputTimeScale;x+=Math.max(0,N),T+=Math.max(0,-N)}if(O){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),m=this.generateIS(e,t,a,u)),g=this.remuxAudio(e,x,this.isAudioContiguous,u,_||k||h===ge.AUDIO?T:void 0),k){const he=g?g.endPTS-g.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),m=this.generateIS(e,t,a,u)),d=this.remuxVideo(t,T,W,he)}}else k&&(d=this.remuxVideo(t,T,W,0));d&&(d.firstKeyFrame=ne,d.independent=ne!==-1,d.firstKeyFramePTS=ce)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(E=_v(s,a,this._initPTS,this._initDTS)),r.samples.length&&(v=Dv(r,a,this._initPTS))),{audio:g,video:d,initSegment:m,independent:S,text:v,id3:E}}computeInitPts(e,t,s,r){const a=Math.round(s*t);let u=ei(e,a);if(u<a+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(a-u)/t} ${r}`);u<a+t;)u+=8589934592;return u-a}generateIS(e,t,s,r){const a=e.samples,u=t.samples,c=this.typeSupported,h={},d=this._initPTS;let g=!d||r,m="audio/mp4",v,E,S,x=-1;if(g&&(v=E=1/0),e.config&&a.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":c.mpeg?(m="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}h.audio={id:"audio",container:m,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&c.mpeg?new Uint8Array(0):j.initSegment([e]),metadata:{channelCount:e.channelCount}},g&&(x=e.id,S=e.inputTimeScale,!d||S!==d.timescale?v=E=this.computeInitPts(a[0].pts,S,s,"audio"):g=!1)}if(t.sps&&t.pps&&u.length){if(t.timescale=t.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:j.initSegment([t]),metadata:{width:t.width,height:t.height}},g)if(x=t.id,S=t.inputTimeScale,!d||S!==d.timescale){const T=this.getVideoStartPts(u),L=ei(u[0].dts,T),_=this.computeInitPts(L,S,s,"video"),I=this.computeInitPts(T,S,s,"video");E=Math.min(E,_),v=Math.min(v,I)}else g=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(h).length)return this.ISGenerated=!0,g?(d&&this.warn(`Timestamps at playlist time: ${r?"":"~"}${s} ${v/S} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${v/S} (${v}/${S}) trackId: ${x}`),this._initPTS={baseTime:v,timescale:S,trackId:x},this._initDTS={baseTime:E,timescale:S,trackId:x}):v=S=void 0,{tracks:h,initPTS:v,timescale:S,trackId:x}}remuxVideo(e,t,s,r){const a=e.inputTimeScale,u=e.samples,c=[],h=u.length,d=this._initPTS,g=d.baseTime*a/d.timescale;let m=this.nextVideoTs,v=8,E=this.videoSampleDuration,S,x,T=Number.POSITIVE_INFINITY,L=Number.NEGATIVE_INFINITY,_=!1;if(!s||m===null){const C=g+t*a,F=u[0].pts-ei(u[0].dts,u[0].pts);lr&&m!==null&&Math.abs(C-F-(m+g))<15e3?s=!0:m=C-F-g}const I=m+g;for(let C=0;C<h;C++){const F=u[C];F.pts=ei(F.pts,I),F.dts=ei(F.dts,I),F.dts<u[C>0?C-1:C].dts&&(_=!0)}_&&u.sort(function(C,F){const se=C.dts-F.dts,re=C.pts-F.pts;return se||re}),S=u[0].dts,x=u[u.length-1].dts;const O=x-S,k=O?Math.round(O/(h-1)):E||e.inputTimeScale/30;if(s){const C=S-I,F=C>k,se=C<-1;if((F||se)&&(F?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ya(C,!0)} ms (${C}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ya(-C,!0)} ms (${C}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!se||I>=u[0].pts||lr)){S=I;const re=u[0].pts-C;if(F)u[0].dts=S,u[0].pts=re;else{let le=!0;for(let de=0;de<u.length&&!(u[de].dts>re&&le);de++){const Se=u[de].pts;if(u[de].dts-=C,u[de].pts-=C,de<u.length-1){const Ne=u[de+1].pts,ke=u[de].pts,Dt=Ne<=ke,ni=Ne<=Se;le=Dt==ni}}}this.log(`Video: Initial PTS/DTS adjusted: ${ya(re,!0)}/${ya(S,!0)}, delta: ${ya(C,!0)} ms`)}}S=Math.max(0,S);let K=0,w=0,B=S;for(let C=0;C<h;C++){const F=u[C],se=F.units,re=se.length;let le=0;for(let de=0;de<re;de++)le+=se[de].data.length;w+=le,K+=re,F.length=le,F.dts<B?(F.dts=B,B+=k/4|0||1):B=F.dts,T=Math.min(F.pts,T),L=Math.max(F.pts,L)}x=u[h-1].dts;const $=w+4*K+8;let U;try{U=new Uint8Array($)}catch(C){this.observer.emit(b.ERROR,b.ERROR,{type:ye.MUX_ERROR,details:H.REMUX_ALLOC_ERROR,fatal:!1,error:C,bytes:$,reason:`fail allocating video mdat ${$}`});return}const W=new DataView(U.buffer);W.setUint32(0,$),U.set(j.types.mdat,4);let ne=!1,ce=Number.POSITIVE_INFINITY,he=Number.POSITIVE_INFINITY,oe=Number.NEGATIVE_INFINITY,N=Number.NEGATIVE_INFINITY;for(let C=0;C<h;C++){const F=u[C],se=F.units;let re=0;for(let Se=0,Ne=se.length;Se<Ne;Se++){const ke=se[Se],Dt=ke.data,ni=ke.data.byteLength;W.setUint32(v,ni),v+=4,U.set(Dt,v),v+=ni,re+=4+ni}let le;if(C<h-1)E=u[C+1].dts-F.dts,le=u[C+1].pts-F.pts;else{const Se=this.config,Ne=C>0?F.dts-u[C-1].dts:k;if(le=C>0?F.pts-u[C-1].pts:k,Se.stretchShortVideoTrack&&this.nextAudioTs!==null){const ke=Math.floor(Se.maxBufferHole*a),Dt=(r?T+r*a:this.nextAudioTs+g)-F.pts;Dt>ke?(E=Dt-Ne,E<0?E=Ne:ne=!0,this.log(`It is approximately ${Dt/90} ms to the next segment; using duration ${E/90} ms for the last video frame.`)):E=Ne}else E=Ne}const de=Math.round(F.pts-F.dts);ce=Math.min(ce,E),oe=Math.max(oe,E),he=Math.min(he,le),N=Math.max(N,le),c.push(kp(F.key,E,re,de))}if(c.length){if(lr){if(lr<70){const C=c[0].flags;C.dependsOn=2,C.isNonSync=0}}else if(Tf&&N-he<oe-ce&&k/oe<.025&&c[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let C=S;for(let F=0,se=c.length;F<se;F++){const re=C+c[F].duration,le=C+c[F].cts;if(F<se-1){const de=re+c[F+1].cts;c[F].duration=de-le}else c[F].duration=F?c[F-1].duration:k;c[F].cts=0,C=re}}}E=ne||!E?k:E;const X=x+E;this.nextVideoTs=m=X-g,this.videoSampleDuration=E,this.isVideoContiguous=!0;const ue={data1:j.moof(e.sequenceNumber++,S,Ve(e,{samples:c})),data2:U,startPTS:(T-g)/a,endPTS:(L+E-g)/a,startDTS:(S-g)/a,endDTS:m/a,type:"video",hasAudio:!1,hasVideo:!0,nb:c.length,dropped:e.dropped};return e.samples=[],e.dropped=0,ue}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return FL;case"ac3":return BL;default:return UL}}remuxAudio(e,t,s,r,a){const u=e.inputTimeScale,c=e.samplerate?e.samplerate:u,h=u/c,d=this.getSamplesPerFrame(e),g=d*h,m=this._initPTS,v=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,E=[],S=a!==void 0;let x=e.samples,T=v?0:8,L=this.nextAudioTs||-1;const _=m.baseTime*u/m.timescale,I=_+t*u;if(this.isAudioContiguous=s=s||x.length&&L>0&&(r&&Math.abs(I-(L+_))<9e3||Math.abs(ei(x[0].pts,I)-(L+_))<20*g),x.forEach(function(N){N.pts=ei(N.pts,I)}),!s||L<0){const N=x.length;if(x=x.filter(X=>X.pts>=0),N!==x.length&&this.warn(`Removed ${x.length-N} of ${N} samples (initPTS ${_} / ${u})`),!x.length)return;a===0?L=0:r&&!S?L=Math.max(0,I-_):L=x[0].pts-_}if(e.segmentCodec==="aac"){const N=this.config.maxAudioFramesDrift;for(let X=0,J=L+_;X<x.length;X++){const ae=x[X],ue=ae.pts,C=ue-J,F=Math.abs(1e3*C/u);if(C<=-N*g&&S)X===0&&(this.warn(`Audio frame @ ${(ue/u).toFixed(3)}s overlaps marker by ${Math.round(1e3*C/u)} ms.`),this.nextAudioTs=L=ue-_,J=ue);else if(C>=N*g&&F<PL&&S){let se=Math.round(C/g);for(J=ue-se*g;J<0&&se&&g;)se--,J+=g;X===0&&(this.nextAudioTs=L=J-_),this.warn(`Injecting ${se} audio frames @ ${((J-_)/u).toFixed(3)}s due to ${Math.round(1e3*C/u)} ms gap.`);for(let re=0;re<se;re++){let le=ML.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);le||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),le=ae.unit.subarray()),x.splice(X,0,{unit:le,pts:J}),J+=g,X++}}ae.pts=J,J+=g}}let O=null,k=null,K,w=0,B=x.length;for(;B--;)w+=x[B].unit.byteLength;for(let N=0,X=x.length;N<X;N++){const J=x[N],ae=J.unit;let ue=J.pts;if(k!==null){const F=E[N-1];F.duration=Math.round((ue-k)/h)}else if(s&&e.segmentCodec==="aac"&&(ue=L+_),O=ue,w>0){w+=T;try{K=new Uint8Array(w)}catch(F){this.observer.emit(b.ERROR,b.ERROR,{type:ye.MUX_ERROR,details:H.REMUX_ALLOC_ERROR,fatal:!1,error:F,bytes:w,reason:`fail allocating audio mdat ${w}`});return}v||(new DataView(K.buffer).setUint32(0,w),K.set(j.types.mdat,4))}else return;K.set(ae,T);const C=ae.byteLength;T+=C,E.push(kp(!0,d,C,0)),k=ue}const $=E.length;if(!$)return;const U=E[E.length-1];L=k-_,this.nextAudioTs=L+h*U.duration;const W=v?new Uint8Array(0):j.moof(e.sequenceNumber++,O/h,Ve({},e,{samples:E}));e.samples=[];const ne=(O-_)/u,ce=this.nextAudioTs/u,oe={data1:W,data2:K,startPTS:ne,endPTS:ce,startDTS:ne,endDTS:ce,type:"audio",hasAudio:!0,hasVideo:!1,nb:$};return this.isAudioContiguous=!0,oe}}function ei(l,e){let t;if(e===null)return l;for(e<l?t=-8589934592:t=8589934592;Math.abs(l-e)>4294967296;)l+=t;return l}function $L(l){for(let e=0;e<l.length;e++)if(l[e].key)return e;return-1}function _v(l,e,t,s){const r=l.samples.length;if(!r)return;const a=l.inputTimeScale;for(let c=0;c<r;c++){const h=l.samples[c];h.pts=ei(h.pts-t.baseTime*a/t.timescale,e*a)/a,h.dts=ei(h.dts-s.baseTime*a/s.timescale,e*a)/a}const u=l.samples;return l.samples=[],{samples:u}}function Dv(l,e,t){const s=l.samples.length;if(!s)return;const r=l.inputTimeScale;for(let u=0;u<s;u++){const c=l.samples[u];c.pts=ei(c.pts-t.baseTime*r/t.timescale,e*r)/r}l.samples.sort((u,c)=>u.pts-c.pts);const a=l.samples;return l.samples=[],{samples:a}}class GL extends vi{constructor(e,t,s,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,s,r){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:s,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:a,video:u}=this.initData=ky(e);if(t)DA(e,t);else{const h=a||u;h!=null&&h.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${h.codec}")!`)}a&&(s=Np(a,qe.AUDIO,this)),u&&(r=Np(u,qe.VIDEO,this));const c={};a&&u?c.audiovideo={container:"video/mp4",codec:s+","+r,supplemental:u.supplemental,encrypted:u.encrypted,initSegment:e,id:"main"}:a?c.audio={container:"audio/mp4",codec:s,encrypted:a.encrypted,initSegment:e,id:"audio"}:u?c.video={container:"video/mp4",codec:r,supplemental:u.supplemental,encrypted:u.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=c}remux(e,t,s,r,a,u){var c,h;let{initPTS:d,lastEndTime:g}=this;const m={audio:void 0,video:void 0,text:r,id3:s,initSegment:void 0};fe(g)||(g=this.lastEndTime=a||0);const v=t.samples;if(!v.length)return m;const E={initPTS:void 0,timescale:void 0,trackId:void 0};let S=this.initData;if((c=S)!=null&&c.length||(this.generateInitSegment(v),S=this.initData),!((h=S)!=null&&h.length))return this.warn("Failed to generate initSegment."),m;this.emitInitSegment&&(E.tracks=this.initTracks,this.emitInitSegment=!1);const x=CA(v,S,this),T=S.audio?x[S.audio.id]:null,L=S.video?x[S.video.id]:null,_=ao(L,1/0),I=ao(T,1/0),O=ao(L,0,!0),k=ao(T,0,!0);let K=a,w=0;const B=T&&(!L||!d&&I<_||d&&d.trackId===S.audio.id),$=B?T:L;if($){const J=$.timescale,ae=$.start-a*J,ue=B?S.audio.id:S.video.id;K=$.start/J,w=B?k-I:O-_,(u||!d)&&(jL(d,K,a,w)||J!==d.timescale)&&(d&&this.warn(`Timestamps at playlist time: ${u?"":"~"}${a} ${ae/J} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${a} offset: ${K-a} (${ae}/${J}) trackId: ${ue}`),d=null,E.initPTS=ae,E.timescale=J,E.trackId=ue)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${a}`);d?(E.initPTS=d.baseTime,E.timescale=d.timescale,E.trackId=d.trackId):((!E.timescale||E.trackId===void 0||E.initPTS===void 0)&&(this.warn("Could not set initPTS"),E.initPTS=K,E.timescale=1,E.trackId=-1),this.initPTS=d={baseTime:E.initPTS,timescale:E.timescale,trackId:E.trackId});const U=K-d.baseTime/d.timescale,W=U+w;w>0?this.lastEndTime=W:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const ne=!!S.audio,ce=!!S.video;let he="";ne&&(he+="audio"),ce&&(he+="video");const oe=(S.audio?S.audio.encrypted:!1)||(S.video?S.video.encrypted:!1),N={data1:v,startPTS:U,startDTS:U,endPTS:W,endDTS:W,type:he,hasAudio:ne,hasVideo:ce,nb:1,dropped:0,encrypted:oe};m.audio=ne&&!ce?N:void 0,m.video=ce?N:void 0;const X=L?.sampleCount;if(X){const J=L.keyFrameIndex,ae=J!==-1;N.nb=X,N.dropped=J===0||this.isVideoContiguous?0:ae?J:X,N.independent=ae,N.firstKeyFrame=J,ae&&L.keyFrameStart&&(N.firstKeyFramePTS=(L.keyFrameStart-d.baseTime)/d.timescale),this.isVideoContiguous||(m.independent=ae),this.isVideoContiguous||(this.isVideoContiguous=ae),N.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${J}/${X} dropped: ${N.dropped} start: ${N.firstKeyFramePTS||"NA"}`)}return m.initSegment=E,m.id3=_v(s,a,d,d),r.samples.length&&(m.text=Dv(r,a,d)),m}}function ao(l,e,t=!1){return l?.start!==void 0?(l.start+(t?l.duration:0))/l.timescale:e}function jL(l,e,t,s){if(l===null)return!0;const r=Math.max(s,1),a=e-l.baseTime/l.timescale;return Math.abs(a-t)>r}function Np(l,e,t){const s=l.codec;return s&&s.length>4?s:e===qe.AUDIO?s==="ec-3"||s==="ac-3"||s==="alac"?s:s==="fLaC"||s==="Opus"?Do(s,!1):(t.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"):(t.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1")}let os;try{os=self.performance.now.bind(self.performance)}catch{os=Date.now}const xo=[{demux:_L,remux:GL},{demux:Gs,remux:To},{demux:AL,remux:To},{demux:LL,remux:To}];xo.splice(2,0,{demux:bL,remux:To});class Pp{constructor(e,t,s,r,a,u){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=a,this.logger=u}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,r){const a=s.transmuxing;a.executeStart=os();let u=new Uint8Array(e);const{currentTransmuxState:c,transmuxConfig:h}=this;r&&(this.currentTransmuxState=r);const{contiguous:d,discontinuity:g,trackSwitch:m,accurateTimeOffset:v,timeOffset:E,initSegmentChange:S}=r||c,{audioCodec:x,videoCodec:T,defaultInitPts:L,duration:_,initSegmentData:I}=h,O=HL(u,t);if(O&&dr(O.method)){const B=this.getDecrypter(),$=pd(O.method);if(B.isSync()){let U=B.softwareDecrypt(u,O.key.buffer,O.iv.buffer,$);if(s.part>-1){const ne=B.flush();U=ne&&ne.buffer}if(!U)return a.executeEnd=os(),xf(s);u=new Uint8Array(U)}else return this.asyncResult=!0,this.decryptionPromise=B.webCryptoDecrypt(u,O.key.buffer,O.iv.buffer,$).then(U=>{const W=this.push(U,null,s);return this.decryptionPromise=null,W}),this.decryptionPromise}const k=this.needsProbing(g,m);if(k){const B=this.configureTransmuxer(u);if(B)return this.logger.warn(`[transmuxer] ${B.message}`),this.observer.emit(b.ERROR,b.ERROR,{type:ye.MEDIA_ERROR,details:H.FRAG_PARSING_ERROR,fatal:!1,error:B,reason:B.message}),a.executeEnd=os(),xf(s)}(g||m||S||k)&&this.resetInitSegment(I,x,T,_,t),(g||S||k)&&this.resetInitialTimestamp(L),d||this.resetContiguity();const K=this.transmux(u,O,E,v,s);this.asyncResult=Da(K);const w=this.currentTransmuxState;return w.contiguous=!0,w.discontinuity=!1,w.trackSwitch=!1,a.executeEnd=os(),K}flush(e){const t=e.transmuxing;t.executeStart=os();const{decrypter:s,currentTransmuxState:r,decryptionPromise:a}=this;if(a)return this.asyncResult=!0,a.then(()=>this.flush(e));const u=[],{timeOffset:c}=r;if(s){const m=s.flush();m&&u.push(this.push(m.buffer,null,e))}const{demuxer:h,remuxer:d}=this;if(!h||!d){t.executeEnd=os();const m=[xf(e)];return this.asyncResult?Promise.resolve(m):m}const g=h.flush(c);return Da(g)?(this.asyncResult=!0,g.then(m=>(this.flushRemux(u,m,e),u))):(this.flushRemux(u,g,e),this.asyncResult?Promise.resolve(u):u)}flushRemux(e,t,s){const{audioTrack:r,videoTrack:a,id3Track:u,textTrack:c}=t,{accurateTimeOffset:h,timeOffset:d}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===ge.MAIN?"level":"track"} ${s.level}`);const g=this.remuxer.remux(r,a,u,c,d,h,!0,this.id);e.push({remuxResult:g,chunkMeta:s}),s.transmuxing.executeEnd=os()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;!t||!s||(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,r,a){const{demuxer:u,remuxer:c}=this;!u||!c||(u.resetInitSegment(e,t,s,r),c.resetInitSegment(e,t,s,a))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,r,a){let u;return t&&t.method==="SAMPLE-AES"?u=this.transmuxSampleAes(e,t,s,r,a):u=this.transmuxUnencrypted(e,s,r,a),u}transmuxUnencrypted(e,t,s,r){const{audioTrack:a,videoTrack:u,id3Track:c,textTrack:h}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(a,u,c,h,t,s,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,s,r,a){return this.demuxer.demuxSampleAes(e,t,s).then(u=>({remuxResult:this.remuxer.remux(u.audioTrack,u.videoTrack,u.id3Track,u.textTrack,s,r,!1,this.id),chunkMeta:a}))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:r}=this;let a;for(let m=0,v=xo.length;m<v;m++){var u;if((u=xo[m].demux)!=null&&u.probe(e,this.logger)){a=xo[m];break}}if(!a)return new Error("Failed to find demuxer by probing fragment data");const c=this.demuxer,h=this.remuxer,d=a.remux,g=a.demux;(!h||!(h instanceof d))&&(this.remuxer=new d(s,t,r,this.logger)),(!c||!(c instanceof g))&&(this.demuxer=new g(s,t,r,this.logger),this.probe=g.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new gd(this.config)),e}}function HL(l,e){let t=null;return l.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const xf=l=>({remuxResult:{},chunkMeta:l});function Da(l){return"then"in l&&l.then instanceof Function}class KL{constructor(e,t,s,r,a){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=r,this.defaultInitPts=a||null}}class zL{constructor(e,t,s,r,a,u){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=r,this.timeOffset=a,this.initSegmentChange=u}}let Up=0;class Iv{constructor(e,t,s,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Up++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=h=>{const d=h.data,g=this.hls;if(!(!g||!(d!=null&&d.event)||d.instanceNo!==this.instanceNo))switch(d.event){case"init":{var m;const v=(m=this.workerContext)==null?void 0:m.objectURL;v&&self.URL.revokeObjectURL(v);break}case"transmuxComplete":{this.handleTransmuxComplete(d.data);break}case"flush":{this.onFlush(d.data);break}case"workerLog":{g.logger[d.data.logType]&&g.logger[d.data.logType](d.data.message);break}default:{d.data=d.data||{},d.data.frag=this.frag,d.data.part=this.part,d.data.id=this.id,g.trigger(d.event,d.data);break}}},this.onWorkerError=h=>{if(!this.hls)return;const d=new Error(`${h.message}  (${h.filename}:${h.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(b.ERROR,{type:ye.OTHER_ERROR,details:H.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:d})};const a=e.config;this.hls=e,this.id=t,this.useWorker=!!a.enableWorker,this.onTransmuxComplete=s,this.onFlush=r;const u=(h,d)=>{d=d||{},d.frag=this.frag||void 0,h===b.ERROR&&(d=d,d.parent=this.id,d.part=this.part,this.error=d.error),this.hls.trigger(h,d)};this.observer=new Ed,this.observer.on(b.FRAG_DECRYPTED,u),this.observer.on(b.ERROR,u);const c=Z0(a.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const h=this.hls.logger;if(a.workerPath||Xb()){try{a.workerPath?(h.log(`loading Web Worker ${a.workerPath} for "${t}"`),this.workerContext=Wb(a.workerPath)):(h.log(`injecting Web Worker for "${t}"`),this.workerContext=Qb());const{worker:g}=this.workerContext;g.addEventListener("message",this.onWorkerMessage),g.addEventListener("error",this.onWorkerError),g.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:c,id:t,config:Xe(a)})}catch(g){h.warn(`Error setting up "${t}" Web Worker, fallback to inline`,g),this.terminateWorker(),this.error=null,this.transmuxer=new Pp(this.observer,c,a,"",t,e.logger)}return}}this.transmuxer=new Pp(this.observer,c,a,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Up++;const t=this.hls.config,s=Z0(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:Xe(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),Zb(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,r,a,u,c,h,d,g){var m,v;d.transmuxing.start=self.performance.now();const{instanceNo:E,transmuxer:S}=this,x=u?u.start:a.start,T=a.decryptdata,L=this.frag,_=!(L&&a.cc===L.cc),I=!(L&&d.level===L.level),O=L?d.sn-L.sn:-1,k=this.part?d.part-this.part.index:-1,K=O===0&&d.id>1&&d.id===L?.stats.chunkCount,w=!I&&(O===1||O===0&&(k===1||K&&k<=0)),B=self.performance.now();(I||O||a.stats.parsing.start===0)&&(a.stats.parsing.start=B),u&&(k||!w)&&(u.stats.parsing.start=B);const $=!(L&&((m=a.initSegment)==null?void 0:m.url)===((v=L.initSegment)==null?void 0:v.url)),U=new zL(_,w,h,I,x,$);if(!w||_||$){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${a.type} sn: ${d.sn}${d.part>-1?" part: "+d.part:""} ${this.id===ge.MAIN?"level":"track"}: ${d.level} id: ${d.id}
        discontinuity: ${_}
        trackSwitch: ${I}
        contiguous: ${w}
        accurateTimeOffset: ${h}
        timeOffset: ${x}
        initSegmentChange: ${$}`);const W=new KL(s,r,t,c,g);this.configureTransmuxer(W)}if(this.frag=a,this.part=u,this.workerContext)this.workerContext.worker.postMessage({instanceNo:E,cmd:"demux",data:e,decryptdata:T,chunkMeta:d,state:U},e instanceof ArrayBuffer?[e]:[]);else if(S){const W=S.push(e,T,d,U);Da(W)?W.then(ne=>{this.handleTransmuxComplete(ne)}).catch(ne=>{this.transmuxerError(ne,d,"transmuxer-interface push error")}):this.handleTransmuxComplete(W)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const r=s.flush(e);Da(r)?r.then(a=>{this.handleFlushResult(a,e)}).catch(a=>{this.transmuxerError(a,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(b.ERROR,{type:ye.MEDIA_ERROR,details:H.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach(s=>{this.handleTransmuxComplete(s)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Fp=100;class VL extends vd{constructor(e,t,s){super(e,t,s,"audio-stream-controller",ge.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(b.BUFFER_RESET,this.onBufferReset,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(b.FRAG_LOADING,this.onFragLoading,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(b.BUFFER_RESET,this.onBufferReset,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(b.FRAG_LOADING,this.onFragLoading,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:r,timescale:a,trackId:u}){if(s===ge.MAIN){const c=t.cc,h=this.fragCurrent;if(this.initPTS[c]={baseTime:r,timescale:a,trackId:u},this.log(`InitPTS for cc: ${c} found from main: ${r/a} (${r}/${a}) trackId: ${u}`),this.mainAnchor=t,this.state===ee.WAITING_INIT_PTS){const d=this.waitingData;(!d&&!this.loadingParts||d&&d.frag.cc!==c)&&this.syncWithAnchor(t,d?.frag)}else!this.hls.hasEnoughToStart&&h&&h.cc!==c?(h.abortRequests(),this.syncWithAnchor(t,h)):this.state===ee.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var s;const r=((s=this.mainFragLoading)==null?void 0:s.frag)||null;if(t&&r?.cc===t.cc)return;const a=(r||e).cc,u=this.getLevelDetails(),c=this.getLoadPosition(),h=zy(u,a,c);h&&(this.log(`Syncing with main frag at ${h.start} cc ${h.cc}`),this.startFragRequested=!1,this.nextLoadPosition=h.start,this.resetLoadingState(),this.state===ee.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=ee.STOPPED;return}const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(Fp),s>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=ee.IDLE):this.state=ee.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case ee.IDLE:this.doTickIdle();break;case ee.WAITING_TRACK:{const{levels:e,trackId:t}=this,s=e?.[t],r=s?.details;if(r&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(r))break;this.state=ee.WAITING_INIT_PTS}break}case ee.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case ee.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:s,cache:r,complete:a}=e,u=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=ee.FRAG_LOADING;const c=r.flush().buffer,h={frag:t,part:s,payload:c,networkDetails:null};this._handleFragmentLoadProgress(h),a&&super._handleFragmentLoadComplete(h)}else u&&u.cc!==e.frag.cc&&this.syncWithAnchor(u,e.frag)}else this.state=ee.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:r,trackId:a}=this,u=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!u.startFragPrefetch)||!(s!=null&&s[a]))return;const c=s[a],h=c.details;if(!h||this.waitForLive(c)||this.waitForCdnTuneIn(h)){this.state=ee.WAITING_TRACK,this.startFragRequested=!1;return}const d=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&d&&(this.bufferFlushed=!1,this.afterBufferFlushed(d,qe.AUDIO,ge.AUDIO));const g=this.getFwdBufferInfo(d,ge.AUDIO);if(g===null)return;if(!this.switchingTrack&&this._streamEnded(g,h)){t.trigger(b.BUFFER_EOS,{type:"audio"}),this.state=ee.ENDED;return}const m=g.len,v=t.maxBufferLength,E=h.fragments,S=E[0].start,x=this.getLoadPosition(),T=this.flushing?x:g.end;if(this.switchingTrack&&r){const I=x;h.PTSKnown&&I<S&&(g.end>S||g.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=S+.05)}if(m>=v&&!this.switchingTrack&&T<E[E.length-1].start)return;let L=this.getNextFragment(T,h);if(L&&this.isLoopLoading(L,T)&&(L=this.getNextFragmentLoopLoading(L,h,g,ge.MAIN,v)),!L){this.bufferFlushed=!0;return}let _=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&_&&lt(L)&&!L.endList&&(!h.live||!this.loadingParts&&T<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(_)===gt.OK&&(this.mainFragLoading=_=null),_&&lt(_))){if(L.start>_.end){const O=this.fragmentTracker.getFragAtPos(T,ge.MAIN);O&&O.end>_.end&&(_=O,this.mainFragLoading={frag:O,targetBufferTime:null})}if(L.start>_.end)return}this.loadFragment(L,c,T)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(s=>new La(s))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==ee.STOPPED&&(this.setInterval(Fp),this.state=ee.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(b.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:r}=this,{details:a,id:u,groupId:c,track:h}=t;if(!r){this.warn(`Audio tracks reset while loading track ${u} "${h.name}" of "${c}"`);return}const d=this.mainDetails;if(!d||a.endCC>d.endCC||d.expired){this.cachedTrackLoadedData=t,this.state!==ee.STOPPED&&(this.state=ee.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${u} "${h.name}" of "${c}" loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`);const g=r[u];let m=0;if(a.live||(s=g.details)!=null&&s.live){if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;if(g.details){var v;m=this.alignPlaylists(a,g.details,(v=this.levelLastLoaded)==null?void 0:v.details)}a.alignedSliding||(uv(a,d),a.alignedSliding||No(a,d),m=a.fragmentStart)}g.details=a,this.levelLastLoaded=g,this.startFragRequested||this.setStartPosition(d,m),this.hls.trigger(b.AUDIO_TRACK_UPDATED,{details:a,id:u,groupId:t.groupId}),this.state===ee.WAITING_TRACK&&!this.waitForCdnTuneIn(a)&&(this.state=ee.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:r,payload:a}=e,{config:u,trackId:c,levels:h}=this;if(!h){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const d=h[c];if(!d){this.warn("Audio track is undefined on fragment load progress");return}const g=d.details;if(!g){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(s.start);return}const m=u.defaultAudioCodec||d.audioCodec||"mp4a.40.2";let v=this.transmuxer;v||(v=this.transmuxer=new Iv(this.hls,ge.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const E=this.initPTS[s.cc],S=(t=s.initSegment)==null?void 0:t.data;if(E!==void 0){const T=r?r.index:-1,L=T!==-1,_=new md(s.level,s.sn,s.stats.chunkCount,a.byteLength,T,L);v.push(a,S,m,"",s,r,g.totalduration,!1,_,E)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${g.startSN} ,${g.endSN}],track ${c}`);const{cache:x}=this.waitingData=this.waitingData||{frag:s,part:r,cache:new cv,complete:!1};x.push(new Uint8Array(a)),this.state!==ee.STOPPED&&(this.state=ee.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===ge.MAIN&&lt(t.frag)&&(this.mainFragLoading=t,this.state===ee.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:s,part:r}=t;if(s.type!==ge.AUDIO){!this.audioOnly&&s.type===ge.MAIN&&!s.elementaryStreams.video&&!s.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${r?" p: "+r.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(lt(s)){this.fragPrevious=s;const a=this.switchingTrack;a&&(this.bufferedTrack=a,this.switchingTrack=null,this.hls.trigger(b.AUDIO_TRACK_SWITCHED,Ge({},a)))}this.fragBufferedComplete(s,r),this.media&&this.tick()}onError(e,t){var s;if(t.fatal){this.state=ee.ERROR;return}switch(t.details){case H.FRAG_GAP:case H.FRAG_PARSING_ERROR:case H.FRAG_DECRYPT_ERROR:case H.FRAG_LOAD_ERROR:case H.FRAG_LOAD_TIMEOUT:case H.KEY_LOAD_ERROR:case H.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ge.AUDIO,t);break;case H.AUDIO_TRACK_LOAD_ERROR:case H.AUDIO_TRACK_LOAD_TIMEOUT:case H.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ee.WAITING_TRACK&&((s=t.context)==null?void 0:s.type)===_e.AUDIO_TRACK&&(this.state=ee.IDLE);break;case H.BUFFER_ADD_CODEC_ERROR:case H.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case H.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case H.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==qe.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==qe.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ee.ENDED&&(this.state=ee.IDLE);const s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,t,ge.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:r}=this,{remuxResult:a,chunkMeta:u}=e,c=this.getCurrentContext(u);if(!c){this.resetWhenMissingContext(u);return}const{frag:h,part:d,level:g}=c,{details:m}=g,{audio:v,text:E,id3:S,initSegment:x}=a;if(this.fragContextChanged(h)||!m){this.fragmentTracker.removeFragment(h);return}if(this.state=ee.PARSING,this.switchingTrack&&v&&this.completeAudioSwitch(this.switchingTrack),x!=null&&x.tracks){const T=h.initSegment||h;if(this.unhandledEncryptionError(x,h))return;this._bufferInitSegment(g,x.tracks,T,u),r.trigger(b.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:s,tracks:x.tracks})}if(v){const{startPTS:T,endPTS:L,startDTS:_,endDTS:I}=v;d&&(d.elementaryStreams[qe.AUDIO]={startPTS:T,endPTS:L,startDTS:_,endDTS:I}),h.setElementaryStreamInfo(qe.AUDIO,T,L,_,I),this.bufferFragmentData(v,h,d,u)}if(S!=null&&(t=S.samples)!=null&&t.length){const T=Ve({id:s,frag:h,details:m},S);r.trigger(b.FRAG_PARSING_METADATA,T)}if(E){const T=Ve({id:s,frag:h,details:m},E);r.trigger(b.FRAG_PARSING_USERDATA,T)}}_bufferInitSegment(e,t,s,r){if(this.state!==ee.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const a=t.audio;a.id=ge.AUDIO;const u=e.audioCodec;this.log(`Init audio buffer, container:${a.container}, codecs[level/parsed]=[${u}/${a.codec}]`),u&&u.split(",").length===1&&(a.levelCodec=u),this.hls.trigger(b.BUFFER_CODECS,t);const c=a.initSegment;if(c!=null&&c.byteLength){const h={type:"audio",frag:s,part:null,chunkMeta:r,parent:s.type,data:c};this.hls.trigger(b.BUFFER_APPENDING,h)}this.tickImmediate()}loadFragment(e,t,s){const r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===gt.NOT_LOADED||r===gt.PARTIAL){var a;if(!lt(e))this._loadInitSegment(e,t);else if((a=t.details)!=null&&a.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ee.WAITING_INIT_PTS;const u=this.mainDetails;u&&u.fragmentStart!==t.details.fragmentStart&&No(t.details,u)}else super.loadFragment(e,t,s)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:r,characteristics:a,audioCodec:u,channels:c}=this.bufferedTrack;mn({name:t,lang:s,assocLang:r,characteristics:a,audioCodec:u,channels:c},e,gn)||(Co(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(b.AUDIO_TRACK_SWITCHED,Ge({},e))}}class Rd extends vi{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const r=t?.renditionReports;if(r){let a=-1;for(let u=0;u<r.length;u++){const c=r[u];let h;try{h=new self.URL(c.URI,t.url).href}catch(d){this.warn(`Could not construct new URL for Rendition Report: ${d}`),h=c.URI||""}if(h===e){a=u;break}else h===e.substring(0,h.length)&&(a=u)}if(a!==-1){const u=r[a],c=parseInt(u["LAST-MSN"])||t.lastPartSn;let h=parseInt(u["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const g=Math.min(t.age-t.partTarget,t.targetduration);h>=0&&g>t.partTarget&&(h+=1)}const d=s&&J0(s);return new ep(c,h>=0?h:void 0,d)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return e}playlistLoaded(e,t,s){const{details:r,stats:a}=t,u=self.performance.now(),c=a.loading.first?Math.max(0,u-a.loading.first):0;r.advancedDateTime=Date.now()-c;const h=this.hls.config.timelineOffset;if(h!==r.appliedTimelineOffset){const g=Math.max(h||0,0);r.appliedTimelineOffset=g,r.fragments.forEach(m=>{m.setStart(m.playlistOffset+g)})}if(r.live||s!=null&&s.live){const g="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(s),s&&r.fragments.length>0){Fb(s,r,this);const _=r.playlistParsingError;if(_){this.warn(_);const I=this.hls;if(!I.config.ignorePlaylistParsingErrors){var d;const{networkDetails:O}=t;I.trigger(b.ERROR,{type:ye.NETWORK_ERROR,details:H.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:_,reason:_.message,level:t.level||void 0,parent:(d=r.fragments[0])==null?void 0:d.type,networkDetails:O,stats:a});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=a.loading.start);const m=this.hls.mainForwardBufferInfo,v=m?m.end-m.len:0,E=(r.edge-v)*1e3,S=nv(r,E);if(r.requestScheduled+S<u?r.requestScheduled=u:r.requestScheduled+=S,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let x,T,L;if(r.canBlockReload&&r.endSN&&r.advanced){const _=this.hls.config.lowLatencyMode,I=r.lastPartSn,O=r.endSN,k=r.lastPartIndex,K=k!==-1,w=I===O;K?w?(T=O+1,L=_?0:k):(T=I,L=_?k+1:r.maxPartIndex):T=O+1;const B=r.age,$=B+r.ageHeader;let U=Math.min($-r.partTarget,r.targetduration*1.5);if(U>0){if($>r.targetduration*3)this.log(`Playlist last advanced ${B.toFixed(2)}s ago. Omitting segment and part directives.`),T=void 0,L=void 0;else if(s!=null&&s.tuneInGoal&&$-r.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${U} with playlist age: ${r.age}`),U=0;else{const W=Math.floor(U/r.targetduration);if(T+=W,L!==void 0){const ne=Math.round(U%r.targetduration/r.partTarget);L+=ne}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${B.toFixed(2)}s goal: ${U} skip sn ${W} to part ${L}`)}r.tuneInGoal=U}if(x=this.getDeliveryDirectives(r,t.deliveryDirectives,T,L),_||!w){r.requestScheduled=u,this.loadingPlaylist(g,x);return}}else(r.canBlockReload||r.canSkipUntil)&&(x=this.getDeliveryDirectives(r,t.deliveryDirectives,T,L));x&&T!==void 0&&r.canBlockReload&&(r.requestScheduled=a.loading.first+Math.max(S-c*2,S/2)),this.scheduleLoading(g,x,r)}else this.clearTimer()}scheduleLoading(e,t,s){const r=s||e.details;if(!r){this.loadingPlaylist(e,t);return}const a=self.performance.now(),u=r.requestScheduled;if(a>=u){this.loadingPlaylist(e,t);return}const c=u-a;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(c)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),c)}getDeliveryDirectives(e,t,s,r){let a=J0(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,r=t.part,a=Eo.No),new ep(s,r,a)}checkRetry(e){const t=e.details,s=Oo(e),r=e.errorAction,{action:a,retryCount:u=0,retryConfig:c}=r||{},h=!!r&&!!c&&(a===Lt.RetryRequest||!r.resolved&&a===Lt.SendAlternateToPenaltyBox);if(h){var d;if(u>=c.maxNumRetry)return!1;if(s&&(d=e.context)!=null&&d.deliveryDirectives)this.warn(`Retrying playlist loading ${u+1}/${c.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const g=hd(c,u);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),g),this.warn(`Retrying playlist loading ${u+1}/${c.maxNumRetry} after "${t}" in ${g}ms`)}e.levelRetry=!0,r.resolved=!0}return h}}function Cv(l,e){if(l.length!==e.length)return!1;for(let t=0;t<l.length;t++)if(!Ia(l[t].attrs,e[t].attrs))return!1;return!0}function Ia(l,e,t){const s=l["STABLE-RENDITION-ID"];return s&&!t?s===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>l[r]!==e[r])}function qf(l,e){return e.label.toLowerCase()===l.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(l.lang||"").toLowerCase())}class YL extends Rd{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(b.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:r,details:a}=t,u=this.tracksInGroup[s];if(!u||u.groupId!==r){this.warn(`Audio track with id:${s} and group:${r} not found in active group ${u?.groupId}`);return}const c=u.details;u.details=t.details,this.log(`Audio track ${s} "${u.name}" lang:${u.lang} group:${r} loaded [${a.startSN}-${a.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,r=this.groupIds;let a=this.currentTrack;if(!s||r?.length!==s?.length||s!=null&&s.some(c=>r?.indexOf(c)===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(v=>!s||s.indexOf(v.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(v=>v.default)&&(this.selectDefaultTrack=!1),c.forEach((v,E)=>{v.id=E});else if(!a&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const h=this.hls.config.audioPreference;if(!a&&h){const v=Ni(h,c,gn);if(v>-1)a=c[v];else{const E=Ni(h,this.tracks);a=this.tracks[E]}}let d=this.findTrackId(a);d===-1&&a&&(d=this.findTrackId(null));const g={audioTracks:c};this.log(`Updating audio tracks, ${c.length} track(s) found in group(s): ${s?.join(",")}`),this.hls.trigger(b.AUDIO_TRACKS_UPDATED,g);const m=this.trackId;if(d!==-1&&m===-1)this.setAudioTrack(d);else if(c.length&&m===-1){var u;const v=new Error(`No audio track selected for current audio group-ID(s): ${(u=this.groupIds)==null?void 0:u.join(",")} track count: ${c.length}`);this.warn(v.message),this.hls.trigger(b.ERROR,{type:ye.MEDIA_ERROR,details:H.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:v})}}}onError(e,t){t.fatal||!t.context||t.context.type===_e.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const r=this.currentTrack;if(r&&mn(e,r,gn))return r;const a=Ni(e,this.tracksInGroup,gn);if(a>-1){const u=this.tracksInGroup[a];return this.setAudioTrack(a),u}else if(r){let u=t.loadLevel;u===-1&&(u=t.firstAutoLevel);const c=rb(e,t.levels,s,u,gn);if(c===-1)return null;t.nextLoadLevel=c}if(e.channels||e.audioCodec){const u=Ni(e,s);if(u>-1)return s[u]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,r=t[e],a=r.details&&!r.details.live;if(e===this.trackId&&r===s&&a||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(b.AUDIO_TRACK_SWITCHING,Ge({},r)),a))return;const u=this.switchParams(r.url,s?.details,r.details);this.loadPlaylist(u)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const r=t[s];if(!(this.selectDefaultTrack&&!r.default)&&(!e||mn(e,r,gn)))return s}if(e){const{name:s,lang:r,assocLang:a,characteristics:u,audioCodec:c,channels:h}=e;for(let d=0;d<t.length;d++){const g=t[d];if(mn({name:s,lang:r,assocLang:a,characteristics:u,audioCodec:c,channels:h},g,gn))return d}for(let d=0;d<t.length;d++){const g=t[d];if(Ia(e.attrs,g.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return d}for(let d=0;d<t.length;d++){const g=t[d];if(Ia(e.attrs,g.attrs,["LANGUAGE"]))return d}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Co(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,r=e.groupId,a=this.getUrlWithDirectives(e.url,t),u=e.details,c=u?.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&u.live?" age "+c.toFixed(1)+(u.type&&" "+u.type||""):""} ${a}`),this.hls.trigger(b.AUDIO_TRACK_LOADING,{url:a,id:s,groupId:r,deliveryDirectives:t||null,track:e})}}class qL{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(this.queues===null||this.tracks===null)return;const r=this.queues[t];r.push(e),r.length===1&&!s&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const s=(t=e[0])==null?void 0:t.label;(s==="async-blocker"||s==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(a){var s;if(r.onError(a),this.queues===null||this.tracks===null)return;const u=(s=this.tracks[e])==null?void 0:s.buffer;u!=null&&u.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,s;return(t=this.queues)!=null&&t[e]||(s=this.tracks)!=null&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=(t=this.tracks)==null?void 0:t[e],r=s?.buffer;return r?`SourceBuffer${r.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(s=>s.label).join(", "))||""}}const Bp=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Ov="HlsJsTrackRemovedError";class XL extends Error{constructor(e){super(e),this.name=Ov}}class QL extends vi{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=s=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=s=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=s=>{const{media:r,mediaSource:a}=this;s&&this.log("Media source opened"),!(!r||!a)&&(a.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(b.MEDIA_ATTACHED,{media:r,mediaSource:a}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:s,_objectUrl:r}=this;s!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${s})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=vA(Hs(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.BUFFER_RESET,this.onBufferReset,this),e.on(b.BUFFER_APPENDING,this.onBufferAppending,this),e.on(b.BUFFER_CODECS,this.onBufferCodecs,this),e.on(b.BUFFER_EOS,this.onBufferEos,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(b.FRAG_PARSED,this.onFragParsed,this),e.on(b.FRAG_CHANGED,this.onFragChanged,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.BUFFER_RESET,this.onBufferReset,this),e.off(b.BUFFER_APPENDING,this.onBufferAppending,this),e.off(b.BUFFER_CODECS,this.onBufferCodecs,this),e.off(b.BUFFER_EOS,this.onBufferEos,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(b.FRAG_PARSED,this.onFragParsed,this),e.off(b.FRAG_CHANGED,this.onFragChanged,this),e.off(b.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const a=this.isUpdating();a||this.operationQueue.removeBlockers();const u=this.isQueued();(a||u)&&this.warn(`Transfering MediaSource with${u?" operations in queue":""}${a?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?Ve(s,r.tracks):this.sourceBuffers.forEach(a=>{const[u]=a;u&&(s[u]=Ve({},this.tracks[u]),this.removeBuffer(u)),a[0]=a[1]=null}),{media:e,mediaSource:t,tracks:s}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(s=this.transferData)!=null&&s.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media;this.transferData=this.overrides=void 0;const r=Hs(this.appendSource);if(r){const a=!!t.mediaSource;(a||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const u=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(u),a)this._objectUrl=s.src,this.attachTransferred();else{const c=this._objectUrl=self.URL.createObjectURL(u);if(this.appendSource)try{s.removeAttribute("src");const h=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||h&&u instanceof h,$p(s),WL(s,c),s.load()}catch{s.src=c}else s.src=c}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(s=e.constructor)==null?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,r=t.tracks,a=r?Object.keys(r):null,u=a?a.length:0,c=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&a&&u){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Xe(s,(h,d)=>h==="initSegment"?void 0:d)};
transfer tracks: ${Xe(r,(h,d)=>h==="initSegment"?void 0:d)}}`),!_y(r,s)){t.mediaSource=null,t.tracks=void 0;const h=e.currentTime,d=this.details,g=Math.max(h,d?.fragments[0].start||0);if(g-h>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${h} -> ${g}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(s)}") start time: ${g} currentTime: ${h}`),this.onMediaDetaching(b.MEDIA_DETACHING,{}),this.onMediaAttaching(b.MEDIA_ATTACHING,t),e.currentTime=g;return}this.transferData=void 0,a.forEach(h=>{const d=h,g=r[d];if(g){const m=g.buffer;if(m){const v=this.fragmentTracker,E=g.id;if(v.hasFragments(E)||v.hasParts(E)){const T=xe.getBuffered(m);v.detectEvictedFragments(d,T,E,null,!0)}const S=Af(d),x=[d,m];this.sourceBuffers[S]=x,m.updating&&this.operationQueue&&this.operationQueue.prependBlocker(d),this.trackSourceBuffer(d,g)}}}),c(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),c()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:a,_objectUrl:u}=this;if(a){if(this.log(`media source ${s?"transferring":"detaching"}`),s)this.sourceBuffers.forEach(([c])=>{c&&this.removeBuffer(c)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const c=a.readyState==="open";try{const h=a.sourceBuffers;for(let d=h.length;d--;)c&&h[d].abort(),a.removeSourceBuffer(h[d]);c&&a.endOfStream()}catch(h){this.warn(`onMediaDetaching: ${h.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(a.removeEventListener("startstreaming",this._onStartStreaming),a.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),s||(u&&self.URL.revokeObjectURL(u),this.mediaSrc===u?(r.removeAttribute("src"),this.appendSource&&$p(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(b.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const s=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),s)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(a){this.warn(`onBufferReset ${e}`,a)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Af(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new qL(this.tracks)}onBufferCodecs(e,t){var s;const r=this.tracks,a=Object.keys(t);this.log(`BUFFER_CODECS: "${a}" (current SB count ${this.sourceBufferCount})`);const u="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),c=!u&&this.sourceBufferCount&&this.media&&a.some(h=>!r[h]);if(u||c){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${a}" SourceBuffers`);return}a.forEach(h=>{var d,g;const m=t[h],{id:v,codec:E,levelCodec:S,container:x,metadata:T,supplemental:L}=m;let _=r[h];const I=(d=this.transferData)==null||(d=d.tracks)==null?void 0:d[h],O=I!=null&&I.buffer?I:_,k=O?.pendingCodec||O?.codec,K=O?.levelCodec;_||(_=r[h]={buffer:void 0,listeners:[],codec:E,supplemental:L,container:x,levelCodec:S,metadata:T,id:v});const w=vo(k,K),B=w?.replace(Bp,"$1");let $=vo(E,S);const U=(g=$)==null?void 0:g.replace(Bp,"$1");$&&w&&B!==U&&(h.slice(0,5)==="audio"&&($=Do($,this.appendSource)),this.log(`switching codec ${k} to ${$}`),$!==(_.pendingCodec||_.codec)&&(_.pendingCodec=$),_.container=x,this.appendChangeType(h,x,$))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((s=t.audio)==null?void 0:s.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e},{})}appendChangeType(e,t,s){const r=`${t};codecs=${s}`,a={label:`change-type=${r}`,execute:()=>{const u=this.tracks[e];if(u){const c=u.buffer;c!=null&&c.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),c.changeType(r),u.codec=s,u.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:u=>{this.warn(`Failed to change ${e} SourceBuffer type`,u)}};this.append(a,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,r=s+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(s,ge.MAIN))==null?void 0:t.gap)===!0)return;const u={label:"block-audio",execute:()=>{var c;const h=this.tracks.video;(this.lastVideoAppendEnd>r||h!=null&&h.buffer&&xe.isBuffered(h.buffer,r)||((c=this.fragmentTracker.getAppendedFrag(r,ge.MAIN))==null?void 0:c.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:c=>{this.warn("Error executing block-audio operation",c)}};this.blockedAudioAppend={op:u,frag:e},this.append(u,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:r,type:a,parent:u,frag:c,part:h,chunkMeta:d,offset:g}=t,m=d.buffering[a],{sn:v,cc:E}=c,S=self.performance.now();m.start=S;const x=c.stats.buffering,T=h?h.stats.buffering:null;x.start===0&&(x.start=S),T&&T.start===0&&(T.start=S);const L=s.audio;let _=!1;a==="audio"&&L?.container==="audio/mpeg"&&(_=!this.lastMpegAudioChunk||d.id===1||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const I=s.video,O=I?.buffer;if(O&&v!=="initSegment"){const w=h||c,B=this.blockedAudioAppend;if(a==="audio"&&u!=="main"&&!this.blockedAudioAppend&&!(I.ending||I.ended)){const U=w.start+w.duration*.05,W=O.buffered,ne=this.currentOp("video");!W.length&&!ne?this.blockAudio(w):!ne&&!xe.isBuffered(O,U)&&this.lastVideoAppendEnd<U&&this.blockAudio(w)}else if(a==="video"){const $=w.end;if(B){const U=B.frag.start;($>U||$<this.lastVideoAppendEnd||xe.isBuffered(O,U))&&this.unblockAudio()}this.lastVideoAppendEnd=$}}const k=(h||c).start,K={label:`append-${a}`,execute:()=>{var w;m.executeStart=self.performance.now();const B=(w=this.tracks[a])==null?void 0:w.buffer;B&&(_?this.updateTimestampOffset(B,k,.1,a,v,E):g!==void 0&&fe(g)&&this.updateTimestampOffset(B,g,1e-6,a,v,E)),this.appendExecutor(r,a)},onStart:()=>{},onComplete:()=>{const w=self.performance.now();m.executeEnd=m.end=w,x.first===0&&(x.first=w),T&&T.first===0&&(T.first=w);const B={};this.sourceBuffers.forEach(([$,U])=>{$&&(B[$]=xe.getBuffered(U))}),this.appendErrors[a]=0,a==="audio"||a==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(b.BUFFER_APPENDED,{type:a,frag:c,part:h,chunkMeta:d,parent:c.type,timeRanges:B})},onError:w=>{var B;const $={type:ye.MEDIA_ERROR,parent:c.type,details:H.BUFFER_APPEND_ERROR,sourceBufferName:a,frag:c,part:h,chunkMeta:d,error:w,err:w,fatal:!1},U=(B=this.media)==null?void 0:B.error;if(w.code===DOMException.QUOTA_EXCEEDED_ERR||w.name=="QuotaExceededError"||"quota"in w)$.details=H.BUFFER_FULL_ERROR;else if(w.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!U)$.errorAction=fr(!0);else if(w.name===Ov&&this.sourceBufferCount===0)$.errorAction=fr(!0);else{const W=++this.appendErrors[a];this.warn(`Failed ${W}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${a}" sourceBuffer (${U||"no media error"})`),(W>=this.hls.config.appendErrorMaxRetry||U)&&($.fatal=!0)}this.hls.trigger(b.ERROR,$)}};this.log(`queuing "${a}" append sn: ${v}${h?" p: "+h.index:""} of ${c.type===ge.MAIN?"level":"track"} ${c.level} cc: ${E}`),this.append(K,a,this.isPending(this.tracks[a]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(b.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){const{type:s,startOffset:r,endOffset:a}=t;s?this.append(this.getFlushOp(s,r,a),s):this.sourceBuffers.forEach(([u])=>{u&&this.append(this.getFlushOp(u,r,a),u)})}onFragParsed(e,t){const{frag:s,part:r}=t,a=[],u=r?r.elementaryStreams:s.elementaryStreams;u[qe.AUDIOVIDEO]?a.push("audiovideo"):(u[qe.AUDIO]&&a.push("audio"),u[qe.VIDEO]&&a.push("video"));const c=()=>{const h=self.performance.now();s.stats.buffering.end=h,r&&(r.stats.buffering.end=h);const d=r?r.stats:s.stats;this.hls.trigger(b.FRAG_BUFFERED,{frag:s,part:r,stats:d,id:s.type})};a.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers(c,a).catch(h=>{this.warn(`Fragment buffered callback ${h}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var s;this.sourceBuffers.forEach(([u])=>{if(u){const c=this.tracks[u];(!t.type||t.type===u)&&(c.ending=!0,c.ended||(c.ended=!0,this.log(`${u} buffer reached EOS`)))}});const r=((s=this.overrides)==null?void 0:s.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([u])=>{var c;return u&&!((c=this.tracks[u])!=null&&c.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:u}=this;if(!u||u.readyState!=="open"){u&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${u.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),u.endOfStream(),this.hls.trigger(b.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(b.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===H.BUFFER_APPEND_ERROR&&t.frag){var s;const r=(s=t.errorAction)==null?void 0:s.nextAutoLevel;fe(r)&&r!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||t===null||!this.sourceBufferCount)return;const r=e.config,a=s.currentTime,u=t.levelTargetDuration,c=t.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(fe(c)&&c>=0){const d=Math.max(c,u),g=Math.floor(a/u)*u-d;this.flushBackBuffer(a,u,g)}const h=r.frontBufferFlushThreshold;if(fe(h)&&h>0){const d=Math.max(r.maxBufferLength,h),g=Math.max(d,u),m=Math.floor(a/u)*u+g;this.flushFrontBuffer(a,u,m)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach(([r,a])=>{if(a){const c=xe.getBuffered(a);if(c.length>0&&s>c.start(0)){var u;this.hls.trigger(b.BACK_BUFFER_REACHED,{bufferEnd:s});const h=this.tracks[r];if((u=this.details)!=null&&u.live)this.hls.trigger(b.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(h!=null&&h.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(b.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:r})}}})}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach(([r,a])=>{if(a){const u=xe.getBuffered(a),c=u.length;if(c<2)return;const h=u.start(c-1),d=u.end(c-1);if(s>h||e>=h&&e<=d)return;this.hls.trigger(b.BUFFER_FLUSHING,{startOffset:h,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||s?.readyState!=="open")return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&s.setLiveSeekableRange){const d=Math.max(0,t.fragmentStart),g=Math.max(d,r);return{duration:1/0,start:d,end:g}}return{duration:1/0}}const a=(e=this.overrides)==null?void 0:e.duration;if(a)return fe(a)?{duration:a}:null;const u=this.media.duration,c=fe(s.duration)?s.duration:0;return r>c&&r>u||!fe(u)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:s}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&(fe(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),t!==void 0&&s!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${s}.`),r.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Xe(s)}`),this.tracksReady){var r;const a=(r=this.transferData)==null?void 0:r.tracks;a&&Object.keys(a).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,s])=>{if(t){const r=this.tracks[t];e[t]={buffer:s,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(b.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(b.ERROR,{type:ye.MEDIA_ERROR,details:H.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const a in e){const u=a,c=e[u];if(this.isPending(c)){const h=this.getTrackCodec(c,u),d=`${c.container};codecs=${h}`;c.codec=h,this.log(`creating sourceBuffer(${d})${this.currentOp(u)?" Queued":""} ${Xe(c)}`);try{const g=s.addSourceBuffer(d),m=Af(u),v=[u,g];t[m]=v,c.buffer=g}catch(g){var r;this.error(`error while trying to add sourceBuffer: ${g.message}`),this.shiftAndExecuteNext(u),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[u],this.hls.trigger(b.ERROR,{type:ye.MEDIA_ERROR,details:H.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:g,sourceBufferName:u,mimeType:d,parent:c.id});return}this.trackSourceBuffer(u,c)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let r=e.codec;s&&(t==="video"||t==="audiovideo")&&Aa(s,"video")&&(r=$A(r,s));const a=vo(r,e.levelCodec);return a?t.slice(0,5)==="audio"?Do(a,this.appendSource):a:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(a,u)=>{const c=u.removedRanges;c!=null&&c.length&&this.hls.trigger(b.BUFFER_FLUSHED,{type:a})})}get mediaSrc(){var e,t;const s=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return s?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(s=this.mediaSource)==null?void 0:s.readyState}`);this.error(`${r}`,t),this.hls.trigger(b.ERROR,{type:ye.MEDIA_ERROR,details:H.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const a=this.currentOp(e);a&&a.onError(r)}updateTimestampOffset(e,t,s,r,a,u){const c=t-e.timestampOffset;Math.abs(c)>=s&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${t} (sn: ${a} cc: ${u})`),e.timestampOffset=t)}removeExecutor(e,t,s){const{media:r,mediaSource:a}=this,u=this.tracks[e],c=u?.buffer;if(!r||!a||!c){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const h=fe(r.duration)?r.duration:1/0,d=fe(a.duration)?a.duration:1/0,g=Math.max(0,t),m=Math.min(s,h,d);m>g&&(!u.ending||u.ended)?(u.ended=!1,this.log(`Removing [${g},${m}] from the ${e} SourceBuffer`),c.remove(g,m)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],r=s?.buffer;if(!r)throw new XL(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,r=t.map(u=>this.appendBlocker(u));return t.length>1&&this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(u=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var s;const r=(s=this.tracks[t])==null?void 0:s.buffer;!r||r.updating||this.shiftAndExecuteNext(t)})}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,s){const r=this.tracks[e];if(!r)return;const a=r.buffer;if(!a)return;const u=s.bind(this,e);r.listeners.push({event:t,listener:u}),a.addEventListener(t,u)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach(r=>{s.removeEventListener(r.event,r.listener)}),t.listeners.length=0)}}function $p(l){const e=l.querySelectorAll("source");[].slice.call(e).forEach(t=>{l.removeChild(t)})}function WL(l,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,l.appendChild(t)}function Af(l){return l==="audio"?1:0}class _d{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(b.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.BUFFER_CODECS,this.onBufferCodecs,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(b.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.BUFFER_CODECS,this.onBufferCodecs,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&fe(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter((r,a)=>this.isLevelAllowed(r)&&a<=e);return this.clientRect=null,_d.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,!t.width&&!t.height&&(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(s=>e.bitrate===s.bitrate&&e.width===s.width&&e.height===s.height)}static getMaxLevelByMediaSize(e,t,s){if(!(e!=null&&e.length))return-1;const r=(c,h)=>h?c.width!==h.width||c.height!==h.height:!0;let a=e.length-1;const u=Math.max(t,s);for(let c=0;c<e.length;c+=1){const h=e[c];if((h.width>=u||h.height>=u)&&r(h,e[c+1])){a=c;break}}return a}}const ZL={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Gt=ZL,JL={HLS:"h"},eR=JL;class Fi{constructor(e,t){Array.isArray(e)&&(e=e.map(s=>s instanceof Fi?s:new Fi(s))),this.value=e,this.params=t}}const tR="Dict";function iR(l){return Array.isArray(l)?JSON.stringify(l):l instanceof Map?"Map{}":l instanceof Set?"Set{}":typeof l=="object"?JSON.stringify(l):String(l)}function sR(l,e,t,s){return new Error(`failed to ${l} "${iR(e)}" as ${t}`,{cause:s})}function Bi(l,e,t){return sR("serialize",l,e,t)}class wv{constructor(e){this.description=e}}const Gp="Bare Item",nR="Boolean";function rR(l){if(typeof l!="boolean")throw Bi(l,nR);return l?"?1":"?0"}function aR(l){return btoa(String.fromCharCode(...l))}const lR="Byte Sequence";function oR(l){if(ArrayBuffer.isView(l)===!1)throw Bi(l,lR);return`:${aR(l)}:`}const uR="Integer";function cR(l){return l<-999999999999999||999999999999999<l}function Mv(l){if(cR(l))throw Bi(l,uR);return l.toString()}function fR(l){return`@${Mv(l.getTime()/1e3)}`}function kv(l,e){if(l<0)return-kv(-l,e);const t=Math.pow(10,e);if(Math.abs(l*t%1-.5)<Number.EPSILON){const r=Math.floor(l*t);return(r%2===0?r:r+1)/t}else return Math.round(l*t)/t}const dR="Decimal";function hR(l){const e=kv(l,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Bi(l,dR);const t=e.toString();return t.includes(".")?t:`${t}.0`}const gR="String",mR=/[\x00-\x1f\x7f]+/;function pR(l){if(mR.test(l))throw Bi(l,gR);return`"${l.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function yR(l){return l.description||l.toString().slice(7,-1)}const vR="Token";function jp(l){const e=yR(l);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Bi(e,vR);return e}function Xf(l){switch(typeof l){case"number":if(!fe(l))throw Bi(l,Gp);return Number.isInteger(l)?Mv(l):hR(l);case"string":return pR(l);case"symbol":return jp(l);case"boolean":return rR(l);case"object":if(l instanceof Date)return fR(l);if(l instanceof Uint8Array)return oR(l);if(l instanceof wv)return jp(l);default:throw Bi(l,Gp)}}const ER="Key";function Qf(l){if(/^[a-z*][a-z0-9\-_.*]*$/.test(l)===!1)throw Bi(l,ER);return l}function Dd(l){return l==null?"":Object.entries(l).map(([e,t])=>t===!0?`;${Qf(e)}`:`;${Qf(e)}=${Xf(t)}`).join("")}function Nv(l){return l instanceof Fi?`${Xf(l.value)}${Dd(l.params)}`:Xf(l)}function SR(l){return`(${l.value.map(Nv).join(" ")})${Dd(l.params)}`}function TR(l,e={whitespace:!0}){if(typeof l!="object"||l==null)throw Bi(l,tR);const t=l instanceof Map?l.entries():Object.entries(l),s=e?.whitespace?" ":"";return Array.from(t).map(([r,a])=>{a instanceof Fi||(a=new Fi(a));let u=Qf(r);return a.value===!0?u+=Dd(a.params):(u+="=",Array.isArray(a.value)?u+=SR(a):u+=Nv(a)),u}).join(`,${s}`)}function Pv(l,e){return TR(l,e)}const wi="CMCD-Object",nt="CMCD-Request",dn="CMCD-Session",Bs="CMCD-Status",xR={br:wi,ab:wi,d:wi,ot:wi,tb:wi,tpb:wi,lb:wi,tab:wi,lab:wi,url:wi,pb:nt,bl:nt,tbl:nt,dl:nt,ltc:nt,mtp:nt,nor:nt,nrr:nt,rc:nt,sn:nt,sta:nt,su:nt,ttfb:nt,ttfbb:nt,ttlb:nt,cmsdd:nt,cmsds:nt,smrt:nt,df:nt,cs:nt,ts:nt,cid:dn,pr:dn,sf:dn,sid:dn,st:dn,v:dn,msd:dn,bs:Bs,bsd:Bs,cdn:Bs,rtp:Bs,bg:Bs,pt:Bs,ec:Bs,e:Bs},AR={REQUEST:nt};function bR(l){return Object.keys(l).reduce((e,t)=>{var s;return(s=l[t])===null||s===void 0||s.forEach(r=>e[r]=t),e},{})}function LR(l,e){const t={};if(!l)return t;const s=Object.keys(l),r=e?bR(e):{};return s.reduce((a,u)=>{var c;const h=xR[u]||r[u]||AR.REQUEST,d=(c=a[h])!==null&&c!==void 0?c:a[h]={};return d[u]=l[u],a},t)}function RR(l){return["ot","sf","st","e","sta"].includes(l)}function _R(l){return typeof l=="number"?fe(l):l!=null&&l!==""&&l!==!1}const Uv="event";function DR(l,e){const t=new URL(l),s=new URL(e);if(t.origin!==s.origin)return l;const r=t.pathname.split("/").slice(1),a=s.pathname.split("/").slice(1,-1);for(;r[0]===a[0];)r.shift(),a.shift();for(;a.length;)a.shift(),r.unshift("..");return r.join("/")+t.search+t.hash}const Ao=l=>Math.round(l),Wf=(l,e)=>Array.isArray(l)?l.map(t=>Wf(t,e)):l instanceof Fi&&typeof l.value=="string"?new Fi(Wf(l.value,e),l.params):(e.baseUrl&&(l=DR(l,e.baseUrl)),e.version===1?encodeURIComponent(l):l),lo=l=>Ao(l/100)*100,IR=(l,e)=>{let t=l;return e.version>=2&&(l instanceof Fi&&typeof l.value=="string"?t=new Fi([l]):typeof l=="string"&&(t=[l])),Wf(t,e)},CR={br:Ao,d:Ao,bl:lo,dl:lo,mtp:lo,nor:IR,rtp:lo,tb:Ao},Fv="request",Bv="response",Id=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],OR=["e"],wR=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function jo(l){return wR.test(l)}function MR(l){return Id.includes(l)||OR.includes(l)||jo(l)}const $v=["d","dl","nor","ot","rtp","su"];function kR(l){return Id.includes(l)||$v.includes(l)||jo(l)}const NR=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function PR(l){return Id.includes(l)||$v.includes(l)||NR.includes(l)||jo(l)}const UR=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function FR(l){return UR.includes(l)||jo(l)}const BR={[Bv]:PR,[Uv]:MR,[Fv]:kR};function Gv(l,e={}){const t={};if(l==null||typeof l!="object")return t;const s=e.version||l.v||1,r=e.reportingMode||Fv,a=s===1?FR:BR[r];let u=Object.keys(l).filter(a);const c=e.filter;typeof c=="function"&&(u=u.filter(c));const h=r===Bv||r===Uv;h&&!u.includes("ts")&&u.push("ts"),s>1&&!u.includes("v")&&u.push("v");const d=Ve({},CR,e.formatters),g={version:s,reportingMode:r,baseUrl:e.baseUrl};return u.sort().forEach(m=>{let v=l[m];const E=d[m];if(typeof E=="function"&&(v=E(v,g)),m==="v"){if(s===1)return;v=s}m=="pr"&&v===1||(h&&m==="ts"&&!fe(v)&&(v=Date.now()),_R(v)&&(RR(m)&&typeof v=="string"&&(v=new wv(v)),t[m]=v))}),t}function $R(l,e={}){const t={};if(!l)return t;const s=Gv(l,e),r=LR(s,e?.customHeaderMap);return Object.entries(r).reduce((a,[u,c])=>{const h=Pv(c,{whitespace:!1});return h&&(a[u]=h),a},t)}function GR(l,e,t){return Ve(l,$R(e,t))}const jR="CMCD";function HR(l,e={}){return l?Pv(Gv(l,e),{whitespace:!1}):""}function KR(l,e={}){if(!l)return"";const t=HR(l,e);return encodeURIComponent(t)}function zR(l,e={}){if(!l)return"";const t=KR(l,e);return`${jR}=${t}`}const Hp=/CMCD=[^&#]+/;function VR(l,e,t){const s=zR(e,t);if(!s)return l;if(Hp.test(l))return l.replace(Hp,s);const r=l.includes("?")?"&":"?";return`${l}${r}${s}`}class YR{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:Gt.MANIFEST,su:!this.initialized})}catch(a){this.hls.logger.warn("Could not generate manifest CMCD data.",a)}},this.applyFragmentData=r=>{try{const{frag:a,part:u}=r,c=this.hls.levels[a.level],h=this.getObjectType(a),d={d:(u||a).duration*1e3,ot:h};(h===Gt.VIDEO||h===Gt.AUDIO||h==Gt.MUXED)&&(d.br=c.bitrate/1e3,d.tb=this.getTopBandwidth(h)/1e3,d.bl=this.getBufferLength(h));const g=u?this.getNextPart(u):this.getNextFrag(a);g!=null&&g.url&&g.url!==a.url&&(d.nor=g.url),this.apply(r,d)}catch(a){this.hls.logger.warn("Could not generate segment CMCD data.",a)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;s!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=s.useHeaders===!0,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHED,this.onMediaDetached,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHED,this.onMediaDetached,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,r;this.audioBuffer=(s=t.tracks.audio)==null?void 0:s.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:eR.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Ve(t,this.createData());const s=t.ot===Gt.INIT||t.ot===Gt.VIDEO||t.ot===Gt.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((u,c)=>(r.includes(c)&&(u[c]=t[c]),u),{}));const a={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),GR(e.headers,t,a)):e.url=VR(e.url,t,a)}getNextFrag(e){var t;const s=(t=this.hls.levels[e.level])==null?void 0:t.details;if(s){const r=e.sn-s.startSN;return s.fragments[r+1]}}getNextPart(e){var t;const{index:s,fragment:r}=e,a=(t=this.hls.levels[r.level])==null||(t=t.details)==null?void 0:t.partList;if(a){const{sn:u}=r;for(let c=a.length-1;c>=0;c--){const h=a[c];if(h.index===s&&h.fragment.sn===u)return a[c+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Gt.TIMED_TEXT;if(e.sn==="initSegment")return Gt.INIT;if(t==="audio")return Gt.AUDIO;if(t==="main")return this.hls.audioTracks.length?Gt.VIDEO:Gt.MUXED}getTopBandwidth(e){let t=0,s;const r=this.hls;if(e===Gt.AUDIO)s=r.audioTracks;else{const a=r.maxAutoLevel,u=a>-1?a+1:r.levels.length;s=r.levels.slice(0,u)}return s.forEach(a=>{a.bitrate>t&&(t=a.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,s=e===Gt.AUDIO?this.audioBuffer:this.videoBuffer;return!s||!t?NaN:xe.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(a){this.loader=void 0,this.loader=new s(a)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(a,u,c){t(a),this.loader.load(a,u,c)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(a){this.loader=void 0,this.loader=new s(a)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(a,u,c){t(a),this.loader.load(a,u,c)}}}}const qR=3e5;class XR extends vi{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(s=>s!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;s!==null&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if(s?.action===Lt.SendAlternateToPenaltyBox&&s.flags===Jt.MoveAllAlternatesMatchingHost){const r=this.levels;let a=this._pathwayPriority,u=this.pathwayId;if(t.context){const{groupId:c,pathwayId:h,type:d}=t.context;c&&r?u=this.getPathwayForGroupId(c,d,u):h&&(u=h)}u in this.penalizedPathways||(this.penalizedPathways[u]=performance.now()),!a&&r&&(a=this.pathways()),a&&a.length>1&&(this.updatePathwayPriority(a),s.resolved=this.pathwayId!==u),t.details===H.BUFFER_APPEND_ERROR&&!t.fatal?s.resolved=!0:s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${u} levels: ${r&&r.length} priorities: ${Xe(a)} penalized: ${Xe(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const s=this.penalizedPathways,r=performance.now();Object.keys(s).forEach(a=>{r-s[a]>qR&&delete s[a]});for(let a=0;a<e.length;a++){const u=e[a];if(u in s)continue;if(u===this.pathwayId)return;const c=this.hls.nextLoadLevel,h=this.hls.levels[c];if(t=this.getLevelsForPathway(u),t.length>0){this.log(`Setting Pathway to "${u}"`),this.pathwayId=u,lv(t),this.hls.trigger(b.LEVELS_UPDATED,{levels:t});const d=this.hls.levels[c];h&&d&&this.levels&&(d.attrs["STABLE-VARIANT-ID"]!==h.attrs["STABLE-VARIANT-ID"]&&d.bitrate!==h.bitrate&&this.log(`Unstable Pathways change from bitrate ${h.bitrate} to ${d.bitrate}`),this.hls.nextLoadLevel=c);break}}}getPathwayForGroupId(e,t,s){const r=this.getLevelsForPathway(s).concat(this.levels||[]);for(let a=0;a<r.length;a++)if(t===_e.AUDIO_TRACK&&r[a].hasAudioGroup(e)||t===_e.SUBTITLE_TRACK&&r[a].hasSubtitleGroup(e))return r[a].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},r={};e.forEach(a=>{const{ID:u,"BASE-ID":c,"URI-REPLACEMENT":h}=a;if(t.some(g=>g.pathwayId===u))return;const d=this.getLevelsForPathway(c).map(g=>{const m=new Je(g.attrs);m["PATHWAY-ID"]=u;const v=m.AUDIO&&`${m.AUDIO}_clone_${u}`,E=m.SUBTITLES&&`${m.SUBTITLES}_clone_${u}`;v&&(s[m.AUDIO]=v,m.AUDIO=v),E&&(r[m.SUBTITLES]=E,m.SUBTITLES=E);const S=jv(g.uri,m["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h),x=new La({attrs:m,audioCodec:g.audioCodec,bitrate:g.bitrate,height:g.height,name:g.name,url:S,videoCodec:g.videoCodec,width:g.width});if(g.audioGroups)for(let T=1;T<g.audioGroups.length;T++)x.addGroupId("audio",`${g.audioGroups[T]}_clone_${u}`);if(g.subtitleGroups)for(let T=1;T<g.subtitleGroups.length;T++)x.addGroupId("text",`${g.subtitleGroups[T]}_clone_${u}`);return x});t.push(...d),Kp(this.audioTracks,s,h,u),Kp(this.subtitleTracks,r,h,u)})}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;this.loader&&this.loader.destroy(),this.loader=new s(t);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const g=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+g)}const a={responseType:"json",url:r.href},u=t.steeringManifestLoadPolicy.default,c=u.errorRetry||u.timeoutRetry||{},h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},d={onSuccess:(g,m,v,E)=>{this.log(`Loaded steering manifest: "${r}"`);const S=g.data;if(S?.VERSION!==1){this.log(`Steering VERSION ${S.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=S.TTL;const{"RELOAD-URI":x,"PATHWAY-CLONES":T,"PATHWAY-PRIORITY":L}=S;if(x)try{this.uri=new self.URL(x,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${x}`);return}this.scheduleRefresh(this.uri||v.url),T&&this.clonePathways(T);const _={steeringManifest:S,url:r.toString()};this.hls.trigger(b.STEERING_MANIFEST_LOADED,_),L&&this.updatePathwayPriority(L)},onError:(g,m,v,E)=>{if(this.log(`Error loading steering manifest: ${g.code} ${g.text} (${m.url})`),this.stopLoad(),g.code===410){this.enabled=!1,this.log(`Steering manifest ${m.url} no longer available`);return}let S=this.timeToLoad*1e3;if(g.code===429){const x=this.loader;if(typeof x?.getResponseHeader=="function"){const T=x.getResponseHeader("Retry-After");T&&(S=parseFloat(T)*1e3)}this.log(`Steering manifest ${m.url} rate limited`);return}this.scheduleRefresh(this.uri||m.url,S)},onTimeout:(g,m,v)=>{this.log(`Timeout loading steering manifest (${m.url})`),this.scheduleRefresh(this.uri||m.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(a,h,d)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var s;const r=(s=this.hls)==null?void 0:s.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Kp(l,e,t,s){l&&Object.keys(e).forEach(r=>{const a=l.filter(u=>u.groupId===r).map(u=>{const c=Ve({},u);return c.details=void 0,c.attrs=new Je(c.attrs),c.url=c.attrs.URI=jv(u.url,u.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),c.groupId=c.attrs["GROUP-ID"]=e[r],c.attrs["PATHWAY-ID"]=s,c});l.push(...a)})}function jv(l,e,t,s){const{HOST:r,PARAMS:a,[t]:u}=s;let c;e&&(c=u?.[e],c&&(l=c));const h=new self.URL(l);return r&&!c&&(h.host=r),a&&Object.keys(a).sort().forEach(d=>{d&&h.searchParams.set(d,a[d])}),h.href}class hr extends vi{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=hr.CDMCleanupPromise?[hr.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:s,initData:r}=t,a=`"${t.type}" event: init data type: "${s}"`;if(this.debug(a),r!==null){if(!this.keyFormatPromise){let u=Object.keys(this.keySystemAccessPromises);u.length||(u=va(this.config));const c=u.map(mf).filter(h=>!!h);this.keyFormatPromise=this.getKeyFormatPromise(c)}this.keyFormatPromise.then(u=>{const c=So(u);if(s!=="sinf"||c!==et.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${s}" for selected key-system ${c}`);return}let h;try{const E=ht(new Uint8Array(r)),S=yd(JSON.parse(E).sinf),x=Py(S);if(!x)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");h=new Uint8Array(x.subarray(8,24))}catch(E){this.warn(`${a} Failed to parse sinf: ${E}`);return}const d=Rt(h),{keyIdToKeySessionPromise:g,mediaKeySessions:m}=this;let v=g[d];for(let E=0;E<m.length;E++){const S=m[E],x=S.decryptdata;if(!x.keyId)continue;const T=Rt(x.keyId);if(Mo(h,x.keyId)||x.uri.replace(/-/g,"").indexOf(d)!==-1){if(v=g[T],!v)continue;if(x.pssh)break;delete g[T],x.pssh=new Uint8Array(r),x.keyId=h,v=g[d]=v.then(()=>this.generateRequestWithPreferredKeySession(S,s,r,"encrypted-event-key-match")),v.catch(L=>this.handleError(L));break}}v||this.handleError(new Error(`Key ID ${d} not encountered in playlist. Key-system sessions ${m.length}.`))}).catch(u=>this.handleError(u))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(b.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(b.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(b.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(b.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,r=t?.[e];if(r)return r.licenseUrl;if(e===et.WIDEVINE&&s)return s}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t?.[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(u,c,h)=>!!u&&h.indexOf(u)===c,r=t.map(u=>u.audioCodec).filter(s),a=t.map(u=>u.videoCodec).filter(s);return r.length+a.length===0&&a.push("avc1.42e01e"),new Promise((u,c)=>{const h=d=>{const g=d.shift();this.getMediaKeysPromise(g,r,a).then(m=>u({keySystem:g,mediaKeys:m})).catch(m=>{d.length?h(d):m instanceof Zt?c(m):c(new Zt({type:ye.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_NO_ACCESS,error:m,fatal:!0},m.message))})};h(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if(typeof s!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${s}`;return Jy===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return s(e,t)}getMediaKeysPromise(e,t,s){var r;const a=Ib(e,t,s,this.config.drmSystemOptions||{});let u=this.keySystemAccessPromises[e],c=(r=u)==null?void 0:r.keySystemAccess;if(!c){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Xe(a)}`),c=this.requestMediaKeySystemAccess(e,a);const h=u=this.keySystemAccessPromises[e]={keySystemAccess:c};return c.catch(d=>{this.log(`Failed to obtain access to key-system "${e}": ${d}`)}),c.then(d=>{this.log(`Access for key-system "${d.keySystem}" obtained`);const g=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const m=h.mediaKeys=d.createMediaKeys().then(v=>(this.log(`Media-keys created for "${e}"`),h.hasMediaKeys=!0,g.then(E=>E?this.setMediaKeysServerCertificate(v,e,E):v)));return m.catch(v=>{this.error(`Failed to create media-keys for "${e}"}: ${v}`)}),m})}return c.then(()=>u.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${Rt(e.keyId||[])} keyUri: ${e.uri}`);const r=s.createSession(),a={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(a),a}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),r=oo(t),a="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(s,a,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyId ${Rt(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),s.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>mf(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:s})=>this.attemptSetMediaKeys(t,s))}selectKeySystem(e){return new Promise((t,s)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:r})=>{const a=mf(r);a?t(a):s(new Error(`Unable to find format for key-system "${r}"`))}).catch(s)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=va(this.config),s=e.map(So).filter(r=>!!r&&t.indexOf(r)!==-1);return this.selectKeySystem(s)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let s=0;s<t.length;s++){const r=QR(e,t[s]);if(r)return r}}loadKey(e){const t=e.keyInfo.decryptdata,s=oo(t),r=this.bannedKeyIds[s];if(r||this.getKeyStatus(t)==="internal-error"){const c=zp(r||"internal-error",t);return this.handleError(c,e.frag),Promise.reject(c)}const a=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${a}`);const u=this.keyIdToKeySessionPromise[s];if(!u){const c=this.getKeySystemForKeyPromise(t).then(({keySystem:h,mediaKeys:d})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${a}`),this.attemptSetMediaKeys(h,d).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:h,mediaKeys:d,decryptdata:t}))))).then(h=>{const d="cenc",g=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(h,d,g,"playlist-key")});return c.catch(h=>this.handleError(h,e.frag)),this.keyIdToKeySessionPromise[s]=c,c}return u.catch(c=>{if(c instanceof Zt){const h=Ge({},c.data);this.getKeyStatus(t)==="internal-error"&&(h.decryptdata=t);const d=new Zt(h,c.message);this.handleError(d,e.frag)}}),u}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Zt){t&&(e.data.frag=t);const s=e.data.decryptdata;this.error(`${e.message}${s?` (${Rt(s.keyId||[])})`:""}`),this.hls.trigger(b.ERROR,e.data)}else this.error(e.message),this.hls.trigger(b.ERROR,{type:ye.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=oo(e),s=this.keyIdToKeySessionPromise[t];if(!s){const r=So(e.keyFormat),a=r?[r]:va(this.config);return this.attemptKeySystemAccess(a)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=va(this.config)),e.length===0)throw new Zt({type:ye.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Xe({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(s).then(()=>this.media?this.media.setMediaKeys(t):new Promise((a,u)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return u(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(a).catch(u)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),s.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(a=>s.indexOf(a)===-1)})}generateRequestWithPreferredKeySession(e,t,s,r){var a;const u=(a=this.config.drmSystems)==null||(a=a[e.keySystem])==null?void 0:a.generateRequest;if(u)try{const S=u.call(this.hls,t,s,e);if(!S)throw new Error("Invalid response from configured generateRequest filter");t=S.initDataType,s=S.initData?S.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(S){if(this.warn(S.message),this.hls&&this.hls.config.debug)throw S}if(s===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const c=oo(e.decryptdata),h=e.decryptdata.uri;this.log(`Generating key-session request for "${r}" keyId: ${c} URI: ${h} (init data type: ${t} length: ${s.byteLength})`);const d=new Ed,g=e._onmessage=S=>{const x=e.mediaKeysSession;if(!x){d.emit("error",new Error("invalid state"));return}const{messageType:T,message:L}=S;this.log(`"${T}" message event for session "${x.sessionId}" message size: ${L.byteLength}`),T==="license-request"||T==="license-renewal"?this.renewLicense(e,L).catch(_=>{d.eventNames().length?d.emit("error",_):this.handleError(_)}):T==="license-release"?e.keySystem===et.FAIRPLAY&&this.updateKeySession(e,Hf("acknowledged")).then(()=>this.removeSession(e)).catch(_=>this.handleError(_)):this.warn(`unhandled media key message type "${T}"`)},m=(S,x)=>{x.keyStatus=S;let T;S.startsWith("usable")?d.emit("resolved"):S==="internal-error"||S==="output-restricted"||S==="output-downscaled"?T=zp(S,x.decryptdata):S==="expired"?T=new Error(`key expired (keyId: ${c})`):S==="released"?T=new Error("key released"):S==="status-pending"||this.warn(`unhandled key status change "${S}" (keyId: ${c})`),T&&(d.eventNames().length?d.emit("error",T):this.handleError(T))},v=e._onkeystatuseschange=S=>{if(!e.mediaKeysSession){d.emit("error",new Error("invalid state"));return}const T=this.getKeyStatuses(e);if(!Object.keys(T).some(O=>T[O]!=="status-pending"))return;if(T[c]==="expired"){this.log(`Expired key ${Xe(T)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let _=T[c];if(_)m(_,e);else{var I;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(I=e.keyStatusTimeouts)[c]||(I[c]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const k=this.getKeyStatus(e.decryptdata);if(k&&k!=="status-pending")return this.log(`No status for keyId ${c} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${k} from other session.`),m(k,e);this.log(`key status for ${c} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),_="internal-error",m(_,e)},1e3)),this.log(`No status for keyId ${c} (${Xe(T)}).`)}};Mt(e.mediaKeysSession,"message",g),Mt(e.mediaKeysSession,"keystatuseschange",v);const E=new Promise((S,x)=>{d.on("error",x),d.on("resolved",S)});return e.mediaKeysSession.generateRequest(t,s).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${c} URI: ${h}`)}).catch(S=>{throw new Zt({type:ye.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_NO_SESSION,error:S,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${S}`)}).then(()=>E).catch(S=>(d.removeAllListeners(),this.removeSession(e).then(()=>{throw S}))).then(()=>(d.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((s,r)=>{if(typeof r=="string"&&typeof s=="object"){const c=r;r=s,s=c}const a="buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);if(e.keySystem===et.PLAYREADY&&a.length===16){const c=Rt(a);t[c]=s,Wy(a)}const u=Rt(a);s==="internal-error"&&(this.bannedKeyIds[u]=s),this.log(`key status change "${s}" for keyStatuses keyId: ${u} key-session "${e.mediaKeysSession.sessionId}"`),t[u]=s}),t}fetchServerCertificate(e){const t=this.config,s=t.loader,r=new s(t),a=this.getServerCertificateUrl(e);return a?(this.log(`Fetching server certificate for "${e}"`),new Promise((u,c)=>{const h={responseType:"arraybuffer",url:a},d=t.certLoadPolicy.default,g={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(v,E,S,x)=>{u(v.data)},onError:(v,E,S,x)=>{c(new Zt({type:ye.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:Ge({url:h.url,data:void 0},v)},`"${e}" certificate request failed (${a}). Status: ${v.code} (${v.text})`))},onTimeout:(v,E,S)=>{c(new Zt({type:ye.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:{url:h.url,data:void 0}},`"${e}" certificate request timed out (${a})`))},onAbort:(v,E,S)=>{c(new Error("aborted"))}};r.load(h,g,m)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise((r,a)=>{e.setServerCertificate(s).then(u=>{this.log(`setServerCertificate ${u?"success":"not supported by CDM"} (${s.byteLength}) on "${t}"`),r(e)}).catch(u=>{a(new Zt({type:ye.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:u,fatal:!0},u.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(s=>this.updateKeySession(e,new Uint8Array(s)).catch(r=>{throw new Zt({type:ye.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:r,fatal:!1},r.message)}))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=new DOMParser().parseFromString(s,"application/xml"),a=r.querySelectorAll("HttpHeader");if(a.length>0){let g;for(let m=0,v=a.length;m<v;m++){var u,c;g=a[m];const E=(u=g.querySelector("name"))==null?void 0:u.textContent,S=(c=g.querySelector("value"))==null?void 0:c.textContent;E&&S&&e.setRequestHeader(E,S)}}const h=r.querySelector("Challenge"),d=h?.textContent;if(!d)throw new Error("Cannot find <Challenge> in key message");return Hf(atob(d))}setupLicenseXHR(e,t,s,r){const a=this.config.licenseXhrSetup;return a?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return a.call(this.hls,e,t,s,r)}).catch(u=>{if(!s.decryptdata)throw u;return e.open("POST",t,!0),a.call(this.hls,e,t,s,r)}).then(u=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:u||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise((r,a)=>{const u=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${u}`);const c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return a(new Error("invalid state"));if(c.readyState===4)if(c.status===200){this._requestLicenseFailureCount=0;let h=c.response;this.log(`License received ${h instanceof ArrayBuffer?h.byteLength:h}`);const d=this.config.licenseResponseCallback;if(d)try{h=d.call(this.hls,c,u,e)}catch(g){this.error(g)}r(h)}else{const h=s.errorRetry,d=h?h.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d||c.status>=400&&c.status<500)a(new Zt({type:ye.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:c,response:{url:u,data:void 0,code:c.status,text:c.statusText}},`License Request XHR failed (${u}). Status: ${c.status} (${c.statusText})`));else{const g=d-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${g} attempts left`),this.requestLicense(e,t).then(r,a)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=c,this.setupLicenseXHR(c,u,e,t).then(({xhr:h,licenseChallenge:d})=>{e.keySystem==et.PLAYREADY&&(d=this.unpackPlayReadyKeyMessage(h,d)),h.send(d)}).catch(a)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,Mt(s,"encrypted",this.onMediaEncrypted),Mt(s,"waitingforkey",this.onWaitingForKey);const r=this.mediaResolved;r?r():this.mediaKeys=s.mediaKeys}onMediaDetached(){const e=this.media;e&&(jt(e,"encrypted",this.onMediaEncrypted),jt(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const s=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,js.clearKeyUriToKeyIdMap();const a=r.length;hr.CDMCleanupPromise=Promise.all(r.map(u=>this.removeSession(u)).concat((s==null||(e=s.setMediaKeys(null))==null?void 0:e.catch(u=>{this.log(`Could not clear media keys: ${u}`),this.hls&&this.hls.trigger(b.ERROR,{type:ye.OTHER_ERROR,details:H.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${u}`)})}))||Promise.resolve())).catch(u=>{this.log(`Could not close sessions and clear media keys: ${u}`),this.hls&&this.hls.trigger(b.ERROR,{type:ye.OTHER_ERROR,details:H.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${u}`)})}).then(()=>{a&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const s=t.reduce((r,a)=>(r.indexOf(a.keyFormat)===-1&&r.push(a.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s,decryptdata:r}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Rt(r?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const a=this.mediaKeySessions.indexOf(e);a>-1&&this.mediaKeySessions.splice(a,1);const{keyStatusTimeouts:u}=e;u&&Object.keys(u).forEach(d=>self.clearTimeout(u[d]));const{drmSystemOptions:c}=this.config;return(Ob(c)?new Promise((d,g)=>{self.setTimeout(()=>g(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(d).catch(g)}):Promise.resolve()).catch(d=>{this.log(`Could not remove session: ${d}`),this.hls&&this.hls.trigger(b.ERROR,{type:ye.OTHER_ERROR,details:H.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${d}`)})}).then(()=>t.close()).catch(d=>{this.log(`Could not close session: ${d}`),this.hls&&this.hls.trigger(b.ERROR,{type:ye.OTHER_ERROR,details:H.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${d}`)})})}return Promise.resolve()}}hr.CDMCleanupPromise=void 0;function oo(l){if(!l)throw new Error("Could not read keyId of undefined decryptdata");if(l.keyId===null)throw new Error("keyId is null");return Rt(l.keyId)}function QR(l,e){if(l.keyId&&e.mediaKeysSession.keyStatuses.has(l.keyId))return e.mediaKeysSession.keyStatuses.get(l.keyId);if(l.matches(e.decryptdata))return e.keyStatus}class Zt extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function zp(l,e){const t=l==="output-restricted",s=t?H.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:H.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Zt({type:ye.KEY_SYSTEM_ERROR,details:s,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${l}"`)}class WR{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(b.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(b.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const r=performance.now();if(t){if(this.lastTime){const a=r-this.lastTime,u=s-this.lastDroppedFrames,c=t-this.lastDecodedFrames,h=1e3*u/a,d=this.hls;if(d.trigger(b.FPS_DROP,{currentDropped:u,currentDecoded:c,totalDroppedFrames:s}),h>0&&u>d.config.fpsDroppedMonitoringThreshold*c){let g=d.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+g),g>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=g)&&(g=g-1,d.trigger(b.FPS_DROP_LEVEL_CAPPING,{level:g,droppedLevel:d.currentLevel}),d.autoLevelCapping=g,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function Hv(l,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=l,e.dispatchEvent(t)}function Kv(l,e){const t=l.mode;if(t==="disabled"&&(l.mode="hidden"),l.cues&&!l.cues.getCueById(e.id))try{if(l.addCue(e),!l.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(s){je.debug(`[texttrack-utils]: ${s}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,l.addCue(r)}catch(r){je.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(l.mode=t)}function cr(l,e){const t=l.mode;if(t==="disabled"&&(l.mode="hidden"),l.cues)for(let s=l.cues.length;s--;)e&&l.cues[s].removeEventListener("enter",e),l.removeCue(l.cues[s]);t==="disabled"&&(l.mode=t)}function Zf(l,e,t,s){const r=l.mode;if(r==="disabled"&&(l.mode="hidden"),l.cues&&l.cues.length>0){const a=JR(l.cues,e,t);for(let u=0;u<a.length;u++)(!s||s(a[u]))&&l.removeCue(a[u])}r==="disabled"&&(l.mode=r)}function ZR(l,e){if(e<=l[0].startTime)return 0;const t=l.length-1;if(e>l[t].endTime)return-1;let s=0,r=t,a;for(;s<=r;)if(a=Math.floor((r+s)/2),e<l[a].startTime)r=a-1;else if(e>l[a].startTime&&s<t)s=a+1;else return a;return l[s].startTime-e<e-l[r].startTime?s:r}function JR(l,e,t){const s=[],r=ZR(l,e);if(r>-1)for(let a=r,u=l.length;a<u;a++){const c=l[a];if(c.startTime>=e&&c.endTime<=t)s.push(c);else if(c.startTime>t)return s}return s}function bo(l){const e=[];for(let t=0;t<l.length;t++){const s=l[t];(s.kind==="subtitles"||s.kind==="captions")&&s.label&&e.push(l[t])}return e}class e1 extends Rd{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const s=bo(this.media.textTracks);for(let a=0;a<s.length;a++)if(s[a].mode==="hidden")t=s[a];else if(s[a].mode==="showing"){t=s[a];break}const r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(b.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;bo(s.textTracks).forEach(u=>{cr(u)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:r,details:a}=t,u=this.tracksInGroup[s];if(!u||u.groupId!==r){this.warn(`Subtitle track with id:${s} and group:${r} not found in active group ${u?.groupId}`);return}const c=u.details;u.details=t.details,this.log(`Subtitle track ${s} "${u.name}" lang:${u.lang} group:${r} loaded [${a.startSN}-${a.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,r=this.groupIds;let a=this.currentTrack;if(!s||r?.length!==s?.length||s!=null&&s.some(u=>r?.indexOf(u)===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const u=this.tracks.filter(g=>!s||s.indexOf(g.groupId)!==-1);if(u.length)this.selectDefaultTrack&&!u.some(g=>g.default)&&(this.selectDefaultTrack=!1),u.forEach((g,m)=>{g.id=m});else if(!a&&!this.tracksInGroup.length)return;this.tracksInGroup=u;const c=this.hls.config.subtitlePreference;if(!a&&c){this.selectDefaultTrack=!1;const g=Ni(c,u);if(g>-1)a=u[g];else{const m=Ni(c,this.tracks);a=this.tracks[m]}}let h=this.findTrackId(a);h===-1&&a&&(h=this.findTrackId(null));const d={subtitleTracks:u};this.log(`Updating subtitle tracks, ${u.length} track(s) found in "${s?.join(",")}" group-id`),this.hls.trigger(b.SUBTITLE_TRACKS_UPDATED,d),h!==-1&&this.trackId===-1&&this.setSubtitleTrack(h)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const a=t[r];if(!(s&&!a.default||!s&&!e)&&(!e||mn(a,e)))return r}if(e){for(let r=0;r<t.length;r++){const a=t[r];if(Ia(e.attrs,a.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const a=t[r];if(Ia(e.attrs,a.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const r=t[s];if(qf(r,e))return s}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===_e.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&mn(e,s))return s;const r=Ni(e,this.tracksInGroup);if(r>-1){const a=this.tracksInGroup[r];return this.setSubtitleTrack(r),a}else{if(s)return null;{const a=Ni(e,t);if(a>-1)return t[a]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,r=e.groupId,a=this.getUrlWithDirectives(e.url,t),u=e.details,c=u?.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&u.live?" age "+c.toFixed(1)+(u.type&&" "+u.type||""):""} ${a}`),this.hls.trigger(b.SUBTITLE_TRACK_LOADING,{url:a,id:s,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=bo(e.textTracks),s=this.currentTrack;let r;if(s&&(r=t.filter(a=>qf(s,a))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach(a=>{a.mode!=="disabled"&&a!==r&&(a.mode="disabled")}),r){const a=this.subtitleDisplay?"showing":"hidden";r.mode!==a&&(r.mode=a)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!fe(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(b.SUBTITLE_TRACK_SWITCH,{id:e});return}const a=!!r.details&&!r.details.live;if(e===this.trackId&&r===s&&a)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:u,groupId:c="",name:h,type:d,url:g}=r;this.hls.trigger(b.SUBTITLE_TRACK_SWITCH,{id:u,groupId:c,name:h,type:d,url:g});const m=this.switchParams(r.url,s?.details,r.details);this.loadPlaylist(m)}}function t1(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const a=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?a:a&3|8).toString(16)})}}}function Ta(l){let e=5381,t=l.length;for(;t;)e=e*33^l.charCodeAt(--t);return(e>>>0).toString()}const gr=.025;let Uo=(function(l){return l[l.Point=0]="Point",l[l.Range=1]="Range",l})({});function i1(l,e,t){return`${l.identifier}-${t+1}-${Ta(e)}`}class s1{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const s=this.playoutLimit;return e<=0||isNaN(s)?!1:s===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>s}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return bf(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,s=bf(t,e);return t-s<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=fe(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return bf(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<gr))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Uo.Range:Uo.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return n1(this)}}function bf(l,e){return l-e.start<e.duration/2&&!(Math.abs(l-(e.start+e.duration))<gr)?e.start:e.start+e.duration}function zv(l,e,t){const s=new self.URL(l,t);return s.protocol!=="data:"&&s.searchParams.set("_HLS_primary_id",e),s}function Lf(l,e){for(;(t=l.assetList[++e])!=null&&t.error;)var t;return e}function n1(l){return`["${l.identifier}" ${l.cue.pre?"<pre>":l.cue.post?"<post>":""}${l.timelineStart.toFixed(2)}-${l.resumeTime.toFixed(2)}]`}function ur(l){const e=l.timelineStart,t=l.duration||0;return`["${l.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class r1{constructor(e,t,s,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(b.PLAYOUT_LIMIT_REACHED,{})};const a=this.hls=new e(t);this.interstitial=s,this.assetItem=r;const u=()=>{this.hasDetails=!0};a.once(b.LEVEL_LOADED,u),a.once(b.AUDIO_TRACK_LOADED,u),a.once(b.SUBTITLE_TRACK_LOADED,u),a.on(b.MEDIA_ATTACHING,(c,{media:h})=>{this.removeMediaListeners(),this.mediaAttached=h,this.interstitial.playoutLimit&&(h.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&a.on(b.BUFFER_APPENDED,()=>{const g=this.bufferedEnd;this.reachedPlayout(g)&&(this._bufferedEosTime=g,a.trigger(b.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=zv(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const s=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,a=xe.bufferInfo(e,r,0);return this.getAssetTime(a.end)>=s-.02}reachedPlayout(e){const s=this.interstitial.playoutLimit;return this.startOffset+e>=s}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=xe.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const s=t-this.startOffset;if(s>0&&s<e)return s}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=s=>delete s.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,s){var r;(r=this.hls)==null||r.on(e,t)}once(e,t,s){var r;(r=this.hls)==null||r.once(e,t)}off(e,t,s){var r;(r=this.hls)==null||r.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${ur(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Vp=.033;class a1 extends vi{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((s,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,s+1):s,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[s]||(t===void 0&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&(a=r[s])!=null&&a.event;){var a;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let r=0;r<s.length;r++){let a=s[r];if(t&&t!=="primary"&&(a=a[t]),e===a.start||e>a.start&&e<a.end)return r}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let r=e;r<=t&&s[r];r++){const a=s[r].event;if(a!=null&&a.restrictions.jump&&!a.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var s;if(((s=t[r].event)==null?void 0:s.identifier)===e)return r}return-1}findAssetIndex(e,t){const s=e.assetList,r=s.length;if(r>1)for(let a=0;a<r;a++){const u=s[a];if(!u.error){const c=u.timelineStart;if(t===c||t>c&&(t<c+(u.duration||0)||a===r-1))return a}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const s=t.assetList,r=s[s.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:r}=s,a=this.events,u=this.parseDateRanges(r,{url:s.url},t),c=Object.keys(r),h=a?a.filter(d=>!c.includes(d.identifier)):[];u.length&&u.sort((d,g)=>{const m=d.cue.pre,v=d.cue.post,E=g.cue.pre,S=g.cue.post;if(m&&!E)return-1;if(E&&!m||v&&!S)return 1;if(S&&!v)return-1;if(!m&&!E&&!v&&!S){const x=d.startTime,T=g.startTime;if(x!==T)return x-T}return d.dateRange.tagOrder-g.dateRange.tagOrder}),this.events=u,h.forEach(d=>{this.removeEvent(d)}),this.updateSchedule(e,h)}updateSchedule(e,t=[],s=!1){const r=this.events||[];if(r.length||t.length||this.length<2){const a=this.items,u=this.parseSchedule(r,e);(s||t.length||a?.length!==u.length||u.some((h,d)=>Math.abs(h.playout.start-a[d].playout.start)>.005||Math.abs(h.playout.end-a[d].playout.end)>.005))&&(this.items=u,this.onScheduleUpdate(t,a))}}parseDateRanges(e,t,s){const r=[],a=Object.keys(e);for(let u=0;u<a.length;u++){const c=a[u],h=e[c];if(h.isInterstitial){let d=this.eventMap[c];d?d.setDateRange(h):(d=new s1(h,t),this.eventMap[c]=d,s===!1&&(d.appendInPlace=s)),r.push(d)}}return r}parseSchedule(e,t){const s=[],r=t.main.details,a=r.live?1/0:r.edge;let u=0;if(e=e.filter(h=>!h.error&&!(h.cue.once&&h.hasPlayed)),e.length){this.resolveOffsets(e,t);let h=0,d=0;if(e.forEach((g,m)=>{const v=g.cue.pre,E=g.cue.post,S=e[m-1]||null,x=g.appendInPlace,T=E?a:g.startOffset,L=g.duration,_=g.timelineOccupancy===Uo.Range?L:0,I=g.resumptionOffset,O=S?.startTime===T,k=T+g.cumulativeDuration;let K=x?k+L:T+I;if(v||!E&&T<=0){const B=d;d+=_,g.timelineStart=k;const $=u;u+=L,s.push({event:g,start:k,end:K,playout:{start:$,end:u},integrated:{start:B,end:d}})}else if(T<=a){if(!O){const U=T-h;if(U>Vp){const W=h,ne=d;d+=U;const ce=u;u+=U;const he={previousEvent:e[m-1]||null,nextEvent:g,start:W,end:W+U,playout:{start:ce,end:u},integrated:{start:ne,end:d}};s.push(he)}else U>0&&S&&(S.cumulativeDuration+=U,s[s.length-1].end=T)}E&&(K=k),g.timelineStart=k;const B=d;d+=_;const $=u;u+=L,s.push({event:g,start:k,end:K,playout:{start:$,end:u},integrated:{start:B,end:d}})}else return;const w=g.resumeTime;E||w>a?h=a:h=w}),h<a){var c;const g=h,m=d,v=a-h;d+=v;const E=u;u+=v,s.push({previousEvent:((c=s[s.length-1])==null?void 0:c.event)||null,nextEvent:null,start:h,end:g+v,playout:{start:E,end:u},integrated:{start:m,end:d}})}this.setDurations(a,u,d)}else s.push({previousEvent:null,nextEvent:null,start:0,end:a,playout:{start:0,end:a},integrated:{start:0,end:a}}),this.setDurations(a,a,a);return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,r=s.live?1/0:s.edge;let a=0,u=-1;e.forEach((c,h)=>{const d=c.cue.pre,g=c.cue.post,m=d?0:g?r:c.startTime;this.updateAssetDurations(c),u===m?c.cumulativeDuration=a:(a=0,u=m),!g&&c.snapOptions.in&&(c.resumeAnchor=pn(null,s.fragments,c.startOffset+c.resumptionOffset,0,0)||void 0),c.appendInPlace&&!c.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(c,t)||(c.appendInPlace=!1)),!c.appendInPlace&&h+1<e.length&&e[h+1].startTime-e[h].resumeTime<Vp&&(e[h+1].appendInPlace=!1,e[h+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${c}`));const E=fe(c.resumeOffset)?c.resumeOffset:c.duration;a+=E})}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(s-r)>gr?(this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${r}`),!1):!Object.keys(t).some(u=>{const c=t[u].details,h=c.edge;if(s>=h)return this.log(`"${e.identifier}" resumption ${s} past ${u} playlist end ${h}`),!1;const d=pn(null,c.fragments,s);if(!d)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${u} playlist (${c.fragStart}-${c.fragmentEnd})`),!0;const g=u==="audio"?.175:0;return Math.abs(d.start-s)<gr+g||Math.abs(d.end-s)<gr+g?!1:(this.log(`"${e.identifier}" resumption ${s} not aligned with ${u} fragment bounds (${d.start}-${d.end} sn: ${d.sn} cc: ${d.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,r=!1,a=!1;for(let u=0;u<e.assetList.length;u++){const c=e.assetList[u],h=t+s;c.startOffset=s,c.timelineStart=h,r||(r=c.duration===null),a||(a=!!c.error);const d=c.error?0:c.duration||0;s+=d}r&&!a?e.duration=Math.max(s,e.duration):e.duration=s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function bi(l){return`[${l.event?'"'+l.event.identifier+'"':"primary"}: ${l.start.toFixed(2)}-${l.end.toFixed(2)}]`}class l1{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let r;try{r=zv(s,this.hls.sessionId,e.baseUrl)}catch(v){const E=this.assignAssetListError(e,H.ASSET_LIST_LOAD_ERROR,v,s);this.hls.trigger(b.ERROR,E);return}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);const a=this.hls.config,u=a.loader,c=new u(a),h={responseType:"json",url:r.href},d=a.interstitialAssetListLoadPolicy.default,g={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(v,E,S,x)=>{const T=v.data,L=T?.ASSETS;if(!Array.isArray(L)){const _=this.assignAssetListError(e,H.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),S.url,E,x);this.hls.trigger(b.ERROR,_);return}e.assetListResponse=T,this.hls.trigger(b.ASSET_LIST_LOADED,{event:e,assetListResponse:T,networkDetails:x})},onError:(v,E,S,x)=>{const T=this.assignAssetListError(e,H.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${v.code} ${v.text} (${E.url})`),E.url,x,S);this.hls.trigger(b.ERROR,T)},onTimeout:(v,E,S)=>{const x=this.assignAssetListError(e,H.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${E.url})`),E.url,v,S);this.hls.trigger(b.ERROR,x)}};return c.load(h,g,m),this.hls.trigger(b.ASSET_LIST_LOADING,{event:e}),c}assignAssetListError(e,t,s,r,a,u){return e.error=s,{type:ye.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:s,networkDetails:u,stats:a}}}function Yp(l){var e;l==null||(e=l.play())==null||e.catch(()=>{})}function uo(l,e){return`[${l}] Advancing timeline position to ${e}`}class o1 extends vi{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled||!this.schedule)return;const r=s-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const u=r<=-.01;this.timelinePos=s,this.bufferedPos=s;const c=this.playingItem;if(!c){this.checkBuffer();return}if(u&&this.schedule.resetErrorsInRange(s,s-r)&&this.updateSchedule(!0),this.checkBuffer(),u&&s<c.start||s>=c.end){var h;const E=this.findItemIndex(c);let S=this.schedule.findItemIndexAtTime(s);if(S===-1&&(S=E+(u?-1:1),this.log(`seeked ${u?"back ":""}to position not covered by schedule ${s} (resolving from ${E} to ${S})`)),!this.isInterstitial(c)&&(h=this.media)!=null&&h.paused&&(this.shouldPlay=!1),!u&&S>E){const x=this.schedule.findJumpRestrictedIndex(E+1,S);if(x>E){this.setSchedulePosition(x);return}}this.setSchedulePosition(S);return}const d=this.playingAsset;if(!d){if(this.playingLastItem&&this.isInterstitial(c)){const E=c.event.assetList[0];E&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(s,E))}return}const g=d.timelineStart,m=d.duration||0;if(u&&s<g||s>=g+m){var v;(v=c.event)!=null&&v.appendInPlace&&(this.clearAssetPlayers(c.event,c),this.flushFrontBuffer(s)),this.setScheduleToAssetAtTime(s,d)}},this.onTimeupdate=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled)return;if(s>this.timelinePos)this.timelinePos=s,s>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(s>=r.end){this.timelinePos=r.end;const c=this.findItemIndex(r);this.setSchedulePosition(c+1)}const a=this.playingAsset;if(!a)return;const u=a.timelineStart+(a.duration||0);s>=u&&this.setScheduleToAssetAtTime(s,a)},this.onScheduleUpdate=(s,r)=>{const a=this.schedule;if(!a)return;const u=this.playingItem,c=a.events||[],h=a.items||[],d=a.durations,g=s.map(x=>x.identifier),m=!!(c.length||g.length);(m||r)&&this.log(`INTERSTITIALS_UPDATED (${c.length}): ${c}
Schedule: ${h.map(x=>bi(x))} pos: ${this.timelinePos}`),g.length&&this.log(`Removed events ${g}`);let v=null,E=null;u&&(v=this.updateItem(u,this.timelinePos),this.itemsMatch(u,v)?this.playingItem=v:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const S=this.bufferingItem;if(S&&(E=this.updateItem(S,this.bufferedPos),this.itemsMatch(S,E)?this.bufferingItem=E:S.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(S.event,null))),s.forEach(x=>{x.assetList.forEach(T=>{this.clearAssetPlayer(T.identifier,null)})}),this.playerQueue.forEach(x=>{if(x.interstitial.appendInPlace){const T=x.assetItem.timelineStart,L=x.timelineOffset-T;if(L)try{x.timelineOffset=T}catch(_){Math.abs(L)>gr&&this.warn(`${_} ("${x.assetId}" ${x.timelineOffset}->${T})`)}}}),m||r){if(this.hls.trigger(b.INTERSTITIALS_UPDATED,{events:c.slice(0),schedule:h.slice(0),durations:d,removedIds:g}),this.isInterstitial(u)&&g.includes(u.event.identifier)){this.warn(`Interstitial "${u.event.identifier}" removed while playing`),this.primaryFallback(u.event);return}u&&this.trimInPlace(v,u),S&&E!==v&&this.trimInPlace(E,S),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new l1(e),this.schedule=new a1(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(b.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(b.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(b.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(b.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(b.BUFFER_APPENDED,this.onBufferAppended,this),e.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(b.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(b.MEDIA_ENDED,this.onMediaEnded,this),e.on(b.ERROR,this.onError,this),e.on(b.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(b.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(b.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(b.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(b.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(b.BUFFER_CODECS,this.onBufferCodecs,this),e.off(b.BUFFER_APPENDED,this.onBufferAppended,this),e.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(b.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(b.MEDIA_ENDED,this.onMediaEnded,this),e.off(b.ERROR,this.onError,this),e.off(b.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){jt(e,"play",this.onPlay),jt(e,"pause",this.onPause),jt(e,"seeking",this.onSeeking),jt(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;Mt(s,"seeking",this.onSeeking),Mt(s,"timeupdate",this.onTimeupdate),Mt(s,"play",this.onPlay),Mt(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,s===null)this.checkStart();else if(!r){this.clearScheduleState();const a=this.findItemIndex(s);this.setSchedulePosition(a)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,r=this.media;if(this.media=null,!s&&(r&&this.removeMediaListeners(r),this.detachedData)){const a=this.getBufferingPlayer();a&&(this.log(`Removing schedule state for detachedData and ${a}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,a.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=m=>m&&e.getAssetPlayer(m.identifier),r=(m,v,E,S,x)=>{if(m){let T=m[v].start;const L=m.event;if(L){if(v==="playout"||L.timelineOccupancy!==Uo.Point){const _=s(E);_?.interstitial===L&&(T+=_.assetItem.startOffset+_[x])}}else{const _=S==="bufferedPos"?u():e[S];T+=_-m.start}return T}return 0},a=(m,v)=>{var E;if(m!==0&&v!=="primary"&&(E=e.schedule)!=null&&E.length){var S;const x=e.schedule.findItemIndexAtTime(m),T=(S=e.schedule.items)==null?void 0:S[x];if(T){const L=T[v].start-T.start;return m+L}}return m},u=()=>{const m=e.bufferedPos;return m===Number.MAX_VALUE?c("primary"):Math.max(m,0)},c=m=>{var v,E;return(v=e.primaryDetails)!=null&&v.live?e.primaryDetails.edge:((E=e.schedule)==null?void 0:E.durations[m])||0},h=(m,v)=>{var E,S;const x=e.effectivePlayingItem;if(x!=null&&(E=x.event)!=null&&E.restrictions.skip||!e.schedule)return;e.log(`seek to ${m} "${v}"`);const T=e.effectivePlayingItem,L=e.schedule.findItemIndexAtTime(m,v),_=(S=e.schedule.items)==null?void 0:S[L],I=e.getBufferingPlayer(),O=I?.interstitial,k=O?.appendInPlace,K=T&&e.itemsMatch(T,_);if(T&&(k||K)){const w=s(e.playingAsset),B=w?.media||e.primaryMedia;if(B){const $=v==="primary"?B.currentTime:r(T,v,e.playingAsset,"timelinePos","currentTime"),U=m-$,W=(k?$:B.currentTime)+U;if(W>=0&&(!w||k||W<=w.duration)){B.currentTime=W;return}}}if(_){let w=m;if(v!=="primary"){const $=_[v].start,U=m-$;w=_.start+U}const B=!e.isInterstitial(_);if((!e.isInterstitial(T)||T.event.appendInPlace)&&(B||_.event.appendInPlace)){const $=e.media||(k?I?.media:null);$&&($.currentTime=w)}else if(T){const $=e.findItemIndex(T);if(L>$){const W=e.schedule.findJumpRestrictedIndex($+1,L);if(W>$){e.setSchedulePosition(W);return}}let U=0;if(B)e.timelinePos=w,e.checkBuffer();else{const W=_.event.assetList,ne=m-(_[v]||_).start;for(let ce=W.length;ce--;){const he=W[ce];if(he.duration&&ne>=he.startOffset&&ne<he.startOffset+he.duration){U=ce;break}}}e.setSchedulePosition(L,U)}}},d=()=>{const m=e.effectivePlayingItem;if(e.isInterstitial(m))return m;const v=t();return e.isInterstitial(v)?v:null},g={get bufferedEnd(){const m=t(),v=e.bufferingItem;if(v&&v===m){var E;return r(v,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-v.playout.start||((E=e.bufferingAsset)==null?void 0:E.startOffset)||0}return 0},get currentTime(){const m=d(),v=e.effectivePlayingItem;return v&&v===m?r(v,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-v.playout.start:0},set currentTime(m){const v=d(),E=e.effectivePlayingItem;E&&E===v&&h(m+E.playout.start,"playout")},get duration(){const m=d();return m?m.playout.end-m.playout.start:0},get assetPlayers(){var m;const v=(m=d())==null?void 0:m.event.assetList;return v?v.map(E=>e.getAssetPlayer(E.identifier)):[]},get playingIndex(){var m;const v=(m=d())==null?void 0:m.event;return v&&e.effectivePlayingAsset?v.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return d()}};return this.manager={get events(){var m;return((m=e.schedule)==null||(m=m.events)==null?void 0:m.slice(0))||[]},get schedule(){var m;return((m=e.schedule)==null||(m=m.items)==null?void 0:m.slice(0))||[]},get interstitialPlayer(){return d()?g:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const m=t();return e.findItemIndex(m)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const m=e.effectivePlayingItem;return e.findItemIndex(m)},primary:{get bufferedEnd(){return u()},get currentTime(){const m=e.timelinePos;return m>0?m:0},set currentTime(m){h(m,"primary")},get duration(){return c("primary")},get seekableStart(){var m;return((m=e.primaryDetails)==null?void 0:m.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(m){h(m,"integrated")},get duration(){return c("integrated")},get seekableStart(){var m;return a(((m=e.primaryDetails)==null?void 0:m.fragmentStart)||0,"integrated")}},skip:()=>{const m=e.effectivePlayingItem,v=m?.event;if(v&&!v.restrictions.skip){const E=e.findItemIndex(m);if(v.appendInPlace){const S=m.playout.start+m.event.duration;h(S+.001,"playout")}else e.advanceAfterAssetEnded(v,E,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!s?!1:this.findItemIndex(t)===s.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let r=this.media;!r&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(r=this.primaryMedia);const a=(t=r)==null?void 0:t.currentTime;if(!(a===void 0||!fe(a)))return a}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,r=e.media;if(s&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}const a=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Xe(a)}`),this.detachedData=a}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var s,r;if(e.media===t)return;let a=null;const u=this.hls,c=e!==u,h=c&&e.interstitial.appendInPlace,d=(s=this.detachedData)==null?void 0:s.mediaSource;let g;if(u.media)h&&(a=u.transferMedia(),this.detachedData=a),g="Primary";else if(d){const S=this.getBufferingPlayer();S?(a=S.transferMedia(),g=`${S}`):g="detached MediaSource"}else g="detached media";if(!a){if(d)a=this.detachedData,this.log(`using detachedData: MediaSource ${Xe(a)}`);else if(!this.detachedData||u.media===t){const S=this.playerQueue;S.length>1&&S.forEach(x=>{if(c&&x.interstitial.appendInPlace!==h){const T=x.interstitial;this.clearInterstitial(x.interstitial,null),T.appendInPlace=!1,T.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${T}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const m=a&&"mediaSource"in a&&((r=a.mediaSource)==null?void 0:r.readyState)!=="closed",v=m&&a?a:t;this.log(`${m?"transfering MediaSource":"attaching media"} to ${c?e:"Primary"} from ${g} (media.currentTime: ${t.currentTime})`);const E=this.schedule;if(v===a&&E){const S=c&&e.assetId===E.assetIdAtEnd;v.overrides={duration:E.duration,endOfStream:!c||S,cueRemoval:!c}}e.attachMedia(v)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const s=this.timelinePos,r=this.effectivePlayingItem;if(s===-1){const a=this.hls.startPosition;if(this.log(uo("checkStart",a)),this.timelinePos=a,t.length&&t[0].cue.pre){const u=e.findEventIndex(t[0].identifier);this.setSchedulePosition(u)}else if(a>=0||!this.primaryLive){const u=this.timelinePos=a>0?a:0,c=e.findItemIndexAtTime(u);this.setSchedulePosition(c)}}else if(r&&!this.playingItem){const a=e.findItemIndex(r);this.setSchedulePosition(a)}}advanceAssetBuffering(e,t){const s=e.event,r=s.findAssetIndex(t),a=Lf(s,r);if(!s.isAssetPastPlayoutLimit(a))this.bufferedToEvent(e,a);else if(this.schedule){var u;const c=(u=this.schedule.items)==null?void 0:u[this.findItemIndex(e)+1];c&&this.bufferedToItem(c)}}advanceAfterAssetEnded(e,t,s){const r=Lf(e,s);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){const a=this.schedule.items;if(a){const u=t+1,c=a.length;if(u>=c){this.setSchedulePosition(-1);return}const h=e.resumeTime;this.timelinePos<h&&(this.log(uo("advanceAfterAssetEnded",h)),this.timelinePos=h,e.appendInPlace&&this.advanceInPlace(h),this.checkBuffer(this.bufferedPos<h)),this.setSchedulePosition(u)}}}else{if(e.appendInPlace){const a=e.assetList[r];a&&this.advanceInPlace(a.timelineStart)}this.setSchedulePosition(t,r)}}setScheduleToAssetAtTime(e,t){const s=this.schedule;if(!s)return;const r=t.parentIdentifier,a=s.getEvent(r);if(a){const u=s.findEventIndex(r),c=s.findAssetIndex(a,e);this.advanceAfterAssetEnded(a,u,c-1)}}setSchedulePosition(e,t){var s;const r=(s=this.schedule)==null?void 0:s.items;if(!r||this.playbackDisabled)return;const a=e>=0?r[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${a&&bi(a)}) pos: ${this.timelinePos}`);const u=this.waitingItem||this.playingItem,c=this.playingLastItem;if(this.isInterstitial(u)){const g=u.event,m=this.playingAsset,v=m?.identifier,E=v?this.getAssetPlayer(v):null;if(E&&v&&(!this.eventItemsMatch(u,a)||t!==void 0&&v!==g.assetList[t].identifier)){var h;const S=g.findAssetIndex(m);if(this.log(`INTERSTITIAL_ASSET_ENDED ${S+1}/${g.assetList.length} ${ur(m)}`),this.endedAsset=m,this.playingAsset=null,this.hls.trigger(b.INTERSTITIAL_ASSET_ENDED,{asset:m,assetListIndex:S,event:g,schedule:r.slice(0),scheduleIndex:e,player:E}),u!==this.playingItem){this.itemsMatch(u,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(g,this.findItemIndex(this.playingItem),S);return}this.retreiveMediaSource(v,a),E.media&&!((h=this.detachedData)!=null&&h.mediaSource)&&E.detachMedia()}if(!this.eventItemsMatch(u,a)&&(this.endedItem=u,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${g} ${bi(u)}`),g.hasPlayed=!0,this.hls.trigger(b.INTERSTITIAL_ENDED,{event:g,schedule:r.slice(0),scheduleIndex:e}),g.cue.once)){var d;this.updateSchedule();const S=(d=this.schedule)==null?void 0:d.items;if(a&&S){const x=this.findItemIndex(a);this.advanceSchedule(x,S,t,u,c)}return}}this.advanceSchedule(e,r,t,u,c)}advanceSchedule(e,t,s,r,a){const u=this.schedule;if(!u)return;const c=t[e]||null,h=this.primaryMedia,d=this.playerQueue;if(d.length&&d.forEach(g=>{const m=g.interstitial,v=u.findEventIndex(m.identifier);(v<e||v>e+1)&&this.clearInterstitial(m,c)}),this.isInterstitial(c)){this.timelinePos=Math.min(Math.max(this.timelinePos,c.start),c.end);const g=c.event;if(s===void 0){s=u.findAssetIndex(g,this.timelinePos);const S=Lf(g,s-1);if(g.isAssetPastPlayoutLimit(S)||g.appendInPlace&&this.timelinePos===c.end){this.advanceAfterAssetEnded(g,e,s);return}s=S}const m=this.waitingItem;this.assetsBuffered(c,h)||this.setBufferingItem(c);let v=this.preloadAssets(g,s);if(this.eventItemsMatch(c,m||r)||(this.waitingItem=c,this.log(`INTERSTITIAL_STARTED ${bi(c)} ${g.appendInPlace?"append in place":""}`),this.hls.trigger(b.INTERSTITIAL_STARTED,{event:g,schedule:t.slice(0),scheduleIndex:e})),!g.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${g}`);return}if(g.assetListLoader&&(g.assetListLoader.destroy(),g.assetListLoader=void 0),!h){this.log(`Waiting for attachMedia to start Interstitial ${g}`);return}this.waitingItem=this.endedItem=null,this.playingItem=c;const E=g.assetList[s];if(!E){this.advanceAfterAssetEnded(g,e,s||0);return}if(v||(v=this.getAssetPlayer(E.identifier)),v===null||v.destroyed){const S=g.assetList.length;this.warn(`asset ${s+1}/${S} player destroyed ${g}`),v=this.createAssetPlayer(g,E,s),v.loadSource()}if(!this.eventItemsMatch(c,this.bufferingItem)&&g.appendInPlace&&this.isAssetBuffered(E))return;this.startAssetPlayer(v,s,t,e,h),this.shouldPlay&&Yp(v.media)}else c?(this.resumePrimary(c,e,r),this.shouldPlay&&Yp(this.hls.media)):a&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(u.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,s){var r,a;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${bi(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let c=this.timelinePos;(c<e.start||c>=e.end)&&(c=this.getPrimaryResumption(e,t),this.log(uo("resumePrimary",c)),this.timelinePos=c),this.attachPrimary(c,e)}if(!s)return;const u=(a=this.schedule)==null?void 0:a.items;u&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${bi(e)}`),this.hls.trigger(b.INTERSTITIALS_PRIMARY_RESUMED,{schedule:u.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const r=this.primaryDetails;if(t===0)return this.hls.startPosition;if(r&&(s<r.fragmentStart||s>r.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:xe.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const a=this.hls;a.media?this.checkBuffer():(this.transferMediaTo(a,r),s&&this.startLoadingPrimaryAt(e,s)),s||(this.log(uo("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((s=r.mainForwardBufferInfo)==null?void 0:s.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(b.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(b.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const s=this.hls.levels[t.level];if(!s.details)return;const r=Ge(Ge({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Ge(Ge({},this.altSelection),{},{audio:s});return}const a=Ge(Ge({},r),{},{audio:s});this.mediaSelection=a}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Ge(Ge({},this.altSelection),{},{subtitles:s});return}const a=Ge(Ge({},r),{},{subtitles:s});this.mediaSelection=a}onAudioTrackSwitching(e,t){const s=ip(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setAudioOption(t)||r.setAudioOption(s)))}onSubtitleTrackSwitch(e,t){const s=ip(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setSubtitleOption(t)||t.id!==-1&&r.setSubtitleOption(s)))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let r=0;r<t.length;r++){const a=t[r];if(a.cue.post){var s;const u=this.schedule.findEventIndex(a.identifier),c=(s=this.schedule.items)==null?void 0:s[u];this.isInterstitial(c)&&this.eventItemsMatch(c,this.bufferingItem)&&this.bufferedToItem(c,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const s=this.findItemIndex(t);this.setSchedulePosition(s+1)}else this.shouldPlay=!1}updateItem(e,t){var s;const r=(s=this.schedule)==null?void 0:s.items;if(e&&r){const a=this.findItemIndex(e,t);return r[a]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((a,u)=>{e.event.isAssetPastPlayoutLimit(u)&&this.clearAssetPlayer(a.identifier,null)});const s=e.end+.25,r=xe.bufferInfo(this.primaryMedia,s,0);(r.end>s||(r.nextStart||0)>s)&&(this.log(`trim buffered interstitial ${bi(e)} (was ${bi(t)})`),this.attachPrimary(s,null,!0),this.flushFrontBuffer(s))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===((s=t.event)==null?void 0:s.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const s=this.mediaSelection;s&&((t=this.schedule)==null||t.updateSchedule(s,[],e))}checkBuffer(e){var t;const s=(t=this.schedule)==null?void 0:t.items;if(!s)return;const r=xe.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,s,e)}updateBufferedPos(e,t,s){const r=this.schedule,a=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(t.length===1&&this.itemsMatch(t[0],a)){this.bufferedPos=e;return}const u=this.playingItem,c=this.findItemIndex(u);let h=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var d;const g=this.findItemIndex(a),m=Math.min(g+1,t.length-1),v=t[m];if((h===-1&&a&&e>=a.end||(d=v.event)!=null&&d.appendInPlace&&e+.01>=v.start)&&(h=m),this.isInterstitial(a)){const E=a.event;if(m-c>1&&E.appendInPlace===!1||E.assetList.length===0&&E.assetListLoader)return}if(this.bufferedPos=e,h>g&&h>c)this.bufferedToItem(v);else{const E=this.primaryDetails;this.primaryLive&&E&&e>E.edge-E.targetduration&&v.start<E.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(v)&&this.preloadAssets(v.event,0)}}else s&&u&&!this.itemsMatch(u,a)&&(h===c?this.bufferedToItem(u):h===c+1&&this.bufferedToItem(t[h]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{const a=this.getAssetPlayer(r.identifier);return!(a!=null&&a.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(!this.itemsMatch(e,t)&&s){const{items:r,events:a}=s;if(!r||!a)return t;const u=this.isInterstitial(e),c=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const h=c?c.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${bi(e)}`+(t?` (${h.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(u){const d=s.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((g,m)=>{const v=this.getAssetPlayer(g.identifier);v&&(m===d&&v.loadSource(),v.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(d=>d.pauseBuffering());this.hls.trigger(b.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:a.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(s!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,r=s.assetList.length===0&&!s.assetListLoader,a=s.cue.once;if(r||!a){const u=this.preloadAssets(s,t);if(u!=null&&u.interstitial.appendInPlace){const c=this.primaryMedia;c&&this.bufferAssetPlayer(u,c)}}}preloadAssets(e,t){const s=e.assetUrl,r=e.assetList.length,a=r===0&&!e.assetListLoader,u=e.cue.once;if(a){const h=e.timelineStart;if(e.appendInPlace){var c;const v=this.playingItem;!this.isInterstitial(v)&&(v==null||(c=v.nextEvent)==null?void 0:c.identifier)===e.identifier&&this.flushFrontBuffer(h+.25)}let d,g=0;if(!this.playingItem&&this.primaryLive&&(g=this.hls.startPosition,g===-1&&(g=this.hls.liveSyncPosition||0)),g&&!(e.cue.pre||e.cue.post)){const v=g-h;v>0&&(d=Math.round(v*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:r} ${e}${d?` live-start: ${g} start-offset: ${d}`:""}`),s)return this.createAsset(e,0,0,h,e.duration,s);const m=this.assetListLoader.loadAssetList(e,d);m&&(e.assetListLoader=m)}else if(!u&&r){for(let d=t;d<r;d++){const g=e.assetList[d],m=this.getAssetPlayerQueueIndex(g.identifier);(m===-1||this.playerQueue[m].destroyed)&&!g.error&&this.createAssetPlayer(e,g,d)}const h=e.assetList[t];if(h){const d=this.getAssetPlayer(h.identifier);return d&&d.loadSource(),d}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(r=>{this.hls.trigger(b.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s]}return null}createAsset(e,t,s,r,a,u){const c={parentIdentifier:e.identifier,identifier:i1(e,u,t),duration:a,startOffset:s,timelineStart:r,uri:u};return this.createAssetPlayer(e,c,t)}createAssetPlayer(e,t,s){const r=this.hls,a=r.userConfig;let u=a.videoPreference;const c=r.loadLevelObj||r.levels[r.currentLevel];(u||c)&&(u=Ve({},u),c.videoCodec&&(u.videoCodec=c.videoCodec),c.videoRange&&(u.allowedVideoRanges=[c.videoRange]));const h=r.audioTracks[r.audioTrack],d=r.subtitleTracks[r.subtitleTrack];let g=0;if(this.primaryLive||e.appendInPlace){const O=this.timelinePos-t.timelineStart;if(O>1){const k=t.duration;k&&O<k&&(g=O)}}const m=t.identifier,v=Ge(Ge({},a),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:m,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:g,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:u,audioPreference:h||a.audioPreference,subtitlePreference:d||a.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(v.timelineOffset=t.timelineStart));const E=v.cmcd;E!=null&&E.sessionId&&E.contentId&&(v.cmcd=Ve({},E,{contentId:Ta(t.uri)})),this.getAssetPlayer(m)&&this.warn(`Duplicate date range identifier ${e} and asset ${m}`);const S=new r1(this.HlsPlayerClass,v,e,t);this.playerQueue.push(S),e.assetList[s]=t;let x=!0;const T=O=>{if(O.live){var k;const B=new Error(`Interstitials MUST be VOD assets ${e}`),$={fatal:!0,type:ye.OTHER_ERROR,details:H.INTERSTITIAL_ASSET_ITEM_ERROR,error:B},U=((k=this.schedule)==null?void 0:k.findEventIndex(e.identifier))||-1;this.handleAssetItemError($,e,U,s,B.message);return}const K=O.edge-O.fragmentStart,w=t.duration;(x||w===null||K>w)&&(x=!1,this.log(`Interstitial asset "${m}" duration change ${w} > ${K}`),t.duration=K,this.updateSchedule())};S.on(b.LEVEL_UPDATED,(O,{details:k})=>T(k)),S.on(b.LEVEL_PTS_UPDATED,(O,{details:k})=>T(k)),S.on(b.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const L=(O,k)=>{const K=this.getAssetPlayer(m);if(K&&k.tracks){K.off(b.BUFFER_CODECS,L),K.tracks=k.tracks;const w=this.primaryMedia;this.bufferingAsset===K.assetItem&&w&&!K.media&&this.bufferAssetPlayer(K,w)}};S.on(b.BUFFER_CODECS,L);const _=()=>{var O;const k=this.getAssetPlayer(m);if(this.log(`buffered to end of asset ${k}`),!k||!this.schedule)return;const K=this.schedule.findEventIndex(e.identifier),w=(O=this.schedule.items)==null?void 0:O[K];this.isInterstitial(w)&&this.advanceAssetBuffering(w,t)};S.on(b.BUFFERED_TO_END,_);const I=O=>()=>{if(!this.getAssetPlayer(m)||!this.schedule)return;this.shouldPlay=!0;const K=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,K,O)};return S.once(b.MEDIA_ENDED,I(s)),S.once(b.PLAYOUT_LIMIT_REACHED,I(1/0)),S.on(b.ERROR,(O,k)=>{if(!this.schedule)return;const K=this.getAssetPlayer(m);if(k.details===H.BUFFER_STALLED_ERROR){if(K!=null&&K.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(k,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${k.error} ${e}`)}),S.on(b.DESTROYING,()=>{if(!this.getAssetPlayer(m)||!this.schedule)return;const k=new Error(`Asset player destroyed unexpectedly ${m}`),K={fatal:!0,type:ye.OTHER_ERROR,details:H.INTERSTITIAL_ASSET_ITEM_ERROR,error:k};this.handleAssetItemError(K,e,this.schedule.findEventIndex(e.identifier),s,k.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${ur(t)}`),this.hls.trigger(b.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:S}),S}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(s=>{this.clearAssetPlayer(s.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const s=this.playerQueue[t];this.transferMediaFromPlayer(s,null),s.resetDetails()}}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(s!==-1){const r=this.playerQueue[s];this.log(`clear ${r} toSegment: ${t&&bi(t)}`),this.transferMediaFromPlayer(r,t),this.playerQueue.splice(s,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,r,a){const{interstitial:u,assetItem:c,assetId:h}=e,d=u.assetList.length,g=this.playingAsset;this.endedAsset=null,this.playingAsset=c,(!g||g.identifier!==h)&&(g&&(this.clearAssetPlayer(g.identifier,s[r]),delete g.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${d} ${ur(c)}`),this.hls.trigger(b.INTERSTITIAL_ASSET_STARTED,{asset:c,assetListIndex:t,event:u,schedule:s.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,a)}bufferAssetPlayer(e,t){var s,r;if(!this.schedule)return;const{interstitial:a,assetItem:u}=e,c=this.schedule.findEventIndex(a.identifier),h=(s=this.schedule.items)==null?void 0:s[c];if(!h)return;e.loadSource(),this.setBufferingItem(h),this.bufferingAsset=u;const d=this.getBufferingPlayer();if(d===e)return;const g=a.appendInPlace;if(g&&d?.interstitial.appendInPlace===!1)return;const m=d?.tracks||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(g&&u!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(m&&!_y(m,e.tracks)){const v=new Error(`Asset ${ur(u)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(m)}')`),E={fatal:!0,type:ye.OTHER_ERROR,details:H.INTERSTITIAL_ASSET_ITEM_ERROR,error:v},S=a.findAssetIndex(u);this.handleAssetItemError(E,a,c,S,v.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,s=this.primaryMedia;if(!t||!s)return;const r=s.currentTime,a=t.findAssetIndex(e,r),u=e.assetList[a];if(u){const c=this.getAssetPlayer(u.identifier);if(c){const h=c.currentTime||r-u.timelineStart,d=c.duration-h;if(this.warn(`Stalled at ${h} of ${h+d} in ${c} ${e} (media.currentTime: ${r})`),h&&(d/s.playbackRate<.5||c.bufferedInPlaceToEnd(s))&&c.hls){const g=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,g,a)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,s,r,a){if(e.details===H.BUFFER_STALLED_ERROR)return;const u=t.assetList[r]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${u&&ur(u)} ${e.error}`),!this.schedule)return;const c=u?.identifier||"",h=this.getAssetPlayerQueueIndex(c),d=this.playerQueue[h]||null,g=this.schedule.items,m=Ve({},e,{fatal:!1,errorAction:fr(!0),asset:u,assetListIndex:r,event:t,schedule:g,scheduleIndex:s,player:d});if(this.hls.trigger(b.INTERSTITIAL_ASSET_ERROR,m),!e.fatal)return;const v=this.playingAsset,E=this.bufferingAsset,S=new Error(a);if(u&&(this.clearAssetPlayer(c,null),u.error=S),!t.assetList.some(x=>!x.error))t.error=S;else for(let x=r;x<t.assetList.length;x++)this.resetAssetPlayer(t.assetList[x].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):v&&v.identifier===c?this.advanceAfterAssetEnded(t,s,r):E&&E.identifier===c&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,E)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;let r=this.timelinePos;if(s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${r} playing: ${bi(s)} error: ${e.error}`),r===-1&&(r=this.hls.startPosition);const u=this.updateItem(s,r);this.itemsMatch(s,u)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(r===-1){this.checkStart();return}if(!this.schedule)return;const a=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(a)}onAssetListLoaded(e,t){var s,r;const a=t.event,u=a.identifier,c=t.assetListResponse.ASSETS;if(!((s=this.schedule)!=null&&s.hasEvent(u)))return;const h=a.timelineStart,d=a.duration;let g=0;c.forEach((x,T)=>{const L=parseFloat(x.DURATION);this.createAsset(a,T,g,h+g,L,x.URI),g+=L}),a.duration=g,this.log(`Loaded asset-list with duration: ${g} (was: ${d}) ${a}`);const m=this.waitingItem,v=m?.event.identifier===u;this.updateSchedule();const E=(r=this.bufferingItem)==null?void 0:r.event;if(v){var S;const x=this.schedule.findEventIndex(u),T=(S=this.schedule.items)==null?void 0:S[x];if(T){if(!this.playingItem&&this.timelinePos>T.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==x){a.error=new Error(`Interstitial ${c.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${a}`),this.log(a.error.message),this.updateSchedule(!0),this.primaryFallback(a);return}this.setBufferingItem(T)}this.setSchedulePosition(x)}else if(E?.identifier===u){const x=a.assetList[0];if(x){const T=this.getAssetPlayer(x.identifier);if(E.appendInPlace){const L=this.primaryMedia;T&&L&&this.bufferAssetPlayer(T,L)}else T&&T.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case H.ASSET_LIST_PARSING_ERROR:case H.ASSET_LIST_LOAD_ERROR:case H.ASSET_LIST_LOAD_TIMEOUT:{const s=t.interstitial;s&&(this.updateSchedule(!0),this.primaryFallback(s));break}case H.BUFFER_STALLED_ERROR:{const s=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&s.event.appendInPlace){this.handleInPlaceStall(s.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const qp=500;class u1 extends vd{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",ge.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(b.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(b.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=ee.IDLE,this.setInterval(qp),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:r}=t;if(this.fragContextChanged(s)||(lt(s)&&(this.fragPrevious=s),this.state=ee.IDLE),!r)return;const a=this.tracksBuffered[this.currentTrackId];if(!a)return;let u;const c=s.start;for(let d=0;d<a.length;d++)if(c>=a[d].start&&c<=a[d].end){u=a[d];break}const h=s.start+s.duration;u?u.end=h:(u={start:c,end:h},a.push(u)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:r}=t;if(s===0&&r!==Number.POSITIVE_INFINITY){const a=r-1;if(a<=0)return;t.endOffsetSubtitles=Math.max(0,a),this.tracksBuffered.forEach(u=>{for(let c=0;c<u.length;){if(u[c].end<=a){u.shift();continue}else if(u[c].start<a)u[c].start=a;else break;c++}}),this.fragmentTracker.removeFragmentsInRange(s,a,ge.SUBTITLE)}}onError(e,t){const s=t.frag;s?.type===ge.SUBTITLE&&(t.details===H.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ee.STOPPED&&(this.state=ee.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&Cv(this.levels,t)){this.levels=t.map(s=>new La(s));return}this.tracksBuffered=[],this.levels=t.map(s=>{const r=new La(s);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ge.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,!((s=this.levels)!=null&&s.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==ee.STOPPED&&this.setInterval(qp)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:r,levels:a}=this,{details:u,id:c}=t;if(!a){this.warn(`Subtitle tracks were reset while loading level ${c}`);return}const h=a[c];if(c>=a.length||!h)return;this.log(`Subtitle track ${c} loaded [${u.startSN},${u.endSN}]${u.lastPartSn?`[part-${u.lastPartSn}-${u.lastPartIndex}]`:""},duration:${u.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let d=0;if(u.live||(s=h.details)!=null&&s.live){if(u.deltaUpdateFailed)return;const m=this.mainDetails;if(!m){this.startFragRequested=!1;return}const v=m.fragments[0];if(!h.details)u.hasProgramDateTime&&m.hasProgramDateTime?(No(u,m),d=u.fragmentStart):v&&(d=v.start,zf(u,d));else{var g;d=this.alignPlaylists(u,h.details,(g=this.levelLastLoaded)==null?void 0:g.details),d===0&&v&&(d=v.start,zf(u,d))}m&&!this.startFragRequested&&this.setStartPosition(m,d)}h.details=u,this.levelLastLoaded=h,c===r&&(this.hls.trigger(b.SUBTITLE_TRACK_UPDATED,{details:u,id:c,groupId:t.groupId}),this.tick(),u.live&&!this.fragCurrent&&this.media&&this.state===ee.IDLE&&(pn(null,u.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),h.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,r=t.decryptdata,a=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&r!=null&&r.key&&r.iv&&dr(r.method)){const u=performance.now();this.decrypter.decrypt(new Uint8Array(s),r.key.buffer,r.iv.buffer,pd(r.method)).catch(c=>{throw a.trigger(b.ERROR,{type:ye.MEDIA_ERROR,details:H.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:t}),c}).then(c=>{const h=performance.now();a.trigger(b.FRAG_DECRYPTED,{frag:t,payload:c,stats:{tstart:u,tdecrypt:h}})}).catch(c=>{this.warn(`${c.name}: ${c.message}`),this.state=ee.IDLE})}}doTick(){if(!this.media){this.state=ee.IDLE;return}if(this.state===ee.IDLE){const{currentTrackId:e,levels:t}=this,s=t?.[e];if(!s||!t.length||!s.details||this.waitForLive(s))return;const{config:r}=this,a=this.getLoadPosition(),u=xe.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],a,r.maxBufferHole),{end:c,len:h}=u,d=s.details,g=this.hls.maxBufferLength+d.levelTargetDuration;if(h>g)return;const m=d.fragments,v=m.length,E=d.edge;let S=null;const x=this.fragPrevious;if(c<E){const _=r.maxFragLookUpTolerance,I=c>E-_?0:_;S=pn(x,m,Math.max(m[0].start,c),I),!S&&x&&x.start<m[0].start&&(S=m[0])}else S=m[v-1];if(S=this.filterReplacedPrimary(S,s.details),!S)return;const T=S.sn-d.startSN,L=m[T-1];if(L&&L.cc===S.cc&&this.fragmentTracker.getState(L)===gt.NOT_LOADED&&(S=L),this.fragmentTracker.getState(S)===gt.NOT_LOADED){const _=this.mapToInitFragWhenRequired(S);_&&this.loadFragment(_,s,c)}}}loadFragment(e,t,s){lt(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new c1(this.tracksBuffered[this.currentTrackId]||[])}}class c1{constructor(e){this.buffered=void 0;const t=(s,r,a)=>{if(r=r>>>0,r>a-1)throw new DOMException(`Failed to execute '${s}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${a})`);return e[r][s]};this.buffered={get length(){return e.length},end(s){return t("end",s,e.length)},start(s){return t("start",s,e.length)}}}}const f1={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Vv=l=>String.fromCharCode(f1[l]||l),Li=15,as=100,d1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},h1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},g1={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},m1={25:2,26:4,29:6,30:8,31:10,27:13,28:15},p1=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class y1{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s=typeof t=="function"?t():t;je.log(`${this.time} [${e}] ${s}`)}}}const hn=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class Yv{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const r=t[s];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class v1{constructor(){this.uchar=" ",this.penState=new Yv}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class E1{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Yv,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<as;t++)this.chars.push(new v1);this.logger=e}equals(e){for(let t=0;t<as;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<as;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<as;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>as&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=as)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Vv(e);if(this.pos>=as){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<as;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<as;s++){const r=this.chars[s].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Rf{constructor(e){this.rows=[],this.currRow=Li-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Li;t++)this.rows.push(new E1(e));this.logger=e}reset(){for(let e=0;e<Li;e++)this.rows[e].clear();this.currRow=Li-1}equals(e){let t=!0;for(let s=0;s<Li;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<Li;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Li;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Xe(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let c=0;c<Li;c++)this.rows[c].clear();const a=this.currRow+1-this.nrRollUpRows,u=this.lastOutputScreen;if(u){const c=u.rows[a].cueStartTime,h=this.logger.time;if(c!==null&&h!==null&&c<h)for(let d=0;d<this.nrRollUpRows;d++)this.rows[t-this.nrRollUpRows+d+1].copy(u.rows[a+d])}}this.currRow=t;const s=this.rows[this.currRow];if(e.indent!==null){const a=e.indent,u=Math.max(a-1,0);s.setCursor(e.indent),e.color=s.chars[u].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Xe(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",r=-1;for(let a=0;a<Li;a++){const u=this.rows[a].getTextString();u&&(r=a+1,e?t.push("Row "+r+": '"+u+"'"):t.push(u.trim()))}return t.length>0&&(e?s="["+t.join(" | ")+"]":s=t.join(`
`)),s}getTextAndFormat(){return this.rows}}class Xp{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Rf(s),this.nonDisplayedMemory=new Rf(s),this.lastOutputScreen=new Rf(s),this.currRollUpRow=this.displayedMemory.rows[Li-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Li-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[s]}this.logger.log(2,"MIDROW: "+Xe(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Qp{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=T1(),this.logger=void 0;const r=this.logger=new y1;this.channels=[null,new Xp(e,t,r),new Xp(e+1,s,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const r=t[s]&127,a=t[s+1]&127;let u=!1,c=null;if(r===0&&a===0)continue;this.logger.log(3,()=>"["+hn([t[s],t[s+1]])+"] -> ("+hn([r,a])+")");const h=this.cmdHistory;if(r>=16&&r<=31){if(S1(r,a,h)){co(null,null,h),this.logger.log(3,()=>"Repeated command ("+hn([r,a])+") is dropped");continue}co(r,a,this.cmdHistory),u=this.parseCmd(r,a),u||(u=this.parseMidrow(r,a)),u||(u=this.parsePAC(r,a)),u||(u=this.parseBackgroundAttributes(r,a))}else co(null,null,h);if(!u&&(c=this.parseChars(r,a),c)){const g=this.currentChannel;g&&g>0?this.channels[g].insertChars(c):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!u&&!c&&this.logger.log(2,()=>"Couldn't parse cleaned data "+hn([r,a])+" orig: "+hn([t[s],t[s+1]]))}}parseCmd(e,t){const s=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(s||r))return!1;const a=e===20||e===21||e===23?1:2,u=this.channels[a];return e===20||e===21||e===28||e===29?t===32?u.ccRCL():t===33?u.ccBS():t===34?u.ccAOF():t===35?u.ccAON():t===36?u.ccDER():t===37?u.ccRU(2):t===38?u.ccRU(3):t===39?u.ccRU(4):t===40?u.ccFON():t===41?u.ccRDC():t===42?u.ccTR():t===43?u.ccRTD():t===44?u.ccEDM():t===45?u.ccCR():t===46?u.ccENM():t===47&&u.ccEOC():u.ccTO(t-32),this.currentChannel=a,!0}parseMidrow(e,t){let s=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?s=1:s=2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[s];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+hn([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let s;const r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,a=(e===16||e===24)&&t>=64&&t<=95;if(!(r||a))return!1;const u=e<=23?1:2;t>=64&&t<=95?s=u===1?d1[e]:g1[e]:s=u===1?h1[e]:m1[e];const c=this.channels[u];return c?(c.setPAC(this.interpretPAC(s,t)),this.currentChannel=u,!0):!1}interpretPAC(e,t){let s;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?s=t-96:s=t-64,r.underline=(s&1)===1,s<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((s-16)/2)*4,r}parseChars(e,t){let s,r=null,a=null;if(e>=25?(s=2,a=e-8):(s=1,a=e),a>=17&&a<=19){let u;a===17?u=t+80:a===18?u=t+112:u=t+144,this.logger.log(2,()=>"Special char '"+Vv(u)+"' in channel "+s),r=[u]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+hn(r).join(",")),r}parseBackgroundAttributes(e,t){const s=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(s||r))return!1;let a;const u={};e===16||e===24?(a=Math.floor((t-32)/2),u.background=p1[a],t%2===1&&(u.background=u.background+"_semi")):t===45?u.background="transparent":(u.foreground="black",t===47&&(u.underline=!0));const c=e<=23?1:2;return this.channels[c].setBkgData(u),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}co(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function co(l,e,t){t.a=l,t.b=e}function S1(l,e,t){return t.a===l&&t.b===e}function T1(){return{a:null,b:null}}var Cd=(function(){if(ko!=null&&ko.VTTCue)return self.VTTCue;const l=["","lr","rl"],e=["start","middle","end","left","right"];function t(c,h){if(typeof h!="string"||!Array.isArray(c))return!1;const d=h.toLowerCase();return~c.indexOf(d)?d:!1}function s(c){return t(l,c)}function r(c){return t(e,c)}function a(c,...h){let d=1;for(;d<arguments.length;d++){const g=arguments[d];for(const m in g)c[m]=g[m]}return c}function u(c,h,d){const g=this,m={enumerable:!0};g.hasBeenReset=!1;let v="",E=!1,S=c,x=h,T=d,L=null,_="",I=!0,O="auto",k="start",K=50,w="middle",B=50,$="middle";Object.defineProperty(g,"id",a({},m,{get:function(){return v},set:function(U){v=""+U}})),Object.defineProperty(g,"pauseOnExit",a({},m,{get:function(){return E},set:function(U){E=!!U}})),Object.defineProperty(g,"startTime",a({},m,{get:function(){return S},set:function(U){if(typeof U!="number")throw new TypeError("Start time must be set to a number.");S=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"endTime",a({},m,{get:function(){return x},set:function(U){if(typeof U!="number")throw new TypeError("End time must be set to a number.");x=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"text",a({},m,{get:function(){return T},set:function(U){T=""+U,this.hasBeenReset=!0}})),Object.defineProperty(g,"region",a({},m,{get:function(){return L},set:function(U){L=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"vertical",a({},m,{get:function(){return _},set:function(U){const W=s(U);if(W===!1)throw new SyntaxError("An invalid or illegal string was specified.");_=W,this.hasBeenReset=!0}})),Object.defineProperty(g,"snapToLines",a({},m,{get:function(){return I},set:function(U){I=!!U,this.hasBeenReset=!0}})),Object.defineProperty(g,"line",a({},m,{get:function(){return O},set:function(U){if(typeof U!="number"&&U!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");O=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"lineAlign",a({},m,{get:function(){return k},set:function(U){const W=r(U);if(!W)throw new SyntaxError("An invalid or illegal string was specified.");k=W,this.hasBeenReset=!0}})),Object.defineProperty(g,"position",a({},m,{get:function(){return K},set:function(U){if(U<0||U>100)throw new Error("Position must be between 0 and 100.");K=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"positionAlign",a({},m,{get:function(){return w},set:function(U){const W=r(U);if(!W)throw new SyntaxError("An invalid or illegal string was specified.");w=W,this.hasBeenReset=!0}})),Object.defineProperty(g,"size",a({},m,{get:function(){return B},set:function(U){if(U<0||U>100)throw new Error("Size must be between 0 and 100.");B=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"align",a({},m,{get:function(){return $},set:function(U){const W=r(U);if(!W)throw new SyntaxError("An invalid or illegal string was specified.");$=W,this.hasBeenReset=!0}})),g.displayState=void 0}return u.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},u})();class x1{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function qv(l){function e(s,r,a,u){return(s|0)*3600+(r|0)*60+(a|0)+parseFloat(u||0)}const t=l.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class A1{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let r=0;r<s.length;++r)if(t===s[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function Xv(l,e,t,s){const r=s?l.split(s):[l];for(const a in r){if(typeof r[a]!="string")continue;const u=r[a].split(t);if(u.length!==2)continue;const c=u[0],h=u[1];e(c,h)}}const Jf=new Cd(0,0,""),fo=Jf.align==="middle"?"middle":"center";function b1(l,e,t){const s=l;function r(){const c=qv(l);if(c===null)throw new Error("Malformed timestamp: "+s);return l=l.replace(/^[^\sa-zA-Z-]+/,""),c}function a(c,h){const d=new A1;Xv(c,function(v,E){let S;switch(v){case"region":for(let x=t.length-1;x>=0;x--)if(t[x].id===E){d.set(v,t[x].region);break}break;case"vertical":d.alt(v,E,["rl","lr"]);break;case"line":S=E.split(","),d.integer(v,S[0]),d.percent(v,S[0])&&d.set("snapToLines",!1),d.alt(v,S[0],["auto"]),S.length===2&&d.alt("lineAlign",S[1],["start",fo,"end"]);break;case"position":S=E.split(","),d.percent(v,S[0]),S.length===2&&d.alt("positionAlign",S[1],["start",fo,"end","line-left","line-right","auto"]);break;case"size":d.percent(v,E);break;case"align":d.alt(v,E,["start",fo,"end","left","right"]);break}},/:/,/\s/),h.region=d.get("region",null),h.vertical=d.get("vertical","");let g=d.get("line","auto");g==="auto"&&Jf.line===-1&&(g=-1),h.line=g,h.lineAlign=d.get("lineAlign","start"),h.snapToLines=d.get("snapToLines",!0),h.size=d.get("size",100),h.align=d.get("align",fo);let m=d.get("position","auto");m==="auto"&&Jf.position===50&&(m=h.align==="start"||h.align==="left"?0:h.align==="end"||h.align==="right"?100:50),h.position=m}function u(){l=l.replace(/^\s+/,"")}if(u(),e.startTime=r(),u(),l.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);l=l.slice(3),u(),e.endTime=r(),u(),a(l,e)}function Qv(l){return l.replace(/<br(?: \/)?>/gi,`
`)}class L1{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new x1,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function s(){let a=t.buffer,u=0;for(a=Qv(a);u<a.length&&a[u]!=="\r"&&a[u]!==`
`;)++u;const c=a.slice(0,u);return a[u]==="\r"&&++u,a[u]===`
`&&++u,t.buffer=a.slice(u),c}function r(a){Xv(a,function(u,c){},/:/)}try{let a="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;a=s();const c=a.match(/^()?WEBVTT([ \t].*)?$/);if(!(c!=null&&c[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let u=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(u?u=!1:a=s(),t.state){case"HEADER":/:/.test(a)?r(a):a||(t.state="ID");continue;case"NOTE":a||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){t.state="NOTE";break}if(!a)continue;if(t.cue=new Cd(0,0,""),t.state="CUE",a.indexOf("-->")===-1){t.cue.id=a;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{b1(a,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const c=a.indexOf("-->")!==-1;if(!a||c&&(u=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=a}continue;case"BADCUE":a||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const R1=/\r\n|\n\r|\n|\r/g,_f=function(e,t,s=0){return e.slice(s,s+t.length)===t},_1=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),a=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!fe(t)||!fe(s)||!fe(r)||!fe(a))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=60*1e3*r,t+=3600*1e3*a,t};function Od(l,e,t){return Ta(l.toString())+Ta(e.toString())+Ta(t)}const D1=function(e,t,s){let r=e[t],a=e[r.prevCC];if(!a||!a.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(u=a)!=null&&u.new;){var u;e.ccOffset+=r.start-a.start,r.new=!1,r=a,a=e[r.prevCC]}e.presentationOffset=s};function I1(l,e,t,s,r,a,u){const c=new L1,h=si(new Uint8Array(l)).trim().replace(R1,`
`).split(`
`),d=[],g=e?NL(e.baseTime,e.timescale):0;let m="00:00.000",v=0,E=0,S,x=!0;c.oncue=function(T){const L=t[s];let _=t.ccOffset;const I=(v-g)/9e4;if(L!=null&&L.new&&(E!==void 0?_=t.ccOffset=L.start:D1(t,s,I)),I){if(!e){S=new Error("Missing initPTS for VTT MPEGTS");return}_=I-t.presentationOffset}const O=T.endTime-T.startTime,k=ei((T.startTime+_-E)*9e4,r*9e4)/9e4;T.startTime=Math.max(k,0),T.endTime=Math.max(k+O,0);const K=T.text.trim();T.text=decodeURIComponent(encodeURIComponent(K)),T.id||(T.id=Od(T.startTime,T.endTime,K)),T.endTime>0&&d.push(T)},c.onparsingerror=function(T){S=T},c.onflush=function(){if(S){u(S);return}a(d)},h.forEach(T=>{if(x)if(_f(T,"X-TIMESTAMP-MAP=")){x=!1,T.slice(16).split(",").forEach(L=>{_f(L,"LOCAL:")?m=L.slice(6):_f(L,"MPEGTS:")&&(v=parseInt(L.slice(7)))});try{E=_1(m)/1e3}catch(L){S=L}return}else T===""&&(x=!1);c.parse(T+`
`)}),c.flush()}const Df="stpp.ttml.im1t",Wv=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Zv=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,C1={left:"start",center:"center",right:"end",start:"start",end:"end"};function Wp(l,e,t,s){const r=Re(new Uint8Array(l),["mdat"]);if(r.length===0){s(new Error("Could not parse IMSC1 mdat"));return}const a=r.map(c=>si(c)),u=kL(e.baseTime,1,e.timescale);try{a.forEach(c=>t(O1(c,u)))}catch(c){s(c)}}function O1(l,e){const r=new DOMParser().parseFromString(l,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const a={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},u=Object.keys(a).reduce((m,v)=>(m[v]=r.getAttribute(`ttp:${v}`)||a[v],m),{}),c=r.getAttribute("xml:space")!=="preserve",h=Zp(If(r,"styling","style")),d=Zp(If(r,"layout","region")),g=If(r,"body","[begin]");return[].map.call(g,m=>{const v=Jv(m,c);if(!v||!m.hasAttribute("begin"))return null;const E=Of(m.getAttribute("begin"),u),S=Of(m.getAttribute("dur"),u);let x=Of(m.getAttribute("end"),u);if(E===null)throw Jp(m);if(x===null){if(S===null)throw Jp(m);x=E+S}const T=new Cd(E-e,x-e,v);T.id=Od(T.startTime,T.endTime,T.text);const L=d[m.getAttribute("region")],_=h[m.getAttribute("style")],I=w1(L,_,h),{textAlign:O}=I;if(O){const k=C1[O];k&&(T.lineAlign=k),T.align=O}return Ve(T,I),T}).filter(m=>m!==null)}function If(l,e,t){const s=l.getElementsByTagName(e)[0];return s?[].slice.call(s.querySelectorAll(t)):[]}function Zp(l){return l.reduce((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e},{})}function Jv(l,e){return[].slice.call(l.childNodes).reduce((t,s,r)=>{var a;return s.nodeName==="br"&&r?t+`
`:(a=s.childNodes)!=null&&a.length?Jv(s,e):e?t+s.textContent.trim().replace(/\s+/g," "):t+s.textContent},"")}function w1(l,e,t){const s="http://www.w3.org/ns/ttml#styling";let r=null;const a=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],u=l!=null&&l.hasAttribute("style")?l.getAttribute("style"):null;return u&&t.hasOwnProperty(u)&&(r=t[u]),a.reduce((c,h)=>{const d=Cf(e,s,h)||Cf(l,s,h)||Cf(r,s,h);return d&&(c[h]=d),c},{})}function Cf(l,e,t){return l&&l.hasAttributeNS(e,t)?l.getAttributeNS(e,t):null}function Jp(l){return new Error(`Could not parse ttml timestamp ${l}`)}function Of(l,e){if(!l)return null;let t=qv(l);return t===null&&(Wv.test(l)?t=M1(l,e):Zv.test(l)&&(t=k1(l,e))),t}function M1(l,e){const t=Wv.exec(l),s=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+s/e.frameRate}function k1(l,e){const t=Zv.exec(l),s=Number(t[1]);switch(t[2]){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/e.frameRate;case"t":return s/e.tickRate}return s}class ho{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class N1{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=ty(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(b.FRAG_LOADING,this.onFragLoading,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this),e.on(b.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(b.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(b.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(b.FRAG_LOADING,this.onFragLoading,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this),e.off(b.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(b.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(b.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new ho(this,"textTrack1"),t=new ho(this,"textTrack2"),s=new ho(this,"textTrack3"),r=new ho(this,"textTrack4");this.cea608Parser1=new Qp(1,e,t),this.cea608Parser2=new Qp(3,s,r)}addCues(e,t,s,r,a){let u=!1;for(let c=a.length;c--;){const h=a[c],d=P1(h[0],h[1],t,s);if(d>=0&&(h[0]=Math.min(h[0],t),h[1]=Math.max(h[1],s),u=!0,d/(s-t)>.5))return}if(u||a.push([t,s]),this.config.renderTextTracksNatively){const c=this.captionsTracks[e];this.Cues.newCue(c,t,s,r)}else{const c=this.Cues.newCue(null,t,s,r);this.hls.trigger(b.CUES_PARSED,{type:"captions",cues:c,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:r,timescale:a,trackId:u}){const{unparsedVttFrags:c}=this;s===ge.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:a,trackId:u}),c.length&&(this.unparsedVttFrags=[],c.forEach(h=>{this.initPTS[h.frag.cc]?this.onFragLoaded(b.FRAG_LOADED,h):this.hls.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let r=0;r<s.textTracks.length;r++){const a=s.textTracks[r];if(ey(a,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return a}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:r}=this,{label:a,languageCode:u}=t[e],c=this.getExistingTrack(a,u);if(c)s[e]=c,cr(s[e]),Hv(s[e],r);else{const h=this.createTextTrack("captions",a,u);h&&(h[e]=!0,s[e]=h)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s=t.label,r={_id:e,label:s,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(b.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,s){const r=this.media;if(r)return r.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:r}=this;Object.keys(r).forEach(a=>{cr(r[a]),delete r[a]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=ty(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)cr(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],r=s.some(a=>a.textCodec===Df);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(Cv(this.tracks,s)){this.tracks=s;return}if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const u=this.media,c=u?bo(u.textTracks):null;if(this.tracks.forEach((h,d)=>{let g;if(c){let m=null;for(let v=0;v<c.length;v++)if(c[v]&&ey(c[v],h)){m=c[v],c[v]=null;break}m&&(g=m)}if(g)cr(g);else{const m=eE(h);g=this.createTextTrack(m,h.name,h.lang),g&&(g.mode="disabled")}g&&this.textTracks.push(g)}),c!=null&&c.length){const h=c.filter(d=>d!==null).map(d=>d.label);h.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${h.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const u=this.tracks.map(c=>({label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}));this.hls.trigger(b.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:u})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(s=>{const r=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(!r)return;const a=`textTrack${r[1]}`,u=this.captionsProperties[a];u&&(u.label=s.name,s.lang&&(u.languageCode=s.lang),u.media=s)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===ge.MAIN){var s,r;const{cea608Parser1:a,cea608Parser2:u,lastSn:c}=this,{cc:h,sn:d}=t.frag,g=(s=(r=t.part)==null?void 0:r.index)!=null?s:-1;a&&u&&(d!==c+1||d===c&&g!==this.lastPartIndex+1||h!==this.lastCc)&&(a.reset(),u.reset()),this.lastCc=h,this.lastSn=d,this.lastPartIndex=g}}onFragLoaded(e,t){const{frag:s,payload:r}=t;if(s.type===ge.SUBTITLE)if(r.byteLength){const a=s.decryptdata,u="stats"in t;if(a==null||!a.encrypted||u){const c=this.tracks[s.level],h=this.vttCCs;h[s.cc]||(h[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),c&&c.textCodec===Df?this._parseIMSC1(s,r):this._parseVTTs(t)}}else this.hls.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;Wp(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),s.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{s.logger.log(`Failed to parse IMSC1: ${r}`),s.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;const{frag:s,payload:r}=e,{initPTS:a,unparsedVttFrags:u}=this,c=a.length-1;if(!a[s.cc]&&c===-1){u.push(e);return}const h=this.hls,d=(t=s.initSegment)!=null&&t.data?pi(s.initSegment.data,new Uint8Array(r)).buffer:r;I1(d,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,g=>{this._appendCues(g,s.level),h.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},g=>{const m=g.message==="Missing initPTS for VTT MPEGTS";m?u.push(e):this._fallbackToIMSC1(s,r),h.logger.log(`Failed to parse VTT cue: ${g}`),!(m&&c>s.cc)&&h.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:g})})}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||Wp(t,this.initPTS[e.cc],()=>{s.textCodec=Df,this._parseIMSC1(e,t)},()=>{s.textCodec="wvtt"})}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(a=>Kv(r,a))}else{const r=this.tracks[t];if(!r)return;const a=r.default?"default":"subtitles"+t;s.trigger(b.CUES_PARSED,{type:"subtitles",cues:e,track:a})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===ge.SUBTITLE&&this.onFragLoaded(b.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:r}=t;if(!(s.type===ge.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let a=0;a<r.length;a++){const u=r[a].bytes;if(u){this.cea608Parser1||this.initCea608Parsers();const c=this.extractCea608Data(u);this.cea608Parser1.addData(r[a].pts,c[0]),this.cea608Parser2.addData(r[a].pts,c[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:r,type:a}){const{media:u}=this;if(!(!u||u.currentTime<s)){if(!a||a==="video"){const{captionsTracks:c}=this;Object.keys(c).forEach(h=>Zf(c[h],t,s))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){const{textTracks:c}=this;Object.keys(c).forEach(h=>Zf(c[h],t,r))}}}extractCea608Data(e){const t=[[],[]],s=e[0]&31;let r=2;for(let a=0;a<s;a++){const u=e[r++],c=127&e[r++],h=127&e[r++];if(c===0&&h===0)continue;if((4&u)!==0){const g=3&u;(g===0||g===1)&&(t[g].push(c),t[g].push(h))}}return t}}function eE(l){return l.characteristics&&/transcribes-spoken-dialog/gi.test(l.characteristics)&&/describes-music-and-sound/gi.test(l.characteristics)?"captions":"subtitles"}function ey(l,e){return!!l&&l.kind===eE(e)&&qf(e,l)}function P1(l,e,t,s){return Math.min(e,s)-Math.max(l,t)}function ty(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const U1=/\s/,F1={newCue(l,e,t,s){const r=[];let a,u,c,h,d;const g=self.VTTCue||self.TextTrackCue;for(let v=0;v<s.rows.length;v++)if(a=s.rows[v],c=!0,h=0,d="",!a.isEmpty()){var m;for(let x=0;x<a.chars.length;x++)U1.test(a.chars[x].uchar)&&c?h++:(d+=a.chars[x].uchar,c=!1);a.cueStartTime=e,e===t&&(t+=1e-4),h>=16?h--:h++;const E=Qv(d.trim()),S=Od(e,t,E);l!=null&&(m=l.cues)!=null&&m.getCueById(S)||(u=new g(e,t,E),u.id=S,u.line=v+1,u.align="left",u.position=10+Math.min(80,Math.floor(h*8/32)*10),r.push(u))}return l&&r.length&&(r.sort((v,E)=>v.line==="auto"||E.line==="auto"?0:v.line>8&&E.line>8?E.line-v.line:v.line-E.line),r.forEach(v=>Kv(l,v))),r}};function B1(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const $1=/(\d+)-(\d+)\/(\d+)/;class iy{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||K1,this.controller=new self.AbortController,this.stats=new ud}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const a=G1(e,this.controller.signal),u=e.responseType==="arraybuffer",c=u?"byteLength":"length",{maxTimeToFirstByteMs:h,maxLoadTimeMs:d}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,a),self.clearTimeout(this.requestTimeout),t.timeout=h&&fe(h)?h:d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),(Da(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(m=>{var v;this.response=this.loader=m;const E=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},d-(E-r.loading.start)),!m.ok){const{status:x,statusText:T}=m;throw new z1(T||"fetch, bad network response",x,m)}r.loading.first=E,r.total=H1(m.headers)||r.total;const S=(v=this.callbacks)==null?void 0:v.onProgress;return S&&fe(t.highWaterMark)?this.loadProgressively(m,r,e,t.highWaterMark,S):u?m.arrayBuffer():e.responseType==="json"?m.json():m.text()}).then(m=>{var v,E;const S=this.response;if(!S)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const x=m[c];x&&(r.loaded=r.total=x);const T={url:S.url,data:m,code:S.status},L=(v=this.callbacks)==null?void 0:v.onProgress;L&&!fe(t.highWaterMark)&&L(r,e,m,S),(E=this.callbacks)==null||E.onSuccess(T,r,e,S)}).catch(m=>{var v;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const E=m&&m.code||0,S=m?m.message:null;(v=this.callbacks)==null||v.onError({code:E,text:S},e,m?m.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,r=0,a){const u=new cv,c=e.body.getReader(),h=()=>c.read().then(d=>{if(d.done)return u.dataLength&&a(t,s,u.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const g=d.value,m=g.length;return t.loaded+=m,m<r||u.dataLength?(u.push(g),u.dataLength>=r&&a(t,s,u.flush().buffer,e)):a(t,s,g.buffer,e),h()}).catch(()=>Promise.reject());return h()}}function G1(l,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Ve({},l.headers))};return l.rangeEnd&&t.headers.set("Range","bytes="+l.rangeStart+"-"+String(l.rangeEnd-1)),t}function j1(l){const e=$1.exec(l);if(e)return parseInt(e[2])-parseInt(e[1])+1}function H1(l){const e=l.get("Content-Range");if(e){const s=j1(e);if(fe(s))return s}const t=l.get("Content-Length");if(t)return parseInt(t)}function K1(l,e){return new self.Request(l.url,e)}class z1 extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const V1=/^age:\s*[\d.]+\s*$/im;class tE{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new ud,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const a=this.xhrSetup;a?Promise.resolve().then(()=>{if(!(this.loader!==s||this.stats.aborted))return a(s,t.url)}).catch(u=>{if(!(this.loader!==s||this.stats.aborted))return s.open("GET",t.url,!0),a(s,t.url)}).then(()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)}).catch(u=>{var c;(c=this.callbacks)==null||c.onError({code:s.status,text:u.message},t,s,r)}):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:a,maxLoadTimeMs:u}=s.loadPolicy;if(r)for(const c in r)e.setRequestHeader(c,r[c]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=a&&fe(a)?a:u,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const r=t.readyState,a=this.config;if(!s.aborted&&r>=2&&(s.loading.first===0&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),a.timeout!==a.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),a.timeout=a.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const d=t.status,g=t.responseType==="text"?t.responseText:null;if(d>=200&&d<300){const S=g??t.response;if(S!=null){var u,c;s.loading.end=Math.max(self.performance.now(),s.loading.first);const x=t.responseType==="arraybuffer"?S.byteLength:S.length;s.loaded=s.total=x,s.bwEstimate=s.total*8e3/(s.loading.end-s.loading.first);const T=(u=this.callbacks)==null?void 0:u.onProgress;T&&T(s,e,S,t);const L={url:t.responseURL,data:S,code:d};(c=this.callbacks)==null||c.onSuccess(L,s,e,t);return}}const m=a.loadPolicy.errorRetry,v=s.retry,E={url:e.url,data:void 0,code:d};if(wo(m,v,!1,E))this.retry(m);else{var h;je.error(`${d} while loading ${e.url}`),(h=this.callbacks)==null||h.onError({code:d,text:t.statusText},e,t,s)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(wo(e,t,!0))this.retry(e);else{var s;je.warn(`timeout while loading ${(s=this.context)==null?void 0:s.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=hd(e,s.retry),s.retry++,je.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&V1.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const Y1={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},q1=Ge(Ge({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:tE,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:ab,bufferController:QL,capLevelController:_d,errorController:fb,fpsController:WR,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Jy,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:Y1},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},X1()),{},{subtitleStreamController:u1,subtitleTrackController:e1,timelineController:N1,audioStreamController:VL,audioTrackController:YL,emeController:hr,cmcdController:YR,contentSteeringController:XR,interstitialsController:o1});function X1(){return{cueHandler:F1,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function Q1(l,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=ed(l),r=["manifest","level","frag"],a=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(u=>{const c=`${u==="level"?"playlist":u}LoadPolicy`,h=e[c]===void 0,d=[];a.forEach(g=>{const m=`${u}Loading${g}`,v=e[m];if(v!==void 0&&h){d.push(m);const E=s[c].default;switch(e[c]={default:E},g){case"TimeOut":E.maxLoadTimeMs=v,E.maxTimeToFirstByteMs=v;break;case"MaxRetry":E.errorRetry.maxNumRetry=v,E.timeoutRetry.maxNumRetry=v;break;case"RetryDelay":E.errorRetry.retryDelayMs=v,E.timeoutRetry.retryDelayMs=v;break;case"MaxRetryTimeout":E.errorRetry.maxRetryDelayMs=v,E.timeoutRetry.maxRetryDelayMs=v;break}}}),d.length&&t.warn(`hls.js config: "${d.join('", "')}" setting(s) are deprecated, use "${c}": ${Xe(e[c])}`)}),Ge(Ge({},s),e)}function ed(l){return l&&typeof l=="object"?Array.isArray(l)?l.map(ed):Object.keys(l).reduce((e,t)=>(e[t]=ed(l[t]),e),{}):l}function W1(l,e){const t=l.loader;t!==iy&&t!==tE?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),l.progressive=!1):B1()&&(l.loader=iy,l.progressive=!0,l.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Lo=2,Z1=.1,J1=.05,e_=100;class t_ extends qy{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var s;(s=this.media)!=null&&s.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var s;this.ended=((s=this.media)==null?void 0:s.currentTime)||1,this.hls.trigger(b.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(e_),this.mediaSource=t.mediaSource;const s=this.media=t.media;Mt(s,"playing",this.onMediaPlaying),Mt(s,"waiting",this.onMediaWaiting),Mt(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(jt(s,"playing",this.onMediaPlaying),jt(s,"waiting",this.onMediaWaiting),jt(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,r;const a=(s=this.hls)==null?void 0:s.config;if(!a)return;const u=this.media;if(!u)return;const{seeking:c}=u,h=this.seeking&&!c,d=!this.seeking&&c,g=u.paused&&!c||u.ended||u.playbackRate===0;if(this.seeking=c,e!==t){t&&(this.ended=0),this.moved=!0,c||(this.nudgeRetry=0,a.nudgeOnVideoHole&&!g&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(d||h){h&&this.stallResolved(e);return}if(g){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&u.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(b.MEDIA_ENDED,{stalled:!1}));return}if(!xe.getBuffered(u).length){this.nudgeRetry=0;return}const m=xe.bufferInfo(u,e,0),v=m.nextStart||0,E=this.fragmentTracker;if(c&&E&&this.hls){const K=sy(this.hls.inFlightFragments,e),w=m.len>Lo,B=!v||K||v-e>Lo&&!E.getPartialFragment(e);if(w||B)return;this.moved=!1}const S=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&E){if(!(m.len>0)&&!v)return;const w=Math.max(v,m.start||0)-e,$=!!(S!=null&&S.live)?S.targetduration*2:Lo,U=go(e,E);if(w>0&&(w<=$||U)){u.paused||this._trySkipBufferHole(U);return}}const x=a.detectStallWithCurrentTimeMs,T=self.performance.now(),L=this.waiting;let _=this.stalled;if(_===null)if(L>0&&T-L<x)_=this.stalled=L;else{this.stalled=T;return}const I=T-_;if(!c&&(I>=x||L)&&this.hls){var O;if(((O=this.mediaSource)==null?void 0:O.readyState)==="ended"&&!(S!=null&&S.live)&&Math.abs(e-(S?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(b.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(m),!this.media||!this.hls)return}const k=xe.bufferInfo(u,e,a.maxBufferHole);this._tryFixBufferStall(k,I,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(b.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(s=this.buffered.audio)!=null&&s.length&&r&&r.length>1&&e>r.end(0)){const a=xe.bufferedInfo(xe.timeRangesToArray(this.buffered.audio),e,0);if(a.len>1&&t>=a.start){const u=xe.timeRangesToArray(r),c=xe.bufferedInfo(u,t,0).bufferedIndex;if(c>-1&&c<u.length-1){const h=xe.bufferedInfo(u,e,0).bufferedIndex,d=u[c].end,g=u[c+1].start;if((h===-1||h>c)&&g-d<1&&e-d<2){const m=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${d} -> ${g} buffered index: ${h}`);this.warn(m.message),this.media.currentTime+=1e-6;let v=go(e,this.fragmentTracker);v&&"fragment"in v?v=v.fragment:v||(v=void 0);const E=xe.bufferInfo(this.media,e,0);this.hls.trigger(b.ERROR,{type:ye.MEDIA_ERROR,details:H.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,frag:v,buffer:E.len,bufferInfo:E})}}}}}_tryFixBufferStall(e,t,s){var r,a;const{fragmentTracker:u,media:c}=this,h=(r=this.hls)==null?void 0:r.config;if(!c||!u||!h)return;const d=(a=this.hls)==null?void 0:a.latestLevelDetails,g=go(s,u);if((g||d!=null&&d.live&&s<d.fragmentStart)&&(this._trySkipBufferHole(g)||!this.media))return;const m=e.buffered,v=this.adjacentTraversal(e,s);(m&&m.length>1&&e.len>h.maxBufferHole||e.nextStart&&(e.nextStart-s<h.maxBufferHole||v))&&(t>h.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const s=this.fragmentTracker,r=e.nextStart;if(s&&r){const a=s.getFragAtPos(t,ge.MAIN),u=s.getFragAtPos(r,ge.MAIN);if(a&&u)return u.sn-a.sn<2}return!1}_reportStall(e){const{hls:t,media:s,stallReported:r,stalled:a}=this;if(!r&&a!==null&&s&&t){this.stallReported=!0;const u=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${Xe(e)})`);this.warn(u.message),t.trigger(b.ERROR,{type:ye.MEDIA_ERROR,details:H.BUFFER_STALLED_ERROR,fatal:!1,error:u,buffer:e.len,bufferInfo:e,stalled:{start:a}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:r}=this,a=(t=this.hls)==null?void 0:t.config;if(!r||!s||!a)return 0;const u=r.currentTime,c=xe.bufferInfo(r,u,0),h=u<c.start?c.start:c.nextStart;if(h&&this.hls){const g=c.len<=a.maxBufferHole,m=c.len>0&&c.len<1&&r.readyState<3,v=h-u;if(v>0&&(g||m)){if(v>a.maxBufferHole){let S=!1;if(u===0){const x=s.getAppendedFrag(0,ge.MAIN);x&&h<x.end&&(S=!0)}if(!S&&e){var d;if(!((d=this.hls.loadLevelObj)!=null&&d.details)||sy(this.hls.inFlightFragments,h))return 0;let T=!1,L=e.end;for(;L<h;){const _=go(L,s);if(_)L+=_.duration;else{T=!0;break}}if(T)return 0}}const E=Math.max(h+J1,u+Z1);if(this.warn(`skipping hole, adjusting currentTime from ${u} to ${E}`),this.moved=!0,r.currentTime=E,!(e!=null&&e.gap)){const S=new Error(`fragment loaded with buffer holes, seeking from ${u} to ${E}`),x={type:ye.MEDIA_ERROR,details:H.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:S,reason:S.message,buffer:c.len,bufferInfo:c};e&&("fragment"in e?x.part=e:x.frag=e),this.hls.trigger(b.ERROR,x)}return E}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:r}=this,a=t?.config;if(!s||!a)return 0;const u=s.currentTime;if(this.nudgeRetry++,r<a.nudgeMaxRetry){const c=u+(r+1)*a.nudgeOffset,h=new Error(`Nudging 'currentTime' from ${u} to ${c}`);this.warn(h.message),s.currentTime=c,t.trigger(b.ERROR,{type:ye.MEDIA_ERROR,details:H.BUFFER_NUDGE_ON_STALL,error:h,fatal:!1,buffer:e.len,bufferInfo:e})}else{const c=new Error(`Playhead still not moving while enough data buffered @${u} after ${a.nudgeMaxRetry} nudges`);this.error(c.message),t.trigger(b.ERROR,{type:ye.MEDIA_ERROR,details:H.BUFFER_STALLED_ERROR,error:c,fatal:!0,buffer:e.len,bufferInfo:e})}}}function sy(l,e){const t=ny(l.main);if(t&&t.start<=e)return t;const s=ny(l.audio);return s&&s.start<=e?s:null}function ny(l){if(!l)return null;switch(l.state){case ee.IDLE:case ee.STOPPED:case ee.ENDED:case ee.ERROR:return null}return l.frag}function go(l,e){return e.getAppendedFrag(l,ge.MAIN)||e.getPartialFragment(l)}const i_=.25;function td(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function wf(l,e,t,s,r){let a=new l(e,t,"");try{a.value=s,r&&(a.type=r)}catch{a=new l(e,t,Xe(r?Ge({type:r},s):s))}return a}const mo=(()=>{const l=td();try{l&&new l(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class s_{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(b.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(b.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(b.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var s;this.media=t.media,((s=t.overrides)==null?void 0:s.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&cr(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if(s.kind==="metadata"&&s.label==="id3")return Hv(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:s,enableID3MetadataCues:r}=this.hls.config;if(!s&&!r)return;const{samples:a}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const u=td();if(u)for(let c=0;c<a.length;c++){const h=a[c].type;if(h===ti.emsg&&!s||!r)continue;const d=yv(a[c].data),g=a[c].pts;let m=g+a[c].duration;m>mo&&(m=mo),m-g<=0&&(m=g+i_);for(let E=0;E<d.length;E++){const S=d[E];if(!vv(S)){this.updateId3CueEnds(g,h);const x=wf(u,g,m,S,h);x&&this.id3Track.addCue(x)}}}}updateId3CueEnds(e,t){var s;const r=(s=this.id3Track)==null?void 0:s.cues;if(r)for(let a=r.length;a--;){const u=r[a];u.type===t&&u.startTime<e&&u.endTime===mo&&(u.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:r}){const{id3Track:a,hls:u}=this;if(!u)return;const{config:{enableEmsgMetadataCues:c,enableID3MetadataCues:h}}=u;if(a&&(c||h)){let d;r==="audio"?d=g=>g.type===ti.audioId3&&h:r==="video"?d=g=>g.type===ti.emsg&&c:d=g=>g.type===ti.audioId3&&h||g.type===ti.emsg&&c,Zf(a,t,s,d)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:s,timelineOffset:r,enableDateRangeMetadataCues:a,interstitialsController:u}=this.hls.config;if(!a)return;const c=td();if(s&&r&&!u){const{fragmentStart:x,fragmentEnd:T}=e;let L=this.assetCue;L?(L.startTime=x,L.endTime=T):c&&(L=this.assetCue=wf(c,x,T,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),L&&(L.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(L),L.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:h}=this,{dateRanges:d}=e,g=Object.keys(d);let m=this.dateRangeCuesAppended;if(h&&t){var v;if((v=h.cues)!=null&&v.length){const x=Object.keys(m).filter(T=>!g.includes(T));for(let T=x.length;T--;){var E;const L=x[T],_=(E=m[L])==null?void 0:E.cues;delete m[L],_&&Object.keys(_).forEach(I=>{const O=_[I];if(O){O.removeEventListener("enter",this.onEventCueEnter);try{h.removeCue(O)}catch{}}})}}else m=this.dateRangeCuesAppended={}}const S=e.fragments[e.fragments.length-1];if(!(g.length===0||!fe(S?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let x=0;x<g.length;x++){const T=g[x],L=d[T],_=L.startTime,I=m[T],O=I?.cues||{};let k=I?.durationKnown||!1,K=mo;const{duration:w,endDate:B}=L;if(B&&w!==null)K=_+w,k=!0;else if(L.endOnNext&&!k){const U=g.reduce((W,ne)=>{if(ne!==L.id){const ce=d[ne];if(ce.class===L.class&&ce.startDate>L.startDate&&(!W||L.startDate<W.startDate))return ce}return W},null);U&&(K=U.startTime,k=!0)}const $=Object.keys(L.attr);for(let U=0;U<$.length;U++){const W=$[U];if(!bb(W))continue;const ne=O[W];if(ne)k&&!(I!=null&&I.durationKnown)?ne.endTime=K:Math.abs(ne.startTime-_)>.01&&(ne.startTime=_,ne.endTime=K);else if(c){let ce=L.attr[W];Lb(W)&&(ce=Dy(ce));const oe=wf(c,_,K,{key:W,data:ce},ti.dateRange);oe&&(oe.id=T,this.id3Track.addCue(oe),O[W]=oe,u&&(W==="X-ASSET-LIST"||W==="X-ASSET-URL")&&oe.addEventListener("enter",this.onEventCueEnter))}}m[T]={cues:O,dateRange:L,durationKnown:k}}}}}class n_{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,s=this.levelDetails;if(!t||!s)return;this.currentTime=t.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:a,maxLiveSyncPlaybackRate:u}=this.config;if(!a||u===1||!s.live)return;const c=this.targetLatency;if(c===null)return;const h=r-c,d=Math.min(this.maxLatency,c+s.targetduration);if(h<d&&h>.05&&this.forwardBufferLength>1){const m=Math.min(2,Math.max(1,u)),v=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20,E=Math.min(m,Math.max(1,v));this.changeMediaPlaybackRate(t,E)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:s,targetduration:r}=e,{liveSyncDuration:a,liveSyncDurationCount:u,lowLatencyMode:c}=this.config,h=this.hls.userConfig;let d=c&&s||t;(this._targetLatencyUpdated||h.liveSyncDuration||h.liveSyncDurationCount||d===0)&&(d=a!==void 0?a:u*r);const g=r;return d+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,g)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const s=this.levelDetails;if(s===null)return null;const r=s.edge,a=e-t-this.edgeStalled,u=r-s.totalduration,c=r-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(u,a),c)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(b.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(b.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===H.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(s=this.levelDetails)!=null&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,r;e.playbackRate!==t&&((s=this.hls)==null||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class r_ extends Rd{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this),e.on(b.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this),e.off(b.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,r=[],a={},u={};let c=!1,h=!1,d=!1;t.levels.forEach(g=>{const m=g.attrs;let{audioCodec:v,videoCodec:E}=g;v&&(g.audioCodec=v=Do(v,s)||void 0),E&&(E=g.videoCodec=GA(E));const{width:S,height:x,unknownCodecs:T}=g,L=T?.length||0;if(c||(c=!!(S&&x)),h||(h=!!E),d||(d=!!v),L||v&&!this.isAudioSupported(v)||E&&!this.isVideoSupported(E)){this.log(`Some or all CODECS not supported "${m.CODECS}"`);return}const{CODECS:_,"FRAME-RATE":I,"HDCP-LEVEL":O,"PATHWAY-ID":k,RESOLUTION:K,"VIDEO-RANGE":w}=m,$=`${`${k||"."}-`}${g.bitrate}-${K}-${I}-${_}-${w}-${O}`;if(a[$])if(a[$].uri!==g.url&&!g.attrs["PATHWAY-ID"]){const U=u[$]+=1;g.attrs["PATHWAY-ID"]=new Array(U+1).join(".");const W=this.createLevel(g);a[$]=W,r.push(W)}else a[$].addGroupId("audio",m.AUDIO),a[$].addGroupId("text",m.SUBTITLES);else{const U=this.createLevel(g);a[$]=U,u[$]=1,r.push(U)}}),this.filterAndSortMediaOptions(r,t,c,h,d)}createLevel(e){const t=new La(e),s=e.supplemental;if(s!=null&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(r.message),t.supportedResult=$y(r,[])}return t}isAudioSupported(e){return Aa(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Aa(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,r,a){var u;let c=[],h=[],d=e;const g=((u=t.stats)==null?void 0:u.parsing)||{};if((s||r)&&a&&(d=d.filter(({videoCodec:_,videoRange:I,width:O,height:k})=>(!!_||!!(O&&k))&&WA(I))),d.length===0){Promise.resolve().then(()=>{if(this.hls){let _="no level with compatible codecs found in manifest",I=_;t.levels.length&&(I=`one or more CODECS in variant not supported: ${Xe(t.levels.map(k=>k.attrs.CODECS).filter((k,K,w)=>w.indexOf(k)===K))}`,this.warn(I),_+=` (${I})`);const O=new Error(_);this.hls.trigger(b.ERROR,{type:ye.MEDIA_ERROR,details:H.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:O,reason:I})}}),g.end=performance.now();return}t.audioTracks&&(c=t.audioTracks.filter(_=>!_.audioCodec||this.isAudioSupported(_.audioCodec)),ry(c)),t.subtitles&&(h=t.subtitles,ry(h));const m=d.slice(0);d.sort((_,I)=>{if(_.attrs["HDCP-LEVEL"]!==I.attrs["HDCP-LEVEL"])return(_.attrs["HDCP-LEVEL"]||"")>(I.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&_.height!==I.height)return _.height-I.height;if(_.frameRate!==I.frameRate)return _.frameRate-I.frameRate;if(_.videoRange!==I.videoRange)return Io.indexOf(_.videoRange)-Io.indexOf(I.videoRange);if(_.videoCodec!==I.videoCodec){const O=Q0(_.videoCodec),k=Q0(I.videoCodec);if(O!==k)return k-O}if(_.uri===I.uri&&_.codecSet!==I.codecSet){const O=_o(_.codecSet),k=_o(I.codecSet);if(O!==k)return k-O}return _.averageBitrate!==I.averageBitrate?_.averageBitrate-I.averageBitrate:0});let v=m[0];if(this.steering&&(d=this.steering.filterParsedLevels(d),d.length!==m.length)){for(let _=0;_<m.length;_++)if(m[_].pathwayId===d[0].pathwayId){v=m[_];break}}this._levels=d;for(let _=0;_<d.length;_++)if(d[_]===v){var E;this._firstLevel=_;const I=v.bitrate,O=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${d.length} level(s) found, first bitrate: ${I}`),((E=this.hls.userConfig)==null?void 0:E.abrEwmaDefaultEstimate)===void 0){const k=Math.min(I,this.hls.config.abrEwmaDefaultEstimateMax);k>O&&O===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=k)}break}const S=a&&!r,x=this.hls.config,T=!!(x.audioStreamController&&x.audioTrackController),L={levels:d,audioTracks:c,subtitleTracks:h,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:a,video:r,altAudio:T&&!S&&c.some(_=>!!_.url)};g.end=performance.now(),this.hls.trigger(b.MANIFEST_PARSED,L)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const g=new Error("invalid level idx"),m=e<0;if(this.hls.trigger(b.ERROR,{type:ye.OTHER_ERROR,details:H.LEVEL_SWITCH_ERROR,level:e,fatal:m,error:g,reason:g.message}),m)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,r=this.currentLevel,a=r?r.attrs["PATHWAY-ID"]:void 0,u=t[e],c=u.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=u,s===e&&r&&a===c)return;this.log(`Switching to level ${e} (${u.height?u.height+"p ":""}${u.videoRange?u.videoRange+" ":""}${u.codecSet?u.codecSet+" ":""}@${u.bitrate})${c?" with Pathway "+c:""} from level ${s}${a?" with Pathway "+a:""}`);const h={level:e,attrs:u.attrs,details:u.details,bitrate:u.bitrate,averageBitrate:u.averageBitrate,maxBitrate:u.maxBitrate,realBitrate:u.realBitrate,width:u.width,height:u.height,codecSet:u.codecSet,audioCodec:u.audioCodec,videoCodec:u.videoCodec,audioGroups:u.audioGroups,subtitleGroups:u.subtitleGroups,loaded:u.loaded,loadError:u.loadError,fragmentError:u.fragmentError,name:u.name,id:u.id,uri:u.uri,url:u.url,urlId:0,audioGroupIds:u.audioGroupIds,textGroupIds:u.textGroupIds};this.hls.trigger(b.LEVEL_SWITCHING,h);const d=u.details;if(!d||d.live){const g=this.switchParams(u.uri,r?.details,d);this.loadPlaylist(g)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter(r=>t.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=s}}onError(e,t){t.fatal||!t.context||t.context.type===_e.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===ge.MAIN){const s=t.elementaryStreams;if(!Object.keys(s).some(a=>!!s[a]))return;const r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var s;const{level:r,details:a}=t,u=t.levelInfo;if(!u){var c;this.warn(`Invalid level index ${r}`),(c=t.deliveryDirectives)!=null&&c.skip&&(a.deltaUpdateFailed=!0);return}if(u===this.currentLevel||t.withoutMultiVariant){u.fragmentError===0&&(u.loadError=0);let h=u.details;h===t.details&&h.advanced&&(h=void 0),this.playlistLoaded(r,t,h)}else(s=t.deliveryDirectives)!=null&&s.skip&&(a.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,a=e.attrs["PATHWAY-ID"],u=e.details,c=u?.age;this.log(`Loading level index ${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${a?" Pathway "+a:""}${c&&u.live?" age "+c.toFixed(1)+(u.type&&" "+u.type||""):""} ${s}`),this.hls.trigger(b.LEVEL_LOADING,{url:s,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const s=this._levels.filter((a,u)=>u!==e?!0:(this.steering&&this.steering.removeLevel(a),a===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,a.details&&a.details.fragments.forEach(c=>c.level=-1)),!1));lv(s),this._levels=s,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=s.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(b.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(b.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function ry(l){const e={};l.forEach(t=>{const s=t.groupId||"";t.id=e[s]=e[s]||0,e[s]++})}function iE(){return self.SourceBuffer||self.WebKitSourceBuffer}function sE(){if(!Hs())return!1;const e=iE();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function a_(){if(!sE())return!1;const l=Hs();return typeof l?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>l.isTypeSupported(ba(e,"video")))||["mp4a.40.2","fLaC"].some(e=>l.isTypeSupported(ba(e,"audio"))))}function l_(){var l;const e=iE();return typeof(e==null||(l=e.prototype)==null?void 0:l.changeType)=="function"}const o_=100;class u_ extends vd{constructor(e,t,s){super(e,t,s,"stream-controller",ge.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,a=r?r.currentTime:null;if(a===null||!fe(a)||(this.log(`Media seeked to ${a.toFixed(3)}`),!this.getBufferedFrag(a)))return;const u=this.getFwdBufferInfoAtPos(r,a,ge.MAIN,0);if(u===null||u.len===0){this.warn(`Main forward buffer length at ${a} on "seeked" event ${u?u.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this),e.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this),e.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:r}=this;if(this.stopLoad(),this.setInterval(o_),this.level=-1,!this.startFragRequested){let a=r.startLevel;a===-1&&(r.config.testBandwidth&&this.levels.length>1?(a=0,this.bitrateTest=!0):a=r.firstAutoLevel),r.nextLoadLevel=a,this.level=r.loadLevel,this._hasEnoughToStart=!!t}s>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=ee.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=ee.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ee.WAITING_LEVEL:{const{levels:e,level:t}=this,s=e?.[t],r=s?.details;if(r&&(!r.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(r))break;this.state=ee.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ee.IDLE;break}break}case ee.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===ee.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:r}=this;if(t===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const a=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(s!=null&&s[a]))return;const u=s[a],c=this.getMainFwdBufferInfo();if(c===null)return;const h=this.getLevelDetails();if(h&&this._streamEnded(c,h)){const x={};this.altAudio===2&&(x.type="video"),this.hls.trigger(b.BUFFER_EOS,x),this.state=ee.ENDED;return}if(!this.buffering)return;e.loadLevel!==a&&e.manualLevel===-1&&this.log(`Adapting to level ${a} from level ${this.level}`),this.level=e.nextLoadLevel=a;const d=u.details;if(!d||this.state===ee.WAITING_LEVEL||this.waitForLive(u)){this.level=a,this.state=ee.WAITING_LEVEL,this.startFragRequested=!1;return}const g=c.len,m=this.getMaxBufferLength(u.maxBitrate);if(g>=m)return;this.backtrackFragment&&this.backtrackFragment.start>c.end&&(this.backtrackFragment=null);const v=this.backtrackFragment?this.backtrackFragment.start:c.end;let E=this.getNextFragment(v,d);if(this.couldBacktrack&&!this.fragPrevious&&E&&lt(E)&&this.fragmentTracker.getState(E)!==gt.OK){var S;const T=((S=this.backtrackFragment)!=null?S:E).sn-d.startSN,L=d.fragments[T-1];L&&E.cc===L.cc&&(E=L,this.fragmentTracker.removeFragment(L))}else this.backtrackFragment&&c.len&&(this.backtrackFragment=null);if(E&&this.isLoopLoading(E,v)){if(!E.gap){const T=this.audioOnly&&!this.altAudio?qe.AUDIO:qe.VIDEO,L=(T===qe.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;L&&this.afterBufferFlushed(L,T,ge.MAIN)}E=this.getNextFragmentLoopLoading(E,d,c,ge.MAIN,m)}E&&(E.initSegment&&!E.initSegment.data&&!this.bitrateTest&&(E=E.initSegment),this.loadFragment(E,u,v))}loadFragment(e,t,s){const r=this.fragmentTracker.getState(e);r===gt.NOT_LOADED||r===gt.PARTIAL?lt(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ge.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let s;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const a=this.getLevelDetails();if(a!=null&&a.live){const c=this.getMainFwdBufferInfo();if(!c||c.len<a.targetduration*2)return}if(!t.paused&&e){const c=this.hls.nextLoadLevel,h=e[c],d=this.fragLastKbps;d&&this.fragCurrent?s=this.fragCurrent.duration*h.maxBitrate/(1e3*d)+1:s=0}else s=0;const u=this.getBufferedFrag(t.currentTime+s);if(u){const c=this.followingBufferedFrag(u);if(c){this.abortCurrentFrag();const h=c.maxStartPTS?c.maxStartPTS:c.start,d=c.duration,g=Math.max(u.end,h+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,d*(this.couldBacktrack?.5:.125)),d*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(g,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ee.KEY_LOADING:case ee.FRAG_LOADING:case ee.FRAG_LOADING_WAITING_RETRY:case ee.PARSING:case ee.PARSED:this.state=ee.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;Mt(s,"playing",this.onMediaPlaying),Mt(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(jt(s,"playing",this.onMediaPlaying),jt(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(b.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,r=!1;for(let a=0;a<t.levels.length;a++){const u=t.levels[a].audioCodec;u&&(s=s||u.indexOf("mp4a.40.2")!==-1,r=r||u.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=s&&r&&!l_(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==ee.IDLE)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=ee.WAITING_LEVEL)}onLevelLoaded(e,t){var s;const{levels:r,startFragRequested:a}=this,u=t.level,c=t.details,h=c.totalduration;if(!r){this.warn(`Levels were reset while loading level ${u}`);return}this.log(`Level ${u} loaded [${c.startSN},${c.endSN}]${c.lastPartSn?`[part-${c.lastPartSn}-${c.lastPartIndex}]`:""}, cc [${c.startCC}, ${c.endCC}] duration:${h}`);const d=t.levelInfo,g=this.fragCurrent;g&&(this.state===ee.FRAG_LOADING||this.state===ee.FRAG_LOADING_WAITING_RETRY)&&g.level!==t.level&&g.loader&&this.abortCurrentFrag();let m=0;if(c.live||(s=d.details)!=null&&s.live){var v;if(this.checkLiveUpdate(c),c.deltaUpdateFailed)return;m=this.alignPlaylists(c,d.details,(v=this.levelLastLoaded)==null?void 0:v.details)}if(d.details=c,this.levelLastLoaded=d,a||this.setStartPosition(c,m),this.hls.trigger(b.LEVEL_UPDATED,{details:c,level:u}),this.state===ee.WAITING_LEVEL){if(this.waitForCdnTuneIn(c))return;this.state=ee.IDLE}a&&c.live&&this.synchronizeToLiveEdge(c),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const r=this.hls.liveSyncPosition,a=this.getLoadPosition(),u=e.fragmentStart,c=e.edge,h=a>=u-t.maxFragLookUpTolerance&&a<=c;if(r!==null&&s.duration>r&&(a<r||!h)){const g=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!h&&s.readyState<4||a<c-g)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),s.readyState))if(this.warn(`Playback: ${a.toFixed(3)} is located too far from the end of live sliding playlist: ${c}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var d;const m=xe.bufferInfo(s,r,0);if(!((d=m.buffered)!=null&&d.length)){s.currentTime=r;return}if(m.start<=a){s.currentTime=r;return}const{nextStart:E}=xe.bufferedInfo(m.buffered,a,0);E&&(s.currentTime=E)}else s.currentTime=r}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:r,payload:a}=e,{levels:u}=this;if(!u){this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const c=u[s.level];if(!c){this.warn(`Level ${s.level} not found on progress`);return}const h=c.details;if(!h){this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),this.fragmentTracker.removeFragment(s);return}const d=c.videoCodec,g=h.PTSKnown||!h.live,m=(t=s.initSegment)==null?void 0:t.data,v=this._getAudioCodec(c),E=this.transmuxer=this.transmuxer||new Iv(this.hls,ge.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),S=r?r.index:-1,x=S!==-1,T=new md(s.level,s.sn,s.stats.chunkCount,a.byteLength,S,x),L=this.initPTS[s.cc];E.push(a,m,v,d,s,r,h.totalduration,g,T,L)}onAudioTrackSwitching(e,t){const s=this.hls,r=this.altAudio!==0;if(Co(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const u=this.fragCurrent;u&&(this.log("Switching to main audio track, cancel main fragment load"),u.abortRequests(),this.fragmentTracker.removeFragment(u)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.altAudio=0,this.fragmentTracker.removeAllFragments(),s.once(b.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(b.AUDIO_TRACK_SWITCHED,t)}),s.trigger(b.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(b.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=Co(t.url,this.hls);if(s){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let r,a,u=!1;for(const c in s){const h=s[c];if(h.id==="main"){if(a=c,r=h,c==="video"){const d=s[c];d&&(this.videoBuffer=d.buffer)}}else u=!0}u&&r?(this.log(`Alternate track found, use ${a}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:r}=t,a=s.type===ge.MAIN;if(a){if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${r?" p: "+r.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ee.PARSED&&(this.state=ee.IDLE);return}const c=r?r.stats:s.stats;this.fragLastKbps=Math.round(8*c.total/(c.buffering.end-c.loading.first)),lt(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,r)}const u=this.media;u&&(!this._hasEnoughToStart&&xe.getBuffered(u).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),a&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal){this.state=ee.ERROR;return}switch(t.details){case H.FRAG_GAP:case H.FRAG_PARSING_ERROR:case H.FRAG_DECRYPT_ERROR:case H.FRAG_LOAD_ERROR:case H.FRAG_LOAD_TIMEOUT:case H.KEY_LOAD_ERROR:case H.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ge.MAIN,t);break;case H.LEVEL_LOAD_ERROR:case H.LEVEL_LOAD_TIMEOUT:case H.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ee.WAITING_LEVEL&&((s=t.context)==null?void 0:s.type)===_e.LEVEL&&(this.state=ee.IDLE);break;case H.BUFFER_ADD_CODEC_ERROR:case H.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case H.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case H.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=ee.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==qe.AUDIO||!this.altAudio){const s=(t===qe.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,t,ge.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking){this.log(`could not seek to ${s}, already seeking at ${t}`);return}const r=this.timelineOffset;r&&s&&(s+=r);const a=this.getLevelDetails(),u=xe.getBuffered(e),c=u.length?u.start(0):0,h=c-s,d=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||h>0&&(h<d||this.loadingParts&&h<2*(a?.partTarget||0)))&&(this.log(`adjusting start position by ${h} to match buffer start`),s+=h,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${c}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(s=>{const{hls:r}=this,a=s?.frag;if(!a||this.fragContextChanged(a))return;t.fragmentError=0,this.state=ee.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const u=a.stats;u.parsing.start=u.parsing.end=u.buffering.start=u.buffering.end=self.performance.now(),r.trigger(b.FRAG_LOADED,s),a.bitrateTest=!1}).catch(s=>{this.state===ee.STOPPED||this.state===ee.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:s}=this,{remuxResult:r,chunkMeta:a}=e,u=this.getCurrentContext(a);if(!u){this.resetWhenMissingContext(a);return}const{frag:c,part:h,level:d}=u,{video:g,text:m,id3:v,initSegment:E}=r,{details:S}=d,x=this.altAudio?void 0:r.audio;if(this.fragContextChanged(c)){this.fragmentTracker.removeFragment(c);return}if(this.state=ee.PARSING,E){const T=E.tracks;if(T){const O=c.initSegment||c;if(this.unhandledEncryptionError(E,c))return;this._bufferInitSegment(d,T,O,a),s.trigger(b.FRAG_PARSING_INIT_SEGMENT,{frag:O,id:t,tracks:T})}const L=E.initPTS,_=E.timescale,I=this.initPTS[c.cc];if(fe(L)&&(!I||I.baseTime!==L||I.timescale!==_)){const O=E.trackId;this.initPTS[c.cc]={baseTime:L,timescale:_,trackId:O},s.trigger(b.INIT_PTS_FOUND,{frag:c,id:t,initPTS:L,timescale:_,trackId:O})}}if(g&&S){x&&g.type==="audiovideo"&&this.logMuxedErr(c);const T=S.fragments[c.sn-1-S.startSN],L=c.sn===S.startSN,_=!T||c.cc>T.cc;if(r.independent!==!1){const{startPTS:I,endPTS:O,startDTS:k,endDTS:K}=g;if(h)h.elementaryStreams[g.type]={startPTS:I,endPTS:O,startDTS:k,endDTS:K};else if(g.firstKeyFrame&&g.independent&&a.id===1&&!_&&(this.couldBacktrack=!0),g.dropped&&g.independent){const w=this.getMainFwdBufferInfo(),B=(w?w.end:this.getLoadPosition())+this.config.maxBufferHole,$=g.firstKeyFramePTS?g.firstKeyFramePTS:I;if(!L&&B<$-this.config.maxBufferHole&&!_){this.backtrack(c);return}else _&&(c.gap=!0);c.setElementaryStreamInfo(g.type,c.start,O,c.start,K,!0)}else L&&I-(S.appliedTimelineOffset||0)>Lo&&(c.gap=!0);c.setElementaryStreamInfo(g.type,I,O,k,K),this.backtrackFragment&&(this.backtrackFragment=c),this.bufferFragmentData(g,c,h,a,L||_)}else if(L||_)c.gap=!0;else{this.backtrack(c);return}}if(x){const{startPTS:T,endPTS:L,startDTS:_,endDTS:I}=x;h&&(h.elementaryStreams[qe.AUDIO]={startPTS:T,endPTS:L,startDTS:_,endDTS:I}),c.setElementaryStreamInfo(qe.AUDIO,T,L,_,I),this.bufferFragmentData(x,c,h,a)}if(S&&v!=null&&v.samples.length){const T={id:t,frag:c,details:S,samples:v.samples};s.trigger(b.FRAG_PARSING_METADATA,T)}if(S&&m){const T={id:t,frag:c,details:S,samples:m.samples};s.trigger(b.FRAG_PARSING_USERDATA,T)}}logMuxedErr(e){this.warn(`${lt(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,r){if(this.state!==ee.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:a,video:u,audiovideo:c}=t;if(a){const d=e.audioCodec;let g=vo(a.codec,d);g==="mp4a"&&(g="mp4a.40.5");const m=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){g&&(g.indexOf("mp4a.40.5")!==-1?g="mp4a.40.2":g="mp4a.40.5");const v=a.metadata;v&&"channelCount"in v&&(v.channelCount||1)!==1&&m.indexOf("firefox")===-1&&(g="mp4a.40.5")}g&&g.indexOf("mp4a.40.5")!==-1&&m.indexOf("android")!==-1&&a.container!=="audio/mpeg"&&(g="mp4a.40.2",this.log(`Android: force audio codec to ${g}`)),d&&d!==g&&this.log(`Swapping manifest audio codec "${d}" for "${g}"`),a.levelCodec=g,a.id=ge.MAIN,this.log(`Init audio buffer, container:${a.container}, codecs[selected/level/parsed]=[${g||""}/${d||""}/${a.codec}]`),delete t.audiovideo}if(u){u.levelCodec=e.videoCodec,u.id=ge.MAIN;const d=u.codec;if(d?.length===4)switch(d){case"hvc1":case"hev1":u.codec="hvc1.1.6.L120.90";break;case"av01":u.codec="av01.0.04M.08";break;case"avc1":u.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${u.container}, codecs[level/parsed]=[${e.videoCodec||""}/${d}]${u.codec!==d?" parsed-corrected="+u.codec:""}${u.supplemental?" supplemental="+u.supplemental:""}`),delete t.audiovideo}c&&(this.log(`Init audiovideo buffer, container:${c.container}, codecs[level/parsed]=[${e.codecs}/${c.codec}]`),delete t.video,delete t.audio);const h=Object.keys(t);if(h.length){if(this.hls.trigger(b.BUFFER_CODECS,t),!this.hls)return;h.forEach(d=>{const m=t[d].initSegment;m!=null&&m.byteLength&&this.hls.trigger(b.BUFFER_APPENDING,{type:d,data:m,frag:s,part:null,chunkMeta:r,parent:s.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,ge.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,s=e?.[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ee.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const s=e.currentTime;if(xe.isBuffered(e,s)?t=this.getAppendedFrag(s):xe.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const r=this.fragPlaying,a=t.level;(!r||t.sn!==r.sn||r.level!==a)&&(this.fragPlaying=t,this.hls.trigger(b.FRAG_CHANGED,{frag:t}),(!r||r.level!==a)&&this.hls.trigger(b.LEVEL_SWITCHED,{level:a}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return fe(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(fe(t)){const s=this.getLevelDetails(),r=this.currentFrag||(s?pn(null,s.fragments,t):null);if(r){const a=r.programDateTime;if(a!==null){const u=a+(t-r.start)*1e3;return new Date(u)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class c_ extends vi{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyIdToKeyInfo){const r=this.keyIdToKeyInfo[s].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=H.KEY_LOAD_ERROR,s,r,a){return new ls({type:ye.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:a,error:s,networkDetails:r})}loadClear(e,t,s){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,a=t.length;r<a;r++){const u=t[r];if(e.cc<=u.cc&&(!lt(e)||!lt(u)||e.sn<u.sn)||!s&&r==a-1)return this.emeController.selectKeySystemFormat(u).then(c=>{if(!this.emeController)return;u.setKeyFormat(c);const h=So(c);if(h)return this.emeController.getKeySystemAccess([h])})}if(this.config.requireKeySystemAccessOnStart){const r=va(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var s,r;t&&e.setKeyFormat(t);const a=e.decryptdata;if(!a){const d=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,H.KEY_LOAD_ERROR,d))}const u=a.uri;if(!u)return Promise.reject(this.createKeyLoadError(e,H.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${u}"`)));const c=Mf(a);let h=this.keyIdToKeyInfo[c];if((s=h)!=null&&s.decryptdata.key)return a.key=h.decryptdata.key,Promise.resolve({frag:e,keyInfo:h});if(this.emeController&&(r=h)!=null&&r.keyLoadPromise)switch(this.emeController.getKeyStatus(h.decryptdata)){case"usable":case"usable-in-future":return h.keyLoadPromise.then(g=>{const{keyInfo:m}=g;return a.key=m.decryptdata.key,{frag:e,keyInfo:m}})}switch(this.log(`${this.keyIdToKeyInfo[c]?"Rel":"L"}oading${a.keyId?" keyId: "+Rt(a.keyId):""} URI: ${a.uri} from ${e.type} ${e.level}`),h=this.keyIdToKeyInfo[c]={decryptdata:a,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},a.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return a.keyFormat==="identity"?this.loadKeyHTTP(h,e):this.loadKeyEME(h,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(h,e);default:return Promise.reject(this.createKeyLoadError(e,H.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${a.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var r;if(!e.decryptdata.keyId&&(r=t.initSegment)!=null&&r.data){const u=IA(t.initSegment.data);if(u.length){let c=u[0];c.some(h=>h!==0)?(this.log(`Using keyId found in init segment ${Rt(c)}`),js.setKeyIdForUri(e.decryptdata.uri,c)):(c=js.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Rt(c)}`)),e.decryptdata.keyId=c}}if(!e.decryptdata.keyId&&!lt(t))return Promise.resolve(s);const a=this.emeController.loadKey(s);return(e.keyLoadPromise=a.then(u=>(e.mediaKeySessionContext=u,s))).catch(u=>{throw e.keyLoadPromise=null,"data"in u&&(u.data.frag=t),u})}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,r=s.loader,a=new r(s);return t.keyLoader=e.loader=a,e.keyLoadPromise=new Promise((u,c)=>{const h={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},d=s.keyLoadPolicy.default,g={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(v,E,S,x)=>{const{frag:T,keyInfo:L}=S,_=Mf(L.decryptdata);if(!T.decryptdata||L!==this.keyIdToKeyInfo[_])return c(this.createKeyLoadError(T,H.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),x));L.decryptdata.key=T.decryptdata.key=new Uint8Array(v.data),T.keyLoader=null,L.loader=null,u({frag:T,keyInfo:L})},onError:(v,E,S,x)=>{this.resetLoader(E),c(this.createKeyLoadError(t,H.KEY_LOAD_ERROR,new Error(`HTTP Error ${v.code} loading key ${v.text}`),S,Ge({url:h.url,data:void 0},v)))},onTimeout:(v,E,S)=>{this.resetLoader(E),c(this.createKeyLoadError(t,H.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),S))},onAbort:(v,E,S)=>{this.resetLoader(E),c(this.createKeyLoadError(t,H.INTERNAL_ABORTED,new Error("key loading aborted"),S))}};a.load(h,g,m)})}resetLoader(e){const{frag:t,keyInfo:s,url:r}=e,a=s.loader;t.keyLoader===a&&(t.keyLoader=null,s.loader=null);const u=Mf(s.decryptdata)||r;delete this.keyIdToKeyInfo[u],a&&a.destroy()}}function Mf(l){if(l.keyFormat!==_t.FAIRPLAY){const e=l.keyId;if(e)return Rt(e)}return l.uri}function ay(l){const{type:e}=l;switch(e){case _e.AUDIO_TRACK:return ge.AUDIO;case _e.SUBTITLE_TRACK:return ge.SUBTITLE;default:return ge.MAIN}}function kf(l,e){let t=l.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class f_{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(b.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(b.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,r=t.loader,a=s||r,u=new a(t);return this.loaders[e.type]=u,u}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:_e.MANIFEST,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:r,pathwayId:a,url:u,deliveryDirectives:c,levelInfo:h}=t;this.load({id:s,level:r,pathwayId:a,responseType:"text",type:_e.LEVEL,url:u,deliveryDirectives:c,levelOrTrack:h})}onAudioTrackLoading(e,t){const{id:s,groupId:r,url:a,deliveryDirectives:u,track:c}=t;this.load({id:s,groupId:r,level:null,responseType:"text",type:_e.AUDIO_TRACK,url:a,deliveryDirectives:u,levelOrTrack:c})}onSubtitleTrackLoading(e,t){const{id:s,groupId:r,url:a,deliveryDirectives:u,track:c}=t;this.load({id:s,groupId:r,level:null,responseType:"text",type:_e.SUBTITLE_TRACK,url:a,deliveryDirectives:u,levelOrTrack:c})}onLevelsUpdated(e,t){const s=this.loaders[_e.LEVEL];if(s){const r=s.context;r&&!t.levels.some(a=>a===r.levelOrTrack)&&(s.abort(),delete this.loaders[_e.LEVEL])}}load(e){var t;const s=this.hls.config;let r=this.getInternalLoader(e);if(r){const d=this.hls.logger,g=r.context;if(g&&g.levelOrTrack===e.levelOrTrack&&(g.url===e.url||g.deliveryDirectives&&!e.deliveryDirectives)){g.url===e.url?d.log(`[playlist-loader]: ignore ${e.url} ongoing request`):d.log(`[playlist-loader]: ignore ${e.url} in favor of ${g.url}`);return}d.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let a;if(e.type===_e.MANIFEST?a=s.manifestLoadPolicy.default:a=Ve({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),fe((t=e.deliveryDirectives)==null?void 0:t.part)){let d;if(e.type===_e.LEVEL&&e.level!==null?d=this.hls.levels[e.level].details:e.type===_e.AUDIO_TRACK&&e.id!==null?d=this.hls.audioTracks[e.id].details:e.type===_e.SUBTITLE_TRACK&&e.id!==null&&(d=this.hls.subtitleTracks[e.id].details),d){const g=d.partTarget,m=d.targetduration;if(g&&m){const v=Math.max(g*3,m*.8)*1e3;a=Ve({},a,{maxTimeToFirstByteMs:Math.min(v,a.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(v,a.maxTimeToFirstByteMs)})}}}const u=a.errorRetry||a.timeoutRetry||{},c={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},h={onSuccess:(d,g,m,v)=>{const E=this.getInternalLoader(m);this.resetInternalLoader(m.type);const S=d.data;g.parsing.start=performance.now(),Pi.isMediaPlaylist(S)||m.type!==_e.MANIFEST?this.handleTrackOrLevelPlaylist(d,g,m,v||null,E):this.handleMasterPlaylist(d,g,m,v)},onError:(d,g,m,v)=>{this.handleNetworkError(g,m,!1,d,v)},onTimeout:(d,g,m)=>{this.handleNetworkError(g,m,!0,void 0,d)}};r.load(e,c,h)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,r){const a=this.hls,u=e.data,c=kf(e,s),h=Pi.parseMasterPlaylist(u,c);if(h.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,s,h.playlistParsingError,r,t);return}const{contentSteering:d,levels:g,sessionData:m,sessionKeys:v,startTimeOffset:E,variableList:S}=h;this.variableList=S,g.forEach(_=>{const{unknownCodecs:I}=_;if(I){const{preferManagedMediaSource:O}=this.hls.config;let{audioCodec:k,videoCodec:K}=_;for(let w=I.length;w--;){const B=I[w];Aa(B,"audio",O)?(_.audioCodec=k=k?`${k},${B}`:B,mr.audio[k.substring(0,4)]=2,I.splice(w,1)):Aa(B,"video",O)&&(_.videoCodec=K=K?`${K},${B}`:B,mr.video[K.substring(0,4)]=2,I.splice(w,1))}}});const{AUDIO:x=[],SUBTITLES:T,"CLOSED-CAPTIONS":L}=Pi.parseMasterPlaylistMedia(u,c,h);x.length&&!x.some(I=>!I.url)&&g[0].audioCodec&&!g[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),x.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Je({}),bitrate:0,url:""})),a.trigger(b.MANIFEST_LOADED,{levels:g,audioTracks:x,subtitles:T,captions:L,contentSteering:d,url:c,stats:t,networkDetails:r,sessionData:m,sessionKeys:v,startTimeOffset:E,variableList:S})}handleTrackOrLevelPlaylist(e,t,s,r,a){const u=this.hls,{id:c,level:h,type:d}=s,g=kf(e,s),m=fe(h)?h:fe(c)?c:0,v=ay(s),E=Pi.parseLevelPlaylist(e.data,g,m,v,0,this.variableList);if(d===_e.MANIFEST){const S={attrs:new Je({}),bitrate:0,details:E,name:"",url:g};E.requestScheduled=t.loading.start+nv(E,0),u.trigger(b.MANIFEST_LOADED,{levels:[S],audioTracks:[],url:g,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=E,this.handlePlaylistLoaded(E,e,t,s,r,a)}handleManifestParsingError(e,t,s,r,a){this.hls.trigger(b.ERROR,{type:ye.NETWORK_ERROR,details:H.MANIFEST_PARSING_ERROR,fatal:t.type===_e.MANIFEST,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:r,stats:a})}handleNetworkError(e,t,s=!1,r,a){let u=`A network ${s?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===_e.LEVEL?u+=`: ${e.level} id: ${e.id}`:(e.type===_e.AUDIO_TRACK||e.type===_e.SUBTITLE_TRACK)&&(u+=` id: ${e.id} group-id: "${e.groupId}"`);const c=new Error(u);this.hls.logger.warn(`[playlist-loader]: ${u}`);let h=H.UNKNOWN,d=!1;const g=this.getInternalLoader(e);switch(e.type){case _e.MANIFEST:h=s?H.MANIFEST_LOAD_TIMEOUT:H.MANIFEST_LOAD_ERROR,d=!0;break;case _e.LEVEL:h=s?H.LEVEL_LOAD_TIMEOUT:H.LEVEL_LOAD_ERROR,d=!1;break;case _e.AUDIO_TRACK:h=s?H.AUDIO_TRACK_LOAD_TIMEOUT:H.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case _e.SUBTITLE_TRACK:h=s?H.SUBTITLE_TRACK_LOAD_TIMEOUT:H.SUBTITLE_LOAD_ERROR,d=!1;break}g&&this.resetInternalLoader(e.type);const m={type:ye.NETWORK_ERROR,details:h,fatal:d,url:e.url,loader:g,context:e,error:c,networkDetails:t,stats:a};if(r){const v=t?.url||e.url;m.response=Ge({url:v,data:void 0},r)}this.hls.trigger(b.ERROR,m)}handlePlaylistLoaded(e,t,s,r,a,u){const c=this.hls,{type:h,level:d,levelOrTrack:g,id:m,groupId:v,deliveryDirectives:E}=r,S=kf(t,r),x=ay(r);let T=typeof r.level=="number"&&x===ge.MAIN?d:void 0;const L=e.playlistParsingError;if(L){if(this.hls.logger.warn(`${L} ${e.url}`),!c.config.ignorePlaylistParsingErrors){c.trigger(b.ERROR,{type:ye.NETWORK_ERROR,details:H.LEVEL_PARSING_ERROR,fatal:!1,url:S,error:L,reason:L.message,response:t,context:r,level:T,parent:x,networkDetails:a,stats:s});return}e.playlistParsingError=null}if(!e.fragments.length){const _=e.playlistParsingError=new Error("No Segments found in Playlist");c.trigger(b.ERROR,{type:ye.NETWORK_ERROR,details:H.LEVEL_EMPTY_ERROR,fatal:!1,url:S,error:_,reason:_.message,response:t,context:r,level:T,parent:x,networkDetails:a,stats:s});return}switch(e.live&&u&&(u.getCacheAge&&(e.ageHeader=u.getCacheAge()||0),(!u.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),h){case _e.MANIFEST:case _e.LEVEL:if(T){if(!g)T=0;else if(g!==c.levels[T]){const _=c.levels.indexOf(g);_>-1&&(T=_)}}c.trigger(b.LEVEL_LOADED,{details:e,levelInfo:g||c.levels[0],level:T||0,id:m||0,stats:s,networkDetails:a,deliveryDirectives:E,withoutMultiVariant:h===_e.MANIFEST});break;case _e.AUDIO_TRACK:c.trigger(b.AUDIO_TRACK_LOADED,{details:e,track:g,id:m||0,groupId:v||"",stats:s,networkDetails:a,deliveryDirectives:E});break;case _e.SUBTITLE_TRACK:c.trigger(b.SUBTITLE_TRACK_LOADED,{details:e,track:g,id:m||0,groupId:v||"",stats:s,networkDetails:a,deliveryDirectives:E});break}}}class ii{static get version(){return Ra}static isMSESupported(){return sE()}static isSupported(){return a_()}static getMediaSource(){return Hs()}static get Events(){return b}static get MetadataSchema(){return ti}static get ErrorTypes(){return ye}static get ErrorDetails(){return H}static get DefaultConfig(){return ii.defaultConfig?ii.defaultConfig:q1}static set DefaultConfig(e){ii.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Ed,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=yA(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=Q1(ii.DefaultConfig,e,t);this.userConfig=e,s.progressive&&W1(s,t);const{abrController:r,bufferController:a,capLevelController:u,errorController:c,fpsController:h}=s,d=new c(this),g=this.abrController=new r(this),m=new db(this),v=s.interstitialsController,E=v?this.interstitialsController=new v(this,ii):null,S=this.bufferController=new a(this,m),x=this.capLevelController=new u(this),T=new h(this),L=new f_(this),_=s.contentSteeringController,I=_?new _(this):null,O=this.levelController=new r_(this,I),k=new s_(this),K=new c_(this.config,this.logger),w=this.streamController=new u_(this,m,K),B=this.gapController=new t_(this,m);x.setStreamController(w),T.setStreamController(w);const $=[L,O,w];E&&$.splice(1,0,E),I&&$.splice(1,0,I),this.networkControllers=$;const U=[g,S,B,x,T,k,m];this.audioTrackController=this.createController(s.audioTrackController,$);const W=s.audioStreamController;W&&$.push(this.audioStreamController=new W(this,m,K)),this.subtitleTrackController=this.createController(s.subtitleTrackController,$);const ne=s.subtitleStreamController;ne&&$.push(this.subtititleStreamController=new ne(this,m,K)),this.createController(s.timelineController,U),K.emeController=this.emeController=this.createController(s.emeController,U),this.cmcdController=this.createController(s.cmcdController,U),this.latencyController=this.createController(n_,U),this.coreComponents=U,$.push(d);const ce=d.onErrorOut;typeof ce=="function"&&this.on(b.ERROR,ce,d),this.on(b.MANIFEST_LOADED,L.onManifestLoaded,L)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,r){this._emitter.off(e,t,s,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const r=e===b.ERROR;this.trigger(b.ERROR,{type:ye.OTHER_ERROR,details:H.INTERNAL_EXCEPTION,fatal:r,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(b.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const a=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(b.ERROR,{type:ye.OTHER_ERROR,details:H.ATTACH_MEDIA_ERROR,fatal:!0,error:a});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,r=t?e:{media:s};this._media=s,this.trigger(b.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(b.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(b.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,r=this._url=od.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),t&&s&&(s!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(b.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),!(!this.started||!this.networkControllers));s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[ge.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[ge.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ge.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=t1()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){QA(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let r=0;r<s;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let r;if(t===-1&&e!=null&&e.length?r=e.length-1:r=t,s)for(let a=r;a--;){const u=e[a].attrs["HDCP-LEVEL"];if(u&&u<=s)return a}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const s=Hy(t);return Gy(e,s,navigator.mediaCapabilities)}}ii.defaultConfig=void 0;const d_=({src:l,autoPlay:e=!0,controls:t=!0})=>{const s=Q.useRef(null);return Q.useEffect(()=>{let r;return(()=>{if(s.current){const u=s.current;ii.isSupported()?(r=new ii({debug:!1,enableWorker:!0,lowLatencyMode:!0}),r.loadSource(l),r.attachMedia(u),r.on(ii.Events.MANIFEST_PARSED,()=>{e&&u.play().catch(c=>console.log("Autoplay prevented:",c))}),r.on(ii.Events.ERROR,(c,h)=>{if(h.fatal)switch(h.type){case ii.ErrorTypes.NETWORK_ERROR:console.error("fatal network error encountered, try to recover"),r.startLoad();break;case ii.ErrorTypes.MEDIA_ERROR:console.error("fatal media error encountered, try to recover"),r.recoverMediaError();break;default:r.destroy();break}})):u.canPlayType("application/vnd.apple.mpegurl")&&(u.src=l,u.addEventListener("loadedmetadata",()=>{e&&u.play().catch(c=>console.log("Autoplay prevented:",c))}))}})(),()=>{r&&r.destroy()}},[l,e]),R.jsx("video",{ref:s,controls:t,style:{width:"100%",height:"100%",objectFit:"contain",position:"absolute",top:0,left:0},playsInline:!0})},h_=({onFetch:l,isLoading:e,error:t})=>{const[s,r]=Q.useState(""),[a,u]=Q.useState(!1),c=()=>{s.trim()&&l(s.trim())},h=d=>{d.key==="Enter"&&c()};return R.jsx("section",{className:"hero",id:"home",children:R.jsxs("div",{className:"container",children:[R.jsx("h1",{children:"Best Free Video Downloader: YouTube, Facebook, TikTok"}),R.jsx("p",{children:"Download Videos from YouTube, Facebook, Instagram, TikTok & more in HD/4K"}),R.jsx("div",{className:"live-match-container mb-5 text-center",children:a?R.jsxs("div",{className:"live-player-wrapper mb-4",style:{position:"relative",width:"100%",maxWidth:"800px",margin:"0 auto",borderRadius:"15px",overflow:"hidden",boxShadow:"0 10px 40px rgba(0,0,0,0.6)",border:"2px solid #333"},children:[R.jsxs("div",{style:{padding:"12px 20px",backgroundColor:"#111",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #333"},children:[R.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[R.jsx("span",{className:"spinner-grow spinner-grow-sm text-danger",role:"status","aria-hidden":"true",style:{width:"0.8rem",height:"0.8rem"}}),R.jsx("span",{style:{color:"white",fontWeight:"bold",fontSize:"1.1rem"},children:"Star Sports - Live"})]}),R.jsxs("button",{onClick:()=>u(!1),className:"btn btn-sm btn-outline-light",style:{borderRadius:"50px",padding:"5px 15px"},children:[R.jsx("i",{className:"bi bi-x-lg me-1"})," Close Player"]})]}),R.jsx("div",{style:{width:"100%",paddingTop:"56.25%",position:"relative",backgroundColor:"black"},children:R.jsx(d_,{src:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",autoPlay:!0,controls:!0})})]}):R.jsxs("button",{onClick:()=>u(!0),className:"btn",style:{backgroundColor:"#ff0000",color:"white",fontWeight:"bold",borderRadius:"50px",padding:"12px 30px",fontSize:"1.2rem",boxShadow:"0 0 20px rgba(255, 0, 0, 0.6)",border:"2px solid white",display:"inline-flex",alignItems:"center",gap:"10px",textTransform:"uppercase",letterSpacing:"1px"},children:[R.jsx("span",{className:"spinner-grow spinner-grow-sm text-light",role:"status","aria-hidden":"true",style:{width:"1rem",height:"1rem"}}),"Watch Live: Star Sports"]})}),R.jsxs("div",{className:"url-input-container",children:[R.jsx("input",{type:"text",className:"form-control url-input",id:"videoUrl",placeholder:"Paste your video URL here (YouTube, Facebook, Instagram, TikTok, Vimeo...)",value:s,onChange:d=>r(d.target.value),onKeyPress:h,disabled:e}),R.jsx("button",{className:"btn btn-primary btn-fetch",onClick:c,disabled:e||!s.trim(),children:e?R.jsxs(R.Fragment,{children:[R.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Fetching..."]}):R.jsxs(R.Fragment,{children:[R.jsx("i",{className:"bi bi-search me-2"}),"Fetch Video"]})})]}),t&&R.jsxs("div",{className:"alert alert-danger alert-custom active",role:"alert",children:[R.jsx("i",{className:"bi bi-exclamation-triangle-fill me-2"}),R.jsx("span",{children:t})]}),R.jsxs("div",{className:"platforms",children:[R.jsx("div",{className:"platform-icon",style:{color:"#FF0000"},title:"YouTube",children:R.jsx("i",{className:"bi bi-youtube"})}),R.jsx("div",{className:"platform-icon",style:{color:"#1877F2"},title:"Facebook",children:R.jsx("i",{className:"bi bi-facebook"})}),R.jsx("div",{className:"platform-icon",style:{color:"#E4405F"},title:"Instagram",children:R.jsx("i",{className:"bi bi-instagram"})}),R.jsx("div",{className:"platform-icon",style:{color:"#000000"},title:"TikTok",children:R.jsx("i",{className:"bi bi-tiktok"})}),R.jsx("div",{className:"platform-icon",style:{color:"#1DA1F2"},title:"X (Twitter)",children:R.jsx("i",{className:"bi bi-twitter-x"})}),R.jsx("div",{className:"platform-icon",style:{color:"#1AB7EA"},title:"Vimeo",children:R.jsx("i",{className:"bi bi-vimeo"})}),R.jsx("div",{className:"platform-icon",style:{color:"#FF9900"},title:"Pornhub",children:R.jsx("span",{style:{fontSize:"1.2rem",fontWeight:900,fontFamily:"Arial, sans-serif",letterSpacing:"-1px"},children:"PH"})}),R.jsx("div",{className:"platform-icon",style:{color:"#E52B50"},title:"XVideos",children:R.jsx("span",{style:{fontSize:"1.2rem",fontWeight:900,fontFamily:"Arial, sans-serif",letterSpacing:"-1px"},children:"XV"})}),R.jsx("div",{className:"platform-icon",style:{color:"#E52B50"},title:"xHamster",children:R.jsx("span",{style:{fontSize:"1.1rem",fontWeight:900,fontFamily:"Arial, sans-serif"},children:"xH"})}),R.jsx("div",{className:"platform-icon",style:{color:"#0055A4"},title:"XNXX",children:R.jsx("span",{style:{fontSize:"0.9rem",fontWeight:900,fontFamily:"Arial, sans-serif"},children:"XNXX"})}),R.jsx("div",{className:"platform-icon",style:{color:"#00AFF0"},title:"OnlyFans",children:R.jsx("span",{style:{fontSize:"1.2rem",fontWeight:900,fontFamily:"Arial, sans-serif",letterSpacing:"-1px"},children:"OF"})})]})]})})},g_=({videoInfo:l,url:e,onDownload:t,isDownloading:s})=>{const[r,a]=Q.useState("720p"),[u,c]=Q.useState("mp4");Q.useEffect(()=>{u==="mp3"?a("audio"):r==="audio"&&a("720p")},[u]),Q.useEffect(()=>{r==="audio"?c("mp3"):u==="mp3"&&c("mp4")},[r]);const h=m=>{const v=Math.floor(m/60),E=m%60;return`${v}:${E.toString().padStart(2,"0")}`},g=(m=>m.includes("youtube")||m.includes("youtu.be")?"YouTube":m.includes("facebook")?"Facebook":m.includes("instagram")?"Instagram":m.includes("tiktok")?"TikTok":m.includes("twitter")||m.includes("x.com")?"X (Twitter)":m.includes("vimeo")?"Vimeo":"Unknown")(e);return R.jsx("section",{className:"preview-section active",id:"previewSection",children:R.jsx("div",{className:"container",children:R.jsx("div",{className:"preview-card",children:R.jsxs("div",{className:"row",children:[R.jsx("div",{className:"col-lg-5",children:R.jsx("img",{src:l.thumbnail,alt:l.title,className:"video-thumbnail"})}),R.jsx("div",{className:"col-lg-7",children:R.jsxs("div",{className:"video-info",children:[R.jsx("h4",{children:l.title}),R.jsxs("div",{className:"mb-3",children:[R.jsxs("span",{className:"platform-badge",children:[R.jsx("i",{className:"bi bi-play-circle me-1"}),g]}),l.duration>0&&R.jsxs("span",{className:"duration-badge",children:[R.jsx("i",{className:"bi bi-clock me-1"}),h(l.duration)]})]}),R.jsxs("div",{className:"download-options",children:[R.jsxs("div",{className:"row g-3",children:[R.jsxs("div",{className:"col-md-6",children:[R.jsx("label",{className:"form-label",children:"Quality"}),R.jsxs("select",{className:"form-select",value:r,onChange:m=>a(m.target.value),children:[R.jsx("option",{value:"1080p",children:"1080p (Full HD)"}),R.jsx("option",{value:"720p",children:"720p (HD)"}),R.jsx("option",{value:"480p",children:"480p (SD)"}),R.jsx("option",{value:"360p",children:"360p"}),R.jsx("option",{value:"audio",children:"Audio Only (MP3)"})]})]}),R.jsxs("div",{className:"col-md-6",children:[R.jsx("label",{className:"form-label",children:"Format"}),R.jsxs("select",{className:"form-select",value:u,onChange:m=>c(m.target.value),children:[R.jsx("option",{value:"mp4",children:"MP4 (Video)"}),R.jsx("option",{value:"mp3",children:"MP3 (Audio)"})]})]})]}),R.jsx("button",{className:"btn btn-success btn-download",onClick:()=>t(e,u,r),disabled:s,children:s?R.jsxs(R.Fragment,{children:[R.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Processing Download..."]}):R.jsxs(R.Fragment,{children:[R.jsx("i",{className:"bi bi-download me-2"}),"Download Video"]})}),s&&R.jsxs("div",{className:"progress-container active",children:[R.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[R.jsx("span",{className:"text-secondary",children:"Processing..."}),R.jsx("span",{className:"text-secondary",children:"Please wait"})]}),R.jsx("div",{className:"progress",children:R.jsx("div",{className:"progress-bar progress-bar-striped progress-bar-animated",role:"progressbar",style:{width:"100%"}})}),R.jsxs("div",{className:"mt-2 text-warning small",children:[R.jsx("i",{className:"bi bi-info-circle me-1"}),"Large videos may take a few minutes. Do not close this tab."]})]})]})]})})]})})})})},m_=()=>R.jsx("section",{className:"features",id:"features",children:R.jsxs("div",{className:"container",children:[R.jsx("h2",{className:"section-title",children:"Powerful Features"}),R.jsx("p",{className:"section-subtitle",children:"Everything you need to download videos from any platform"}),R.jsxs("div",{className:"row g-4",children:[R.jsx("div",{className:"col-lg-3 col-md-6",children:R.jsxs("div",{className:"feature-card",children:[R.jsx("div",{className:"feature-icon",children:R.jsx("i",{className:"bi bi-lightning-charge-fill"})}),R.jsx("h4",{children:"Fast Downloads"}),R.jsx("p",{children:"Lightning-fast download speeds with our optimized servers. Get your videos in seconds."})]})}),R.jsx("div",{className:"col-lg-3 col-md-6",children:R.jsxs("div",{className:"feature-card",children:[R.jsx("div",{className:"feature-icon",children:R.jsx("i",{className:"bi bi-grid-3x3-gap-fill"})}),R.jsx("h4",{children:"Multi-Platform"}),R.jsx("p",{children:"Support for YouTube, Facebook, Instagram, TikTok, Twitter, Vimeo, Pornhub, XVideos, xHamster, XNXX, OnlyFans and many more platforms."})]})}),R.jsx("div",{className:"col-lg-3 col-md-6",children:R.jsxs("div",{className:"feature-card",children:[R.jsx("div",{className:"feature-icon",children:R.jsx("i",{className:"bi bi-music-note-beamed"})}),R.jsx("h4",{children:"Audio Extraction"}),R.jsx("p",{children:"Extract audio from any video and download as MP3 with high quality preservation."})]})}),R.jsx("div",{className:"col-lg-3 col-md-6",children:R.jsxs("div",{className:"feature-card",children:[R.jsx("div",{className:"feature-icon",children:R.jsx("i",{className:"bi bi-badge-hd-fill"})}),R.jsx("h4",{children:"HD Quality"}),R.jsx("p",{children:"Download videos in up to 4K resolution. Choose from multiple quality options."})]})})]})]})}),p_=[{question:"How to download YouTube videos for free?",answer:"Simply paste the YouTube video URL into the search box above, click 'Fetch Video', choose your quality (MP4, MP3, 1080p, 4K), and click 'Download'. Done!"},{question:"What video formats does InfinityGrab support?",answer:"InfinityGrab supports MP4 video downloads up to 4K/2160p, 1080p, 720p, 480p, 360p, and MP3 audio extraction from any video."},{question:"Which platforms can I download videos from?",answer:"InfinityGrab supports YouTube, Facebook, Instagram, TikTok, Twitter/X, Vimeo, Pornhub, XVideos, xHamster, XNXX, OnlyFans, and hundreds of other platforms worldwide."},{question:"Is InfinityGrab free to use?",answer:"Yes! InfinityGrab is completely free. No registration, no subscription, no hidden fees. Just paste any video URL and download instantly."},{question:"Is it safe to use InfinityGrab?",answer:"Yes, InfinityGrab is 100% safe. We do not store your video files on our servers and do not require any personal information."},{question:"Can I download videos on mobile?",answer:"Absolutely! InfinityGrab works perfectly on all mobile browsers (iOS, Android) as well as desktop browsers on Windows and Mac."}],y_=()=>{const[l,e]=Q.useState(null);return R.jsx("section",{className:"faq-section",id:"faq","aria-label":"Frequently Asked Questions",children:R.jsxs("div",{className:"container",children:[R.jsx("h2",{className:"section-title",children:"Frequently Asked Questions"}),R.jsx("p",{className:"section-subtitle",children:"Everything you need to know about downloading videos with InfinityGrab"}),R.jsx("div",{className:"faq-list",children:p_.map((t,s)=>R.jsxs("div",{className:`faq-item${l===s?" open":""}`,onClick:()=>e(l===s?null:s),"aria-expanded":l===s,children:[R.jsxs("div",{className:"faq-question",children:[R.jsx("span",{children:t.question}),R.jsx("i",{className:`bi ${l===s?"bi-dash-lg":"bi-plus-lg"}`})]}),l===s&&R.jsx("div",{className:"faq-answer",children:R.jsx("p",{children:t.answer})})]},s))})]})})},v_=()=>R.jsx("footer",{className:"footer",children:R.jsxs("div",{className:"container",children:[R.jsxs("div",{className:"footer-brand",children:[R.jsx("img",{src:"/logo.png",alt:"InfinityGrab",width:"36",height:"36",className:"rounded-circle me-2"}),R.jsx("span",{children:"InfinityGrab"})]}),R.jsx("p",{className:"footer-tagline",children:"The fastest free video downloader for YouTube, Facebook, TikTok & more."}),R.jsxs("div",{className:"footer-links",children:[R.jsx(mi,{to:"/",children:"Home"}),R.jsx(mi,{to:"/about",children:"About"}),R.jsx(mi,{to:"/privacy",children:"Privacy Policy"}),R.jsx(mi,{to:"/terms",children:"Terms of Service"}),R.jsx(mi,{to:"/contact",children:"Contact"})]}),R.jsx("div",{className:"footer-disclaimer",children:R.jsx("p",{children:" InfinityGrab is intended for personal, non-commercial use only. Users are responsible for complying with applicable copyright laws. We do not host or store any video content."})}),R.jsxs("p",{className:"copyright",children:[" ",new Date().getFullYear()," InfinityGrab. All rights reserved. Made with  by Randidu Damsith"]})]})}),E_=()=>R.jsx("section",{className:"policy-section",id:"privacy",children:R.jsx("div",{className:"container",children:R.jsxs("div",{className:"policy-card",children:[R.jsx("h1",{className:"policy-title",children:"Privacy Policy"}),R.jsx("p",{className:"policy-date",children:"Last Updated: February 20, 2026"}),R.jsxs("div",{className:"policy-body",children:[R.jsx("h2",{children:"1. Introduction"}),R.jsxs("p",{children:["Welcome to ",R.jsx("strong",{children:"InfinityGrab"}),' ("we", "our", or "us"). We are committed to protecting your personal information and your right to privacy. This Privacy Policy explains how we collect, use, and share information about you when you use our website at ',R.jsx("a",{href:"https://infinitygrab.xyz",children:"infinitygrab.xyz"}),"."]}),R.jsx("h2",{children:"2. Information We Collect"}),R.jsx("p",{children:"We collect minimal information to provide you with the best experience:"}),R.jsxs("ul",{children:[R.jsxs("li",{children:[R.jsx("strong",{children:"Usage Data:"})," We collect anonymous usage statistics such as pages visited, time spent, and browser type via Google Analytics."]}),R.jsxs("li",{children:[R.jsx("strong",{children:"Log Data:"})," Our servers may log your IP address, browser type, and referring URLs for security and performance monitoring."]}),R.jsxs("li",{children:[R.jsx("strong",{children:"Cookies:"})," We use cookies and similar tracking technologies to improve your experience and serve relevant advertisements."]})]}),R.jsx("h2",{children:"3. How We Use Your Information"}),R.jsxs("ul",{children:[R.jsx("li",{children:"To operate and improve our services"}),R.jsx("li",{children:"To display relevant advertisements via Google AdSense"}),R.jsx("li",{children:"To analyze usage patterns and optimize performance"}),R.jsx("li",{children:"To ensure the security of our platform"})]}),R.jsx("h2",{children:"4. Google AdSense & Third-Party Advertising"}),R.jsxs("p",{children:["We use ",R.jsx("strong",{children:"Google AdSense"})," to display advertisements on our website. Google uses cookies to serve ads based on your prior visits to our site and other sites on the Internet. You can opt out of personalized advertising by visiting ",R.jsx("a",{href:"https://www.google.com/settings/ads",target:"_blank",rel:"noopener noreferrer",children:"Google Ads Settings"}),"."]}),R.jsxs("p",{children:["Google's use of advertising cookies enables it and its partners to serve ads based on your visit to our site and/or other sites on the Internet. More information on Google's privacy policy can be found at ",R.jsx("a",{href:"https://policies.google.com/privacy",target:"_blank",rel:"noopener noreferrer",children:"policies.google.com/privacy"}),"."]}),R.jsx("h2",{children:"5. Cookies Policy"}),R.jsx("p",{children:"Our website uses cookies to enhance your experience. Types of cookies we use:"}),R.jsxs("ul",{children:[R.jsxs("li",{children:[R.jsx("strong",{children:"Essential Cookies:"})," Required for the website to function properly"]}),R.jsxs("li",{children:[R.jsx("strong",{children:"Analytics Cookies:"})," Help us understand how visitors interact with our site"]}),R.jsxs("li",{children:[R.jsx("strong",{children:"Advertising Cookies:"})," Used by Google AdSense to serve personalized ads"]})]}),R.jsx("p",{children:"You can control cookies through your browser settings. Disabling cookies may affect some functionality of our website."}),R.jsx("h2",{children:"6. Data Retention"}),R.jsx("p",{children:"We do not store any videos you download through our service. Video files are processed in real-time and streamed directly to your device. We do not retain any video content on our servers."}),R.jsx("h2",{children:"7. Third-Party Links"}),R.jsx("p",{children:"Our website may contain links to third-party websites. We are not responsible for the privacy practices of these sites. We encourage you to review their privacy policies."}),R.jsx("h2",{children:"8. Children's Privacy"}),R.jsx("p",{children:"Our service is not directed to children under 13 years of age. We do not knowingly collect personal information from children under 13."}),R.jsx("h2",{children:"9. Your Rights"}),R.jsxs("p",{children:["You have the right to access, update, or delete your personal information. To exercise these rights, please contact us at ",R.jsx("a",{href:"mailto:privacy@infinitygrab.xyz",children:"privacy@infinitygrab.xyz"}),"."]}),R.jsx("h2",{children:"10. Changes to This Policy"}),R.jsx("p",{children:"We may update this Privacy Policy from time to time. We will notify you of any changes by posting the new Privacy Policy on this page with an updated date."}),R.jsx("h2",{children:"11. Contact Us"}),R.jsxs("p",{children:["If you have any questions about this Privacy Policy, please contact us at: ",R.jsx("a",{href:"mailto:privacy@infinitygrab.xyz",children:"privacy@infinitygrab.xyz"})]})]})]})})}),S_=()=>R.jsx("section",{className:"policy-section",id:"terms",children:R.jsx("div",{className:"container",children:R.jsxs("div",{className:"policy-card",children:[R.jsx("h1",{className:"policy-title",children:"Terms of Service"}),R.jsx("p",{className:"policy-date",children:"Last Updated: February 20, 2026"}),R.jsxs("div",{className:"policy-body",children:[R.jsx("h2",{children:"1. Acceptance of Terms"}),R.jsxs("p",{children:["By accessing and using ",R.jsx("strong",{children:"InfinityGrab"}),' ("Service") at ',R.jsx("a",{href:"https://infinitygrab.xyz",children:"infinitygrab.xyz"}),", you accept and agree to be bound by these Terms of Service. If you do not agree to these terms, please do not use our service."]}),R.jsx("h2",{children:"2. Description of Service"}),R.jsx("p",{children:"InfinityGrab is a free online tool that allows users to download publicly available videos from various platforms including YouTube, Facebook, Instagram, TikTok, and others for personal, non-commercial use."}),R.jsx("h2",{children:"3. Copyright & Intellectual Property Disclaimer"}),R.jsxs("div",{className:"disclaimer-box",children:[R.jsxs("p",{children:[" ",R.jsx("strong",{children:"IMPORTANT DISCLAIMER:"})," InfinityGrab is intended for downloading videos for ",R.jsx("strong",{children:"personal use only"}),". You are solely responsible for ensuring that your use of downloaded content complies with applicable copyright laws."]}),R.jsxs("ul",{children:[R.jsx("li",{children:"Do NOT download copyrighted content without permission from the copyright holder"}),R.jsx("li",{children:"Do NOT redistribute, sell, or publicly perform downloaded content"}),R.jsx("li",{children:"Only download content you have the right to download (e.g., your own videos, Creative Commons licensed content, or content explicitly allowed for download)"})]})]}),R.jsx("h2",{children:"4. Permitted Use"}),R.jsx("p",{children:"You may use InfinityGrab to:"}),R.jsxs("ul",{children:[R.jsx("li",{children:"Download your own videos for backup purposes"}),R.jsx("li",{children:"Download videos licensed under Creative Commons"}),R.jsx("li",{children:"Download content where you have explicit permission from the copyright holder"}),R.jsx("li",{children:"Download content for personal, offline viewing where permitted by the platform"})]}),R.jsx("h2",{children:"5. Prohibited Use"}),R.jsx("p",{children:"You may NOT use InfinityGrab to:"}),R.jsxs("ul",{children:[R.jsx("li",{children:"Download content in violation of any platform's Terms of Service"}),R.jsx("li",{children:"Download, distribute, or use copyrighted material without authorization"}),R.jsx("li",{children:"Use the service for commercial purposes without express written consent"}),R.jsx("li",{children:"Engage in any activity that is illegal or harmful"})]}),R.jsx("h2",{children:"6. Limitation of Liability"}),R.jsx("p",{children:'InfinityGrab is provided "as is" without any warranties. We shall not be liable for:'}),R.jsxs("ul",{children:[R.jsx("li",{children:"Any misuse of downloaded content by users"}),R.jsx("li",{children:"Service interruptions or technical issues"}),R.jsx("li",{children:"Any direct, indirect, or consequential damages arising from use of our service"})]}),R.jsx("h2",{children:"7. Third-Party Services"}),R.jsx("p",{children:"Our service uses third-party tools to facilitate downloads. We are not responsible for the availability or reliability of these third-party services."}),R.jsx("h2",{children:"8. Advertising"}),R.jsx("p",{children:"InfinityGrab displays advertisements served by Google AdSense. You agree to our use of Google AdSense as part of using our free service. These ads help us maintain and improve the service."}),R.jsx("h2",{children:"9. Changes to Terms"}),R.jsx("p",{children:"We reserve the right to modify these Terms of Service at any time. Changes will be effective immediately upon posting. Continued use of the service after changes constitutes acceptance of the new terms."}),R.jsx("h2",{children:"10. Termination"}),R.jsx("p",{children:"We reserve the right to terminate or restrict access to our service for any user who violates these Terms of Service."}),R.jsx("h2",{children:"11. Governing Law"}),R.jsx("p",{children:"These Terms shall be governed by and construed in accordance with applicable laws."}),R.jsx("h2",{children:"12. Contact"}),R.jsxs("p",{children:["For questions about these Terms, contact us: ",R.jsx("a",{href:"mailto:legal@infinitygrab.xyz",children:"legal@infinitygrab.xyz"})]})]})]})})}),T_=()=>R.jsx("section",{className:"policy-section",id:"about",children:R.jsx("div",{className:"container",children:R.jsxs("div",{className:"policy-card",children:[R.jsx("h1",{className:"policy-title",children:"About InfinityGrab"}),R.jsx("p",{className:"policy-date",children:"Your Trusted Free Video Downloader"}),R.jsxs("div",{className:"policy-body",children:[R.jsx("div",{className:"about-hero-text",children:R.jsx("p",{children:"InfinityGrab is a free, powerful, and easy-to-use online video downloader that lets you save videos from YouTube, Facebook, Instagram, TikTok, Twitter/X, Vimeo, and hundreds of other platforms  directly to your device."})}),R.jsx("h2",{children:"Our Mission"}),R.jsx("p",{children:"We believe everyone should have the ability to save and enjoy their favorite online videos offline  whether for travel, studying, or simply accessing content without an internet connection. InfinityGrab was built to make this process simple, fast, and completely free."}),R.jsx("h2",{children:"What Makes InfinityGrab Different?"}),R.jsxs("div",{className:"about-features-grid",children:[R.jsxs("div",{className:"about-feature",children:[R.jsx("span",{className:"about-icon",children:""}),R.jsx("h3",{children:"Lightning Fast"}),R.jsx("p",{children:"Our optimized backend processes video downloads in seconds. No waiting, no delays."})]}),R.jsxs("div",{className:"about-feature",children:[R.jsx("span",{className:"about-icon",children:""}),R.jsx("h3",{children:"Completely Free"}),R.jsx("p",{children:"No registration required. No subscription. No hidden fees. Download unlimited videos for free."})]}),R.jsxs("div",{className:"about-feature",children:[R.jsx("span",{className:"about-icon",children:""}),R.jsx("h3",{children:"Multiple Formats"}),R.jsx("p",{children:"Choose from MP4 video (360p to 4K) or MP3 audio. We support the formats you need."})]}),R.jsxs("div",{className:"about-feature",children:[R.jsx("span",{className:"about-icon",children:""}),R.jsx("h3",{children:"500+ Platforms"}),R.jsx("p",{children:"From YouTube to niche video sites  if it's online, InfinityGrab can likely download it."})]}),R.jsxs("div",{className:"about-feature",children:[R.jsx("span",{className:"about-icon",children:""}),R.jsx("h3",{children:"Safe & Private"}),R.jsx("p",{children:"We don't store your videos or personal data. Downloads are private and secure."})]}),R.jsxs("div",{className:"about-feature",children:[R.jsx("span",{className:"about-icon",children:""}),R.jsx("h3",{children:"Works Everywhere"}),R.jsx("p",{children:"Use InfinityGrab on your phone, tablet or desktop. No app installation required."})]})]}),R.jsx("h2",{children:"Technology"}),R.jsx("p",{children:"InfinityGrab is powered by cutting-edge technology including Python FastAPI backend, React frontend, and the industry-leading yt-dlp library for maximum compatibility with video platforms worldwide."}),R.jsx("h2",{children:"Responsible Use"}),R.jsxs("p",{children:["We built InfinityGrab for legal, personal use. Please respect copyright laws and only download content you have permission to download. See our ",R.jsx("a",{href:"/terms",children:"Terms of Service"})," for more details."]}),R.jsx("h2",{children:"Contact Us"}),R.jsx("p",{children:"Have a question or feedback? We'd love to hear from you!"}),R.jsxs("p",{children:[" ",R.jsx("a",{href:"mailto:hello@infinitygrab.xyz",children:"hello@infinitygrab.xyz"})]})]})]})})}),x_=()=>{const[l,e]=Q.useState({name:"",email:"",message:""}),[t,s]=Q.useState(!1),r=u=>{e({...l,[u.target.name]:u.target.value})},a=u=>{u.preventDefault(),s(!0)};return R.jsx("section",{className:"policy-section",id:"contact",children:R.jsx("div",{className:"container",children:R.jsxs("div",{className:"policy-card",style:{maxWidth:700,margin:"0 auto"},children:[R.jsx("h1",{className:"policy-title",children:"Contact Us"}),R.jsx("p",{className:"policy-date",children:"We'd love to hear from you!"}),R.jsxs("div",{className:"policy-body",children:[R.jsxs("div",{className:"contact-info-row",children:[R.jsxs("div",{className:"contact-info-item",children:[R.jsx("span",{children:""}),R.jsxs("div",{children:[R.jsx("strong",{children:"Email"}),R.jsx("p",{children:R.jsx("a",{href:"mailto:hello@infinitygrab.xyz",children:"hello@infinitygrab.xyz"})})]})]}),R.jsxs("div",{className:"contact-info-item",children:[R.jsx("span",{children:""}),R.jsxs("div",{children:[R.jsx("strong",{children:"Bug Reports"}),R.jsx("p",{children:R.jsx("a",{href:"mailto:support@infinitygrab.xyz",children:"support@infinitygrab.xyz"})})]})]}),R.jsxs("div",{className:"contact-info-item",children:[R.jsx("span",{children:""}),R.jsxs("div",{children:[R.jsx("strong",{children:"Legal / DMCA"}),R.jsx("p",{children:R.jsx("a",{href:"mailto:legal@infinitygrab.xyz",children:"legal@infinitygrab.xyz"})})]})]})]}),t?R.jsx("div",{className:"contact-success",children:" Thank you! We'll get back to you within 24 hours."}):R.jsxs("form",{onSubmit:a,className:"contact-form",children:[R.jsxs("div",{className:"mb-3",children:[R.jsx("label",{htmlFor:"name",className:"form-label",children:"Your Name"}),R.jsx("input",{type:"text",id:"name",name:"name",className:"form-control url-input",placeholder:"John Doe",value:l.name,onChange:r,required:!0})]}),R.jsxs("div",{className:"mb-3",children:[R.jsx("label",{htmlFor:"email",className:"form-label",children:"Email Address"}),R.jsx("input",{type:"email",id:"email",name:"email",className:"form-control url-input",placeholder:"john@example.com",value:l.email,onChange:r,required:!0})]}),R.jsxs("div",{className:"mb-4",children:[R.jsx("label",{htmlFor:"message",className:"form-label",children:"Message"}),R.jsx("textarea",{id:"message",name:"message",className:"form-control url-input",rows:5,placeholder:"Your message...",value:l.message,onChange:r,required:!0})]}),R.jsxs("button",{type:"submit",className:"btn btn-primary btn-fetch w-100",children:[R.jsx("i",{className:"bi bi-send me-2"}),"Send Message"]})]})]})]})})})},ly="";function A_(){const[l,e]=Q.useState(null),[t,s]=Q.useState(""),[r,a]=Q.useState(!1),[u,c]=Q.useState(null),[h,d]=Q.useState(!1),g=async v=>{a(!0),c(null),e(null),s(v);try{const E=await fetch(`${ly}/video/info`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:v})});if(!E.ok){const x=await E.text();try{const T=JSON.parse(x);throw new Error(T.detail||"Failed to fetch video info")}catch{throw new Error(x||"Failed to fetch video info")}}const S=await E.json();if(S.success&&S.data)e(S.data),setTimeout(()=>{const x=document.getElementById("previewSection");x&&x.scrollIntoView({behavior:"smooth"})},100);else throw new Error("Invalid response from server")}catch(E){c(E.message||"An error occurred while fetching video info")}finally{a(!1)}},m=(v,E,S)=>{d(!0);const x=new URLSearchParams({url:v,format:E});let T=S;T==="audio"&&(T=""),T&&x.append("quality",T),window.location.href=`${ly}/video/download_link?${x.toString()}`,setTimeout(()=>d(!1),5e3)};return R.jsxs("div",{className:"app-container",children:[R.jsx(h_,{onFetch:g,isLoading:r,error:u}),l&&R.jsx(g_,{videoInfo:l,url:t,onDownload:m,isDownloading:h}),R.jsx(m_,{}),R.jsx(y_,{})]})}function b_(){return R.jsxs(Zx,{children:[R.jsx(oA,{}),R.jsxs(Dx,{children:[R.jsx(or,{path:"/",element:R.jsx(A_,{})}),R.jsx(or,{path:"/privacy",element:R.jsx(E_,{})}),R.jsx(or,{path:"/terms",element:R.jsx(S_,{})}),R.jsx(or,{path:"/about",element:R.jsx(T_,{})}),R.jsx(or,{path:"/contact",element:R.jsx(x_,{})})]}),R.jsx(v_,{})]})}CT.createRoot(document.getElementById("root")).render(R.jsx(Q.StrictMode,{children:R.jsx(b_,{})}));
